[
  {
    "id" : "fcc553d4-1921-4a2c-a420-a08e6ac0f80d",
    "prId" : 25412,
    "prUrl" : "https://github.com/apache/spark/pull/25412#pullrequestreview-274032674",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "84ec9d5e-e638-4613-a216-dd2ed9f35a9e",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Could you add a corresponding Scala example, too?",
        "createdAt" : "2019-08-13T02:09:24Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "91d482efd10da9a2389dc631605ec6b7a7cbf7c7",
    "line" : 91,
    "diffHunk" : "@@ -1,1 +89,93 @@ */\n\npublic final class JavaDirectKerberizedKafkaWordCount {\n  private static final Pattern SPACE = Pattern.compile(\" \");\n"
  },
  {
    "id" : "034b5049-a409-4735-977b-8d0593282a3b",
    "prId" : 25412,
    "prUrl" : "https://github.com/apache/spark/pull/25412#pullrequestreview-275243767",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "parentId" : null,
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "`SASL_PLAINTEXT` is only for testing.\r\nEither I would use `SASL_SSL` or log a warning like `SASL_PLAINTEXT is only for testing...`.",
        "createdAt" : "2019-08-13T08:22:58Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "bdc7e663-f213-483a-9265-f02ac808e111",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "> `SASL_PLAINTEXT` is only for testing.\r\n> Either I would use `SASL_SSL` or log a warning like `SASL_PLAINTEXT is only for testing...`.\r\n\r\nAs headline said there are kerberized, usually, kerberos and `SASL_PLAINTEXT` work together",
        "createdAt" : "2019-08-13T09:17:03Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      },
      {
        "id" : "90385d9e-042e-4bed-a3be-f5f0ce377678",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "I'm not questioning whether `SASL_PLAINTEXT` works or not, it is. I'm telling that using kerberos on plain text channel is coming from evil from security perspective. Somehow we should tell the users it's not the advised way because credentials can be sniffed.",
        "createdAt" : "2019-08-13T10:47:34Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "a3a48371-6f8a-4442-bffd-38461270726b",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "> I'm not questioning whether `SASL_PLAINTEXT` works or not, it is. I'm telling that using kerberos on plain text channel is coming from evil from security perspective. Somehow we should tell the users it's not the advised way because credentials can be sniffed.\r\n\r\nI  agree it's not completely secure. It's just for testing, if only `SASL_PLAINTEXT` used. But, I don't think it's only for testing with kerbreos. \r\n@dongjoon-hyun @srowen @HyukjinKwon ,can you give some advice.",
        "createdAt" : "2019-08-14T02:29:45Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      },
      {
        "id" : "4142833f-c303-4adf-9f71-774bb15b6626",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I think you can just explain why `SASL_PLAINTEXT` is discouraged (SSL encryption is disabled and why it's dangerous) in a comment.",
        "createdAt" : "2019-08-14T03:21:51Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "a83ea63b-02cf-402f-92ba-6edb64e94599",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "As I understand it, `SASL_PLAINTEXT` is plaintext, we can get username password and other information easy. But with kerberos, can get location of keytab on server and principal only, you can't get keytab file. So, it's enough. \r\nSSL encryption and kerberos both cause loss of performance.",
        "createdAt" : "2019-08-14T07:24:17Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      },
      {
        "id" : "3c66abd5-7a42-4bca-a9b3-d576d20385be",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "> SSL encryption and kerberos both cause loss of performance.\r\n\r\nAs any kind of security solution in the world.\r\n",
        "createdAt" : "2019-08-14T08:41:36Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "680b3737-8ce8-4dd1-93e2-8dcc07be3f31",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "@hddong, the purpose of doing Kerberos is for security. If we want more performance over security, there's no point of using Kerberos.\r\n\r\nIt won't hurt to describe `SASL_PLAINTEXT` vs `SASL_SSL`. You can just say, for example:\r\nThis file uses `SASL_PLAINTEXT` for simplicity; however, `SASL_PLAINTEXT` has no SSL encryption and likely be less secure. Consider using `SASL_SSL`.\r\n\r\nFeel free to reword and rephrase it ^.",
        "createdAt" : "2019-08-14T09:11:30Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "954ae6f7-0423-4330-a145-fc8c71378587",
        "parentId" : "7ec0dc9f-6598-47cd-b13b-f7554d47c9da",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "> @hddong, the purpose of doing Kerberos is for security. If we want more performance over security, there's no point of using Kerberos.\r\n> \r\n> It won't hurt to describe `SASL_PLAINTEXT` vs `SASL_SSL`. You can just say, for example:\r\n> This file uses `SASL_PLAINTEXT` for simplicity; however, `SASL_PLAINTEXT` has no SSL encryption and likely be less secure. Consider using `SASL_SSL`.\r\n> \r\n> Feel free to reword and rephrase it ^.\r\n\r\nThanks, worried about my reading comprehension ability. I will add note for this file.",
        "createdAt" : "2019-08-15T03:05:43Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      }
    ],
    "commit" : "91d482efd10da9a2389dc631605ec6b7a7cbf7c7",
    "line" : 121,
    "diffHunk" : "@@ -1,1 +119,123 @@    kafkaParams.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n    kafkaParams.put(CommonClientConfigs.SECURITY_PROTOCOL_CONFIG,\n                                                  SecurityProtocol.SASL_PLAINTEXT.name);\n\n    // Create direct kafka stream with brokers and topics"
  },
  {
    "id" : "fe1a3c50-e0d1-4c6e-b9a1-190282fe78d5",
    "prId" : 25412,
    "prUrl" : "https://github.com/apache/spark/pull/25412#pullrequestreview-279499895",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c59dd4fe-3eee-444c-9ae1-5fa8e20c1c1d",
        "parentId" : null,
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "This works on sun JVMs, on IBM `com.ibm.security.auth.module.Krb5LoginModule` is needed.",
        "createdAt" : "2019-08-14T09:35:06Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "c7eb4094-a684-474e-9a59-74b6140ccebe",
        "parentId" : "c59dd4fe-3eee-444c-9ae1-5fa8e20c1c1d",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "> This works on sun JVMs, on IBM `com.ibm.security.auth.module.Krb5LoginModule` is needed.\r\n\r\nThanks for your remind.",
        "createdAt" : "2019-08-15T01:30:19Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      },
      {
        "id" : "8c500d2b-369d-4275-a04d-9a09c34b6b25",
        "parentId" : "c59dd4fe-3eee-444c-9ae1-5fa8e20c1c1d",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "This would be good to mention as a comment since users may not read this discussion.",
        "createdAt" : "2019-08-21T09:48:48Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "5ef5ff82-50f5-4aea-925e-323b9fe170cd",
        "parentId" : "c59dd4fe-3eee-444c-9ae1-5fa8e20c1c1d",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "> This would be good to mention as a comment since users may not read this discussion.\r\n\r\nYes, the comment will add.",
        "createdAt" : "2019-08-22T02:02:52Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      },
      {
        "id" : "7eb0760c-2394-4498-bcbe-00d311fa4b67",
        "parentId" : "c59dd4fe-3eee-444c-9ae1-5fa8e20c1c1d",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "OK, this can be resolved.",
        "createdAt" : "2019-08-26T09:47:33Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "91d482efd10da9a2389dc631605ec6b7a7cbf7c7",
    "line" : 72,
    "diffHunk" : "@@ -1,1 +70,74 @@ * kafka_jaas.conf can manually create, template as:\n *   KafkaClient {\n *     com.sun.security.auth.module.Krb5LoginModule required\n *     keyTab=\"./kafka.service.keytab\"\n *     useKeyTab=true"
  },
  {
    "id" : "6621bd80-eba2-4d0b-b560-bc1f7ec4a45f",
    "prId" : 25412,
    "prUrl" : "https://github.com/apache/spark/pull/25412#pullrequestreview-278154670",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7f956c4b-0695-4bee-a80c-d0a510e0abee",
        "parentId" : null,
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "If `--files` used for keytab and jaas file then both driver and executor can pick up the same jaas (in keytab file `./kafka.service.keytab` has to be set). Please see https://github.com/gaborgsomogyi/spark-structured-secure-kafka-app#spark-submit Is that not working somehow?\r\n",
        "createdAt" : "2019-08-21T09:56:30Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "f1ba1dc3-2300-4b17-b29c-12c13773dd3f",
        "parentId" : "7f956c4b-0695-4bee-a80c-d0a510e0abee",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "> If `--files` used for keytab and jaas file then both driver and executor can pick up the same jaas (in keytab file `./kafka.service.keytab` has to be set). Please see https://github.com/gaborgsomogyi/spark-structured-secure-kafka-app#spark-submit Is that not working somehow?\r\n\r\nI thought dirver can pick up the jaas, but it can't pick up files upload by `--files` after my test.\r\nIt can just work on cluster mode.",
        "createdAt" : "2019-08-22T01:48:50Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      }
    ],
    "commit" : "91d482efd10da9a2389dc631605ec6b7a7cbf7c7",
    "line" : 80,
    "diffHunk" : "@@ -1,1 +78,82 @@ *     principal=\"kafka/host@EXAMPLE.COM\";\n *   };\n * kafka_driver_jaas.conf (used by yarn client) and kafka_jaas.conf are basically the same\n * except for some differences at 'keyTab'. In kafka_driver_jaas.conf, 'keyTab' should be\n * \"${keytab_path}/kafka.service.keytab\"."
  },
  {
    "id" : "f7bf69fa-672d-4171-9be6-d67ee3eac2c1",
    "prId" : 25412,
    "prUrl" : "https://github.com/apache/spark/pull/25412#pullrequestreview-279501868",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f3588615-e339-4d18-8dc0-469da9748f4a",
        "parentId" : null,
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "2 questions:\r\n* Why is `krb5.conf` needed for cluster mode?\r\n* Why is `krb5.conf` not needed for client mode?\r\n",
        "createdAt" : "2019-08-21T09:57:40Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "8d3e6e8c-a7c0-4dee-90f4-a4b7e217093f",
        "parentId" : "f3588615-e339-4d18-8dc0-469da9748f4a",
        "authorId" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "body" : "@gaborgsomogyi , Client mode, driver run on client which usually has environment of kerberos, so it's not need. Cluster mode, driver run in a random executor which not contain\r\nkrb5.conf and it will throw exception:\r\n```\r\nCaused by: javax.security.auth.login.LoginException: Cannot locate KDC\r\n        at com.sun.security.auth.module.Krb5LoginModule.attemptAuthentication(Krb5LoginModule.java:804)\r\n        at com.sun.security.auth.module.Krb5LoginModule.login(Krb5LoginModule.java:617)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at javax.security.auth.login.LoginContext.invoke(LoginContext.java:755)\r\n        at javax.security.auth.login.LoginContext.access$000(LoginContext.java:195)\r\n        at javax.security.auth.login.LoginContext$4.run(LoginContext.java:682)\r\n        at javax.security.auth.login.LoginContext$4.run(LoginContext.java:680)\r\n        at java.security.AccessController.doPrivileged(Native Method)\r\n        at javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:680)\r\n        at javax.security.auth.login.LoginContext.login(LoginContext.java:587)\r\n        at org.apache.kafka.common.security.authenticator.AbstractLogin.login(AbstractLogin.java:60)\r\n        at org.apache.kafka.common.security.kerberos.KerberosLogin.login(KerberosLogin.java:103)\r\n        at org.apache.kafka.common.security.authenticator.LoginManager.<init>(LoginManager.java:64)\r\n        at org.apache.kafka.common.security.authenticator.LoginManager.acquireLoginManager(LoginManager.java:114)\r\n        at org.apache.kafka.common.network.SaslChannelBuilder.configure(SaslChannelBuilder.java:142)\r\n        ... 26 more\r\n```\r\nso , `krb5.conf` needed for cluster mode.",
        "createdAt" : "2019-08-22T01:32:12Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "24e25c90-3ce5-4e08-8d5c-5f5f5fbd2714",
        "tags" : [
        ]
      },
      {
        "id" : "b2003522-f68a-4a44-8ba2-798066fa096e",
        "parentId" : "f3588615-e339-4d18-8dc0-469da9748f4a",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "So, the cluster nodes are configured differently. That's a good explanation.",
        "createdAt" : "2019-08-26T09:53:47Z",
        "updatedAt" : "2019-08-27T06:13:06Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "91d482efd10da9a2389dc631605ec6b7a7cbf7c7",
    "line" : 63,
    "diffHunk" : "@@ -1,1 +61,65 @@ *      --driver-java-options \\\n *      \"-Djava.security.auth.login.config=./kafka_jaas.conf \\\n *      -Djava.security.krb5.conf=./krb5.conf\" \\\n *      --conf \\\n *      \"spark.executor.extraJavaOptions=-Djava.security.auth.login.config=./kafka_jaas.conf\" \\"
  }
]