[
  {
    "id" : "d3b597a1-f9d3-4e87-8474-ae29dfe3476c",
    "prId" : 28629,
    "prUrl" : "https://github.com/apache/spark/pull/28629#pullrequestreview-438915685",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ed5bff14-d055-41b6-a58d-636ce81c232a",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "I'm still worried about API inconsistency. We should use either `sc.setLocalProperties` or `MDC.put` for both driver and executor side MDC properties.",
        "createdAt" : "2020-06-29T04:42:58Z",
        "updatedAt" : "2020-06-29T04:42:58Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "a7f46279-5f21-4f0a-9677-0fd082465d1f",
        "parentId" : "ed5bff14-d055-41b6-a58d-636ce81c232a",
        "authorId" : "94b097d7-b786-4315-b54b-ee83105ebd0b",
        "body" : "@cloud-fan I think he is using `MDC.put` in both cases. The only difference is that for executor we also have to call `sc.setLocalProperties` in order to pass the property into the executor JVM. Once the executor process has knowledge of the appId or any other property, it is put into MDC the same way.",
        "createdAt" : "2020-06-29T05:20:14Z",
        "updatedAt" : "2020-06-29T05:20:14Z",
        "lastEditedBy" : "94b097d7-b786-4315-b54b-ee83105ebd0b",
        "tags" : [
        ]
      },
      {
        "id" : "4b9a9da5-051a-42b5-b586-fcce3cb7c9d1",
        "parentId" : "ed5bff14-d055-41b6-a58d-636ce81c232a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "I mean user-facing APIs. Eventually, we have to call `MDC.put` as this is how MDC works.\r\n\r\nMaybe it's better to say that Spark can propagate the MDC properties to both driver thread pools and executor tasks. So end-users only need to call `MDC.put`.",
        "createdAt" : "2020-06-29T06:18:00Z",
        "updatedAt" : "2020-06-29T06:18:00Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "6a8d737d-73f2-4f5b-ad36-c3c5c60420a1",
        "parentId" : "ed5bff14-d055-41b6-a58d-636ce81c232a",
        "authorId" : "d26e612c-2d3f-45a5-bb51-33e844905a11",
        "body" : "For the driver is true. for the Executor as it is in another process it should be called explicitly by the user.",
        "createdAt" : "2020-06-29T06:24:30Z",
        "updatedAt" : "2020-06-29T06:24:30Z",
        "lastEditedBy" : "d26e612c-2d3f-45a5-bb51-33e844905a11",
        "tags" : [
        ]
      },
      {
        "id" : "98ba6a30-f05e-4f27-bec1-5d33dd103fb6",
        "parentId" : "ed5bff14-d055-41b6-a58d-636ce81c232a",
        "authorId" : "94b097d7-b786-4315-b54b-ee83105ebd0b",
        "body" : "right. there is no way to make MDC put something in another process.",
        "createdAt" : "2020-06-29T06:26:39Z",
        "updatedAt" : "2020-06-29T06:26:39Z",
        "lastEditedBy" : "94b097d7-b786-4315-b54b-ee83105ebd0b",
        "tags" : [
        ]
      }
    ],
    "commit" : "cc8d522098440ed92ff8b8cf2c9d78ef464b4966",
    "line" : 12,
    "diffHunk" : "@@ -1,1 +34,38 @@  test(\"newDaemonSingleThreadExecutor with MDC\") {\n    val appIdValue = s\"appId-${System.currentTimeMillis()}\"\n    MDC.put(\"appId\", appIdValue)\n    val executor = ThreadUtils.newDaemonSingleThreadExecutor(\"this-is-a-thread-name\")\n    @volatile var appId = \"\""
  }
]