[
  {
    "id" : "b70542c0-7034-4915-a71d-5d8ccf23f40b",
    "prId" : 30573,
    "prUrl" : "https://github.com/apache/spark/pull/30573#pullrequestreview-554339146",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "parentId" : null,
        "authorId" : "3a227965-84e0-47cf-9974-11293764f028",
        "body" : "Hmm... executor metrics for each stage should be collected [here](https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/status/AppStatusListener.scala#L980).\r\nBut if the heartbeat interval from an executor is longer than lifetime of a stage, we can't collect the executor metrics for the stage.\r\nSo this change can be one option. What do you think @gengliangwang ?",
        "createdAt" : "2020-12-08T02:27:34Z",
        "updatedAt" : "2020-12-09T13:48:52Z",
        "lastEditedBy" : "3a227965-84e0-47cf-9974-11293764f028",
        "tags" : [
        ]
      },
      {
        "id" : "dce1aa5e-f281-4c97-a046-f2f0599ce457",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "We collect all data to choose the peak metrics. IMO,  more accuracy is better. \r\nBut I'm not particularly clear about the performance impact of this part, hope more suggestion.",
        "createdAt" : "2020-12-09T09:38:41Z",
        "updatedAt" : "2020-12-09T13:48:52Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "a128f94c-5d95-4363-a18d-fd236c968855",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "3a227965-84e0-47cf-9974-11293764f028",
        "body" : "@imback82 Do you have any concern about this change?",
        "createdAt" : "2020-12-11T06:55:56Z",
        "updatedAt" : "2020-12-11T06:55:56Z",
        "lastEditedBy" : "3a227965-84e0-47cf-9974-11293764f028",
        "tags" : [
        ]
      },
      {
        "id" : "e5baf57a-9d04-47fc-b792-ce9700299bc3",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "This seems fine to me if we need more accurate peak values.",
        "createdAt" : "2020-12-12T01:17:35Z",
        "updatedAt" : "2020-12-12T01:17:35Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "daba771a-4365-4487-8d42-cc5638e1d01f",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "It seems that the first metrics of `peakExecutorMetrics` become 0 instead of -1 after this. @AngersZhuuuu Do you know the reason?",
        "createdAt" : "2020-12-14T09:03:21Z",
        "updatedAt" : "2020-12-14T09:03:22Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      },
      {
        "id" : "1e285990-434b-4f2b-b3e5-1a907db0d21b",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> It seems that the first metrics of peakExecutorMetrics become 0 instead of -1 after this. @AngersZhuuuu Do you know the reason?\r\n\r\n`-1` is default peakExecutorMetrics, and with this change,  we will update this value with real task metrics, but why all is `0` depend on the metrics data...",
        "createdAt" : "2020-12-14T11:02:28Z",
        "updatedAt" : "2020-12-14T11:02:39Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "e4dd0fb6-fdf9-40b8-9736-a038dec4097d",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "3a227965-84e0-47cf-9974-11293764f028",
        "body" : "> It seems that the first metrics of peakExecutorMetrics become 0 instead of -1 after this. @AngersZhuuuu Do you know the reason?\r\n\r\n@gengliangwang \r\nBy this change, `peakExecutorMetrics` is updated not only `onExecutorMetricsUpdate` but also `onTaskEnd`.\r\nSo, the peak value carried by `SparkListenerTaskEnd` is `0`, the corresponding peak values in `peakExecutorMetrics` is set to `0`.\r\nDo you have any concern?",
        "createdAt" : "2020-12-17T06:46:29Z",
        "updatedAt" : "2020-12-17T06:46:35Z",
        "lastEditedBy" : "3a227965-84e0-47cf-9974-11293764f028",
        "tags" : [
        ]
      },
      {
        "id" : "f24afa75-9abc-46fd-96ab-a3c9ab3f5839",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "@sarutak No, I am ok with it :)",
        "createdAt" : "2020-12-17T07:22:43Z",
        "updatedAt" : "2020-12-17T07:22:44Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      },
      {
        "id" : "1e222b1f-23c6-4305-850b-90c16ff13e58",
        "parentId" : "22610016-bce3-40a8-8291-4bc59f7e3197",
        "authorId" : "3a227965-84e0-47cf-9974-11293764f028",
        "body" : "O.K, I'll merge later if there are no objections. Thanks for the response. @gengliangwang ",
        "createdAt" : "2020-12-17T07:32:05Z",
        "updatedAt" : "2020-12-17T07:32:06Z",
        "lastEditedBy" : "3a227965-84e0-47cf-9974-11293764f028",
        "tags" : [
        ]
      }
    ],
    "commit" : "c21be1157c2fe74aec075e4662aec13d0b66597c",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +690,694 @@\n      stage.executorSummary(event.taskInfo.executorId).peakExecutorMetrics\n        .compareAndUpdatePeakValues(event.taskExecutorMetrics)\n      // [SPARK-24415] Wait for all tasks to finish before removing stage from live list\n      val removeStage ="
  }
]