[
  {
    "id" : "6ba4d717-3a21-4702-b9fe-640b6ff49534",
    "prId" : 25612,
    "prUrl" : "https://github.com/apache/spark/pull/25612#pullrequestreview-282292093",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bf9edc55-6d1d-4f59-bd55-bd31cf4a6b17",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "After releasing keylock, if a new thread for the same broadcastId enters to put a new object before another queueing thread to check `lockMap.get(key) eq lock`,  both threads could get the keylock finally ?",
        "createdAt" : "2019-08-30T13:59:15Z",
        "updatedAt" : "2019-09-03T18:18:55Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "fe9d6e98-a76a-41a7-bd0c-e76c71e78cbb",
        "parentId" : "bf9edc55-6d1d-4f59-bd55-bd31cf4a6b17",
        "authorId" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "body" : "The thread inside this inner while loop will end, and will retry the outer while loop. The line `if (lock == null) return` is the only exit. When `acquireLock` returns, this thread has `putIfAbsent` a new object to `lockMap` successfully.",
        "createdAt" : "2019-08-30T17:21:54Z",
        "updatedAt" : "2019-09-03T18:18:55Z",
        "lastEditedBy" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "tags" : [
        ]
      },
      {
        "id" : "967216be-4157-4dc3-8154-521130dfa6aa",
        "parentId" : "bf9edc55-6d1d-4f59-bd55-bd31cf4a6b17",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Oh, I see.",
        "createdAt" : "2019-08-31T04:34:03Z",
        "updatedAt" : "2019-09-03T18:18:55Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "9b59ca2074f4b90a115b668a6b2c0a043e3475af",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +37,41 @@      if (lock == null) return\n      lock.synchronized {\n        while (lockMap.get(key) eq lock) {\n          lock.wait()\n        }"
  }
]