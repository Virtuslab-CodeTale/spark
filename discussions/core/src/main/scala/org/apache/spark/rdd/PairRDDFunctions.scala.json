[
  {
    "id" : "a1f940b0-97d0-4172-8f73-a24eb03ac7bc",
    "prId" : 27947,
    "prUrl" : "https://github.com/apache/spark/pull/27947#pullrequestreview-376683439",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "23baf697-937e-4b3c-9674-ca7eaa2202e5",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "this impl follows `combineByKeyWithClassTag` (treat as if `self.partitioner == Some(partitioner)`)\r\n```scala\r\ndef combineByKeyWithClassTag[C](\r\n      createCombiner: V => C,\r\n      mergeValue: (C, V) => C,\r\n      mergeCombiners: (C, C) => C,\r\n      partitioner: Partitioner,\r\n      mapSideCombine: Boolean = true,\r\n      serializer: Serializer = null)(implicit ct: ClassTag[C]): RDD[(K, C)] = self.withScope {\r\n    require(mergeCombiners != null, \"mergeCombiners must be defined\") // required as of Spark 0.9.0\r\n    if (keyClass.isArray) {\r\n      if (mapSideCombine) {\r\n        throw new SparkException(\"Cannot use map-side combining with array keys.\")\r\n      }\r\n      if (partitioner.isInstanceOf[HashPartitioner]) {\r\n        throw new SparkException(\"HashPartitioner cannot partition array keys.\")\r\n      }\r\n    }\r\n    val aggregator = new Aggregator[K, V, C](\r\n      self.context.clean(createCombiner),\r\n      self.context.clean(mergeValue),\r\n      self.context.clean(mergeCombiners))\r\n    if (self.partitioner == Some(partitioner)) {\r\n      self.mapPartitions(iter => {\r\n        val context = TaskContext.get()\r\n        new InterruptibleIterator(context, aggregator.combineValuesByKey(iter, context))\r\n      }, preservesPartitioning = true)\r\n    } else {\r\n      new ShuffledRDD[K, V, C](self, partitioner)\r\n        .setSerializer(serializer)\r\n        .setAggregator(aggregator)\r\n        .setMapSideCombine(mapSideCombine)\r\n    }\r\n  }\r\n```",
        "createdAt" : "2020-03-18T09:19:07Z",
        "updatedAt" : "2020-03-18T09:19:08Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "964b9f8c57eb11eac6326e49a1b42fe8e66dcab4",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +114,118 @@   * (Int, Int) into an RDD of type (Int, Seq[Int]).\n   */\n  def combineByKeyWithClassTagWithinPartitions[C](\n      createCombiner: V => C,\n      mergeValue: (C, V) => C,"
  }
]