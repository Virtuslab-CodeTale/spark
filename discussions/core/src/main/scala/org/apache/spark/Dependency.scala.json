[
  {
    "id" : "47a96a9d-542f-4c21-9c9d-450829ecf907",
    "prId" : 33034,
    "prUrl" : "https://github.com/apache/spark/pull/33034#pullrequestreview-719525854",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "parentId" : null,
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "Why are we resetting `mergeLocs` ?",
        "createdAt" : "2021-06-23T02:51:56Z",
        "updatedAt" : "2021-06-23T02:57:56Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      },
      {
        "id" : "7888bd1d-d5c5-43e0-9766-79a1df352d0e",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "body" : "Since we are anyway going to recompute the shuffle data in the case of indeterminate stage retries, we might as well fetch the latest merger locations right?",
        "createdAt" : "2021-06-23T06:06:44Z",
        "updatedAt" : "2021-06-23T06:06:44Z",
        "lastEditedBy" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "tags" : [
        ]
      },
      {
        "id" : "29027f8f-9aec-4af3-8864-4e833892dad1",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "Particularly in context of colocating mergers for coparents (for joins), it would result in churn, no ?",
        "createdAt" : "2021-06-23T18:29:05Z",
        "updatedAt" : "2021-06-23T18:29:05Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      },
      {
        "id" : "965b561f-a6c6-46ea-842e-43a10bf4c524",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "body" : "Since all the other subsequent stages are yet to be run or resubmitted again, we would reuse the mergers once it is fetched again right? Also if we are resubmitting due to fetch failure, then we wouldn't know how many nodes (or mergers) lost in that case reusing them can cause more pushed blocks not get merged right? In that case, isn't it better to just get new set of mergers?",
        "createdAt" : "2021-06-24T00:09:13Z",
        "updatedAt" : "2021-06-24T00:09:13Z",
        "lastEditedBy" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "tags" : [
        ]
      },
      {
        "id" : "19d62dfe-f8a2-4d50-b328-097849a4c7c6",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "For child stages, yes - not for sibling stages.",
        "createdAt" : "2021-06-28T02:54:06Z",
        "updatedAt" : "2021-06-28T02:54:27Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      },
      {
        "id" : "f544ee47-0e3a-4e7f-8b32-d794b62124dc",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "body" : "Do you feel we should reuse the same mergers? We are resetting only in the case of indeterminate stage and that too because there could have been failures we don't know if those merger locations are still valid or not which is why it is better to get the current active + additional mergers locations. Thoughts?",
        "createdAt" : "2021-07-21T19:43:40Z",
        "updatedAt" : "2021-07-21T19:43:40Z",
        "lastEditedBy" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "tags" : [
        ]
      },
      {
        "id" : "d3ca8f77-4f7f-440b-830c-8d3bc48675a6",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "+CC @Victsm who worked on colocating mergers.",
        "createdAt" : "2021-07-25T08:26:40Z",
        "updatedAt" : "2021-07-25T08:47:26Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      },
      {
        "id" : "2105c47f-4202-4d87-a94d-6bd32fd0458f",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "body" : "Since we are only doing this for indeterminate shuffles and for determinate shuffle anyway the retry of a stage will have push disabled. So this is fine for now. Also had a discussion offline with @mridulm on this one. If needed, we can revisit in the future.",
        "createdAt" : "2021-07-30T21:38:00Z",
        "updatedAt" : "2021-07-30T21:38:01Z",
        "lastEditedBy" : "4da55a4a-8a34-454a-9445-fb8101f62652",
        "tags" : [
        ]
      },
      {
        "id" : "edab95cd-1674-432b-8838-c6cc44ba95cb",
        "parentId" : "27030b7d-7582-45de-969f-591ad9d526a2",
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "Sounds good.",
        "createdAt" : "2021-07-31T00:23:12Z",
        "updatedAt" : "2021-07-31T00:23:12Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a43d1d0ccab25a5b790feaa9c74591abaeaca40",
    "line" : 50,
    "diffHunk" : "@@ -1,1 +159,163 @@  def newShuffleMergeState(): Unit = {\n    _shuffleMergedFinalized = false\n    mergerLocs = Nil\n    _shuffleMergeId += 1\n  }"
  },
  {
    "id" : "91e1fdb5-c6b6-457f-9317-7bf3356b7863",
    "prId" : 33034,
    "prUrl" : "https://github.com/apache/spark/pull/33034#pullrequestreview-712944463",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8b31f25b-130b-4b10-9606-6201cf140b64",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Log a warning for the case of barrier RDD?",
        "createdAt" : "2021-07-22T15:38:04Z",
        "updatedAt" : "2021-07-22T15:38:04Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "4a43d1d0ccab25a5b790feaa9c74591abaeaca40",
    "line" : 61,
    "diffHunk" : "@@ -1,1 +170,174 @@    isPushShuffleEnabled &&\n      // TODO: SPARK-35547: Push based shuffle is currently unsupported for Barrier stages\n      !rdd.isBarrier()\n  }\n"
  }
]