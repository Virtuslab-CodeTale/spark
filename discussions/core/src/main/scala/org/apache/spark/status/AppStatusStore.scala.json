[
  {
    "id" : "1189c1d8-8b0c-4761-b582-ba34ed647c1f",
    "prId" : 31611,
    "prUrl" : "https://github.com/apache/spark/pull/31611#pullrequestreview-618140420",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Do we need both params? doesn't this have summaries iff quantiles isn't empty?",
        "createdAt" : "2021-03-10T14:42:07Z",
        "updatedAt" : "2021-03-10T14:42:07Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "97414483-467f-4883-a589-d313cb75f992",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> Do we need both params? doesn't this have summaries iff quantiles isn't empty?\r\n\r\ntwo params is necessary, yea, we need a check if quantiles is empty, we apply a default value",
        "createdAt" : "2021-03-11T03:09:07Z",
        "updatedAt" : "2021-03-11T03:09:07Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "1bd1d2c7-8ed6-4c8a-a128-17169b19e036",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "I don't follow - when would say withSummaries be true and quantiles be empty for example? or when is it false while quantiles is non-empty?",
        "createdAt" : "2021-03-11T03:14:32Z",
        "updatedAt" : "2021-03-11T03:14:32Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "e4c53c47-82fa-4e80-a6b2-fae43dfed8f1",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> when would say withSummaries be true and quantiles be empty for example?\r\n```\r\n?withSummaries=true&quantiles=\r\n```\r\nMaybe this case,  I need to try and test, then update the code.\r\n\r\n> when is it false while quantiles is non-empty?\r\n\r\nWe just ignore this, since quantiles only effect when withSummaries=true",
        "createdAt" : "2021-03-11T03:27:09Z",
        "updatedAt" : "2021-03-11T03:27:09Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "4d01fca6-d702-4f1a-9007-c951ed7a7ccb",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "![image](https://user-images.githubusercontent.com/46485123/111254942-194ece00-8651-11eb-9428-1272bbb913af.png)\r\n\r\nWe  don't need to worry about `quantiles ` is empty since we will throw exception.  `BadParameterException `",
        "createdAt" : "2021-03-16T05:30:51Z",
        "updatedAt" : "2021-03-16T05:31:07Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "3bc5e2ff-48d9-4664-b8df-0b3e6a1b904b",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "OK, I'm still not sure why there are two parameters? sorry if I'm missing the obvious here.",
        "createdAt" : "2021-03-19T16:12:09Z",
        "updatedAt" : "2021-03-19T16:12:09Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "685a89c0-81ea-436b-a9f2-852dc9291b04",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> OK, I'm still not sure why there are two parameters? sorry if I'm missing the obvious here.\r\n\r\nYou mean `details` and `withSummaries`?  Since we add these parameter in restful path `api/v1/applications/[app-id]/stages`",
        "createdAt" : "2021-03-20T12:59:53Z",
        "updatedAt" : "2021-03-20T12:59:53Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "ef258410-a6ec-4c96-842f-85195c4210d6",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Right, but, why add two parameters to begin with? what are the possible values of withSummaries that aren't implied by the value of details?",
        "createdAt" : "2021-03-20T19:12:26Z",
        "updatedAt" : "2021-03-20T19:12:26Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "4891b117-4a2b-4335-a327-5f74f16d789b",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> Right, but, why add two parameters to begin with? what are the possible values of withSummaries that aren't implied by the value of details?\r\n\r\nHmm, one for metrics distribution summaries one for task details. They work in different ways and do not affect each other.\r\n\r\nAdd tow parameters have two concern.\r\n1. Some use may just want summaries metrics to get distribution and check data skew but don't want task details data.\r\n2. `details` parameter keeps consistence with origin.",
        "createdAt" : "2021-03-22T02:25:16Z",
        "updatedAt" : "2021-03-22T02:25:17Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "76045d70-a679-4a34-b49b-46b6f71285f9",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "OK I see it now, withSummaries causes more info to be returned",
        "createdAt" : "2021-03-22T14:26:21Z",
        "updatedAt" : "2021-03-22T14:26:21Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "5fb85e91-0460-4fbe-a337-4b965b06b7e6",
        "parentId" : "3e31ce27-f4db-4d8c-a021-d890a858a70d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> OK I see it now, withSummaries causes more info to be returned\r\n\r\nYea, return more summaries metrics in distribution. It's very useful.",
        "createdAt" : "2021-03-23T02:15:54Z",
        "updatedAt" : "2021-03-23T02:15:54Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      }
    ],
    "commit" : "22f85006551f34272c97c963a2879cfd47c0ad8e",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +117,121 @@    stageId: Int,\n    details: Boolean = false,\n    withSummaries: Boolean = false,\n    unsortedQuantiles: Array[Double] = Array.empty[Double]): Seq[v1.StageData] = {\n    store.view(classOf[StageDataWrapper]).index(\"stageId\").first(stageId).last(stageId)"
  },
  {
    "id" : "a123719d-667a-4561-8f24-1ea5819d7ca2",
    "prId" : 29082,
    "prUrl" : "https://github.com/apache/spark/pull/29082#pullrequestreview-456232829",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b840d8a6-f752-491c-a184-02ad12a8f624",
        "parentId" : null,
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "The method call taskList can be slow. It would be great if we avoid calling it twice for one stage page",
        "createdAt" : "2020-07-27T17:58:25Z",
        "updatedAt" : "2021-01-26T02:07:13Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      },
      {
        "id" : "f7aa0629-ca3d-4864-b02f-7d0f2568326c",
        "parentId" : "b840d8a6-f752-491c-a184-02ad12a8f624",
        "authorId" : "cf8c9534-0cf3-4aad-8ead-54c363cfa86e",
        "body" : "Cached result in store",
        "createdAt" : "2020-07-28T01:00:30Z",
        "updatedAt" : "2021-01-26T02:07:13Z",
        "lastEditedBy" : "cf8c9534-0cf3-4aad-8ead-54c363cfa86e",
        "tags" : [
        ]
      }
    ],
    "commit" : "769ce48b4f1500e65c9548e2bdc93d5c8e01079f",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +452,456 @@\n  def computeFailureSummary(stageId: Int, attemptId: Int): Seq[v1.FailureSummary] = {\n    val tasks = taskList(stageId, attemptId, Int.MaxValue)\n    tasks.filter(t => t.status.equalsIgnoreCase(\"failed\"))\n      .flatMap(t => t.failureReason)"
  },
  {
    "id" : "50438bcc-375a-4cb8-a08b-9701673ccaba",
    "prId" : 29082,
    "prUrl" : "https://github.com/apache/spark/pull/29082#pullrequestreview-532849992",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0c50e33f-6ce8-4839-a13b-72f040a1a782",
        "parentId" : null,
        "authorId" : "1a9f8688-cf0f-450f-98b0-de28f86ae603",
        "body" : "Drop use of tuple component accessors by using `values` on the grouped items?\r\n\r\n```\r\n.groupBy(e => (e.failureType, e.message))\r\n.values\r\n.map(t => new v1.FailureSummary(t.head, t.length))\r\n```",
        "createdAt" : "2020-11-17T22:02:50Z",
        "updatedAt" : "2021-01-26T02:07:13Z",
        "lastEditedBy" : "1a9f8688-cf0f-450f-98b0-de28f86ae603",
        "tags" : [
        ]
      }
    ],
    "commit" : "769ce48b4f1500e65c9548e2bdc93d5c8e01079f",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +455,459 @@    tasks.filter(t => t.status.equalsIgnoreCase(\"failed\"))\n      .flatMap(t => t.failureReason)\n      .groupBy(e => (e.failureType, e.message))\n      .values\n      .map(t => new v1.FailureSummary(t.head, t.length))"
  },
  {
    "id" : "a9006a47-a5c0-4f20-bf13-174b2cdaaa37",
    "prId" : 28769,
    "prUrl" : "https://github.com/apache/spark/pull/28769#pullrequestreview-428373840",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "47daa0a7-2f74-4b25-9eb5-85b8fa263d8c",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "(OFF-TOPIC, as my comment is for further PR, the change itself looks OK.)\r\n\r\n@srowen \r\nThis change shows the drawback if we fix the leak properly. I'm trying to implement at least `Iterable` to the `KVStoreIterator` so that `iterator().asScala` would work, but still require much more lines than before.\r\n\r\nI also see what you meant by toSeq - some callers don't materialize full list and still want to have stream, but then we can't apply the resource cleanup there. I'd say we cannot give up resource cleanup even for that case - looks like there's no choice but just materialize if it is not known to be a huge stream, otherwise just pass KVStoreIterator as a return and let caller deal with cleanup.\r\n\r\nDoes it make sense?",
        "createdAt" : "2020-06-10T19:31:26Z",
        "updatedAt" : "2020-06-14T03:10:06Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "8af3e637-10d4-455a-8744-b24e214635fd",
        "parentId" : "47daa0a7-2f74-4b25-9eb5-85b8fa263d8c",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "An Iterator shouldn't be Iterable, really... hm, what about explicitly draining the iterator to a Seq in the methods that call asScala, so we can manage the iterator lifecycle? \r\n\r\nAssuming there isn't much data there, materializing it could be fine. Or expose some other explicit method that returns the results from KVStore as a Seq, rather than just an iterator, if necessary.\r\n\r\nI still don't quite see how the iterator doesn't get closed; surely the .asScala wrapper has to evaluate all elements in the underlying iterator to produce the final filtered/mapped Seq. Hm. Maybe just being more explicit is better",
        "createdAt" : "2020-06-10T19:43:57Z",
        "updatedAt" : "2020-06-14T03:10:06Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      }
    ],
    "commit" : "9bcc084160021dd9a7dc1d573b787075016e9f01",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +40,44 @@    try {\n      // The ApplicationInfo may not be available when Spark is starting up.\n      Utils.tryWithResource(\n        store.view(classOf[ApplicationInfoWrapper])\n          .max(1)"
  }
]