[
  {
    "id" : "c88e5e3a-4306-45a3-a811-206850af7dde",
    "prId" : 30131,
    "prUrl" : "https://github.com/apache/spark/pull/30131#pullrequestreview-516486865",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "07c369e2-1fd6-4cfa-beb5-bec00893c36d",
        "parentId" : null,
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "Similar like make GC from rate to delay",
        "createdAt" : "2020-10-26T06:07:53Z",
        "updatedAt" : "2020-11-26T00:49:06Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      }
    ],
    "commit" : "5643ec267a339877c1004aae9e1ed8ae1f8f6cca",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +456,460 @@          forwardMessageScheduler.scheduleWithFixedDelay(\n            () => Utils.tryLogNonFatalError { self.send(WorkDirCleanup) },\n            CLEANUP_INTERVAL_MILLIS, CLEANUP_INTERVAL_MILLIS, TimeUnit.MILLISECONDS)\n        }\n"
  },
  {
    "id" : "403c6cab-a73a-4046-95b6-35e4f8284f4f",
    "prId" : 29817,
    "prUrl" : "https://github.com/apache/spark/pull/29817#pullrequestreview-499480390",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cfe3669e-b286-46db-b848-a52b1ebcba8e",
        "parentId" : null,
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "I think this might mean we return from handling the signal right away rather than waiting for decommissionSelf to be finished. Is this an intentional change?\r\n\r\nAlso this will no longer report a decommissioning failure by signal return value, so may block pod deletion or other cleanup task longer than needed.",
        "createdAt" : "2020-09-23T23:03:32Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "96a1e9a4-8301-4790-a5e5-85fccee2dd8c",
        "parentId" : "cfe3669e-b286-46db-b848-a52b1ebcba8e",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "This's Worker, I guess you cares more about the executor? In Worker, `decommissionSelf` always returns true. and In exeutor, there's a change to return false to fail the decommissionSelf but seems rarely happen. If you would insist on returning the value, I think we can use askSync instead.",
        "createdAt" : "2020-09-24T02:41:39Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "6d9167f8-32af-4137-91d8-4f50821b73d8",
        "parentId" : "cfe3669e-b286-46db-b848-a52b1ebcba8e",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "Can you look into what the difference of this behavior might cause at the system level and then tell me if that’s a desired change? I’m ok with us making changes here, I just want us to be intentional and know if we need to test the change and it seems like this change was incidental.",
        "createdAt" : "2020-09-24T16:06:51Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "e1793447-475b-4dd8-ac4b-8cb442d1e9a8",
        "parentId" : "cfe3669e-b286-46db-b848-a52b1ebcba8e",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "The return value of the signal handling decides whether we should forward the signal to the other handlers. If `true`, no other handlers will handle the `PWR` signal except ourselves. If `false`, we will handle it (for decommission) and other handlers will handle it too.  Do you expect other handlers to continue handling the `SIGPWR` when the system isn't really experiencing a power failure?\r\n",
        "createdAt" : "2020-09-28T08:25:54Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "f58e495c-7c8c-4e40-a6c1-b3d3082a005a",
        "parentId" : "cfe3669e-b286-46db-b848-a52b1ebcba8e",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "I do, I think if the signal is unhandled then the process will be killed immediately. If we think of decommissioning/graceful shut down I believe that behavior is desirable, since if we can't shut down gracefully the least we can do is exit quickly.",
        "createdAt" : "2020-09-29T01:23:09Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "0925e286-39e2-439e-8247-8161295c4dd5",
        "parentId" : "cfe3669e-b286-46db-b848-a52b1ebcba8e",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Updated, but please note that I only updated for the executor's case since Worker's case always returns `true` before.",
        "createdAt" : "2020-09-30T14:17:31Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "3c1e033089e392066425139d7ccb52cd501dcc31",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +72,76 @@    SignalUtils.register(\"PWR\", \"Failed to register SIGPWR handler - \" +\n      \"disabling worker decommission feature.\") {\n       self.send(WorkerSigPWRReceived)\n       true\n    }"
  },
  {
    "id" : "def2d478-f498-46a8-be63-418a842207c4",
    "prId" : 29817,
    "prUrl" : "https://github.com/apache/spark/pull/29817#pullrequestreview-506176394",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "89236fe7-e65e-4728-ac3b-cfb748d19560",
        "parentId" : null,
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "To make this code testable I'd move it down to inside of decommissionSelf and give decommissionSelf a param for if the decom originated locally.",
        "createdAt" : "2020-10-06T21:40:18Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "c706098f-4f3d-412a-9342-16033af2b22d",
        "parentId" : "89236fe7-e65e-4728-ac3b-cfb748d19560",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "I added the param previously but removed it later in order to keep `decommissionSelf` unchanged according to the comment: https://github.com/apache/spark/pull/29722#discussion_r487855223",
        "createdAt" : "2020-10-11T12:50:31Z",
        "updatedAt" : "2020-10-22T13:56:45Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "3c1e033089e392066425139d7ccb52cd501dcc31",
    "line" : 34,
    "diffHunk" : "@@ -1,1 +680,684 @@      // Tell the Master that we are starting decommissioning\n      // so it stops trying to launch executor/driver on us\n      sendToMaster(WorkerDecommissioning(workerId, self))\n  }\n"
  },
  {
    "id" : "9d44e30e-4b2a-4a29-96f2-c67ab1b6b818",
    "prId" : 29211,
    "prUrl" : "https://github.com/apache/spark/pull/29211#pullrequestreview-454598314",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "249bb028-af5e-426c-becc-ec59214e4c5d",
        "parentId" : null,
        "authorId" : "711a9ca0-8b90-435a-bf87-eb621aa1db13",
        "body" : "nit: Should this be DecommissionWorker ? That sounds more like a command to me. \r\n\r\nWhereas `WorkerDecommissioned` sounds like a state. ",
        "createdAt" : "2020-07-23T23:43:19Z",
        "updatedAt" : "2020-08-05T18:39:14Z",
        "lastEditedBy" : "711a9ca0-8b90-435a-bf87-eb621aa1db13",
        "tags" : [
        ]
      },
      {
        "id" : "04506eff-fc5e-407a-b205-d6a06e52cbbb",
        "parentId" : "249bb028-af5e-426c-becc-ec59214e4c5d",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "I don't have strong preferences (although this doesn't have `ed` at the end so I don't think it's implying a state).",
        "createdAt" : "2020-07-24T00:37:04Z",
        "updatedAt" : "2020-08-05T18:39:14Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "c87e28da-3b64-4ec8-a15b-fec736dd8c05",
        "parentId" : "249bb028-af5e-426c-becc-ec59214e4c5d",
        "authorId" : "711a9ca0-8b90-435a-bf87-eb621aa1db13",
        "body" : "Most other command messages start with a verb, while the 'state updated' ones are in past tense. So I think we should rename this to DecommissionWorker to match that.",
        "createdAt" : "2020-07-24T01:54:39Z",
        "updatedAt" : "2020-08-05T18:39:14Z",
        "lastEditedBy" : "711a9ca0-8b90-435a-bf87-eb621aa1db13",
        "tags" : [
        ]
      }
    ],
    "commit" : "e81c3fc2d0b8c28cd0aedf08a7ea1e86a153ae49",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +669,673 @@      maybeCleanupApplication(id)\n\n    case WorkerDecommission(_, _) =>\n      decommissionSelf()\n  }"
  },
  {
    "id" : "bc07e2ec-6576-4afa-b1f8-ca32117d2723",
    "prId" : 25047,
    "prUrl" : "https://github.com/apache/spark/pull/25047#pullrequestreview-257814751",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a3c2e834-1e31-4dbe-92df-5bdaf146a6b0",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "~Ur, is it the same? `Utils.createDirectory` seems to work differently from `workDir.mkdirs()`.~\r\n~Or, do we need to change the current behavior of `createWorkDir` fo this PR?~\r\nOops. I realized that this is a newly added function [here in this PR](https://github.com/apache/spark/pull/25047/files#diff-d239aee594001f8391676e1047a0381eR275).\r\nI was confused because this overloaded the existing one. Only parameters are different.",
        "createdAt" : "2019-07-04T03:34:20Z",
        "updatedAt" : "2019-08-09T02:27:37Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "15a9897131f06ec115b13d97e86c497ef36dace8",
    "line" : 63,
    "diffHunk" : "@@ -1,1 +192,196 @@  private def createWorkDir() {\n    workDir = Option(workDirPath).map(new File(_)).getOrElse(new File(sparkHome, \"work\"))\n    if (!Utils.createDirectory(workDir)) {\n      System.exit(1)\n    }"
  },
  {
    "id" : "fcf2bd0d-3eb3-47b5-9c60-93b86d497334",
    "prId" : 24569,
    "prUrl" : "https://github.com/apache/spark/pull/24569#pullrequestreview-237175977",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d702521c-f27a-4d85-8788-7d718ba72339",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "would be good to include the possible reasons for this case, so that end users know what's going on.",
        "createdAt" : "2019-05-14T10:52:20Z",
        "updatedAt" : "2019-05-27T16:16:39Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "98e8accf-3803-434e-abd9-daba6285697e",
        "parentId" : "d702521c-f27a-4d85-8788-7d718ba72339",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Good idea, I'll update it.",
        "createdAt" : "2019-05-14T11:13:28Z",
        "updatedAt" : "2019-05-27T16:16:39Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "c77f1406f2403f2958f587c445e6b04e379e5405",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +405,409 @@        // SPARK-23191 for more details.\n        if (duplicate) {\n          logWarning(s\"Duplicate registration at master $preferredMasterAddress\")\n        }\n"
  }
]