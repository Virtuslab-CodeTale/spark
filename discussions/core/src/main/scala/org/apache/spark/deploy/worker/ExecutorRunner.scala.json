[
  {
    "id" : "8fdc3905-dddf-411a-97af-61b921b4c849",
    "prId" : 33263,
    "prUrl" : "https://github.com/apache/spark/pull/33263#pullrequestreview-707958875",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b18e8949-4ee6-4f25-bca2-d95d4341dbe2",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "what about we wait both threads to finish first by `stderrAppender.awaitTermination()`, close the input streams, and call `Process.waitFor`?",
        "createdAt" : "2021-07-12T04:17:08Z",
        "updatedAt" : "2021-07-12T04:17:09Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "548f6976-cff2-49b4-8b7c-4d53f2550025",
        "parentId" : "b18e8949-4ee6-4f25-bca2-d95d4341dbe2",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "or I think you can add one more method in `FileAppender` that sets a bool variable (like `markedForStop` and `stop`).",
        "createdAt" : "2021-07-12T04:30:45Z",
        "updatedAt" : "2021-07-12T04:30:45Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "d31dd219-4282-499d-a3ba-127cb034b91c",
        "parentId" : "b18e8949-4ee6-4f25-bca2-d95d4341dbe2",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "That will make the changes minimised.",
        "createdAt" : "2021-07-12T04:30:52Z",
        "updatedAt" : "2021-07-12T04:30:52Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "6db6038f-df29-4dd5-9e8d-e6417a1e5697",
        "parentId" : "b18e8949-4ee6-4f25-bca2-d95d4341dbe2",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Would waiting for termination possibly make it hang? same with a boolean flag. I think it maybe needs forcibly closing",
        "createdAt" : "2021-07-13T13:10:30Z",
        "updatedAt" : "2021-07-13T13:10:30Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "7fcba98c-142a-43c5-a0d6-51c933b8e2ac",
        "parentId" : "b18e8949-4ee6-4f25-bca2-d95d4341dbe2",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Yeah, if we're worried, that's fine on that approach.\r\n\r\n> I think you can add one more method in FileAppender that sets a bool variable (like markedForStop and stop).\r\n\r\nwhat about this though? this will minimize the changes",
        "createdAt" : "2021-07-14T03:04:43Z",
        "updatedAt" : "2021-07-14T03:04:43Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "11889fac-2e33-4727-8967-d0220f166478",
        "parentId" : "b18e8949-4ee6-4f25-bca2-d95d4341dbe2",
        "authorId" : "2e76a6ea-a54e-4828-a8af-dee876682473",
        "body" : "Would that make the invoking complicate? \r\nOn the other hand, if the constructor and \"set bool variable\" in two statements, there is still a chance that the inputStream would not been closed: the consume thread is started in construtor, if the thread exited immediately due some error, the inputStream may not close since the \"set bool variable\" may not called at that time. ",
        "createdAt" : "2021-07-16T02:30:49Z",
        "updatedAt" : "2021-07-16T02:30:49Z",
        "lastEditedBy" : "2e76a6ea-a54e-4828-a8af-dee876682473",
        "tags" : [
        ]
      },
      {
        "id" : "92c84d83-2250-4efc-982e-08df2f94bfd5",
        "parentId" : "b18e8949-4ee6-4f25-bca2-d95d4341dbe2",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Hm, okie. I am fine",
        "createdAt" : "2021-07-16T02:37:46Z",
        "updatedAt" : "2021-07-16T02:37:46Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "955d24651aa0af33bc317526411cf2a3f5116f0e",
    "line" : 10,
    "diffHunk" : "@@ -1,1 +190,194 @@      val stderr = new File(executorDir, \"stderr\")\n      Files.write(header, stderr, StandardCharsets.UTF_8)\n      stderrAppender = FileAppender(process.getErrorStream, stderr, conf, true)\n\n      state = ExecutorState.RUNNING"
  }
]