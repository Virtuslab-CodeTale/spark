[
  {
    "id" : "29a24d12-5814-4c72-9b4d-187dca12237a",
    "prId" : 31774,
    "prUrl" : "https://github.com/apache/spark/pull/31774#pullrequestreview-616646722",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6396aa66-0b90-40fe-a624-c5fe1b9e2dbd",
        "parentId" : null,
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "BTW, have you tested the code changes for Spark UI behind proxy and Spark UI of History server?",
        "createdAt" : "2021-03-19T17:36:01Z",
        "updatedAt" : "2021-03-19T17:36:01Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      }
    ],
    "commit" : "14bd9b2ab3ab179b4edc7f26514f6946eacb6774",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +99,103 @@      return;\n    } else {\n      var words = document.baseURI.split('/');\n      var ind = words.indexOf(\"proxy\");\n      if (ind > 0) {"
  },
  {
    "id" : "e499697b-0538-48fe-9eaa-2e83eb1bbc7c",
    "prId" : 30030,
    "prUrl" : "https://github.com/apache/spark/pull/30030#pullrequestreview-513477072",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8b950edb-d6fa-499d-92fb-e443b821dc98",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Okay. We already prevent `-Infinity` at `Math.log(0)`. It looks safe if we prevent `NaN` at `Math.log(-1)`.",
        "createdAt" : "2020-10-13T16:26:04Z",
        "updatedAt" : "2020-10-13T16:26:05Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "4d29d18b-0caf-49b2-adf0-4fc1bb0ce803",
        "parentId" : "8b950edb-d6fa-499d-92fb-e443b821dc98",
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "@akiyamaneko  Thanks for the fix!\r\nBTW, when will the `bytes` be negative here? ",
        "createdAt" : "2020-10-13T16:32:38Z",
        "updatedAt" : "2020-10-13T16:32:38Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      },
      {
        "id" : "3d108445-c917-4b6a-9df4-34e9c6e28b43",
        "parentId" : "8b950edb-d6fa-499d-92fb-e443b821dc98",
        "authorId" : "b81be73a-4737-4677-82f4-098034b8df5d",
        "body" : "@gengliangwang sorry for the delay,I had tried to reproduce the problem \r\nWhen many tasks  failed  in a  stage,  the `shuffleTotalReads` metric can be -1L sometime([storeTypes.scala](https://github.com/apache/spark/blob/46ad325e56abd95c0ffdbe64aad78582da8c725d/core/src/main/scala/org/apache/spark/status/storeTypes.scala#L344))\r\n\r\nthe code: [AppStatusStore#taskSummary](https://github.com/apache/spark/blob/46ad325e56abd95c0ffdbe64aad78582da8c725d/core/src/main/scala/org/apache/spark/status/AppStatusStore.scala#L165) may has bug, It doesn't consider negative values: [AppStatusStore.toValues](https://github.com/apache/spark/blob/46ad325e56abd95c0ffdbe64aad78582da8c725d/core/src/main/scala/org/apache/spark/status/AppStatusStore.scala#L206) and [AppStatusStore.scanTasks](https://github.com/apache/spark/blob/46ad325e56abd95c0ffdbe64aad78582da8c725d/core/src/main/scala/org/apache/spark/status/AppStatusStore.scala#L267)\r\n\r\nDo you think is it necessary to ensure the non-negative metric value ? \r\nI have found the restAPI:`http://host:18081/api/v1/applications/application_Id/stages/stageId/attemptId/taskSummary` sometimes return negative metrics values like `shuffleReadMetrics.readBytes`, `totalBlocksFetched`.\r\n\r\n\r\n\r\n",
        "createdAt" : "2020-10-20T18:29:20Z",
        "updatedAt" : "2020-10-20T18:29:47Z",
        "lastEditedBy" : "b81be73a-4737-4677-82f4-098034b8df5d",
        "tags" : [
        ]
      },
      {
        "id" : "addf0b86-8ae5-414a-b229-e787f671e0cd",
        "parentId" : "8b950edb-d6fa-499d-92fb-e443b821dc98",
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "@akiyamaneko It seems that the negative value is made on purpose to represent that there is no such metrics. I think it's fine for now since there are no complaints about this.",
        "createdAt" : "2020-10-21T09:23:08Z",
        "updatedAt" : "2020-10-21T09:23:08Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      }
    ],
    "commit" : "41afac5712c46cf57d289e39a983197c4cb3ae52",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +40,44 @@function formatBytes(bytes, type) {\n    if (type !== 'display') return bytes;\n    if (bytes <= 0) return '0.0 B';\n    var k = 1024;\n    var dm = 1;"
  }
]