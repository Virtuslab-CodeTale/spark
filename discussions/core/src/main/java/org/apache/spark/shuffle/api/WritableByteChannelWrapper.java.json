[
  {
    "id" : "0a1861a8-b799-4d33-ba34-c763b13b7599",
    "prId" : 25007,
    "prUrl" : "https://github.com/apache/spark/pull/25007#pullrequestreview-270428115",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7f71c0c3-bce3-4fbc-ae47-13fed8ee4c14",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "why do we only need a wrapper for `WritableByteChannel`, but not `OutputStream`?",
        "createdAt" : "2019-08-02T15:54:45Z",
        "updatedAt" : "2019-08-02T15:54:45Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "486b961c-510a-4f9c-a433-598c3bc7cb86",
        "parentId" : "7f71c0c3-bce3-4fbc-ae47-13fed8ee4c14",
        "authorId" : "806aa501-9ea7-4cec-b017-a84d9a1602d8",
        "body" : "We need to return the `FileChannel` object directly to the caller, because `FileChannel#transfer[from|to]` checks `instanceof` on the argument channel to transfer to/from in order to decide to optimize via zero-memory copy. Extending `FileChannel` is nearly impossible since it's an internal JDK abstract class with a lot of methods. But if we return the `FileChannel`, we have no way to shield the channel from being closed so that we can share the same channel resource across partitions.\r\n\r\nThis has come up in https://github.com/apache/spark/pull/25007#discussion_r306936154 and https://github.com/palantir/spark/pull/535 and especially https://github.com/palantir/spark/pull/535#discussion_r280193123. Given that this has come up as a question a number of times, I wonder if there's a better way we can make the semantics more accessible. I don't see a way to improve the architecture itself, but perhaps better documentation in the right places explaining why we went about this the way we did is warranted.",
        "createdAt" : "2019-08-02T23:17:23Z",
        "updatedAt" : "2019-08-02T23:17:24Z",
        "lastEditedBy" : "806aa501-9ea7-4cec-b017-a84d9a1602d8",
        "tags" : [
        ]
      }
    ],
    "commit" : "7dceec971784049442ec3d4cb71ddaa225e1e21f",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +34,38 @@ */\n@Private\npublic interface WritableByteChannelWrapper extends Closeable {\n\n  /**"
  }
]