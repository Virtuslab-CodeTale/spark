[
  {
    "id" : "aea62af0-4dbe-44df-aac8-68a4af46aaa1",
    "prId" : 31985,
    "prUrl" : "https://github.com/apache/spark/pull/31985#pullrequestreview-622847117",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "05bf0ace-7d31-47c6-9f1c-014b609b28d8",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "Old `interceptsRStd` did not equal to GLMNET's result: [-0.69265374, -0.2260274, 0.9186811], so I think this should be a good change",
        "createdAt" : "2021-03-29T03:39:02Z",
        "updatedAt" : "2021-03-29T03:59:04Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "461d1110da71d504780f5a1f7db07fceaf597938",
    "line" : 68,
    "diffHunk" : "@@ -1,1 +1885,1889 @@      -0.1144333, 0.3204703, -0.1621061, -0.2308192,\n      0.0, -0.4832131, 0.0, 0.0), isTransposed = true)\n    val interceptsRStd = Vectors.dense(-0.69265374, -0.2260274, 0.9186811)\n    val coefficientsR = new DenseMatrix(3, 4, Array(\n      0.0, 0.0, 0.01641412, 0.03570376,"
  },
  {
    "id" : "ee992bde-357f-444a-8102-53abff184559",
    "prId" : 31985,
    "prUrl" : "https://github.com/apache/spark/pull/31985#pullrequestreview-622847656",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2403ee8b-929f-420a-ba45-9deeb0b93b79",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "master does not pass this newly add testsuite:\r\n\r\n```\r\n    // scalastyle:off println\r\n    println(\"R\")\r\n    println(interceptsR)\r\n    println(coefficientsR)\r\n\r\n    println()\r\n    println(\"model1\")\r\n    println(model1.interceptVector)\r\n    println(model1.coefficientMatrix)\r\n\r\n    println()\r\n    println(\"model2\")\r\n    println(model2.interceptVector)\r\n    println(model2.coefficientMatrix)\r\n\r\n    println()\r\n    println(\"R2\")\r\n    println(interceptsR2)\r\n    println(coefficientsR2)\r\n\r\n    println()\r\n    println(\"model3\")\r\n    println(model3.interceptVector)\r\n    println(model3.coefficientMatrix)\r\n    // scalastyle:on println\r\n```\r\n\r\n\r\n\r\n\r\nthis PR:\r\n```\r\nR\r\n[2.91748298,-17.510746,14.59326301]\r\n0.21755977  0.01647541   0.16507778  -0.1401668   \r\n-0.24436    0.7564655    -0.2955698  1.3262009    \r\n0.02680026  -0.77294095  0.13049206  -1.18603411  \r\nmodel1\r\n[2.933958199942738,-17.543164024163175,14.609205824220437]\r\n0.21812136899052606   0.015486127035160564  0.16560717317181253  -0.14189621394905397  \r\n-0.2454895541210769   0.7584152697648037    -0.2966285999752721  1.3296192946128171    \r\n0.027368185130550855  -0.7739013967999642   0.13102142680345957  -1.187723080663763    \r\nmodel2\r\n[2.933958199942738,-17.543164024163175,14.609205824220437]\r\n0.21812136899052606   0.015486127035160564  0.16560717317181253  -0.14189621394905397  \r\n-0.2454895541210769   0.7584152697648037    -0.2966285999752721  1.3296192946128171    \r\n0.027368185130550855  -0.7739013967999642   0.13102142680345957  -1.187723080663763    \r\n\r\nR2\r\n[1.751626027,-3.9297124987,2.178086472]\r\n0.019970169   0.079611293   0.003959452   0.110024399   \r\n-4.788494E-4  0.0010097453  -5.832701E-4  0.0           \r\n-0.01936999   -0.080851149  -0.003319687  -0.112435972  \r\nmodel3\r\n[1.7516587309368687,-3.9297178332916585,2.1780591023547897]\r\n0.019968543900064605    0.07960456424549685    0.0039592584764418055   0.11002491382872195  \r\n-4.7805989516075794E-4  0.0010124410611496804  -5.830912612961964E-4   0.0                  \r\n-0.01936890596857533    -0.08084716280475213   -0.0033195486718121834  -0.1124344396230352  \r\n```\r\n\r\n\r\n\r\n\r\n\r\nmaster:\r\n```\r\nR\r\n[2.91748298,-17.510746,14.59326301]\r\n0.21755977  0.01647541   0.16507778  -0.1401668   \r\n-0.24436    0.7564655    -0.2955698  1.3262009    \r\n0.02680026  -0.77294095  0.13049206  -1.18603411  \r\nmodel1\r\n[3.2289115796175536,-3.8874667667006286,0.6585551870830749]\r\n0.21614280080869921   0.010853354751576538  0.16526956599746928  -0.16826299113708829  \r\n-0.24226138413980347  0.766137782321547     -0.2961105375461299  -0.01353727702893284  \r\n0.02611858333110428   -0.7769911370731234   0.13084097154866067  0.18180026816602116   \r\nmodel2\r\n[3.2289115795385817,-3.8874667667014213,0.65855518716284]\r\n0.216142800347921     0.01085335149421333  0.1652695665789533   -0.16826299025797364   \r\n-0.24226138429694594  0.7661377826486023   -0.2961105377075671  -0.013537276769415511  \r\n0.026118583949024932  -0.7769911341428156  0.13084097112861381  0.18180026702738916    \r\n\r\n\r\nR2\r\n[1.751626027,-3.9297124987,2.178086472]\r\n0.019970169   0.079611293   0.003959452   0.110024399   \r\n-4.788494E-4  0.0010097453  -5.832701E-4  0.0           \r\n-0.01936999   -0.080851149  -0.003319687  -0.112435972  \r\nmodel3\r\n[3.2372615840468177,-3.887368655600576,0.6501070715537581]\r\n0.019839138236381705    0.0794011365650966    0.0039488069038510374   -0.028039490169532715  \r\n-4.7766310601985774E-4  0.001015028177410154  -5.837314941386912E-4   0.003248397753479403   \r\n-0.019272077893351464   -0.0806696209827808   -0.0033080309178124827  0.04470991419683469    \r\n```\r\n\r\nWe can see that new impl generate solution much more close to GLMNET.",
        "createdAt" : "2021-03-29T03:41:06Z",
        "updatedAt" : "2021-03-29T03:59:04Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "461d1110da71d504780f5a1f7db07fceaf597938",
    "line" : 87,
    "diffHunk" : "@@ -1,1 +1900,1904 @@  }\n\n  test(\"SPARK-34860: multinomial logistic regression with intercept, with small var\") {\n    val trainer1 = new LogisticRegression().setFitIntercept(true).setStandardization(true)\n      .setWeightCol(\"weight\")"
  },
  {
    "id" : "568da83a-18fd-4bb3-a59b-9d80e50b5a71",
    "prId" : 31693,
    "prUrl" : "https://github.com/apache/spark/pull/31693#pullrequestreview-601406039",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1beaa44d-5c20-40d5-9524-41646c7444a2",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "the last feature is generated with a pretty small var 0.0001",
        "createdAt" : "2021-03-01T09:45:56Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      },
      {
        "id" : "119fda7b-a181-41fe-9b00-199aefb35493",
        "parentId" : "1beaa44d-5c20-40d5-9524-41646c7444a2",
        "authorId" : "7561e4e4-d50e-4172-b2ca-1e61ddd12af9",
        "body" : "We should be able to mathematically compute the intercept, and then see which solver is closer to it.  What are the log(odds) of the target vector for this test case?",
        "createdAt" : "2021-03-02T13:24:37Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "7561e4e4-d50e-4172-b2ca-1e61ddd12af9",
        "tags" : [
        ]
      }
    ],
    "commit" : "c64a4f0546b1f08416f67d4e67cda18820036331",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +91,95 @@      val coefficients = Array(-0.57997, 0.912083, -0.371077, -0.819866, 2.688191)\n      val xMean = Array(5.843, 3.057, 3.758, 10.199)\n      val xVariance = Array(0.6856, 0.1899, 3.116, 0.0001)\n\n      val testData ="
  },
  {
    "id" : "5e18d326-d7b9-4a76-a2e2-c9e1d4aafae2",
    "prId" : 31693,
    "prUrl" : "https://github.com/apache/spark/pull/31693#pullrequestreview-600560988",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3436d494-46ca-4887-90ff-c59f6a0e08f2",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "![image](https://user-images.githubusercontent.com/7322292/109481489-c5bc7c00-7ab7-11eb-9b08-71dd515cf95f.png)\r\n\r\nglmnet version: 3.0-2",
        "createdAt" : "2021-03-01T09:58:51Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "c64a4f0546b1f08416f67d4e67cda18820036331",
    "line" : 56,
    "diffHunk" : "@@ -1,1 +829,833 @@    val model3 = trainer3.fit(binaryDatasetWithSmallVar)\n\n    /*\n      Use the following R code to load the data and train the model using glmnet package.\n      library(\"glmnet\")"
  },
  {
    "id" : "31e70290-ac61-4547-861a-bf84e4a3e4fa",
    "prId" : 31693,
    "prUrl" : "https://github.com/apache/spark/pull/31693#pullrequestreview-606179533",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "eebab4dd-a6b6-4e92-86e6-d0f0c6611ef5",
        "parentId" : null,
        "authorId" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "body" : "Why not increase the xMean to a big value like 100 for the feature with var=0.0001 ?\r\nBecause we center feature first, so it should works well with features with any large xMean",
        "createdAt" : "2021-03-08T10:16:23Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "tags" : [
        ]
      },
      {
        "id" : "2179d6d7-e1d9-46d9-8d21-1b47e9e1d6ef",
        "parentId" : "eebab4dd-a6b6-4e92-86e6-d0f0c6611ef5",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "update xMean to 10.199;\r\nif I update it to 100.199, then all labels sampled from `generateMultinomialLogisticInput` are negative, that is to say, all label=0. Can not train a model in R or MLLib. ",
        "createdAt" : "2021-03-08T11:02:57Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "c64a4f0546b1f08416f67d4e67cda18820036331",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +91,95 @@      val coefficients = Array(-0.57997, 0.912083, -0.371077, -0.819866, 2.688191)\n      val xMean = Array(5.843, 3.057, 3.758, 10.199)\n      val xVariance = Array(0.6856, 0.1899, 3.116, 0.0001)\n\n      val testData ="
  },
  {
    "id" : "9eb026fa-8dcb-4c83-97c4-5bdf3e00f022",
    "prId" : 31693,
    "prUrl" : "https://github.com/apache/spark/pull/31693#pullrequestreview-606186777",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "56809aa2-a06d-4a76-9d8e-f187013b2c3d",
        "parentId" : null,
        "authorId" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "body" : "Does bounded optimizer support centering feature first ? (suppose we don't set bound on intercept)",
        "createdAt" : "2021-03-08T10:22:46Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "tags" : [
        ]
      },
      {
        "id" : "310dd97a-2c88-4cca-8d5a-39ada9b832a5",
        "parentId" : "56809aa2-a06d-4a76-9d8e-f187013b2c3d",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "it should support, if no bounding on the intercept.",
        "createdAt" : "2021-03-08T11:06:45Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      },
      {
        "id" : "98e792ed-67a3-4861-9a36-c8f721eabb78",
        "parentId" : "56809aa2-a06d-4a76-9d8e-f187013b2c3d",
        "authorId" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "body" : "bounded optimizer case may be complicated, and it is rarely used, we can skip this for now.",
        "createdAt" : "2021-03-08T11:12:45Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "tags" : [
        ]
      }
    ],
    "commit" : "c64a4f0546b1f08416f67d4e67cda18820036331",
    "line" : 101,
    "diffHunk" : "@@ -1,1 +874,878 @@    assert(model3.coefficients ~= coefficientsR2 relTol 1E-3)\n  }\n\n  test(\"binary logistic regression without intercept without regularization\") {\n    val trainer1 = (new LogisticRegression).setFitIntercept(false).setStandardization(true)"
  },
  {
    "id" : "ea283240-fcf6-49c8-b433-61844f8c0ad0",
    "prId" : 31693,
    "prUrl" : "https://github.com/apache/spark/pull/31693#pullrequestreview-606178307",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "590abd5d-e763-42a8-96dc-d4374e358691",
        "parentId" : null,
        "authorId" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "body" : "add test for small var features + reg > 0 ?",
        "createdAt" : "2021-03-08T10:33:00Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "7e665d8b-d739-4edf-88c8-7379ff8585c2",
        "tags" : [
        ]
      },
      {
        "id" : "907f1745-8184-47ae-b842-23e43aaa1b6b",
        "parentId" : "590abd5d-e763-42a8-96dc-d4374e358691",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "updated",
        "createdAt" : "2021-03-08T11:01:09Z",
        "updatedAt" : "2021-03-25T01:06:36Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "c64a4f0546b1f08416f67d4e67cda18820036331",
    "line" : 51,
    "diffHunk" : "@@ -1,1 +824,828 @@    val trainer3 = new LogisticRegression().setFitIntercept(true).setStandardization(true)\n      .setElasticNetParam(0.0001).setRegParam(0.5).setWeightCol(\"weight\")\n\n    val model1 = trainer1.fit(binaryDatasetWithSmallVar)\n    val model2 = trainer2.fit(binaryDatasetWithSmallVar)"
  },
  {
    "id" : "09d7832f-afa7-45fd-800a-4626dfb415af",
    "prId" : 30013,
    "prUrl" : "https://github.com/apache/spark/pull/30013#pullrequestreview-507018289",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d057e563-b926-4d52-9663-fb862f0f8b19",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "master fails in this modified case:\r\n![tx](https://user-images.githubusercontent.com/7322292/95806570-98567800-0d3a-11eb-9481-c9cd343cd57f.png)\r\n",
        "createdAt" : "2020-10-13T01:58:14Z",
        "updatedAt" : "2020-10-13T01:58:14Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "7a1749c2e4c40ded1546c7ce3f0a6b190c340c84",
    "line" : 9,
    "diffHunk" : "@@ -1,1 +404,408 @@    val binaryModel = blr.fit(smallBinaryDataset)\n\n    testTransformer[(Double, Vector)](smallBinaryDataset.toDF(), binaryModel, \"prediction\") {\n      row => assert(row.getDouble(0) === 0.0)\n    }"
  },
  {
    "id" : "8f7a4ee5-06d8-43d2-98da-6905524f0016",
    "prId" : 28786,
    "prUrl" : "https://github.com/apache/spark/pull/28786#pullrequestreview-428327489",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f709d364-5ae3-43d3-8cdb-dd55d84a2738",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "InitialModel is set in this case. init state is good so no training is needed. I think totalIterations should be 0 instead of 1.",
        "createdAt" : "2020-06-10T18:35:57Z",
        "updatedAt" : "2020-06-15T01:02:01Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "4c4d52b91e1ebbd018835c3bb2cd565df79bd430",
    "line" : 22,
    "diffHunk" : "@@ -1,1 +2574,2578 @@      }\n    }\n    assert(model2.summary.totalIterations === 0)\n\n    val lr3 = new LogisticRegression().setFamily(\"multinomial\")"
  },
  {
    "id" : "24370408-a856-4338-a591-39949e5015aa",
    "prId" : 28786,
    "prUrl" : "https://github.com/apache/spark/pull/28786#pullrequestreview-428327630",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "63db0cac-833f-4214-ab0b-6577635082ab",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Same as L2576. I think totalIterations should be 0 instead of 1 since no training. ",
        "createdAt" : "2020-06-10T18:36:09Z",
        "updatedAt" : "2020-06-15T01:02:01Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "4c4d52b91e1ebbd018835c3bb2cd565df79bd430",
    "line" : 31,
    "diffHunk" : "@@ -1,1 +2589,2593 @@      }\n    }\n    assert(model4.summary.totalIterations === 0)\n  }\n"
  },
  {
    "id" : "e5cfc9d2-f13b-48a6-bd17-f7f6b7a281d1",
    "prId" : 28786,
    "prUrl" : "https://github.com/apache/spark/pull/28786#pullrequestreview-428327780",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7cf5b2b8-a51c-46d0-a575-91e12c21eebb",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "since I change the objectiveHistory from Array.empty to Array(0.0) for no training case, summary.objectiveHistory(0) should be 0.0 here.",
        "createdAt" : "2020-06-10T18:36:23Z",
        "updatedAt" : "2020-06-15T01:02:01Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "4c4d52b91e1ebbd018835c3bb2cd565df79bd430",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +2609,2613 @@    assert(allZeroInterceptModel.intercept === Double.NegativeInfinity)\n    assert(allZeroInterceptModel.summary.totalIterations === 0)\n    assert(allZeroInterceptModel.summary.objectiveHistory(0) ~== 0.0 absTol 1e-4)\n\n    val allOneInterceptModel = lrIntercept"
  },
  {
    "id" : "6efb30ad-3556-4f61-8038-a802fb6979ce",
    "prId" : 28786,
    "prUrl" : "https://github.com/apache/spark/pull/28786#pullrequestreview-428328420",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3f1e082f-7800-451c-9c9e-9cf3b613daff",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "No training here so I think the totalIterations should be 0 instead of 1",
        "createdAt" : "2020-06-10T18:37:15Z",
        "updatedAt" : "2020-06-15T01:02:01Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "4c4d52b91e1ebbd018835c3bb2cd565df79bd430",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +2667,2671 @@        assert(pred === 0.0)\n    }\n    assert(modelZeroLabel.summary.totalIterations === 0)\n\n    // ensure that the correct value is predicted when numClasses passed through metadata"
  }
]