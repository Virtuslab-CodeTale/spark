[
  {
    "id" : "5caad91a-44ca-4ef8-a536-14650fafc598",
    "prId" : 32124,
    "prUrl" : "https://github.com/apache/spark/pull/32124#pullrequestreview-644116713",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9d1acd55-e493-4344-ab3e-d33e288e2442",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "here `ddot` is only called once in one training, so just use javaBLAS for simplication",
        "createdAt" : "2021-04-15T07:26:00Z",
        "updatedAt" : "2021-04-15T07:26:01Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      },
      {
        "id" : "1075eaf1-f024-4d00-b05a-4b585b6073b4",
        "parentId" : "9d1acd55-e493-4344-ab3e-d33e288e2442",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Is this true for all the instances below though? CC @luhenry who might want to weigh in for consistency",
        "createdAt" : "2021-04-15T13:55:18Z",
        "updatedAt" : "2021-04-15T13:55:19Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "5d34c12b-b841-41d1-bccf-a697da2c9021",
        "parentId" : "9d1acd55-e493-4344-ab3e-d33e288e2442",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "Yes, they are called only once per fitting.",
        "createdAt" : "2021-04-16T00:44:21Z",
        "updatedAt" : "2021-04-16T00:44:22Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      },
      {
        "id" : "a64c6b3e-2a47-42fe-bd88-2b2af0d1b79a",
        "parentId" : "9d1acd55-e493-4344-ab3e-d33e288e2442",
        "authorId" : "567dbcaa-2683-46db-af89-e44be673a7cc",
        "body" : "`javaBLAS` is faster than `nativeBLAS` from local experiment for all level-1 and level-2 operations. The cost of copying from java heap to native memory is too great for these operations, and is only amortized for level-3 operations. So switching to `javaBLAS` here for `ddot` makes sense to me.",
        "createdAt" : "2021-04-25T09:36:21Z",
        "updatedAt" : "2021-04-25T09:36:21Z",
        "lastEditedBy" : "567dbcaa-2683-46db-af89-e44be673a7cc",
        "tags" : [
        ]
      }
    ],
    "commit" : "5857a52f9cb9fe787b22dfdfd647e04b801224db",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +990,994 @@        // we should adjust it to the initial solution for problem:\n        // y = f(w1 * (x1 - avg_x1) / std_x1, w2 * (x2 - avg_x2) / std_x2, ..., intercept)\n        val adapt = BLAS.javaBLAS.ddot(numFeatures, initialSolution, 1, scaledMean, 1)\n        initialSolution(numFeatures) += adapt\n      }"
  },
  {
    "id" : "47570e26-4b6c-4238-9ef8-e348fb824e4d",
    "prId" : 31657,
    "prUrl" : "https://github.com/apache/spark/pull/31657#pullrequestreview-600948708",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2c889e4e-d4c4-482e-9af4-9b903440e35f",
        "parentId" : null,
        "authorId" : "7561e4e4-d50e-4172-b2ca-1e61ddd12af9",
        "body" : "As you added the intercept adjustment below, can probably change the comment",
        "createdAt" : "2021-03-01T16:50:26Z",
        "updatedAt" : "2021-03-01T17:27:28Z",
        "lastEditedBy" : "7561e4e4-d50e-4172-b2ca-1e61ddd12af9",
        "tags" : [
        ]
      }
    ],
    "commit" : "49141bbb178ac28af3263efa31299f8eb835830b",
    "line" : 63,
    "diffHunk" : "@@ -1,1 +853,857 @@              value / featuresStd(featureIndex))\n          }\n          // It seems that we only adjust coef, intercept is missing?\n          if (isIntercept) interceptVec.toArray(classIndex) = value\n        }"
  },
  {
    "id" : "48ee9202-e7e5-4edd-b900-64001c039983",
    "prId" : 31657,
    "prUrl" : "https://github.com/apache/spark/pull/31657#pullrequestreview-600948708",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "fa80e0c4-b429-4b4a-868f-991ab07e35b8",
        "parentId" : null,
        "authorId" : "7561e4e4-d50e-4172-b2ca-1e61ddd12af9",
        "body" : "While I understand perfectly well what you are doing here, someone who hasnt thought about this will not.  I would add a comment explaining why the adjustment is equal to the dot product of the coefficients and the means.  Something along the lines of \"If one applies a linear transformation to the data x -> (x - avg(x))/std(x), and finds a minimum of the objective function with the transformed data, then moving all the averages over to the intercept changes the intercept by coeffs(in unscaled space) dot averages.\"",
        "createdAt" : "2021-03-01T17:10:24Z",
        "updatedAt" : "2021-03-01T17:27:28Z",
        "lastEditedBy" : "7561e4e4-d50e-4172-b2ca-1e61ddd12af9",
        "tags" : [
        ]
      }
    ],
    "commit" : "49141bbb178ac28af3263efa31299f8eb835830b",
    "line" : 74,
    "diffHunk" : "@@ -1,1 +864,868 @@            var adjust = 0.0\n            while (j < numFeatures) {\n              adjust += denseCoefficientMatrix(i, j) * featuresMean(j)\n              j += 1\n            }"
  },
  {
    "id" : "314b1353-28c9-4ecd-b2cf-5dd09172adc5",
    "prId" : 29255,
    "prUrl" : "https://github.com/apache/spark/pull/29255#pullrequestreview-456251157",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4695f091-e659-4c44-a6f6-07ced1baf641",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Does anything need to happen in the multinomial case?",
        "createdAt" : "2020-07-27T14:39:49Z",
        "updatedAt" : "2020-07-28T02:08:06Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "38a97679-8091-4993-a37e-ddc4f179ff99",
        "parentId" : "4695f091-e659-4c44-a6f6-07ced1baf641",
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "@zhengruifeng We can only improve the performance for binary case, right?",
        "createdAt" : "2020-07-27T18:10:09Z",
        "updatedAt" : "2020-07-28T02:08:06Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      },
      {
        "id" : "396b7c8f-bf27-4920-bac3-f23b871a6bbd",
        "parentId" : "4695f091-e659-4c44-a6f6-07ced1baf641",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "@srowen @huaxingao this change is only for binary classification. I found there is not similar place to change for the multinomial case.",
        "createdAt" : "2020-07-28T01:52:37Z",
        "updatedAt" : "2020-07-28T02:08:06Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      },
      {
        "id" : "745f071c-6578-495d-b9e5-62e7a185b3be",
        "parentId" : "4695f091-e659-4c44-a6f6-07ced1baf641",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "for multinomial case, it seems should be modified in `ProbabilisticClassifier`.\r\n\r\nI will study whether similar change in  `ProbabilisticClassifier` can help improve performance in all `ProbabilisticClassificationModel` including multinomial logistic regression.",
        "createdAt" : "2020-07-28T02:00:58Z",
        "updatedAt" : "2020-07-28T02:08:06Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "e86d8fbd51f8ca89e18afcefd5e1123cd7fd7d3b",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +1107,1111 @@\n  private def updateBinaryThreshold(): Unit = {\n    if (!isMultinomial) {\n      _threshold = getThreshold\n      if (_threshold == 0.0) {"
  }
]