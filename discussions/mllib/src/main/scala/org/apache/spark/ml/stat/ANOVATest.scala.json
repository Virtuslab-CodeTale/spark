[
  {
    "id" : "a6ef07d0-27fd-4876-a591-98cc5bd83c6e",
    "prId" : 27979,
    "prUrl" : "https://github.com/apache/spark/pull/27979#pullrequestreview-378992685",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f767c779-4892-4d26-b71e-e088cd99933c",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "directly get `numSamples` and `numClasses` here",
        "createdAt" : "2020-03-22T10:54:01Z",
        "updatedAt" : "2020-03-22T10:54:01Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "7048f8dbd8ee0fdb3856cbb2c04c697ee76d2bfb",
    "line" : 92,
    "diffHunk" : "@@ -1,1 +104,108 @@        ).map { case (col, (sum, sumOfSq, sums, counts)) =>\n          val numSamples = counts.iterator.map(_._2).sum\n          val numClasses = counts.size\n\n          // e.g. features are [3.3, 2.5, 1.0, 3.0, 2.0] and labels are [1, 2, 1, 3, 3]"
  },
  {
    "id" : "ebcac026-cb68-4cf3-8f6f-b31a31b8bb03",
    "prId" : 27895,
    "prUrl" : "https://github.com/apache/spark/pull/27895#pullrequestreview-375722284",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3882939f-0572-4bf2-8d99-1546e7b87a5e",
        "parentId" : null,
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "We can move `numFeatures` and `val Row(numSamples: Long, numClasses: Long)` above.\r\nAnd do not need to create var `labeledPointRdd` and do not need to convert rows to LabeledPoints:\r\n```\r\ndataset.select(col(labelCol).cast(\"double\"), col(featuresCol))\r\n      .as[(Double, Vector)]\r\n      .rdd\r\n      .flatMap { case (label, features) =>\r\n            features.iterator.map {case (col, value) => (col, (label, value))}\r\n      }.aggregateByKey[(Double, Double, OpenHashMap[Double, Double], OpenHashMap[Double, Long])](\r\n            (0.0, 0.0, new OpenHashMap[Double, Double], new OpenHashMap[Double, Long]))(\r\n                   seq = { case ((sum: Double, sqSum: Double, sums, counts), (label, value)) =>\r\n                            sums.changeValue(label, value, _ + value)\r\n                            counts.changeValue(label, 1L, _ + 1L)\r\n                            (sum + value, sqSum + value * value, sums, counts)\r\n            }\r\n           ...\r\n      )...\r\n\r\n```",
        "createdAt" : "2020-03-17T03:45:05Z",
        "updatedAt" : "2020-03-18T20:51:43Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "481026cab7e7110249275f30ad068ffb0d3d33ee",
    "line" : 85,
    "diffHunk" : "@@ -1,1 +83,87 @@    SchemaUtils.checkNumericType(dataset.schema, labelCol)\n\n    val numFeatures = MetadataUtils.getNumFeatures(dataset, featuresCol)\n    val Row(numSamples: Long, numClasses: Long) =\n      dataset.select(count(labelCol), countDistinct(labelCol)).head"
  }
]