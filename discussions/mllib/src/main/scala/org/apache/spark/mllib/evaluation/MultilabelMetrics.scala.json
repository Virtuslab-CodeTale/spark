[
  {
    "id" : "2b006ac7-86cb-46ae-a45c-0f872f8f9c84",
    "prId" : 32648,
    "prUrl" : "https://github.com/apache/spark/pull/32648#pullrequestreview-667482608",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5adaf57e-13d2-4ff3-af8c-d166cc380ed6",
        "parentId" : null,
        "authorId" : "c7afbd1a-ab9f-4878-b837-32685ae783b0",
        "body" : "In Scala 2.13.5\r\n```\r\nWelcome to Scala 2.13.5 (OpenJDK 64-Bit Server VM, Java 1.8.0_232).\r\nType in expressions for evaluation. Or try :help.\r\n\r\nscala> Array.empty[Double].intersect(Array(0.0))\r\nval res0: Array[Double] = Array()\r\n\r\nscala> Array(0.0).intersect(Array.empty[Double])\r\nval res1: Array[Double] = Array()\r\n```\r\n\r\nbut in Scala 2.13.6\r\n\r\n```\r\nWelcome to Scala 2.13.6 (OpenJDK 64-Bit Server VM, Java 1.8.0_232).\r\nType in expressions for evaluation. Or try :help.\r\n\r\nscala> Array.empty[Double].intersect(Array(0.0))\r\njava.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [D\r\n  ... 32 elided\r\n\r\nscala> Array(0.0).intersect(Array.empty[Double])\r\njava.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [D\r\n  ... 32 elided\r\n```\r\n\r\n`Array()` is replaced by throw `ClassCastException`, this change is uncomfortable ... @dongjoon-hyun @maropu do you think this is a bug of Scala 2.13.6?\r\n\r\n\r\n",
        "createdAt" : "2021-05-25T03:29:26Z",
        "updatedAt" : "2021-05-25T03:29:26Z",
        "lastEditedBy" : "c7afbd1a-ab9f-4878-b837-32685ae783b0",
        "tags" : [
        ]
      },
      {
        "id" : "4a10861e-5c83-4bff-bead-f95a701b9a6c",
        "parentId" : "5adaf57e-13d2-4ff3-af8c-d166cc380ed6",
        "authorId" : "c7afbd1a-ab9f-4878-b837-32685ae783b0",
        "body" : "I submitted an issue to consult the Scala community  [https://github.com/scala/bug/issues/12403](https://github.com/scala/bug/issues/12403)",
        "createdAt" : "2021-05-25T03:43:54Z",
        "updatedAt" : "2021-05-25T03:43:55Z",
        "lastEditedBy" : "c7afbd1a-ab9f-4878-b837-32685ae783b0",
        "tags" : [
        ]
      },
      {
        "id" : "f3706982-f544-4bae-81f1-a2d319be7275",
        "parentId" : "5adaf57e-13d2-4ff3-af8c-d166cc380ed6",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Thank you for filing the upstream issue. Ya, it looks like a breaking behavior change.",
        "createdAt" : "2021-05-25T07:09:51Z",
        "updatedAt" : "2021-05-25T07:09:51Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "6de0ff34-d9f2-40ff-bd1d-70f5d2b8b4eb",
        "parentId" : "5adaf57e-13d2-4ff3-af8c-d166cc380ed6",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "As @LuciferYang mentioned at the Scala community, I also confirmed that only Scala 2.13.6 has this bug unlike Scala 2.13.5/3.0.0.\r\n\r\n```\r\nscala3-3.0.0:$ bin/scala\r\nscala> Array.empty[Double].intersect(Array(0.0))\r\nval res0: Array[Double] = Array()\r\n\r\nscala-2.13.6:$ bin/scala\r\nWelcome to Scala 2.13.6 (OpenJDK 64-Bit Server VM, Java 1.8.0_292).\r\nType in expressions for evaluation. Or try :help.\r\n\r\nscala> Array.empty[Double].intersect(Array(0.0))\r\njava.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [D\r\n  ... 32 elided\r\n```\r\n\r\n",
        "createdAt" : "2021-05-25T07:17:20Z",
        "updatedAt" : "2021-05-25T07:17:20Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "50c251d3-3c3c-4d7a-9923-f43ebc3ea97e",
        "parentId" : "5adaf57e-13d2-4ff3-af8c-d166cc380ed6",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "In this case, we had better skip Scala 2.13.6.",
        "createdAt" : "2021-05-25T07:18:25Z",
        "updatedAt" : "2021-05-25T07:18:25Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "d39fab3b-b143-4ff3-8dd1-5799d2d70889",
        "parentId" : "5adaf57e-13d2-4ff3-af8c-d166cc380ed6",
        "authorId" : "c7afbd1a-ab9f-4878-b837-32685ae783b0",
        "body" : "@dongjoon-hyun agree with you. we'd better skip this version",
        "createdAt" : "2021-05-25T07:31:02Z",
        "updatedAt" : "2021-05-25T07:31:02Z",
        "lastEditedBy" : "c7afbd1a-ab9f-4878-b837-32685ae783b0",
        "tags" : [
        ]
      }
    ],
    "commit" : "2a867a6277c1c6c4f1a6497973588304f907bede",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +179,183 @@   */\n  def add(predictions: Array[Double], labels: Array[Double]): this.type = {\n    val intersection = if (predictions.isEmpty || labels.isEmpty) {\n      Array.empty[Double]\n    } else {"
  },
  {
    "id" : "d8b33ad5-b535-4a35-a86a-392c0866b8b7",
    "prId" : 24717,
    "prUrl" : "https://github.com/apache/spark/pull/24717#pullrequestreview-242711599",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "82e0d043-204e-4269-bb24-151095d80a38",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Can `sample` be written as `(label, prediction)` for clarity? I forget whether Scala allows nested tuples here",
        "createdAt" : "2019-05-27T13:33:11Z",
        "updatedAt" : "2019-05-29T03:03:35Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "e61e97f6-d789-40e8-93a2-398e2a03d4f5",
        "parentId" : "82e0d043-204e-4269-bb24-151095d80a38",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "If I convert this to `(summary, (preds, l)) => summary.add(preds, l),` then the IDEA complains ",
        "createdAt" : "2019-05-28T02:36:15Z",
        "updatedAt" : "2019-05-29T03:03:35Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      },
      {
        "id" : "29676aac-407a-4398-ac9c-a8dea03f0913",
        "parentId" : "82e0d043-204e-4269-bb24-151095d80a38",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "With a `{ case (...) =>` statement? OK no big deal",
        "createdAt" : "2019-05-28T14:32:57Z",
        "updatedAt" : "2019-05-29T03:03:35Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      }
    ],
    "commit" : "7d83ac39df2a45fca2990e855802055f60804cc6",
    "line" : 21,
    "diffHunk" : "@@ -1,1 +48,52 @@    predictionAndLabels\n      .treeAggregate(new MultilabelSummarizer)(\n        (summary, sample) => summary.add(sample._1, sample._2),\n        (sum1, sum2) => sum1.merge(sum2)\n      )"
  },
  {
    "id" : "38d738d4-c648-4598-849a-015657858c98",
    "prId" : 24717,
    "prUrl" : "https://github.com/apache/spark/pull/24717#pullrequestreview-244743248",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ad26361a-a9ac-4cac-b19c-c211ab93916c",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Same point about .values.sum here I think",
        "createdAt" : "2019-05-29T14:27:19Z",
        "updatedAt" : "2019-05-29T14:27:58Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "d2cb3144-4f57-49c2-88ea-f3e62bcb048a",
        "parentId" : "ad26361a-a9ac-4cac-b19c-c211ab93916c",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "@zhengruifeng maybe we should change this too for completeness, but I'll merge later today either way",
        "createdAt" : "2019-05-31T14:13:50Z",
        "updatedAt" : "2019-05-31T14:13:51Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "5935eea6-7d60-4275-8e86-66beaa122645",
        "parentId" : "ad26361a-a9ac-4cac-b19c-c211ab93916c",
        "authorId" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "body" : "@srowen  I think I can change this place in MultilabelEvaluator",
        "createdAt" : "2019-06-03T08:34:36Z",
        "updatedAt" : "2019-06-03T08:34:36Z",
        "lastEditedBy" : "685f805b-e4fa-4f21-b066-58afcecf9ce6",
        "tags" : [
        ]
      }
    ],
    "commit" : "7d83ac39df2a45fca2990e855802055f60804cc6",
    "line" : 143,
    "diffHunk" : "@@ -1,1 +135,139 @@  @Since(\"1.2.0\")\n  lazy val microPrecision: Double = {\n    val sumFp = summary.fpPerClass.foldLeft(0L) { case(cum, (_, fp)) => cum + fp}\n    sumTp.toDouble / (sumTp + sumFp)\n  }"
  }
]