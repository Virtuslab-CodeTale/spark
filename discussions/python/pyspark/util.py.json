[
  {
    "id" : "03b661e5-341f-4c2e-9c7e-54f6e9538a61",
    "prId" : 32989,
    "prUrl" : "https://github.com/apache/spark/pull/32989#pullrequestreview-687966889",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e1da6e55-a498-4926-81a0-e99b30a66b01",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Because the removal on the deque on the specific thread local will only happen in the same thread.",
        "createdAt" : "2021-06-21T01:19:33Z",
        "updatedAt" : "2021-06-21T01:19:33Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "2101e669-9255-42a8-81ba-e8ff574640d4",
        "parentId" : "e1da6e55-a498-4926-81a0-e99b30a66b01",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "This logic was just copied from Py4J to be extra safe.",
        "createdAt" : "2021-06-21T01:19:52Z",
        "updatedAt" : "2021-06-21T01:19:53Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "8b08f162e9ccf3c765851bf0a71fa9bd9944b05f",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +387,391 @@                jvm._gateway_client.deque.remove(thread_connection)\n            except ValueError:\n                # Should never reach this point\n                return\n            finally:"
  },
  {
    "id" : "87812dc0-8a5d-4d66-a494-9d601d278c5e",
    "prId" : 32962,
    "prUrl" : "https://github.com/apache/spark/pull/32962#pullrequestreview-687782885",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e8756e4c-1e71-40c9-945e-7cabc1ec815a",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "This seems to be the change of default value when `PYSPARK_PIN_THREAD` is not set. Do we need to mention this in the PR description?",
        "createdAt" : "2021-06-19T01:08:08Z",
        "updatedAt" : "2021-06-19T01:08:08Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "d774e6a5-c22e-4d46-8053-05fc68ad944e",
        "parentId" : "e8756e4c-1e71-40c9-945e-7cabc1ec815a",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Oh yeah, it was a mistake from #32429, and actually I meant it by:\r\n\r\n> #32429 missed one place at inheritable_thread_target (https://github.com/apache/spark/blob/master/python/pyspark/util.py#L308).\r\n\r\nLet me me more explicit on that",
        "createdAt" : "2021-06-19T01:09:31Z",
        "updatedAt" : "2021-06-19T01:09:31Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "be9dd5ecc3eaa9a21958d50d7d469c40fa569c6a",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +309,313 @@    from pyspark import SparkContext\n\n    if os.environ.get(\"PYSPARK_PIN_THREAD\", \"true\").lower() == \"true\":\n        # NOTICE the internal difference vs `InheritableThread`. `InheritableThread`\n        # copies local properties when the thread starts but `inheritable_thread_target`"
  },
  {
    "id" : "e478f04e-94ef-422e-88d1-6cc71e0da149",
    "prId" : 30309,
    "prUrl" : "https://github.com/apache/spark/pull/30309#pullrequestreview-530096430",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cb156484-1319-42ce-99fb-542cc605e447",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I thought it's easier to understand this traceback modification with the doctests. But let me know if any of you think it should be converted and placed as a proper unittest under `test_xxx.py`.",
        "createdAt" : "2020-11-13T14:16:58Z",
        "updatedAt" : "2020-11-16T14:41:55Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "0f04af73fab996ce619aea1372e5a00fc405b181",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +102,106 @@    though the following tracebacks are from the current package.\n\n    Examples\n    --------\n    >>> import importlib"
  },
  {
    "id" : "c0eea6f9-9a47-4cb8-bfe5-eff2b25bac41",
    "prId" : 30309,
    "prUrl" : "https://github.com/apache/spark/pull/30309#pullrequestreview-530556863",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "21d6c40f-61c3-42d6-81de-cdb8d1280ace",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Does this mean we also skip other doctest in `python/pyspark/util.py`?",
        "createdAt" : "2020-11-14T05:48:29Z",
        "updatedAt" : "2020-11-16T14:41:55Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "0f04af73fab996ce619aea1372e5a00fc405b181",
    "line" : 170,
    "diffHunk" : "@@ -1,1 +328,332 @@\n    if \"pypy\" not in platform.python_implementation().lower() and sys.version_info[:2] >= (3, 7):\n        (failure_count, test_count) = doctest.testmod()\n        if failure_count:\n            sys.exit(-1)"
  },
  {
    "id" : "d65b28dc-f947-4b4b-b0c3-ce0dbe36c91f",
    "prId" : 30309,
    "prUrl" : "https://github.com/apache/spark/pull/30309#pullrequestreview-531385741",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "eb10ca7d-7857-458a-8845-c5c563679521",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "@viirya, let me just skip the tests here. Seems like it's tricky to conditionally skip the tests.",
        "createdAt" : "2020-11-16T14:44:29Z",
        "updatedAt" : "2020-11-16T14:44:29Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "0f04af73fab996ce619aea1372e5a00fc405b181",
    "line" : 169,
    "diffHunk" : "@@ -1,1 +327,331 @@    import doctest\n\n    if \"pypy\" not in platform.python_implementation().lower() and sys.version_info[:2] >= (3, 7):\n        (failure_count, test_count) = doctest.testmod()\n        if failure_count:"
  },
  {
    "id" : "6c49bb1e-ca4d-4848-9823-02fb074732d9",
    "prId" : 28968,
    "prUrl" : "https://github.com/apache/spark/pull/28968#pullrequestreview-478101122",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7e4d9176-e933-498b-a1eb-42f1146028b7",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Why we need to `clone`? Doesn't `sc.localProperties` get clone in `childValue` already?",
        "createdAt" : "2020-08-29T04:28:30Z",
        "updatedAt" : "2020-08-29T04:28:47Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "e0b9ff99-b388-4f13-be81-671f774a83a1",
        "parentId" : "7e4d9176-e933-498b-a1eb-42f1146028b7",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Actually we're mimicking that behaviour here because the thread in JVM does not respect the inheritance here since the thread is always sepearately created via the JVM gateway whereas Scala Java side we can keep the inheritance by creating a thread within a thread.",
        "createdAt" : "2020-08-29T05:51:22Z",
        "updatedAt" : "2020-08-29T05:51:22Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "a78fd4314ba39d1feb63ba1539ac9a2acf40de77",
    "line" : 44,
    "diffHunk" : "@@ -1,1 +144,148 @@        if isinstance(sc._gateway, ClientServer):\n            # Here's when the pinned-thread mode (PYSPARK_PIN_THREAD) is on.\n            properties = sc._jsc.sc().getLocalProperties().clone()\n            self._sc = sc\n"
  }
]