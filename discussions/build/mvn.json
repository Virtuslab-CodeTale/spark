[
  {
    "id" : "9d110dab-bb6d-4801-8459-ce6d9a94befa",
    "prId" : 32505,
    "prUrl" : "https://github.com/apache/spark/pull/32505#pullrequestreview-656944450",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f1919374-4550-43e9-bb17-c73cf715fe06",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "I had to break down the arguments further to make the logic work below. As part of that I tried to refactor this method a bit, which was getting hard to understand.",
        "createdAt" : "2021-05-11T16:15:28Z",
        "updatedAt" : "2021-05-11T16:16:58Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      }
    ],
    "commit" : "b0db41e6ee0154d247bbcd5575e1edcfc7f7f311",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +35,39 @@# 6 - Checkable Binary\ninstall_app() {\n  local mirror_host=\"$1\"\n  local url_path=\"$2\"\n  local url_query=\"$3\""
  },
  {
    "id" : "d96d11fc-45c3-4462-8be0-e3ec0167ae04",
    "prId" : 32505,
    "prUrl" : "https://github.com/apache/spark/pull/32505#pullrequestreview-656944450",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "123dc906-d808-4791-872c-40b3ee81d86b",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "The old arg 3 was never empty; not sure what this is about",
        "createdAt" : "2021-05-11T16:15:44Z",
        "updatedAt" : "2021-05-11T16:16:58Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      }
    ],
    "commit" : "b0db41e6ee0154d247bbcd5575e1edcfc7f7f311",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +48,52 @@  local wget_opts=\"--no-verbose\"\n\n  if [ ! -f \"$binary\" ]; then\n    # check if we already have the tarball\n    # check if we have curl installed"
  },
  {
    "id" : "159c7ce5-6748-44ed-8226-429da255ca66",
    "prId" : 32505,
    "prUrl" : "https://github.com/apache/spark/pull/32505#pullrequestreview-664291849",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "84701dbf-bfaf-492d-9898-9a6218ddefd6",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "I switched to 'regular' if syntax here for consistency, and because it's necessary to make multiple commands below work readably",
        "createdAt" : "2021-05-11T16:16:13Z",
        "updatedAt" : "2021-05-11T16:16:58Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "a709183b-fde5-423b-b9a3-8b7cfbe8adc3",
        "parentId" : "84701dbf-bfaf-492d-9898-9a6218ddefd6",
        "authorId" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "body" : "`build/mvn: line 56: [: /root/spark/build/apache-maven-3.6.3-bin.tar.gz: binary operator expected` is raised after this patch, I submitted a followup:\r\n\r\nhttps://github.com/apache/spark/pull/32608",
        "createdAt" : "2021-05-20T12:03:46Z",
        "updatedAt" : "2021-05-20T12:03:46Z",
        "lastEditedBy" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "tags" : [
        ]
      }
    ],
    "commit" : "b0db41e6ee0154d247bbcd5575e1edcfc7f7f311",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +52,56 @@    # check if we have curl installed\n    # download application\n    if [ ! -f \"${local_tarball}\" -a $(command -v curl) ]; then\n      echo \"exec: curl ${curl_opts} ${remote_tarball}\" 1>&2\n      curl ${curl_opts} \"${remote_tarball}\" > \"${local_tarball}\""
  },
  {
    "id" : "8c221aa0-41c4-4583-863a-12d86984f2de",
    "prId" : 32505,
    "prUrl" : "https://github.com/apache/spark/pull/32505#pullrequestreview-656944450",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "357e2eb9-c9b1-4415-bb31-acffb5a8da63",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "As noted in the JIRA, Scala distributions on lightbend servers don't have a checksum, so we can't do anything there.",
        "createdAt" : "2021-05-11T16:16:55Z",
        "updatedAt" : "2021-05-11T16:16:58Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      }
    ],
    "commit" : "b0db41e6ee0154d247bbcd5575e1edcfc7f7f311",
    "line" : 130,
    "diffHunk" : "@@ -1,1 +144,148 @@    \"scala/${scala_version}/${SCALA_TARBALL}\" \\\n    \"\" \\\n    \"\" \\\n    ${SCALA_TARBALL} \\\n    \"scala-${scala_version}/bin/scala\""
  },
  {
    "id" : "f30cc034-7954-4cdc-9a40-cd88fd11ef08",
    "prId" : 32505,
    "prUrl" : "https://github.com/apache/spark/pull/32505#pullrequestreview-656947785",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0d4e54c3-ed18-48fc-a2de-835948bca2a3",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "One more point : the checksums are not mirrored (well, not consistently). But we very much want to check only the ASF's version of the checksum. If an attacker modified a mirror's artifact, they could just modify the checksum too of course.",
        "createdAt" : "2021-05-11T16:18:43Z",
        "updatedAt" : "2021-05-11T16:18:43Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      }
    ],
    "commit" : "b0db41e6ee0154d247bbcd5575e1edcfc7f7f311",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +43,47 @@  local remote_tarball=\"${mirror_host}/${url_path}${url_query}\"\n  local local_checksum=\"${local_tarball}.${checksum_suffix}\"\n  local remote_checksum=\"https://archive.apache.org/dist/${url_path}.${checksum_suffix}\"\n\n  local curl_opts=\"--silent --show-error -L\""
  },
  {
    "id" : "05953574-fa9a-40a3-9d80-f1f2acb115be",
    "prId" : 32505,
    "prUrl" : "https://github.com/apache/spark/pull/32505#pullrequestreview-663757445",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2d228030-4882-49d3-8301-dc82bc377e16",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "We don't need to add `$(command -v shasum)` here to check if  `shasum` exists or not (then, raise an error with an explicit message)? For example, Amazon Linux2 does not have it by default.",
        "createdAt" : "2021-05-19T23:43:43Z",
        "updatedAt" : "2021-05-19T23:43:43Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "3943515a-46a8-41dd-a6e6-1399542fc5ae",
        "parentId" : "2d228030-4882-49d3-8301-dc82bc377e16",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Oh really? shoot. That seemed to be the one command that was on Linux and OS X. Well, we can fail outright if not present, which would stop the build. Is that better or worse than just silently letting it proceed without verification? I don't know. Would developers generally build on this distro? ",
        "createdAt" : "2021-05-19T23:51:03Z",
        "updatedAt" : "2021-05-19T23:51:03Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "56132b1e-fb98-42c2-bcd8-cb60a1a3e548",
        "parentId" : "2d228030-4882-49d3-8301-dc82bc377e16",
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "> Oh really? shoot. That seemed to be the one command that was on Linux and OS X.\r\n\r\nYea, for Amazon Linux2, we need to run `sudo yum install perl-Digest-SHA` before running `build/mvn`.\r\n\r\n> Is that better or worse than just silently letting it proceed without verification?\r\n\r\nIMO, since this check exists to prevent cyber attacks, it is safer to make`build/mvn` fail if  `shasum` does not exists (actually, it seems the other OSs have `shasum` by default, so most developers don't care, I think).\r\n\r\n> Would developers generally build on this distro?\r\n\r\nNot sure, but that's the default option in aws ec2. I noticed this issue because my daily build broke after this commit merged.",
        "createdAt" : "2021-05-20T00:11:53Z",
        "updatedAt" : "2021-05-20T00:11:53Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "5c1feba9-3ba6-4cfa-9c0f-85af4b90b9b8",
        "parentId" : "2d228030-4882-49d3-8301-dc82bc377e16",
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "OK. I can submit a follow-up to fail if shasum is not present. That might inconvenience some developers, but, this is a security issue, and of course developers are welcome to install mvn / scala directly if desired.",
        "createdAt" : "2021-05-20T00:17:41Z",
        "updatedAt" : "2021-05-20T00:17:41Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "e2fe5fb0-3e59-4d2b-8cdb-60395123c8ef",
        "parentId" : "2d228030-4882-49d3-8301-dc82bc377e16",
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "+1",
        "createdAt" : "2021-05-20T00:21:23Z",
        "updatedAt" : "2021-05-20T00:21:24Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      }
    ],
    "commit" : "b0db41e6ee0154d247bbcd5575e1edcfc7f7f311",
    "line" : 69,
    "diffHunk" : "@@ -1,1 +75,79 @@    fi\n    # Checksum may not have been specified; don't check if doesn't exist\n    if [ -f \"${local_checksum}\" ]; then\n      echo \"  ${local_tarball}\" >> ${local_checksum} # two spaces + file are important!\n      # Assuming SHA512 here for now"
  }
]