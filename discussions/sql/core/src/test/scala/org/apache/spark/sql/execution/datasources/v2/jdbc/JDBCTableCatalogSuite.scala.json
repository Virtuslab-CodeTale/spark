[
  {
    "id" : "83afc1b8-c762-4b81-8fa8-aa5b4964f5db",
    "prId" : 33213,
    "prUrl" : "https://github.com/apache/spark/pull/33213#pullrequestreview-699391928",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "63611d55-3f56-4266-8a18-61ab7fb5cc9f",
        "parentId" : null,
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "If we are simplifying the message, we may not need to have `AlterTableComand.operation`. I can remove it in #33200.",
        "createdAt" : "2021-07-05T17:31:12Z",
        "updatedAt" : "2021-07-05T17:45:43Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "93c62afc-dc2b-45d9-a76c-410e8aa08647",
        "parentId" : "63611d55-3f56-4266-8a18-61ab7fb5cc9f",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "sounds good, thanks!",
        "createdAt" : "2021-07-05T19:40:00Z",
        "updatedAt" : "2021-07-05T19:40:00Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "52383baf47bdea4097a9ebbcd8722d03ca1c2b9c",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +322,326 @@        sql(s\"ALTER TABLE $tableName ALTER COLUMN bad_column COMMENT 'test'\")\n      }.getMessage\n      assert(msg.contains(\"Missing field bad_column in table h2.test.alt_table\"))\n    }\n    // Update column comments in not existing table and namespace"
  },
  {
    "id" : "3041725f-becc-48df-85be-6f1a9453b94d",
    "prId" : 30856,
    "prUrl" : "https://github.com/apache/spark/pull/30856#pullrequestreview-555971618",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "48b950bc-ad6b-42f9-82a6-7329e07f03c1",
        "parentId" : null,
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "This is slightly different from master: https://github.com/apache/spark/blob/37c4cd8f05316227465ff9cccbba063779827660/sql/core/src/test/scala/org/apache/spark/sql/execution/datasources/v2/jdbc/JDBCTableCatalogSuite.scala#L112-L113\r\n\r\nsince the table look up done in `DataSourceV2Strategy` instead of `Analyzer` (#30610).",
        "createdAt" : "2020-12-19T22:12:00Z",
        "updatedAt" : "2020-12-19T22:12:04Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "378d73bcc7e828f15e7cf60b8ff0dce38a8c2329",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +110,114 @@      sql(s\"ALTER TABLE h2.test.not_existing_table RENAME TO test.dst_table\")\n    }\n    assert(exp1.getMessage.contains(\"Table test.not_existing_table not found\"))\n    val exp2 = intercept[NoSuchTableException] {\n      sql(s\"ALTER TABLE h2.bad_test.not_existing_table RENAME TO test.dst_table\")"
  },
  {
    "id" : "3592af2e-6470-410c-bc8a-6fc33699a6fc",
    "prId" : 30041,
    "prUrl" : "https://github.com/apache/spark/pull/30041#pullrequestreview-509042143",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e8009d67-cf63-4d5d-8c2e-cae826c82502",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Without fix (with unquoted column name), `assert(t.schema === expectedSchema)` throws the following Exception:\r\n```\r\norg.scalatest.exceptions.TestFailedException: StructType(StructField(ID,IntegerType,true), StructField(C1,IntegerType,true), StructField(C2,StringType,true), StructField(C3,DoubleType,true)) did not equal StructType(StructField(ID,IntegerType,true), StructField(C1,IntegerType,true), StructField(C2,StringType,true), StructField(c3,DoubleType,true))\r\n\tat org.scalatest.Assertions.newAssertionFailedException(Assertions.scala:472)\r\n```",
        "createdAt" : "2020-10-15T06:31:56Z",
        "updatedAt" : "2020-10-15T06:31:56Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7e8098cebdfae077205253028e48d7b5bf9a8c07",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +181,185 @@      sql(\"ALTER TABLE h2.test.alt_table ADD COLUMNS (c3 DOUBLE)\")\n      t = spark.table(\"h2.test.alt_table\")\n      expectedSchema = expectedSchema.add(\"c3\", DoubleType)\n      assert(t.schema === expectedSchema)\n      // Add already existing column"
  },
  {
    "id" : "e7563beb-fcea-4823-951c-2bef3929dc72",
    "prId" : 30041,
    "prUrl" : "https://github.com/apache/spark/pull/30041#pullrequestreview-509547972",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "807b896a-8995-4aeb-858c-d5be67a85197",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Without fix (with unquoted column name), this throws the following Exception:\r\n```\r\nFailed table altering: test.alt_table;\r\norg.apache.spark.sql.AnalysisException: Failed table altering: test.alt_table;\r\n\tat org.apache.spark.sql.jdbc.JdbcDialect.classifyException(JdbcDialects.scala:268)\r\n\r\nCaused by: org.h2.jdbc.JdbcSQLException: Column \"ID\" not found; SQL statement:\r\nALTER TABLE \"test\".\"alt_table\" RENAME COLUMN id TO \"C\" [42122-195]\r\n```",
        "createdAt" : "2020-10-15T06:32:10Z",
        "updatedAt" : "2020-10-15T06:32:10Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      },
      {
        "id" : "7eaa3554-17d3-4f2f-82ee-5cca13806d37",
        "parentId" : "807b896a-8995-4aeb-858c-d5be67a85197",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "It should still work if we write `ID`, right? Spark normalizes the columns according to the table schema, so case sensitivity flag can still apply. See `ResolveAlterTableChanges`.\r\n\r\nIt would be better if we can add tests for case insensitive column resolution.",
        "createdAt" : "2020-10-15T15:36:49Z",
        "updatedAt" : "2020-10-15T15:36:49Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "872fa58f-4c43-4caf-997f-014edfa77894",
        "parentId" : "807b896a-8995-4aeb-858c-d5be67a85197",
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Yes, upper case `ID` still works here. I will add tests for case insensitive column resolution.\r\nThanks for reviewing and merging my PR!",
        "createdAt" : "2020-10-15T16:13:45Z",
        "updatedAt" : "2020-10-15T16:13:45Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7e8098cebdfae077205253028e48d7b5bf9a8c07",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +201,205 @@    withTable(\"h2.test.alt_table\") {\n      sql(\"CREATE TABLE h2.test.alt_table (id INTEGER, C0 INTEGER) USING _\")\n      sql(\"ALTER TABLE h2.test.alt_table RENAME COLUMN id TO C\")\n      val t = spark.table(\"h2.test.alt_table\")\n      val expectedSchema = new StructType()"
  },
  {
    "id" : "23927739-4de5-4e93-a8f5-57c1d2e8fe99",
    "prId" : 30041,
    "prUrl" : "https://github.com/apache/spark/pull/30041#pullrequestreview-509043057",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "694ff5f2-fbc0-4283-972e-3063c951d3e9",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Without fix (with unquoted column name), this throws the following Exception:\r\n```\r\nFailed table altering: test.alt_table;\r\norg.apache.spark.sql.AnalysisException: Failed table altering: test.alt_table;\r\n\tat org.apache.spark.sql.jdbc.JdbcDialect.classifyException(JdbcDialects.scala:268)\r\nCaused by: org.h2.jdbc.JdbcSQLException: Column \"C3\" not found; SQL statement:\r\nALTER TABLE \"test\".\"alt_table\" DROP COLUMN c3 [42122-195]\r\n```",
        "createdAt" : "2020-10-15T06:32:23Z",
        "updatedAt" : "2020-10-15T06:32:24Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7e8098cebdfae077205253028e48d7b5bf9a8c07",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +226,230 @@      sql(\"CREATE TABLE h2.test.alt_table (C1 INTEGER, C2 INTEGER, c3 INTEGER) USING _\")\n      sql(\"ALTER TABLE h2.test.alt_table DROP COLUMN C1\")\n      sql(\"ALTER TABLE h2.test.alt_table DROP COLUMN c3\")\n      val t = spark.table(\"h2.test.alt_table\")\n      val expectedSchema = new StructType().add(\"C2\", IntegerType)"
  },
  {
    "id" : "87d047a5-f8dc-4af0-865a-58208fb243c8",
    "prId" : 30041,
    "prUrl" : "https://github.com/apache/spark/pull/30041#pullrequestreview-509043345",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "75de657e-2ddb-49e5-bbc0-eb5109a461bb",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Without fix (with unquoted column name), this throws the following Exception:\r\n```\r\nFailed table altering: test.alt_table;\r\norg.apache.spark.sql.AnalysisException: Failed table altering: test.alt_table;\r\n\tat org.apache.spark.sql.jdbc.JdbcDialect.classifyException(JdbcDialects.scala:268)\r\n  Caused by: org.h2.jdbc.JdbcSQLException: Column \"DEPTNO\" not found; SQL statement:\r\nALTER TABLE \"test\".\"alt_table\" ALTER COLUMN deptno DOUBLE PRECISION [42122-195]\r\n```",
        "createdAt" : "2020-10-15T06:32:32Z",
        "updatedAt" : "2020-10-15T06:32:32Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7e8098cebdfae077205253028e48d7b5bf9a8c07",
    "line" : 49,
    "diffHunk" : "@@ -1,1 +249,253 @@      sql(\"CREATE TABLE h2.test.alt_table (ID INTEGER, deptno INTEGER) USING _\")\n      sql(\"ALTER TABLE h2.test.alt_table ALTER COLUMN id TYPE DOUBLE\")\n      sql(\"ALTER TABLE h2.test.alt_table ALTER COLUMN deptno TYPE DOUBLE\")\n      val t = spark.table(\"h2.test.alt_table\")\n      val expectedSchema = new StructType().add(\"ID\", DoubleType).add(\"deptno\", DoubleType)"
  },
  {
    "id" : "7af7df0e-02f8-42ef-ab1d-76ee9e184aed",
    "prId" : 30041,
    "prUrl" : "https://github.com/apache/spark/pull/30041#pullrequestreview-509043528",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ea6432db-74e0-45ab-9e16-a1262af986b3",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Without fix (with unquoted column name), this throws the following Exception:\r\n```\r\nFailed table altering: test.alt_table;\r\norg.apache.spark.sql.AnalysisException: Failed table altering: test.alt_table;\r\n\tat org.apache.spark.sql.jdbc.JdbcDialect.classifyException(JdbcDialects.scala:268)\r\n  Caused by: org.h2.jdbc.JdbcSQLException: Column \"DEPTNO\" not found; SQL statement:\r\nALTER TABLE \"test\".\"alt_table\" ALTER COLUMN deptno SET NULL [42122-195]\r\n```",
        "createdAt" : "2020-10-15T06:32:38Z",
        "updatedAt" : "2020-10-15T06:32:38Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7e8098cebdfae077205253028e48d7b5bf9a8c07",
    "line" : 61,
    "diffHunk" : "@@ -1,1 +275,279 @@  test(\"alter table ... update column nullability\") {\n    withTable(\"h2.test.alt_table\") {\n      sql(\"CREATE TABLE h2.test.alt_table (ID INTEGER NOT NULL, deptno INTEGER NOT NULL) USING _\")\n      sql(\"ALTER TABLE h2.test.alt_table ALTER COLUMN ID DROP NOT NULL\")\n      sql(\"ALTER TABLE h2.test.alt_table ALTER COLUMN deptno DROP NOT NULL\")"
  },
  {
    "id" : "72bd6749-b409-4661-82bf-e639c5b0b589",
    "prId" : 29324,
    "prUrl" : "https://github.com/apache/spark/pull/29324#pullrequestreview-459827409",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "879f53b0-1fc4-4bd1-ace8-a96115e8ea9f",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "let's add a new test to test \"update column nullability\"",
        "createdAt" : "2020-08-03T08:08:11Z",
        "updatedAt" : "2020-08-05T07:11:02Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "ef55b5ee728a16c67c993eabecd37aec2587d0fe",
    "line" : 51,
    "diffHunk" : "@@ -1,1 +145,149 @@  }\n\n  test(\"alter table ... update column type\") {\n    withTable(\"h2.test.alt_table\") {\n      sql(\"CREATE TABLE h2.test.alt_table (ID INTEGER) USING _\")"
  },
  {
    "id" : "fa1976a5-79a2-43d7-a7a7-c9a525b001f5",
    "prId" : 29324,
    "prUrl" : "https://github.com/apache/spark/pull/29324#pullrequestreview-460383287",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "72cb1931-8dbb-42ac-8f75-3c2d404a42e4",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "I think it's better to compare schemas than my previous method to use DESCRIBE TABLE.",
        "createdAt" : "2020-08-03T22:36:04Z",
        "updatedAt" : "2020-08-05T07:11:02Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "ef55b5ee728a16c67c993eabecd37aec2587d0fe",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +121,125 @@      t = spark.table(\"h2.test.alt_table\")\n      expectedSchema = expectedSchema.add(\"C3\", DoubleType)\n      assert(t.schema === expectedSchema)\n    }\n  }"
  },
  {
    "id" : "30fd4117-e6f0-4cf6-aa19-28ceb4a0506d",
    "prId" : 29168,
    "prUrl" : "https://github.com/apache/spark/pull/29168#pullrequestreview-454728274",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4ddaff2a-f46b-4a5a-877d-6023e87f94e8",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "does it have to be `\"test\".\"to_drop\"`?",
        "createdAt" : "2020-07-24T08:51:08Z",
        "updatedAt" : "2020-07-24T11:21:33Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "8a021fb2-efb4-4452-9122-71d837153af0",
        "parentId" : "4ddaff2a-f46b-4a5a-877d-6023e87f94e8",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "ah, otherwise it's upper-cased.",
        "createdAt" : "2020-07-24T08:51:51Z",
        "updatedAt" : "2020-07-24T11:21:33Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "9b7aa8d0fbc79897fa652fa7b5faf0b9d076692f",
    "line" : 70,
    "diffHunk" : "@@ -1,1 +68,72 @@  test(\"drop a table and test whether the table exists\") {\n    withConnection { conn =>\n      conn.prepareStatement(\"\"\"CREATE TABLE \"test\".\"to_drop\" (id INTEGER)\"\"\").executeUpdate()\n    }\n    checkAnswer(sql(\"SHOW TABLES IN h2.test\"), Seq(Row(\"test\", \"to_drop\"), Row(\"test\", \"people\")))"
  },
  {
    "id" : "e3d6882c-b25b-4750-a12c-6d4a65ccdaec",
    "prId" : 29168,
    "prUrl" : "https://github.com/apache/spark/pull/29168#pullrequestreview-454810614",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "08ccdcd8-78da-4efb-ad81-256b4d1c2e28",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "can we add a TODO to omit USING?",
        "createdAt" : "2020-07-24T08:52:32Z",
        "updatedAt" : "2020-07-24T11:21:33Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "18f0199c-f70f-4250-823e-7181716438c8",
        "parentId" : "08ccdcd8-78da-4efb-ad81-256b4d1c2e28",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "https://issues.apache.org/jira/browse/SPARK-32427",
        "createdAt" : "2020-07-24T11:22:00Z",
        "updatedAt" : "2020-07-24T11:22:00Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "9b7aa8d0fbc79897fa652fa7b5faf0b9d076692f",
    "line" : 103,
    "diffHunk" : "@@ -1,1 +101,105 @@    withTable(\"h2.test.new_table\") {\n      // TODO (SPARK-32427): Omit USING in CREATE TABLE\n      sql(\"CREATE TABLE h2.test.new_table(i INT, j STRING) USING _\")\n      checkAnswer(\n        sql(\"SHOW TABLES IN h2.test\"),"
  }
]