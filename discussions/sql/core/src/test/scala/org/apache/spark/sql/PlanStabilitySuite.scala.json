[
  {
    "id" : "b9e13fd1-3587-462c-9f92-acdb343b9ec0",
    "prId" : 31927,
    "prUrl" : "https://github.com/apache/spark/pull/31927#pullrequestreview-617643832",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "65544e61-f3c1-4f7e-8a17-29509e40628a",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Can we avoid the comparison between explains when `expectedSimplified != actualSimplifiedPlan`?",
        "createdAt" : "2021-03-22T15:14:57Z",
        "updatedAt" : "2021-03-22T17:47:09Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "1093f3e006bd1cbdae25db84f4dc79fc5089e66e",
    "line" : 24,
    "diffHunk" : "@@ -1,1 +105,109 @@    lazy val explainFile = new File(dir, \"explain.txt\")\n    lazy val expectedExplain = FileUtils.readFileToString(explainFile, StandardCharsets.UTF_8)\n    expectedSimplified == actualSimplifiedPlan && expectedExplain == actualExplain\n  }\n"
  },
  {
    "id" : "60d0b75d-a0eb-46f8-9ec9-12b3420f3d02",
    "prId" : 29860,
    "prUrl" : "https://github.com/apache/spark/pull/29860#pullrequestreview-496216337",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2d0344c5-2b4d-4e38-b0e1-f3821ed61228",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "One hard problem is how to match the lines from both sides. It's possible that the left side has one more node in the middle, so simply matching lines bottom-up may not work. It's like git diff, we should do the match w.r.t. the content, which can be very complicated.\r\n\r\nMaybe we should just recommend some online text diff tools in the comment and ask people to use.",
        "createdAt" : "2020-09-25T08:30:33Z",
        "updatedAt" : "2020-09-25T08:30:33Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "826a2e99701f39a793fc87fe417c612bf4141c2b",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +179,183 @@  private def addDiffHint(approvedSimplified: String, actualSimplified: String)\n    : (String, String) = {\n    // reverse the plan so we can compare the node from the bottom to top\n    val approvedLines = approvedSimplified.split(\"\\n\").reverse\n    val actualLines = actualSimplified.split(\"\\n\").reverse"
  },
  {
    "id" : "1bd60e60-e239-43b9-a51b-41d7e91e8850",
    "prId" : 29537,
    "prUrl" : "https://github.com/apache/spark/pull/29537#pullrequestreview-474179114",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "849ffa05-5582-4f4e-a8b4-295a9ea3f13d",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Address the comment from https://github.com/apache/spark/pull/29270#discussion_r476178381",
        "createdAt" : "2020-08-25T06:46:18Z",
        "updatedAt" : "2020-08-25T06:46:18Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "702bb32eb89bcaf66eb7c7674850db2745a81fad",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +106,110 @@    val file = new File(dir, \"simplified.txt\")\n    val expected = FileUtils.readFileToString(file, StandardCharsets.UTF_8)\n    expected == actualSimplifiedPlan\n  }\n"
  },
  {
    "id" : "abebda73-0acc-4ae3-81d4-05f1cdd85279",
    "prId" : 29537,
    "prUrl" : "https://github.com/apache/spark/pull/29537#pullrequestreview-474179279",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d4a9113b-0ffd-4492-8615-63cc091781d2",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Address the comment from https://github.com/apache/spark/pull/29270#discussion_r476174979",
        "createdAt" : "2020-08-25T06:46:38Z",
        "updatedAt" : "2020-08-25T06:46:38Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "702bb32eb89bcaf66eb7c7674850db2745a81fad",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +118,122 @@   *                plan is not too useful for debugging\n   */\n  private def generateGoldenFile(plan: SparkPlan, name: String, explain: String): Unit = {\n    val dir = getDirForTest(name)\n    val simplified = getSimplifiedPlan(plan)"
  },
  {
    "id" : "a7875317-6312-441b-9ea2-39fdd2b68f4b",
    "prId" : 29537,
    "prUrl" : "https://github.com/apache/spark/pull/29537#pullrequestreview-474179413",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "76afa73e-54e3-45e4-a34b-09e3aaab6a1e",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Address the comment from https://github.com/apache/spark/pull/29270#discussion_r476176111",
        "createdAt" : "2020-08-25T06:46:54Z",
        "updatedAt" : "2020-08-25T06:46:54Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "702bb32eb89bcaf66eb7c7674850db2745a81fad",
    "line" : 34,
    "diffHunk" : "@@ -1,1 +210,214 @@     *     Project [c_customer_id]\n     */\n    def simplifyNode(node: SparkPlan, depth: Int): String = {\n      val padding = \"  \" * depth\n      var thisNode = node.nodeName"
  },
  {
    "id" : "28681583-9a28-4ca2-97ce-5fb6c8e01539",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-459883432",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e3af4ef8-04c1-4e90-9236-4a234d75b476",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Can you explain the simplifying logic here by adding some method comments?",
        "createdAt" : "2020-08-02T06:31:31Z",
        "updatedAt" : "2020-08-17T09:39:09Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "5606d863-3edc-426a-87d7-63dbe7de7d2a",
        "parentId" : "e3af4ef8-04c1-4e90-9236-4a234d75b476",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "added: 3186b87",
        "createdAt" : "2020-08-03T09:31:29Z",
        "updatedAt" : "2020-08-17T09:39:09Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 178,
    "diffHunk" : "@@ -1,1 +176,180 @@   * expect to avoid frequent plan changing and catch the possible meaningful regression.\n   */\n  private def getSimplifiedPlan(plan: SparkPlan): String = {\n    val exchangeIdMap = new mutable.HashMap[Int, Int]()\n    val subqueriesMap = new mutable.HashMap[Int, Int]()"
  },
  {
    "id" : "111f8b1e-5972-4d31-844c-08ff22a50f8f",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-465720432",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c4c6668c-32da-4bd1-acbe-a6b7d8ce5082",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "Is this test related to the adaptive execution?",
        "createdAt" : "2020-08-11T23:47:02Z",
        "updatedAt" : "2020-08-17T09:39:09Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "03125502-e6e5-4c9d-8ac0-e1399f1d7343",
        "parentId" : "c4c6668c-32da-4bd1-acbe-a6b7d8ce5082",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "This test can fail when enable AQE since AQE could generate different plans. So, `DisableAdaptiveExecutionSuite` is used to prevent test failure after enabling AQE. ",
        "createdAt" : "2020-08-12T02:30:22Z",
        "updatedAt" : "2020-08-17T09:39:09Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "c7f8500a-67fc-459d-a51f-578da0ac15ec",
        "parentId" : "c4c6668c-32da-4bd1-acbe-a6b7d8ce5082",
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "Oh, I see.",
        "createdAt" : "2020-08-12T08:55:15Z",
        "updatedAt" : "2020-08-17T09:39:09Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 73,
    "diffHunk" : "@@ -1,1 +71,75 @@ */\n// scalastyle:on line.size.limit\ntrait PlanStabilitySuite extends TPCDSBase with DisableAdaptiveExecutionSuite {\n\n  private val originalMaxToStringFields = conf.maxToStringFields"
  },
  {
    "id" : "7f8fa62a-0b0e-464e-8c0c-283a92cc0215",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-466420906",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a5559e5a-ed6d-4182-9c7b-c99b72f763cb",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "We need `@ExtendedSQLTest` for the added new test suites?",
        "createdAt" : "2020-08-12T23:08:40Z",
        "updatedAt" : "2020-08-17T09:39:09Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "2368c61c-e297-4399-a319-b1e8795b243e",
        "parentId" : "a5559e5a-ed6d-4182-9c7b-c99b72f763cb",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "How long does these test suites take?",
        "createdAt" : "2020-08-13T03:32:11Z",
        "updatedAt" : "2020-08-17T09:39:09Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 257,
    "diffHunk" : "@@ -1,1 +255,259 @@}\n\nclass TPCDSV1_4_PlanStabilitySuite extends PlanStabilitySuite {\n  override val goldenFilePath: String =\n    new File(baseResourcePath, s\"approved-plans-v1_4\").getAbsolutePath"
  },
  {
    "id" : "a433e889-a039-44be-835a-4f81565d03d6",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-474153935",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a6feba78-d856-4ed9-ba97-57c9b145c928",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I think we usually say a golden file instead of a approved file.",
        "createdAt" : "2020-08-25T04:54:01Z",
        "updatedAt" : "2020-08-25T04:54:02Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "5da91031-e72c-461c-8019-694f1f68e222",
        "parentId" : "a6feba78-d856-4ed9-ba97-57c9b145c928",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "I can rename it to `generateGoldenFile` since we prefer `expected` compares to `approved`. ",
        "createdAt" : "2020-08-25T05:52:49Z",
        "updatedAt" : "2020-08-25T05:52:49Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 118,
    "diffHunk" : "@@ -1,1 +116,120 @@   *                plan is not too useful for debugging\n   */\n  private def generateApprovedPlanFile(plan: SparkPlan, name: String, explain: String): Unit = {\n    val dir = getDirForTest(name)\n    val simplified = getSimplifiedPlan(plan)"
  },
  {
    "id" : "9ac5b0e6-c2ba-4b46-acb4-62a10fc768fa",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-474157134",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3735bc1e-a2ac-45d4-8fac-237554b902e1",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Same name of the function (inner and outer) looks a bit odd ...",
        "createdAt" : "2020-08-25T04:55:36Z",
        "updatedAt" : "2020-08-25T04:55:36Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "77274120-1c9a-4d02-a2da-47465e1718e5",
        "parentId" : "3735bc1e-a2ac-45d4-8fac-237554b902e1",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Let me rename it to `simplifyNode`.",
        "createdAt" : "2020-08-25T06:00:50Z",
        "updatedAt" : "2020-08-25T06:00:50Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 210,
    "diffHunk" : "@@ -1,1 +208,212 @@     *     Project [c_customer_id]\n     */\n    def getSimplifiedPlan(node: SparkPlan, depth: Int): String = {\n      val padding = \"  \" * depth\n      var thisNode = node.nodeName"
  },
  {
    "id" : "8aa72d7d-c93c-4a89-8658-01d61560359e",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-474151457",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "134dea0b-5416-48ec-a6f3-99998eed3ed7",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "If `actualSimplifiedPlan` refers `expected` vs `actual`, I think it would be nicer if we rename `approved` to `expected`.",
        "createdAt" : "2020-08-25T05:00:17Z",
        "updatedAt" : "2020-08-25T05:00:17Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "09b651a1-db79-4494-b220-10377165df1a",
        "parentId" : "134dea0b-5416-48ec-a6f3-99998eed3ed7",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Sounds reasonable.",
        "createdAt" : "2020-08-25T05:46:39Z",
        "updatedAt" : "2020-08-25T05:46:39Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 106,
    "diffHunk" : "@@ -1,1 +104,108 @@    val file = new File(dir, \"simplified.txt\")\n    val approved = FileUtils.readFileToString(file, StandardCharsets.UTF_8)\n    approved == actualSimplifiedPlan\n  }\n"
  },
  {
    "id" : "311c22ba-daba-4983-91d9-585d0eed4137",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-487407421",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f6d80b36-994b-4cdf-b23e-6f0eb222e54e",
        "parentId" : null,
        "authorId" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "body" : "Does this work? \r\n\r\nIn my environment, I have to do something like \r\n> SPARK_GENERATE_GOLDEN_FILES=1 build/sbt \"sql/test-only *PlanStabilitySuite *PlanStabilityWithStatsSuite\"\r\n",
        "createdAt" : "2020-09-13T05:09:36Z",
        "updatedAt" : "2020-09-13T05:09:36Z",
        "lastEditedBy" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "tags" : [
        ]
      },
      {
        "id" : "7f0b6e94-5e78-4bfa-aa82-b7df7406c0f6",
        "parentId" : "f6d80b36-994b-4cdf-b23e-6f0eb222e54e",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "`[WithStats]` means you can add it or not when running this command. It's not a supported syntax for SBT...",
        "createdAt" : "2020-09-14T04:27:04Z",
        "updatedAt" : "2020-09-14T04:27:05Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +62,66 @@ * To re-generate golden files for entire suite, run:\n * {{{\n *   SPARK_GENERATE_GOLDEN_FILES=1 build/sbt \"sql/test-only *PlanStability[WithStats]Suite\"\n * }}}\n *"
  },
  {
    "id" : "1988f086-15d1-4b19-9f50-467ed7108444",
    "prId" : 29270,
    "prUrl" : "https://github.com/apache/spark/pull/29270#pullrequestreview-487275239",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "134f0b1f-315e-499e-9d69-966be1e416d6",
        "parentId" : null,
        "authorId" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "body" : "the same here. ",
        "createdAt" : "2020-09-13T05:10:31Z",
        "updatedAt" : "2020-09-13T05:10:31Z",
        "lastEditedBy" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebdf7fe325ef10228eb129dd10c6db566ef584d8",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +52,56 @@ * To run the entire test suite:\n * {{{\n *   build/sbt \"sql/test-only *PlanStability[WithStats]Suite\"\n * }}}\n *"
  }
]