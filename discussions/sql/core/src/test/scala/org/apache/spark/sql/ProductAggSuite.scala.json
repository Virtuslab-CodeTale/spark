[
  {
    "id" : "4c4477ad-e8b7-4196-a984-cdefa2befec2",
    "prId" : 30745,
    "prUrl" : "https://github.com/apache/spark/pull/30745#pullrequestreview-599749818",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b31bde02-32ef-4119-8b11-4c612e7b0adc",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "Can we move the tests to `DataFrameAggregateSuite` and `DataFrameWindowFunctionsSuite`, and use the test infra there? Then you don't need to specify the encoder manually and can use `checkAnswer` to check result.",
        "createdAt" : "2021-02-26T09:21:10Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "17e5c344-ab91-4d5f-b4c8-3b6cfafe498a",
        "parentId" : "b31bde02-32ef-4119-8b11-4c612e7b0adc",
        "authorId" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "body" : "Is this a high priority change - it's not clear whether this will make the existing tests substantially more effective?",
        "createdAt" : "2021-02-26T12:26:29Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "tags" : [
        ]
      },
      {
        "id" : "1d0da1ae-0ac9-4cd8-8b97-a36f289342db",
        "parentId" : "b31bde02-32ef-4119-8b11-4c612e7b0adc",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "The test infra will do more checks for you automatically. e.g. it checks the structural integrity of the plan, it checks RDD serialization, etc.\r\n\r\nI'm OK if you insist to create a new suite for product, but please follow `DataFrameAggregateSuite` to write tests.",
        "createdAt" : "2021-02-26T13:25:36Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "f269026c-0c66-4222-ae06-e50cc482d768",
        "parentId" : "b31bde02-32ef-4119-8b11-4c612e7b0adc",
        "authorId" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "body" : "Thanks, @cloud-fan - that's useful to know.\r\nFor the current (low risk?) `product` aggregation, I'm doubtful that making these changes is justifiable at this stage of development.\r\nObviously, for any future patches I develop, I'll be happy to build these around `DataFrameAggregateSuite` where appropriate.",
        "createdAt" : "2021-02-26T13:49:16Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "tags" : [
        ]
      },
      {
        "id" : "c5c6d21d-2961-4c8f-8093-74d72df6e87d",
        "parentId" : "b31bde02-32ef-4119-8b11-4c612e7b0adc",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "It's not only about risk, but also about having a consistent code style for writing tests in Spark. If another people is trying to add a new agg function as you did, and sees this test suite,he/she may follow it to write a new test suite, which is unexpected.\r\n\r\nIf you don't have time to do this, please create a JIRA ticket for rewriting this test suite, add a TODO with the JIRA ID here, so that other people won't follow it to write tests.",
        "createdAt" : "2021-02-26T14:07:39Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "c42b0fde-b4d2-4224-b78e-8fc45dca3dfe",
        "parentId" : "b31bde02-32ef-4119-8b11-4c612e7b0adc",
        "authorId" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "body" : "Ok, I've rebuilt `sql/ProductAggSuite.scala` to be more like `DataFrameAggregateSuite`.",
        "createdAt" : "2021-02-26T16:41:07Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "tags" : [
        ]
      }
    ],
    "commit" : "1cdabcbdab2d54c67f09139f3b6cea1b2c09e04e",
    "line" : 47,
    "diffHunk" : "@@ -1,1 +45,49 @@\n  test(\"type flexibility\") {\n    val bytes16 = spark.createDataset((1 to 16).map { _.toByte })(Encoders.scalaByte).toDF(\"x\")\n\n    val variants = Map("
  },
  {
    "id" : "4b8cf682-2197-4f88-a15d-a9d335e33171",
    "prId" : 30745,
    "prUrl" : "https://github.com/apache/spark/pull/30745#pullrequestreview-600536683",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9f978885-2da9-4d8f-8fb0-4a18c32f7d56",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "we can follow `DataFrameAggregateSuite` and do `import testImplicits._` here, then we don't need to specify encoders manually in the test.",
        "createdAt" : "2021-03-01T09:31:24Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "1cdabcbdab2d54c67f09139f3b6cea1b2c09e04e",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +26,30 @@class ProductAggSuite extends QueryTest\n  with SharedSparkSession {\n\n  // Sequence of integers small enough that factorial is representable exactly as DoubleType:\n  private lazy val data16 = spark.range(1, 17).toDF(\"x\")"
  },
  {
    "id" : "8a27a45d-e7ca-4b38-a6ec-773508a9087b",
    "prId" : 30745,
    "prUrl" : "https://github.com/apache/spark/pull/30745#pullrequestreview-601016456",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bf9010ec-6f91-47f1-adae-9ff441e36ca4",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "let's add a `.sortBy(col(\"x\"))`, to explicitly get the top 5 elements.",
        "createdAt" : "2021-03-01T09:34:24Z",
        "updatedAt" : "2021-03-01T17:18:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "9675582d-05f4-4008-985f-6c06972f6f28",
        "parentId" : "bf9010ec-6f91-47f1-adae-9ff441e36ca4",
        "authorId" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "body" : "Fair point - the `Window` doesn't guarantee that the output will be ordered, although that's almost certain to be the case on this tiny dataset.\r\nI've added a `.sortBy` elsewhere to make this safer, thanks.",
        "createdAt" : "2021-03-01T18:00:39Z",
        "updatedAt" : "2021-03-01T18:00:39Z",
        "lastEditedBy" : "dc7a33cf-bba6-4512-a5a1-248c3cac6eae",
        "tags" : [
        ]
      }
    ],
    "commit" : "1cdabcbdab2d54c67f09139f3b6cea1b2c09e04e",
    "line" : 75,
    "diffHunk" : "@@ -1,1 +73,77 @@\n    checkAnswer(\n      prodFactorials.limit(5),\n      Seq(\n        Row(1, 1.0),"
  }
]