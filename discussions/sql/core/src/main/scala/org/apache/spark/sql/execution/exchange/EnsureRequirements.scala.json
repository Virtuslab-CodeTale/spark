[
  {
    "id" : "13162e36-2430-46b0-8709-e1311a5a2d98",
    "prId" : 33541,
    "prUrl" : "https://github.com/apache/spark/pull/33541#pullrequestreview-718762829",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "554420a9-7140-49a1-97e1-bccaedfa86a2",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "The logic here is simplified as well. Now it's pretty simple to keep the old logic and try our best to optimize out user-specified repartition.\r\n\r\nhttps://github.com/apache/spark/commit/7fe4c4a9ad92cedd398a13a1781649dff57ca4d9 can be reverted to avoid perf regreession.",
        "createdAt" : "2021-07-29T07:12:27Z",
        "updatedAt" : "2021-07-29T07:15:40Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "5fa8ded9-00d1-456c-9f12-c94bbfa7232d",
        "parentId" : "554420a9-7140-49a1-97e1-bccaedfa86a2",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "The previous check is to avoid AQE change output partitioning during execution (not the final stage). So I suggested do not remove all shuffle origin before.",
        "createdAt" : "2021-07-29T11:42:01Z",
        "updatedAt" : "2021-07-29T11:42:30Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      },
      {
        "id" : "fe2998cf-0651-44f2-a740-3f2560ce8388",
        "parentId" : "554420a9-7140-49a1-97e1-bccaedfa86a2",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "why do we care about user-specified repartition if it's not in the final stage?",
        "createdAt" : "2021-07-30T04:34:29Z",
        "updatedAt" : "2021-07-30T04:34:30Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "ef427ee2-dc89-4f24-a9b4-5477f23632f8",
        "parentId" : "554420a9-7140-49a1-97e1-bccaedfa86a2",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "User may want to have a custom shuffle partition number with `/*+ repartition(10000, col) */`. If this shuffle is removed, I think it will break user expectaion.",
        "createdAt" : "2021-07-30T05:27:06Z",
        "updatedAt" : "2021-07-30T05:27:06Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      },
      {
        "id" : "a393ec20-516b-405b-8e9e-3b564ee6f56e",
        "parentId" : "554420a9-7140-49a1-97e1-bccaedfa86a2",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "This may be good or not, but my change here is to revert back to the behavior in 3.1, to make sure we don't have perf regression in 3.2",
        "createdAt" : "2021-07-30T06:34:23Z",
        "updatedAt" : "2021-07-30T06:34:23Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "c99463d3-02af-4c08-aa3c-161bb7346c94",
        "parentId" : "554420a9-7140-49a1-97e1-bccaedfa86a2",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "ok I'm fine with this",
        "createdAt" : "2021-07-30T06:36:45Z",
        "updatedAt" : "2021-07-30T06:36:45Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      }
    ],
    "commit" : "61cc6751e4baad96f0a8b251296c6e58ffbbf3a3",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +258,262 @@    case operator @ ShuffleExchangeExec(upper: HashPartitioning, child, shuffleOrigin)\n        if optimizeOutRepartition &&\n          (shuffleOrigin == REPARTITION_BY_COL || shuffleOrigin == REPARTITION_BY_NUM) =>\n      def hasSemanticEqualPartitioning(partitioning: Partitioning): Boolean = {\n        partitioning match {"
  }
]