[
  {
    "id" : "95fba07c-8807-48ba-88d4-93d788a3f965",
    "prId" : 33541,
    "prUrl" : "https://github.com/apache/spark/pull/33541#pullrequestreview-717581804",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "15115db9-5c2c-45cb-b0d9-286996987872",
        "parentId" : null,
        "authorId" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "body" : "too strict? can user-specified partitioning appear here?",
        "createdAt" : "2021-07-28T18:55:50Z",
        "updatedAt" : "2021-07-28T18:55:50Z",
        "lastEditedBy" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "tags" : [
        ]
      },
      {
        "id" : "c4261356-4162-490b-9704-15f208ba155f",
        "parentId" : "15115db9-5c2c-45cb-b0d9-286996987872",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "shuffle can only be added by `df.repartition` or `EnsureRequirements`, all the possible partitioning has been listed here.",
        "createdAt" : "2021-07-29T01:12:58Z",
        "updatedAt" : "2021-07-29T01:12:58Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "61cc6751e4baad96f0a8b251296c6e58ffbbf3a3",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +83,87 @@        case r: RoundRobinPartitioning =>\n          r.copy(numPartitions = partitionSpecs.length)\n        case other => throw new IllegalStateException(\n          \"Unexpected partitioning for coalesced shuffle read: \" + other)\n      }"
  },
  {
    "id" : "72ef5a4d-f64d-4e8f-ac1a-68d6da6773f7",
    "prId" : 33541,
    "prUrl" : "https://github.com/apache/spark/pull/33541#pullrequestreview-717580834",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5c524cdb-8626-4b1a-b408-edd7e9a421a8",
        "parentId" : null,
        "authorId" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "body" : "is `CurrentOrigin.withOrigin()` also needed here?",
        "createdAt" : "2021-07-28T18:57:30Z",
        "updatedAt" : "2021-07-28T18:57:31Z",
        "lastEditedBy" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "tags" : [
        ]
      },
      {
        "id" : "b6519eea-2aab-47ed-8f21-df4890c0a771",
        "parentId" : "5c524cdb-8626-4b1a-b408-edd7e9a421a8",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "no, `RoundRobinPartitioning` is not an expression.",
        "createdAt" : "2021-07-29T01:10:08Z",
        "updatedAt" : "2021-07-29T01:10:08Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "61cc6751e4baad96f0a8b251296c6e58ffbbf3a3",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +81,85 @@        // This can only happen for `REBALANCE_PARTITIONS_BY_NONE`, which uses\n        // `RoundRobinPartitioning` but we don't need to retain the number of partitions.\n        case r: RoundRobinPartitioning =>\n          r.copy(numPartitions = partitionSpecs.length)\n        case other => throw new IllegalStateException("
  },
  {
    "id" : "d69c720d-c240-49af-8fcf-89357adfbe69",
    "prId" : 33541,
    "prUrl" : "https://github.com/apache/spark/pull/33541#pullrequestreview-718711014",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b568e33d-4e99-468c-a8d6-becaa2f83a5c",
        "parentId" : null,
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "We need ensure here is no skewedPartition.",
        "createdAt" : "2021-07-29T11:09:34Z",
        "updatedAt" : "2021-07-29T11:42:30Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      },
      {
        "id" : "a36283a9-adf7-4e30-ba36-39420b074d9a",
        "parentId" : "b568e33d-4e99-468c-a8d6-becaa2f83a5c",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "It's ensured by this new method `isCoalescedRead`",
        "createdAt" : "2021-07-30T04:31:45Z",
        "updatedAt" : "2021-07-30T04:31:46Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "61cc6751e4baad96f0a8b251296c6e58ffbbf3a3",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +71,75 @@          throw new IllegalStateException(\"operating on canonicalization plan\")\n      }\n    } else if (isCoalescedRead) {\n      // For coalesced shuffle read, the data distribution is not changed, only the number of\n      // partitions is changed."
  },
  {
    "id" : "c44b02b8-249f-40ee-93e2-e6a0c5c2dc60",
    "prId" : 33541,
    "prUrl" : "https://github.com/apache/spark/pull/33541#pullrequestreview-718762398",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c8a32156-2d2f-4fb6-8762-349b65ab0131",
        "parentId" : null,
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "shall we add check if the coalesced partition is only at first/last position.",
        "createdAt" : "2021-07-29T11:36:31Z",
        "updatedAt" : "2021-07-29T11:42:30Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      },
      {
        "id" : "e75f630c-f506-4542-9976-5b036a691d1d",
        "parentId" : "c8a32156-2d2f-4fb6-8762-349b65ab0131",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "what do you mean? coalesced partition can be in any position",
        "createdAt" : "2021-07-30T04:32:30Z",
        "updatedAt" : "2021-07-30T04:32:30Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "9f8afd54-8d27-4a03-8573-24a3c2f56946",
        "parentId" : "c8a32156-2d2f-4fb6-8762-349b65ab0131",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "A corner case. If the last partition size is 0, we may discard that partition directly which doesn't combine to previous partition. So this check is incorrect If the last partition size is 0 and other partition size is big enough. here existed a test in `ShufflePartitionsUtilSuite`:\r\n```\r\n    {\r\n      // There are a few large shuffle partitions.\r\n      val bytesByPartitionId = Array[Long](110, 10, 100, 110, 0)\r\n      val expectedPartitionSpecs = Seq(\r\n        CoalescedPartitionSpec(0, 1, 110),\r\n        CoalescedPartitionSpec(1, 2, 10),\r\n        CoalescedPartitionSpec(2, 3, 100),\r\n        CoalescedPartitionSpec(3, 4, 110))\r\n      checkEstimation(Array(bytesByPartitionId), expectedPartitionSpecs :: Nil, targetSize)\r\n    }\r\n```",
        "createdAt" : "2021-07-30T05:23:22Z",
        "updatedAt" : "2021-07-30T05:23:22Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      },
      {
        "id" : "f4e10999-4445-446e-88e2-7339627b9d11",
        "parentId" : "c8a32156-2d2f-4fb6-8762-349b65ab0131",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "the code here works for this case, or do I miss something?",
        "createdAt" : "2021-07-30T06:21:13Z",
        "updatedAt" : "2021-07-30T06:21:13Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "b63287bd-83ee-49c0-b2df-ec16a31677af",
        "parentId" : "c8a32156-2d2f-4fb6-8762-349b65ab0131",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "you are right. it works",
        "createdAt" : "2021-07-30T06:35:54Z",
        "updatedAt" : "2021-07-30T06:35:55Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      }
    ],
    "commit" : "61cc6751e4baad96f0a8b251296c6e58ffbbf3a3",
    "line" : 73,
    "diffHunk" : "@@ -1,1 +134,138 @@      case Seq(_: CoalescedPartitionSpec) => true\n      case Seq(l: CoalescedPartitionSpec, r: CoalescedPartitionSpec) =>\n        l.endReducerIndex <= r.startReducerIndex\n      case _ => false\n    }"
  }
]