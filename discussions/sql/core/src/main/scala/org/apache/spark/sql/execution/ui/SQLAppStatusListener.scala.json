[
  {
    "id" : "e31dfb53-1f53-4a75-a204-e9ce7aea1f7c",
    "prId" : 31451,
    "prUrl" : "https://github.com/apache/spark/pull/31451#pullrequestreview-636929725",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ddbcf9d0-8b21-4b9d-b947-625b83a766e1",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "nit: this can be merged to the line above.",
        "createdAt" : "2021-04-15T10:34:21Z",
        "updatedAt" : "2021-04-20T06:45:33Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "7700e044-ada6-45f6-93b9-6e8a2df978c4",
        "parentId" : "ddbcf9d0-8b21-4b9d-b947-625b83a766e1",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "merged.",
        "createdAt" : "2021-04-15T17:05:02Z",
        "updatedAt" : "2021-04-20T06:45:33Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "06eb9c79a3fdd807ec08540deb2234939396325a",
    "line" : 92,
    "diffHunk" : "@@ -1,1 +291,295 @@    val aggregatedMetrics = allMetrics.map { case (id, values) =>\n      id -> metricAggregationMethods(id)(values, maxMetricsFromAllStages.getOrElse(id,\n        Array.empty[Long]))\n    }.toMap\n"
  },
  {
    "id" : "c6f3cad2-9f5a-4441-9ee4-790af5aabef0",
    "prId" : 26821,
    "prUrl" : "https://github.com/apache/spark/pull/26821#pullrequestreview-331022756",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d04e343d-862c-46c9-89bb-b32a28bf37ec",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "I think this should be after `foreach` statement.",
        "createdAt" : "2019-12-12T09:09:27Z",
        "updatedAt" : "2019-12-12T09:24:31Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6b2c5a3cc46d25595bfa7e187846187dd5ac806",
    "line" : 20,
    "diffHunk" : "@@ -1,1 +69,73 @@        exec.metricsValues = aggregateMetrics(exec)\n        exec.write(kvstore, now)\n        if (appId != null) {\n          kvstore.write(new SQLAppStatusListenerData(appId, attemptId,\n            liveExecutions, stageMetrics))"
  },
  {
    "id" : "92b8d466-99a4-432b-99da-6cb83a14f5ba",
    "prId" : 26821,
    "prUrl" : "https://github.com/apache/spark/pull/26821#pullrequestreview-331022756",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b2e90c3b-e633-4534-9d17-a2204a6f7bb8",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "same here",
        "createdAt" : "2019-12-12T09:09:45Z",
        "updatedAt" : "2019-12-12T09:22:06Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6b2c5a3cc46d25595bfa7e187846187dd5ac806",
    "line" : 30,
    "diffHunk" : "@@ -1,1 +79,83 @@  def initialize(appId: String, attemptId: Option[String]): Unit = {\n    if (!live) {\n      this.appId = appId\n      this.attemptId = attemptId\n      try {"
  },
  {
    "id" : "501ec94e-b352-4b59-abbb-3794f95247e2",
    "prId" : 26821,
    "prUrl" : "https://github.com/apache/spark/pull/26821#pullrequestreview-331022756",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ebd7b438-b499-4f89-842a-ea3cde2a488d",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "exec.metricsValues may need to be reset to null, see comment on `kvstore.onFlush`",
        "createdAt" : "2019-12-12T09:10:49Z",
        "updatedAt" : "2019-12-12T09:22:06Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6b2c5a3cc46d25595bfa7e187846187dd5ac806",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +85,89 @@          Array(Some(appId), attemptId))\n        listenerData.liveExecutions.entrySet().asScala.foreach { entry =>\n          liveExecutions.put(entry.getKey, entry.getValue)\n        }\n        listenerData.stageMetrics.entrySet().asScala.foreach { entry =>"
  },
  {
    "id" : "a9ca6603-df9b-416d-a6b9-a453b6a73de9",
    "prId" : 26405,
    "prUrl" : "https://github.com/apache/spark/pull/26405#pullrequestreview-315190175",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "521e0129-7590-40ff-be0a-459dbc1d54d3",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "As a side-effect, this PR seems to increase the number of invocation `update(exec)` exactly twice. Is this okay?",
        "createdAt" : "2019-11-10T05:53:43Z",
        "updatedAt" : "2019-11-10T05:53:43Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "15479166-83b1-44f2-b119-6ccd28b01501",
        "parentId" : "521e0129-7590-40ff-be0a-459dbc1d54d3",
        "authorId" : "0b3111e2-9584-4813-8cb5-8f40e119f71c",
        "body" : "Yes.",
        "createdAt" : "2019-11-11T22:14:26Z",
        "updatedAt" : "2019-11-11T22:14:27Z",
        "lastEditedBy" : "0b3111e2-9584-4813-8cb5-8f40e119f71c",
        "tags" : [
        ]
      },
      {
        "id" : "a8e0605e-15bb-446e-ac4b-3800f1135e83",
        "parentId" : "521e0129-7590-40ff-be0a-459dbc1d54d3",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Got it. Thank you for confirming.",
        "createdAt" : "2019-11-11T22:18:01Z",
        "updatedAt" : "2019-11-11T22:18:01Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "e28df7e578d360597b4c928df4c48df1e0e52a51",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +323,327 @@    Option(liveExecutions.get(executionId)).foreach { exec =>\n      exec.completionTime = Some(new Date(time))\n      update(exec)\n\n      // Aggregating metrics can be expensive for large queries, so do it asynchronously. The end"
  },
  {
    "id" : "0b8818bb-2d45-4862-a4f1-22c32a7adc71",
    "prId" : 26218,
    "prUrl" : "https://github.com/apache/spark/pull/26218#pullrequestreview-306910060",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6fdfad17-67fb-4795-99aa-7b7911d2aad1",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "~In `{ stage =>`, can we use `metrics` or `stageMetrics` or `liveStageMetrics` instead of `stage`?~\r\nNever mind.",
        "createdAt" : "2019-10-24T23:03:50Z",
        "updatedAt" : "2019-10-25T00:52:21Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "6377c701620d9c6b344993a8bf4c2c1acd267c00",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +123,127 @@\n    // Reset the metrics tracking object for the new attempt.\n    Option(stageMetrics.get(event.stageInfo.stageId)).foreach { stage =>\n      if (stage.attemptId != event.stageInfo.attemptNumber) {\n        stageMetrics.put(event.stageInfo.stageId,"
  },
  {
    "id" : "0ec9a23c-8347-408b-bf89-5197b34bb4f4",
    "prId" : 26218,
    "prUrl" : "https://github.com/apache/spark/pull/26218#pullrequestreview-306936340",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e91d0b24-5eb9-45bf-b5ce-311681c402fa",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Actually, it seems that we need a little comment for this, @vanzin .\r\nThis PR defines the following.\r\n```scala\r\n  /**\r\n   * Mapping of task IDs to the partition index they're computing. Note this may contain more\r\n   * elements than the stage's number of tasks, if speculative execution is on.\r\n   */\r\n  private val taskIndices = new OpenHashMap[Long, Int]()\r\n```\r\n\r\nHowever, we are putting `TaskInfo.Index` which is defined like the following.\r\n```scala\r\n@DeveloperApi\r\nclass TaskInfo(\r\n    val taskId: Long,\r\n    /**\r\n     * The index of this task within its task set. Not necessarily the same as the ID of the RDD\r\n     * partition that the task is computing.\r\n     */\r\n    val index: Int,\r\n```\r\n\r\nI guess we can update the definition of `taskIndices` by using `task index` instead of `partition index`. How do you think about that?",
        "createdAt" : "2019-10-24T23:22:37Z",
        "updatedAt" : "2019-10-25T00:52:21Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "3495e934-712a-4f4e-9805-d89fe2b12e7d",
        "parentId" : "e91d0b24-5eb9-45bf-b5ce-311681c402fa",
        "authorId" : "0b3111e2-9584-4813-8cb5-8f40e119f71c",
        "body" : "See below. ",
        "createdAt" : "2019-10-24T23:52:30Z",
        "updatedAt" : "2019-10-25T00:52:21Z",
        "lastEditedBy" : "0b3111e2-9584-4813-8cb5-8f40e119f71c",
        "tags" : [
        ]
      },
      {
        "id" : "64ab29f1-a67b-4aa9-8909-8b37848370eb",
        "parentId" : "e91d0b24-5eb9-45bf-b5ce-311681c402fa",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Thank you for the explanation. However, simply put, when `taskIndices` maintain a copy of `TaskInfo.taskId` and `TaskInfo.index`, can we call them, `taskId` and `taskIndex`, literally? The variable name is already _task**Indices**_.",
        "createdAt" : "2019-10-25T00:10:53Z",
        "updatedAt" : "2019-10-25T00:52:21Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "96629e3f-7050-4692-a97e-77803d0a6084",
        "parentId" : "e91d0b24-5eb9-45bf-b5ce-311681c402fa",
        "authorId" : "0b3111e2-9584-4813-8cb5-8f40e119f71c",
        "body" : "Man, if that's going to make you drop this discussion, I'll call them \"pink unicorns\" if that's what you want. The variable name won't help you understand the relationship between partitions and indices and why it's important to track this.",
        "createdAt" : "2019-10-25T00:53:13Z",
        "updatedAt" : "2019-10-25T00:53:14Z",
        "lastEditedBy" : "0b3111e2-9584-4813-8cb5-8f40e119f71c",
        "tags" : [
        ]
      }
    ],
    "commit" : "6377c701620d9c6b344993a8bf4c2c1acd267c00",
    "line" : 62,
    "diffHunk" : "@@ -1,1 +155,159 @@    Option(stageMetrics.get(event.stageId)).foreach { stage =>\n      if (stage.attemptId == event.stageAttemptId) {\n        stage.registerTask(event.taskInfo.taskId, event.taskInfo.index)\n      }\n    }"
  }
]