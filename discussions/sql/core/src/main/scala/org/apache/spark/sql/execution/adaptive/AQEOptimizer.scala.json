[
  {
    "id" : "4dd3a9c4-6243-4a01-b607-4ba3e5652a7e",
    "prId" : 32724,
    "prUrl" : "https://github.com/apache/spark/pull/32724#pullrequestreview-673385491",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "91f09791-6a79-44fd-a593-9aed1f50457a",
        "parentId" : null,
        "authorId" : "c62ded40-3015-4888-8e91-d671d0f615be",
        "body" : "do we need a separate conf for `AQEOptimizer`",
        "createdAt" : "2021-06-01T17:06:05Z",
        "updatedAt" : "2021-06-01T17:06:05Z",
        "lastEditedBy" : "c62ded40-3015-4888-8e91-d671d0f615be",
        "tags" : [
        ]
      },
      {
        "id" : "93317af2-adcf-4e08-90cc-ca630c851f07",
        "parentId" : "91f09791-6a79-44fd-a593-9aed1f50457a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "I don't see a user request at least until now",
        "createdAt" : "2021-06-01T17:12:06Z",
        "updatedAt" : "2021-06-01T17:12:06Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "c7996bbdfc7af288979ea65102e7637d4c5da1a7",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +31,35 @@  private def fixedPoint =\n    FixedPoint(\n      conf.optimizerMaxIterations,\n      maxIterationsSetting = SQLConf.OPTIMIZER_MAX_ITERATIONS.key)\n"
  },
  {
    "id" : "b6c4a6d6-083f-4418-88c5-a3e5baab0c34",
    "prId" : 32602,
    "prUrl" : "https://github.com/apache/spark/pull/32602#pullrequestreview-672625084",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3afee352-8a91-4f99-a7a9-4c3d51b2a257",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "shall we also put `ConvertToLocalRelation` in this batch?",
        "createdAt" : "2021-05-31T16:42:26Z",
        "updatedAt" : "2021-05-31T16:42:26Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "25898a7d-e203-48af-8b6c-aefd016d0415",
        "parentId" : "3afee352-8a91-4f99-a7a9-4c3d51b2a257",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "yeah, I noticed it. We can put it so that we can propagate empty through `project/filter`. like such case:\r\n```\r\nAggregate\r\n  Project\r\n    Join\r\n      Shuffle\r\n```\r\nBut it need to isolate normal and AQE due to `transformWithPruning`.\r\n\r\nOtherhand I feel that it's similar if we just let `AQEPropagateEmptyRelation` support propagate `project/filter`. and the later is simpler. ",
        "createdAt" : "2021-06-01T02:47:27Z",
        "updatedAt" : "2021-06-01T02:47:27Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      },
      {
        "id" : "56bbf43b-71aa-4544-a571-0389ac2778b3",
        "parentId" : "3afee352-8a91-4f99-a7a9-4c3d51b2a257",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "It's a bit different:\r\n```\r\nProject\r\n  Shuffle Stage\r\n```\r\nFor the above case, we don't want to optimize it as the benefit is too small (removing a shuffle stage may cause regression)\r\n\r\n```\r\nProject\r\n  Sort\r\n    Shuffle Stage\r\n```\r\nFor the above case, we will optimize Sort -> Shuffle Stage to empty relation first. Then it makes sense to optimize further and optimize out project, as the shuffle stage is already gone.\r\n\r\nSo adding `ConvertToLocalRelation` looks the best solution here.",
        "createdAt" : "2021-06-01T02:53:51Z",
        "updatedAt" : "2021-06-01T02:54:20Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "9f4f2aba-218c-42ad-9b35-e0e894d24436",
        "parentId" : "3afee352-8a91-4f99-a7a9-4c3d51b2a257",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "ah I see, will do this.",
        "createdAt" : "2021-06-01T03:26:50Z",
        "updatedAt" : "2021-06-01T03:26:50Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      }
    ],
    "commit" : "624e45e27513933e9fe5615601d0dddac341a258",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +31,35 @@    Batch(\"Propagate Empty Relations\", Once,\n      AQEPropagateEmptyRelation,\n      UpdateAttributeNullability),\n    Batch(\"Demote BroadcastHashJoin\", Once, DemoteBroadcastHashJoin)\n  )"
  },
  {
    "id" : "ffaa262f-1ca0-4563-bc9f-b3ac2339ea2d",
    "prId" : 29585,
    "prUrl" : "https://github.com/apache/spark/pull/29585#pullrequestreview-486727710",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "fff1f1f3-f5ea-4e1e-a1bd-5c5563e5541b",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "NOTE: I noticed that we forgot to impmement it here.",
        "createdAt" : "2020-09-11T11:34:11Z",
        "updatedAt" : "2020-09-29T12:28:36Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      }
    ],
    "commit" : "e3c87429e7e6f463c4e7740c7a42e8b2def528b0",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +56,60 @@  }\n\n  override protected def isPlanIntegral(plan: LogicalPlan): Boolean = {\n    !Utils.isTesting || (plan.resolved &&\n      plan.find(PlanHelper.specialExpressionsInUnsupportedOperator(_).nonEmpty).isEmpty &&"
  }
]