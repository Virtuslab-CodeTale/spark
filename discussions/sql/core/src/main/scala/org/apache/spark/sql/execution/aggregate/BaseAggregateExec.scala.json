[
  {
    "id" : "f3191c4e-e4e3-4b65-aafe-7600d37b43af",
    "prId" : 28869,
    "prUrl" : "https://github.com/apache/spark/pull/28869#pullrequestreview-434584222",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3abc8b2b-9f36-4ead-a06d-f89d1639d71c",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "`producedAttributes` should be attributes produced by this node. But isn't `inputAggBufferAttributes` from child?",
        "createdAt" : "2020-06-20T19:17:09Z",
        "updatedAt" : "2020-06-22T03:41:22Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "ddba5d14-d3fd-432a-b87d-e929d8a64896",
        "parentId" : "3abc8b2b-9f36-4ead-a06d-f89d1639d71c",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Oh..the comment should actually be:\r\n\r\n`it's not empty when the inputAggBufferAttributes is not equal to the aggerate buffer attributes of child Aggregate, when the child  Aggregate contains the subquery in AggregateFunction.`\r\n\r\n\r\n\r\nAfter SPARK-31620, the inputAggBufferAttributes is not from children but the node itself when there're Final/PartialMerge aggregate expressions, see `inputAttributes()` above. (But please note that agg attributes are still the same between the parent agg node and child agg node when there's no subquery in agg expression)\r\n\r\n\r\nTherefore, in the case of SPARK-31620, we actually use the attributes produced by the node itself. But for other cases, we still use the agg  buffer attributes from the children, since `inputAggBufferAttributes` is equal to the agg buffer attributes from the children and so `inputAggBufferAttributes.filterNot(child.output.contains)` is empty.\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
        "createdAt" : "2020-06-22T03:36:11Z",
        "updatedAt" : "2020-06-22T03:41:22Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "04a2d4485021b8be1aa66936e2ca071bd52990a6",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +81,85 @@    // attributes of the child Aggregate, when the child Aggregate contains the subquery in\n    // AggregateFunction. See SPARK-31620 for more details.\n    AttributeSet(inputAggBufferAttributes.filterNot(child.output.contains))\n}"
  }
]