[
  {
    "id" : "e4a5cc8b-3878-44f9-a65b-e81da7745607",
    "prId" : 29614,
    "prUrl" : "https://github.com/apache/spark/pull/29614#pullrequestreview-481559013",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f3bc18ee-9642-4b56-b45d-5630c1c7577f",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "nit: can we use `collectFirst` instead?\r\n```\r\n   val immutablePartitionStageExists = streamedPlan.collectFirst {\r\n      case LogicalQueryStage(_, physicalPlan: SparkPlan)\r\n        if physicalPlan.collectFirst {\r\n          case s: ShuffleQueryStageExec if !s.shuffle.canChangeNumPartitions => s\r\n        }.nonEmpty => true\r\n    }.isDefined\r\n```",
        "createdAt" : "2020-09-03T07:18:15Z",
        "updatedAt" : "2020-09-03T07:18:16Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      }
    ],
    "commit" : "82f6cc656ebc1f77ef736f07bd3e0dd71eea07fe",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +45,49 @@    // it can't be rewritten to EmptyRelation because the conversion might lost user specified\n    // number partition information.\n    val immutablePartitionStageExists = streamedPlan.collect {\n      case LogicalQueryStage(_, physicalPlan: SparkPlan) =>\n        physicalPlan.collect {"
  },
  {
    "id" : "709abfa5-be8f-4d78-b685-2bed4f131873",
    "prId" : 29614,
    "prUrl" : "https://github.com/apache/spark/pull/29614#pullrequestreview-481559475",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9da01f2c-d400-489e-a736-3bbfb36c313e",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "nit: `canChangeNumPartitions== false` => `canChangeNumPartitions == false`",
        "createdAt" : "2020-09-03T07:19:00Z",
        "updatedAt" : "2020-09-03T07:19:01Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      }
    ],
    "commit" : "82f6cc656ebc1f77ef736f07bd3e0dd71eea07fe",
    "line" : 20,
    "diffHunk" : "@@ -1,1 +42,46 @@      buildPlan: LogicalPlan,\n      relation: HashedRelation): Boolean = {\n    // If streamedSide of the Join contains ShuffleQueryStageExec(canChangeNumPartitions== false)\n    // it can't be rewritten to EmptyRelation because the conversion might lost user specified\n    // number partition information."
  },
  {
    "id" : "91d4c869-84f9-4a22-9489-d81918e3a71f",
    "prId" : 29614,
    "prUrl" : "https://github.com/apache/spark/pull/29614#pullrequestreview-481562201",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "fdf90f89-6185-4c46-b962-4b2086dab533",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "nit format:\r\n```\r\n    !immutablePartitionStageExists && {\r\n      buildPlan match {\r\n        case LogicalQueryStage(_, stage: BroadcastQueryStageExec)\r\n          if stage.resultOption.get().isDefined\r\n            && stage.broadcast.relationFuture.get().value == relation => true\r\n        case _ => false\r\n      }\r\n    }\r\n```\r\n?",
        "createdAt" : "2020-09-03T07:23:04Z",
        "updatedAt" : "2020-09-03T07:23:04Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      }
    ],
    "commit" : "82f6cc656ebc1f77ef736f07bd3e0dd71eea07fe",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +54,58 @@    if (immutablePartitionStageExists) {\n      false\n    } else {\n      buildPlan match {\n        case LogicalQueryStage(_, stage: BroadcastQueryStageExec)"
  }
]