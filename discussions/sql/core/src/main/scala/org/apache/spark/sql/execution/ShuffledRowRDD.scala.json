[
  {
    "id" : "5732e9f8-4d72-40f0-b2fd-55e0ad8f14c8",
    "prId" : 33310,
    "prUrl" : "https://github.com/apache/spark/pull/33310#pullrequestreview-711411411",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2e7ee9b5-b520-49ea-8c09-8d4224cd254f",
        "parentId" : null,
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "I see this can reduce the partition number, but I'm not sure this approach has benefits of perf. The origin idea of `OptimizeLocalShuffleReader` is make reducer task run at the same executor of target mapper so that it can reduce some network IO.\r\n\r\nI think order by partition size only solve the issue partially. If we want to coalesce mappers, shall we check the coalesced mappers are at the same executor or node ?\r\n",
        "createdAt" : "2021-07-21T02:20:17Z",
        "updatedAt" : "2021-07-21T02:20:17Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      },
      {
        "id" : "962322a0-5a98-4601-a850-c0a44ce00bae",
        "parentId" : "2e7ee9b5-b520-49ea-8c09-8d4224cd254f",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "There is a TODO for it: https://github.com/apache/spark/pull/33310/files#diff-9df2adce46395944a9245289a01eb85e797ec460aaef725a8108ec1054e2772aR61",
        "createdAt" : "2021-07-21T05:55:31Z",
        "updatedAt" : "2021-07-21T05:55:31Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "5af59e75-08d5-4e04-b630-00b5bb270ae1",
        "parentId" : "2e7ee9b5-b520-49ea-8c09-8d4224cd254f",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "This PR has benefits when all the mappers have very small shuffle output and it's better to coalesce them.",
        "createdAt" : "2021-07-21T06:00:49Z",
        "updatedAt" : "2021-07-21T06:00:50Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "fe7fe177-a4c3-4197-b944-39b64159dc11",
        "parentId" : "2e7ee9b5-b520-49ea-8c09-8d4224cd254f",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "OK got it",
        "createdAt" : "2021-07-21T08:49:05Z",
        "updatedAt" : "2021-07-21T08:49:05Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      }
    ],
    "commit" : "b4b6b15b8841bc6e9e2452861db74440e5dcbcd2",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +190,194 @@\n      case CoalescedMapperPartitionSpec(startMapIndex, endMapIndex, numReducers) =>\n        tracker.getMapLocation(dependency, startMapIndex, endMapIndex)\n    }\n  }"
  }
]