[
  {
    "id" : "9bb036a6-04c9-4026-89b3-2a34ecfa18e8",
    "prId" : 33038,
    "prUrl" : "https://github.com/apache/spark/pull/33038#pullrequestreview-703649227",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7da0f282-7001-4008-a449-d84c5dcef2e1",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "\"A value not greater than 0 means that the StateStore doesn't support `prefixScan` API.\"",
        "createdAt" : "2021-07-11T07:42:38Z",
        "updatedAt" : "2021-07-11T08:08:07Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "ab7747bc-8870-43d3-a033-d6b079c154b8",
        "parentId" : "7da0f282-7001-4008-a449-d84c5dcef2e1",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "Thanks for the input! I agree we'd need to add more details.\r\n\r\nOne thing we may want to consider is that caller defines the prefix key, and it's natural (or we can document the behavior to `prefixScan` method doc) that it won't work if there's no prefix key.\r\n\r\nI feel we can just emphasize the behavior when the number is less than 1. I'll update the doc, and let's see whether it's good for you as well or not.",
        "createdAt" : "2021-07-12T01:09:11Z",
        "updatedAt" : "2021-07-12T01:09:11Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "42c105c4755542e657d7e3069cc4dd522f1f5ab3",
    "line" : 59,
    "diffHunk" : "@@ -1,1 +256,260 @@   * @param keySchema Schema of keys to be stored\n   * @param valueSchema Schema of value to be stored\n   * @param numColsPrefixKey The number of leftmost columns to be used as prefix key.\n   *                         A value not greater than 0 means the operator doesn't activate prefix\n   *                         key, and the operator should not call prefixScan method in StateStore."
  },
  {
    "id" : "646becbf-b218-4c5c-8cf7-540b1c7242c6",
    "prId" : 33038,
    "prUrl" : "https://github.com/apache/spark/pull/33038#pullrequestreview-703699804",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d6685382-8ea0-48fc-9356-d8158a9e2f1a",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Is this necessary to support by third-party StateStore implementation? If an implementation doesn't support it, what would happens? Could you clarify it in the doc?",
        "createdAt" : "2021-07-11T07:46:29Z",
        "updatedAt" : "2021-07-11T08:08:07Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "e377aa26-5850-41e9-aeb7-e9350284d6ab",
        "parentId" : "d6685382-8ea0-48fc-9356-d8158a9e2f1a",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "E.g., `MemoryStateStore` doesn't support it.",
        "createdAt" : "2021-07-11T07:46:53Z",
        "updatedAt" : "2021-07-11T08:08:07Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "e4335f2d-2baa-4b4a-afa9-93ce86ca99f5",
        "parentId" : "d6685382-8ea0-48fc-9356-d8158a9e2f1a",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "MemoryStateStore is for test purpose. I just skipped implementing it as there's no usage of prefix scan against MemoryStateStore. We can add it whenever we need, like the case we start to feel it'd be easier to test the prefix scan against MemoryStateStore.\r\n\r\nFor 3rd party implementations, I'd say it is necessary to support prefix scan to continue supporting further Spark version. They can still use the trick that throwing exception and saying \"this state store provider doesn't support session window\", but I'd rather not say the feature is limited to session window in the future, hence it would be eventually no longer true and more and more things cannot be supported by such state store providers.\r\n\r\nIn the documentation we can guide the trick and what will happen with the trick, but we probably couldn't update the doc every time for which functionalities will break if prefix scan is not supported. If we still want to allow 3rd party implementations to support partial features, I'll add a guide in the doc.",
        "createdAt" : "2021-07-12T01:28:43Z",
        "updatedAt" : "2021-07-12T01:28:44Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "41672235-a035-4d73-9c55-6fc2b1062060",
        "parentId" : "d6685382-8ea0-48fc-9356-d8158a9e2f1a",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "I just commented on \"partial implementation\" of state store.",
        "createdAt" : "2021-07-12T04:09:24Z",
        "updatedAt" : "2021-07-12T04:09:24Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "42c105c4755542e657d7e3069cc4dd522f1f5ab3",
    "line" : 39,
    "diffHunk" : "@@ -1,1 +76,80 @@   * to the greater than 0.\n   */\n  def prefixScan(prefixKey: UnsafeRow): Iterator[UnsafeRowPair]\n\n  /** Return an iterator containing all the key-value pairs in the StateStore. */"
  }
]