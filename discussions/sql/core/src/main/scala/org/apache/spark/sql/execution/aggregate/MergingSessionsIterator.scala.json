[
  {
    "id" : "6b96f215-f095-4180-863d-41ad4898840b",
    "prId" : 31987,
    "prUrl" : "https://github.com/apache/spark/pull/31987#pullrequestreview-690327205",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "46143a3d-5621-413d-8989-5b02872bd2b4",
        "parentId" : null,
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Not a big deal and can be addressed later. Duplicated code with `SortBasedAggregationIterator`, I think we can avoid this by adding some abstractions.",
        "createdAt" : "2021-06-21T15:12:03Z",
        "updatedAt" : "2021-06-21T15:42:59Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      },
      {
        "id" : "e7d2de77-20ac-47ce-b67e-1fee24c14652",
        "parentId" : "46143a3d-5621-413d-8989-5b02872bd2b4",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "Unfortunately I don't remember clear as the original code is 2.5+ years ago, but I guess I tried to deduplicate with SortBasedAggregationIterator but gave up due to its complexity. The file is quite a copy and paste of SortBasedAggregationIterator, so you'll find lots of duplicated codes here. If someone has brilliant idea to deduplicate then I'm happy to.",
        "createdAt" : "2021-06-22T07:58:54Z",
        "updatedAt" : "2021-06-22T08:12:31Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "7aaf0db5-a684-4411-b26d-349b232c3ee3",
        "parentId" : "46143a3d-5621-413d-8989-5b02872bd2b4",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "We can do duplication later if needed.",
        "createdAt" : "2021-06-23T07:14:26Z",
        "updatedAt" : "2021-06-23T07:25:00Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "9c06bd1d-a579-43e3-9c01-ff282ebc718a",
        "parentId" : "46143a3d-5621-413d-8989-5b02872bd2b4",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Yea, agree.",
        "createdAt" : "2021-06-23T07:56:17Z",
        "updatedAt" : "2021-06-23T07:56:18Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebe4edf6b12c3c6b7b2c373747abf9f281bc9bb0",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +62,66 @@   * for all aggregate functions.\n   */\n  private def newBuffer: InternalRow = {\n    val bufferSchema = aggregateFunctions.flatMap(_.aggBufferAttributes)\n    val bufferRowSize: Int = bufferSchema.length"
  },
  {
    "id" : "b8404cc6-41dc-440c-8bc7-9d088bfaf7e2",
    "prId" : 31987,
    "prUrl" : "https://github.com/apache/spark/pull/31987#pullrequestreview-690326728",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "757376c0-4515-4087-8fcc-fbe569be4721",
        "parentId" : null,
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "seems only used once in `processCurrentSortedGroup`? If so, maybe make it an inner function.",
        "createdAt" : "2021-06-21T15:25:50Z",
        "updatedAt" : "2021-06-21T15:42:59Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      },
      {
        "id" : "e8e9e08e-f4de-4650-a83c-c08fc31d5172",
        "parentId" : "757376c0-4515-4087-8fcc-fbe569be4721",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "Let's refrain `processCurrentSortedGroup` to deal with session struct directly. It'd be odd if we use functions to get the value but directly set it.",
        "createdAt" : "2021-06-22T08:18:33Z",
        "updatedAt" : "2021-06-22T08:18:34Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "f949115e-b6d3-4c12-843b-bd88babcf2e0",
        "parentId" : "757376c0-4515-4087-8fcc-fbe569be4721",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Make sense.",
        "createdAt" : "2021-06-23T07:55:47Z",
        "updatedAt" : "2021-06-23T07:55:48Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "ebe4edf6b12c3c6b7b2c373747abf9f281bc9bb0",
    "line" : 199,
    "diffHunk" : "@@ -1,1 +197,201 @@  }\n\n  private def expandEndOfCurrentSession(sessionEnd: Long): Unit = {\n    if (sessionEnd > getSessionEnd(currentSession)) {\n      currentSession.setLong(1, sessionEnd)"
  }
]