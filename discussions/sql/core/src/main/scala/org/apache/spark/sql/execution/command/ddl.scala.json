[
  {
    "id" : "6581e852-30ad-479a-807e-d227f443941b",
    "prId" : 31635,
    "prUrl" : "https://github.com/apache/spark/pull/31635#pullrequestreview-598236293",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "I'm a bit reluctant to rename v1 commands, as they are legacy and have been there for many years. ",
        "createdAt" : "2021-02-24T17:31:18Z",
        "updatedAt" : "2021-02-24T17:31:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "1c23693e-a002-4fc7-8448-da8ff2549d08",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Sure, but this is non-public API. We have already extended `AlterTableRecoverPartitionsCommand` in https://github.com/apache/spark/pull/31499. After that, it became incompatible by sources and binary with the previous version.",
        "createdAt" : "2021-02-24T17:52:43Z",
        "updatedAt" : "2021-02-24T17:53:15Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "befc5955-9215-4170-8877-1d6c47b5694b",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "And how about the logical nodes that were massively replaced in https://issues.apache.org/jira/browse/SPARK-29900. They are legacy and have been there for many years too, aren't they?",
        "createdAt" : "2021-02-24T17:57:03Z",
        "updatedAt" : "2021-02-24T17:57:03Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "4689b7ad-dd7b-4f00-9925-f975ed082d0b",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I think the point is that we might better focus on checking V2 instead of V1 commands because eventually V2 commands should replace V1 commands in the future. If this is likely only the one, I think it's fine. If there are a lot of such instances, I wouldn't change for now.",
        "createdAt" : "2021-02-25T00:35:56Z",
        "updatedAt" : "2021-02-25T00:35:56Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "da40a887-2a22-4b66-ac89-e1efb6d3a1b5",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "> If this is likely only the one, I think it's fine.\r\n\r\nYep, only this for now.",
        "createdAt" : "2021-02-25T06:37:51Z",
        "updatedAt" : "2021-02-25T06:37:52Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "13362936b7fa8336a13f23f75367aaa4a6624c40",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +601,605 @@ * }}}\n */\ncase class RepairTableCommand(\n    tableName: TableIdentifier,\n    enableAddPartitions: Boolean,"
  },
  {
    "id" : "3cee3646-e1b2-4f06-8316-419389b948fd",
    "prId" : 31499,
    "prUrl" : "https://github.com/apache/spark/pull/31499#pullrequestreview-597256032",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "51f58e19-82ef-43ab-a89b-d0d2172cdfc3",
        "parentId" : null,
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "@cloud-fan @dongjoon-hyun Should we rename this to `RepairTableCommand` (or `MsckRepairTableCommad`) since `ALTER TABLE .. RECOVER PARTITIONS` is just a specific case of `MSCK REPAIR TABLE table [{ADD|DROP|SYNC} PARTITIONS]`, and it doesn't support `{DROP|SYNC} PARTITIONS`?",
        "createdAt" : "2021-02-18T21:56:54Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "7fd39255-6a62-4740-81c8-073e794f4529",
        "parentId" : "51f58e19-82ef-43ab-a89b-d0d2172cdfc3",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Well, it means many additional changes including the doc changes at line 594, `Recover Partitions in ALTER TABLE`. Why don't we do that renaming in another PR separately if you want? For example, like #31584 ?",
        "createdAt" : "2021-02-18T22:30:11Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "c60c58b6-3489-4e8a-81bd-aa7e1ca689c1",
        "parentId" : "51f58e19-82ef-43ab-a89b-d0d2172cdfc3",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Here is the PR https://github.com/apache/spark/pull/31635 for renaming.",
        "createdAt" : "2021-02-24T09:14:52Z",
        "updatedAt" : "2021-02-24T09:14:52Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "fefea57d097e64b5b506dea45aac24c537f27abd",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +601,605 @@ * }}}\n */\ncase class AlterTableRecoverPartitionsCommand(\n    tableName: TableIdentifier,\n    enableAddPartitions: Boolean,"
  },
  {
    "id" : "c3e20fc7-2923-474a-a4b2-64218b46e10f",
    "prId" : 31499,
    "prUrl" : "https://github.com/apache/spark/pull/31499#pullrequestreview-596167737",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "76460ede-67f4-4a49-84dd-4d77dc65d991",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Could you add a comment about the reason why we use `retainData=true`? I guess the reason is that `fs.exists(..)` is already `false` and we don't want addition file system calls. Did I understand correctly?",
        "createdAt" : "2021-02-23T04:42:16Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "8461c589-25c4-49df-aeff-90de939743be",
        "parentId" : "76460ede-67f4-4a49-84dd-4d77dc65d991",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "> ... we don't want addition file system calls. Did I understand correctly?\r\n\r\nYep, if we set `retainData` to `true`, the `deleteData` flag will `false` at https://github.com/apache/hive/blob/release-3.1.3-rc0/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java#L4360-L4378 . So, Hive MeteStore will not try to delete the partition folders.",
        "createdAt" : "2021-02-23T10:00:57Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "352b8049-71d6-4fe3-83a8-ced22380702e",
        "parentId" : "76460ede-67f4-4a49-84dd-4d77dc65d991",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "The same for the `In-Memory` catalog: https://github.com/apache/spark/blob/bfc023501379d28ae2db8708928f4e658ccaa07f/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/catalog/InMemoryCatalog.scala#L464-L473\r\n",
        "createdAt" : "2021-02-23T10:04:59Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "fefea57d097e64b5b506dea45aac24c537f27abd",
    "line" : 99,
    "diffHunk" : "@@ -1,1 +818,822 @@      // Since we have already checked that partition directories do not exist, we can avoid\n      // additional calls to the file system at the catalog side by setting this flag.\n      retainData = true)\n    dropPartSpecs.length\n  }"
  },
  {
    "id" : "1d585c29-69f0-4fdb-9457-899f9a194b4c",
    "prId" : 31107,
    "prUrl" : "https://github.com/apache/spark/pull/31107#pullrequestreview-570939164",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "28d4c125-3bf7-417d-821f-ef06f2dcf2f8",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "how about the v2 drop table command?",
        "createdAt" : "2021-01-18T07:39:08Z",
        "updatedAt" : "2021-01-19T19:56:05Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "c9e5c290-4535-4fe5-9075-cf6789eb34b3",
        "parentId" : "28d4c125-3bf7-417d-821f-ef06f2dcf2f8",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "Hmm, I think all dropping temp views are handled by v1 `DropTableCommand` and v2 only handles tables, is that correct?",
        "createdAt" : "2021-01-19T06:31:09Z",
        "updatedAt" : "2021-01-19T19:56:05Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      },
      {
        "id" : "31323272-d122-4338-a81a-b4e55c05c99b",
        "parentId" : "28d4c125-3bf7-417d-821f-ef06f2dcf2f8",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "ah you are right.",
        "createdAt" : "2021-01-19T06:33:51Z",
        "updatedAt" : "2021-01-19T19:56:05Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "40ef4b12ae328493c4a5ae5fd8274a7f839050de",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +241,245 @@          catalog.getTempViewOrPermanentTableMetadata(tableName).viewText.isDefined\n        sparkSession.sharedState.cacheManager.uncacheQuery(\n          sparkSession.table(tableName), cascade = !isTempView || hasViewText)\n      } catch {\n        case NonFatal(e) => log.warn(e.toString, e)"
  },
  {
    "id" : "ded7f21a-c7e8-4226-9401-07918699c519",
    "prId" : 31107,
    "prUrl" : "https://github.com/apache/spark/pull/31107#pullrequestreview-571527799",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "59b8dcb2-a565-41bd-aff1-4ca7fff82a91",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Is the PR title and description up-to-dated? Looks like the change in the PR is basically changing the uncaching behavior of view with view text.\r\n\r\nLooks like we already did cascade uncache when dropping a source table here, so I'm wondering why the title is \"A cached view should become invalid after the source table is dropped\"?",
        "createdAt" : "2021-01-19T18:10:32Z",
        "updatedAt" : "2021-01-19T19:56:05Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "60d9ed74-bf02-435b-8ab5-9373899ce8f7",
        "parentId" : "59b8dcb2-a565-41bd-aff1-4ca7fff82a91",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "Yes the PR title is not very good - I just updated it. I think the description is more aligned to what the PR does but I'll try to add more details there.",
        "createdAt" : "2021-01-19T18:24:05Z",
        "updatedAt" : "2021-01-19T19:56:05Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      }
    ],
    "commit" : "40ef4b12ae328493c4a5ae5fd8274a7f839050de",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +241,245 @@          catalog.getTempViewOrPermanentTableMetadata(tableName).viewText.isDefined\n        sparkSession.sharedState.cacheManager.uncacheQuery(\n          sparkSession.table(tableName), cascade = !isTempView || hasViewText)\n      } catch {\n        case NonFatal(e) => log.warn(e.toString, e)"
  },
  {
    "id" : "4537af40-4772-4dae-a96d-3a868836b058",
    "prId" : 31101,
    "prUrl" : "https://github.com/apache/spark/pull/31101#pullrequestreview-565354875",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5d8cb716-6468-4af4-b839-f955a950a059",
        "parentId" : null,
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "just curious, does it matter whether we refresh cache before or after the stats are updated?",
        "createdAt" : "2021-01-09T18:11:00Z",
        "updatedAt" : "2021-01-10T05:03:07Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      },
      {
        "id" : "b641a88a-e248-4d1d-b775-8b2920ce0470",
        "parentId" : "5d8cb716-6468-4af4-b839-f955a950a059",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "In this particular case, it doesn't matter because table size is re-calculated by getting file statuses directly from the filesystem. So, the cached data is not used in updating table stats.\r\n\r\nI think we should review other places.\r\n\r\nJust in case, I will update the test and check that table size is updated after adding of the partition.",
        "createdAt" : "2021-01-09T20:06:34Z",
        "updatedAt" : "2021-01-10T05:03:07Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "f95447d4-60f0-461c-9f02-4a043babf2a5",
        "parentId" : "5d8cb716-6468-4af4-b839-f955a950a059",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "> Just in case, I will update the test and check that table size is updated after adding of the partition.\r\n\r\nLet me add such checking later independently from this PR. I think I have found one more issue relating to looking for `HiveTableRelation` in the cache of Cache Manager.\r\n\r\nIt seems cleaning the table stats made in https://github.com/apache/spark/pull/30995 is not enough.",
        "createdAt" : "2021-01-09T21:31:51Z",
        "updatedAt" : "2021-01-10T05:03:07Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "f850f901-c51b-49c2-b5a9-d8a79b6c37b0",
        "parentId" : "5d8cb716-6468-4af4-b839-f955a950a059",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "+1 for @MaxGekk 's decision.",
        "createdAt" : "2021-01-09T23:30:04Z",
        "updatedAt" : "2021-01-10T05:03:07Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "2d9c958d-5d63-4d7c-872b-31c16896aa57",
        "parentId" : "5d8cb716-6468-4af4-b839-f955a950a059",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "Yup, SGTM :)",
        "createdAt" : "2021-01-09T23:34:58Z",
        "updatedAt" : "2021-01-10T05:03:07Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      },
      {
        "id" : "aff89448-37d0-42a4-bdf2-f4f915641b0b",
        "parentId" : "5d8cb716-6468-4af4-b839-f955a950a059",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Here is the bug fix: https://github.com/apache/spark/pull/31112 . Updating of table stats triggers the bug.",
        "createdAt" : "2021-01-10T10:37:38Z",
        "updatedAt" : "2021-01-10T10:37:38Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "159bbe71-9edc-4b21-88bf-74ac22532b67",
        "parentId" : "5d8cb716-6468-4af4-b839-f955a950a059",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "> Let me add such checking later independently from this PR.\r\n\r\nI added the check for partition adding as well. Please, review this PR: https://github.com/apache/spark/pull/31131",
        "createdAt" : "2021-01-11T13:32:17Z",
        "updatedAt" : "2021-01-11T13:32:17Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "8aa432c8797e2d73c8065376d63474321cecf81a",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +486,490 @@    }\n\n    sparkSession.catalog.refreshTable(table.identifier.quotedString)\n    if (table.stats.nonEmpty) {\n      if (sparkSession.sessionState.conf.autoSizeUpdateEnabled) {"
  }
]