[
  {
    "id" : "6581e852-30ad-479a-807e-d227f443941b",
    "prId" : 31635,
    "prUrl" : "https://github.com/apache/spark/pull/31635#pullrequestreview-598236293",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "I'm a bit reluctant to rename v1 commands, as they are legacy and have been there for many years. ",
        "createdAt" : "2021-02-24T17:31:18Z",
        "updatedAt" : "2021-02-24T17:31:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "1c23693e-a002-4fc7-8448-da8ff2549d08",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Sure, but this is non-public API. We have already extended `AlterTableRecoverPartitionsCommand` in https://github.com/apache/spark/pull/31499. After that, it became incompatible by sources and binary with the previous version.",
        "createdAt" : "2021-02-24T17:52:43Z",
        "updatedAt" : "2021-02-24T17:53:15Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "befc5955-9215-4170-8877-1d6c47b5694b",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "And how about the logical nodes that were massively replaced in https://issues.apache.org/jira/browse/SPARK-29900. They are legacy and have been there for many years too, aren't they?",
        "createdAt" : "2021-02-24T17:57:03Z",
        "updatedAt" : "2021-02-24T17:57:03Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "4689b7ad-dd7b-4f00-9925-f975ed082d0b",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I think the point is that we might better focus on checking V2 instead of V1 commands because eventually V2 commands should replace V1 commands in the future. If this is likely only the one, I think it's fine. If there are a lot of such instances, I wouldn't change for now.",
        "createdAt" : "2021-02-25T00:35:56Z",
        "updatedAt" : "2021-02-25T00:35:56Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "da40a887-2a22-4b66-ac89-e1efb6d3a1b5",
        "parentId" : "a1904bfc-9a80-4878-b38e-868df3f5d89f",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "> If this is likely only the one, I think it's fine.\r\n\r\nYep, only this for now.",
        "createdAt" : "2021-02-25T06:37:51Z",
        "updatedAt" : "2021-02-25T06:37:52Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "13362936b7fa8336a13f23f75367aaa4a6624c40",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +601,605 @@ * }}}\n */\ncase class RepairTableCommand(\n    tableName: TableIdentifier,\n    enableAddPartitions: Boolean,"
  },
  {
    "id" : "3cee3646-e1b2-4f06-8316-419389b948fd",
    "prId" : 31499,
    "prUrl" : "https://github.com/apache/spark/pull/31499#pullrequestreview-597256032",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "51f58e19-82ef-43ab-a89b-d0d2172cdfc3",
        "parentId" : null,
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "@cloud-fan @dongjoon-hyun Should we rename this to `RepairTableCommand` (or `MsckRepairTableCommad`) since `ALTER TABLE .. RECOVER PARTITIONS` is just a specific case of `MSCK REPAIR TABLE table [{ADD|DROP|SYNC} PARTITIONS]`, and it doesn't support `{DROP|SYNC} PARTITIONS`?",
        "createdAt" : "2021-02-18T21:56:54Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "7fd39255-6a62-4740-81c8-073e794f4529",
        "parentId" : "51f58e19-82ef-43ab-a89b-d0d2172cdfc3",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Well, it means many additional changes including the doc changes at line 594, `Recover Partitions in ALTER TABLE`. Why don't we do that renaming in another PR separately if you want? For example, like #31584 ?",
        "createdAt" : "2021-02-18T22:30:11Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "c60c58b6-3489-4e8a-81bd-aa7e1ca689c1",
        "parentId" : "51f58e19-82ef-43ab-a89b-d0d2172cdfc3",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Here is the PR https://github.com/apache/spark/pull/31635 for renaming.",
        "createdAt" : "2021-02-24T09:14:52Z",
        "updatedAt" : "2021-02-24T09:14:52Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "fefea57d097e64b5b506dea45aac24c537f27abd",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +601,605 @@ * }}}\n */\ncase class AlterTableRecoverPartitionsCommand(\n    tableName: TableIdentifier,\n    enableAddPartitions: Boolean,"
  },
  {
    "id" : "c3e20fc7-2923-474a-a4b2-64218b46e10f",
    "prId" : 31499,
    "prUrl" : "https://github.com/apache/spark/pull/31499#pullrequestreview-596167737",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "76460ede-67f4-4a49-84dd-4d77dc65d991",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Could you add a comment about the reason why we use `retainData=true`? I guess the reason is that `fs.exists(..)` is already `false` and we don't want addition file system calls. Did I understand correctly?",
        "createdAt" : "2021-02-23T04:42:16Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "8461c589-25c4-49df-aeff-90de939743be",
        "parentId" : "76460ede-67f4-4a49-84dd-4d77dc65d991",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "> ... we don't want addition file system calls. Did I understand correctly?\r\n\r\nYep, if we set `retainData` to `true`, the `deleteData` flag will `false` at https://github.com/apache/hive/blob/release-3.1.3-rc0/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java#L4360-L4378 . So, Hive MeteStore will not try to delete the partition folders.",
        "createdAt" : "2021-02-23T10:00:57Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "352b8049-71d6-4fe3-83a8-ced22380702e",
        "parentId" : "76460ede-67f4-4a49-84dd-4d77dc65d991",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "The same for the `In-Memory` catalog: https://github.com/apache/spark/blob/bfc023501379d28ae2db8708928f4e658ccaa07f/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/catalog/InMemoryCatalog.scala#L464-L473\r\n",
        "createdAt" : "2021-02-23T10:04:59Z",
        "updatedAt" : "2021-02-23T10:22:53Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "fefea57d097e64b5b506dea45aac24c537f27abd",
    "line" : 99,
    "diffHunk" : "@@ -1,1 +818,822 @@      // Since we have already checked that partition directories do not exist, we can avoid\n      // additional calls to the file system at the catalog side by setting this flag.\n      retainData = true)\n    dropPartSpecs.length\n  }"
  }
]