[
  {
    "id" : "50cec823-3ced-4571-8680-08fba445cc60",
    "prId" : 32933,
    "prUrl" : "https://github.com/apache/spark/pull/32933#pullrequestreview-692425879",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6d80c40d-e8da-4bea-97da-c86233b68320",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Is this the change for review in this PR?",
        "createdAt" : "2021-06-23T01:45:57Z",
        "updatedAt" : "2021-06-23T01:45:58Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "ab8545fb-f3b8-4810-a02d-9c753b8aadaa",
        "parentId" : "6d80c40d-e8da-4bea-97da-c86233b68320",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "That's right.",
        "createdAt" : "2021-06-25T03:44:39Z",
        "updatedAt" : "2021-06-25T03:44:39Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "ea949836c26be0124e37df0eb641be806628d94d",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +223,227 @@   *   set of SST files.\n   */\n  def deleteOldVersions(numVersionsToRetain: Int): Unit = {\n    val path = new Path(dfsRootDir)\n"
  },
  {
    "id" : "c1506b51-9165-49cd-98cd-63d3ed83bbb1",
    "prId" : 32933,
    "prUrl" : "https://github.com/apache/spark/pull/32933#pullrequestreview-695921325",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8859dbe4-e175-4d4c-9bd7-ba3cd4902e55",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "What the second case for? When it will happen?",
        "createdAt" : "2021-06-23T01:50:13Z",
        "updatedAt" : "2021-06-23T01:50:13Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "1825e3d2-ae49-4022-957e-d3532b635bf8",
        "parentId" : "8859dbe4-e175-4d4c-9bd7-ba3cd4902e55",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "If I understand correctly, it would occur with reattempt of same micro-batch.",
        "createdAt" : "2021-06-28T09:36:58Z",
        "updatedAt" : "2021-06-28T12:04:27Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "65d747e9-d791-43af-a6cd-9a5f2cf7d067",
        "parentId" : "8859dbe4-e175-4d4c-9bd7-ba3cd4902e55",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Yep, that's right.",
        "createdAt" : "2021-06-30T09:49:22Z",
        "updatedAt" : "2021-06-30T09:49:22Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "ea949836c26be0124e37df0eb641be806628d94d",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +221,225 @@   * - Partially written SST files\n   * - SST files that were used in a version, but that version got overwritten with a different\n   *   set of SST files.\n   */\n  def deleteOldVersions(numVersionsToRetain: Int): Unit = {"
  },
  {
    "id" : "2dcf4962-7cd1-4418-8849-d44aaad9b92a",
    "prId" : 32933,
    "prUrl" : "https://github.com/apache/spark/pull/32933#pullrequestreview-696193810",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bb238ce0-c763-4228-bb04-e4793229407d",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "Is localTempDir used only here? Just to make sure deleting the directory won't break anything.",
        "createdAt" : "2021-06-28T09:58:22Z",
        "updatedAt" : "2021-06-28T12:04:27Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "fbe54132-4dc1-4b3d-9316-8b0c6157617c",
        "parentId" : "bb238ce0-c763-4228-bb04-e4793229407d",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Yes, the `localTempDir` is only used for unzip files.",
        "createdAt" : "2021-06-30T13:54:14Z",
        "updatedAt" : "2021-06-30T13:54:15Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "ea949836c26be0124e37df0eb641be806628d94d",
    "line" : 114,
    "diffHunk" : "@@ -1,1 +392,396 @@  /** Get the SST files required for a version from the version zip file in DFS */\n  private def getImmutableFilesFromVersionZip(version: Long): Seq[RocksDBImmutableFile] = {\n    Utils.deleteRecursively(localTempDir)\n    localTempDir.mkdirs()\n    Utils.unzipFilesFromFile(fs, dfsBatchZipFile(version), localTempDir)"
  },
  {
    "id" : "bf060d2d-8a7d-42e3-b1e8-85ee93266f23",
    "prId" : 32767,
    "prUrl" : "https://github.com/apache/spark/pull/32767#pullrequestreview-690430800",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2a010acf-753c-4eb4-9cf1-d5c753926702",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "When it is possible to have existing file in local dir which has same file name but not the same file in DFS?",
        "createdAt" : "2021-06-22T06:47:26Z",
        "updatedAt" : "2021-06-22T06:51:07Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "ac7291d7-c552-4ad2-a400-7158000ca68b",
        "parentId" : "2a010acf-753c-4eb4-9cf1-d5c753926702",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Or just a safer guard?",
        "createdAt" : "2021-06-22T06:47:40Z",
        "updatedAt" : "2021-06-22T06:51:07Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "d6f4101b-5d13-4cf7-9dbc-ab5942350253",
        "parentId" : "2a010acf-753c-4eb4-9cf1-d5c753926702",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "A safer guard for checking both file names and file size.",
        "createdAt" : "2021-06-23T09:38:18Z",
        "updatedAt" : "2021-06-23T09:38:18Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "7279d434ddba27a93924577458f8dedf6bf340c5",
    "line" : 89,
    "diffHunk" : "@@ -1,1 +263,267 @@          existingFile.delete()\n          logInfo(s\"Deleted local file $existingFile\")\n        }\n      }\n"
  },
  {
    "id" : "ca84fd02-a693-4592-ab5c-d3406261b338",
    "prId" : 32767,
    "prUrl" : "https://github.com/apache/spark/pull/32767#pullrequestreview-690437137",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2882ef77-386b-4f9d-adbb-24e867d85ba6",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Is this only used by tests?",
        "createdAt" : "2021-06-22T06:55:27Z",
        "updatedAt" : "2021-06-22T06:55:28Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "b8c9152e-4468-4c98-bab0-02e73ea3cb5f",
        "parentId" : "2882ef77-386b-4f9d-adbb-24e867d85ba6",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Yes.",
        "createdAt" : "2021-06-23T09:44:47Z",
        "updatedAt" : "2021-06-23T09:44:47Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "7279d434ddba27a93924577458f8dedf6bf340c5",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +188,192 @@\n  /** Get the latest version available in the DFS directory. If no data present, it returns 0. */\n  def getLatestVersion(): Long = {\n    val path = new Path(dfsRootDir)\n    if (fm.exists(path)) {"
  },
  {
    "id" : "8913b6de-e2eb-42d4-bcc1-7c0208d89d02",
    "prId" : 32767,
    "prUrl" : "https://github.com/apache/spark/pull/32767#pullrequestreview-690452537",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "04ad81aa-48e8-43f3-9fc5-d0ecda1e0d95",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "What if we just remove the all files in localDir? Just would like to know the reason we don't clear the directory but just remove the specific files. Would we need to leverage some remaining files?",
        "createdAt" : "2021-06-22T07:31:47Z",
        "updatedAt" : "2021-06-22T07:44:26Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "46c0d5a7-2c41-465e-a226-b18ee9c7cdb2",
        "parentId" : "04ad81aa-48e8-43f3-9fc5-d0ecda1e0d95",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Yes. The consideration here is mainly for immutable files like sst/log files. We can avoid IO for the immutable files shared among different versions.",
        "createdAt" : "2021-06-23T10:00:13Z",
        "updatedAt" : "2021-06-23T10:00:13Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      }
    ],
    "commit" : "7279d434ddba27a93924577458f8dedf6bf340c5",
    "line" : 36,
    "diffHunk" : "@@ -1,1 +170,174 @@      RocksDBCheckpointMetadata(Seq.empty, 0)\n    } else {\n      // Delete all non-immutable files in local dir, and unzip new ones from DFS commit file\n      listRocksDBFiles(localDir)._2.foreach(_.delete())\n      Utils.unzipFilesFromFile(fs, dfsBatchZipFile(version), localDir)"
  }
]