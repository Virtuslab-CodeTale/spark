[
  {
    "id" : "dcd60c32-6cd5-40a0-9e45-e5cd437bbd6f",
    "prId" : 33081,
    "prUrl" : "https://github.com/apache/spark/pull/33081#pullrequestreview-707015221",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1b09fe8d-f8a1-4b86-b3ac-26e16f91e0d1",
        "parentId" : null,
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "nit: maybe we can mention `UpdateSessionsExec` here.",
        "createdAt" : "2021-07-15T04:34:31Z",
        "updatedAt" : "2021-07-15T04:51:30Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      },
      {
        "id" : "6155a35a-d988-464e-a462-f6db08496d2c",
        "parentId" : "1b09fe8d-f8a1-4b86-b3ac-26e16f91e0d1",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "This method does not leverage UpdateSessionsExec.",
        "createdAt" : "2021-07-15T07:28:31Z",
        "updatedAt" : "2021-07-15T07:28:31Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "bbade3501f16e9437ba9af4feca3e2029785d273",
    "line" : 64,
    "diffHunk" : "@@ -1,1 +362,366 @@   *\n   *  - Partial Aggregation\n   *    - all tuples will have aggregated columns with initial value\n   *  - (If \"spark.sql.streaming.sessionWindow.merge.sessions.in.local.partition\" is enabled)\n   *    - Sort within partition (sort: all keys)"
  },
  {
    "id" : "8289695c-e210-4af3-bf56-3f8948132db7",
    "prId" : 33081,
    "prUrl" : "https://github.com/apache/spark/pull/33081#pullrequestreview-706925021",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ddf56217-52c6-4305-bee2-8a304a143d84",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Could you add a comment here explaining why we need to append `MergingSessionExec`?",
        "createdAt" : "2021-07-15T05:28:06Z",
        "updatedAt" : "2021-07-15T05:39:10Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "bbade3501f16e9437ba9af4feca3e2029785d273",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +117,121 @@    // If we have session window expression in aggregation, we add MergingSessionExec to\n    // merge sessions with calculating aggregation values.\n    val interExec: SparkPlan = mayAppendMergingSessionExec(groupingExpressions,\n      aggregateExpressions, partialAggregate)\n"
  },
  {
    "id" : "e31dc034-07b3-4451-b6ab-2f7434367f47",
    "prId" : 33081,
    "prUrl" : "https://github.com/apache/spark/pull/33081#pullrequestreview-706925021",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7a1b8d62-d0c3-4878-a463-946e80779cb6",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "ditto",
        "createdAt" : "2021-07-15T05:28:27Z",
        "updatedAt" : "2021-07-15T05:39:10Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "bbade3501f16e9437ba9af4feca3e2029785d273",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +150,154 @@    // calculate sessions for input rows and update rows' session column, so that further\n    // aggregations can aggregate input rows for the same session.\n    val maySessionChild = mayAppendUpdatingSessionExec(groupingExpressions, child)\n\n    val distinctAttributes = normalizedNamedDistinctExpressions.map(_.toAttribute)"
  },
  {
    "id" : "74b67052-f975-42b1-b411-b8ccd2c04b11",
    "prId" : 31570,
    "prUrl" : "https://github.com/apache/spark/pull/31570#pullrequestreview-614959278",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "01a5b8e5-1dca-43ab-81ac-0f1914798269",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "This process was simplified, compared with original PR. Removed unnecessary `PartialMerge`s so the session window streaming aggregation has the same physical structure as general streaming aggregation.",
        "createdAt" : "2021-02-16T07:21:41Z",
        "updatedAt" : "2021-03-17T08:28:48Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "48aa898c-914e-455c-81bc-2cf432af8bd0",
        "parentId" : "01a5b8e5-1dca-43ab-81ac-0f1914798269",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "As it removed unnecessary `PartialMerge`, I think this could improve the performance.",
        "createdAt" : "2021-02-16T07:52:59Z",
        "updatedAt" : "2021-03-17T08:28:48Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "935edf4f-a8bb-4268-a2dd-74825599893e",
        "parentId" : "01a5b8e5-1dca-43ab-81ac-0f1914798269",
        "authorId" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "body" : "Yes. If we see a bottleneck in the future. We can add the pre-shuffle PartialMerge back.",
        "createdAt" : "2021-03-18T01:58:51Z",
        "updatedAt" : "2021-03-18T02:54:50Z",
        "lastEditedBy" : "cd38bd5a-0fae-4d8e-8acd-36dc13753759",
        "tags" : [
        ]
      },
      {
        "id" : "4b00903d-d7c3-422c-9c79-488cb061901c",
        "parentId" : "01a5b8e5-1dca-43ab-81ac-0f1914798269",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "As @xuanyuanking stated, we can say that's a simplification, but it is arguable that PartialMerge is \"unnecessary\". The sort operation is necessary to aggregate before shuffling so that is a trade-off, but it's known that less amount of shuffle data brings performance benefits.",
        "createdAt" : "2021-03-18T03:50:59Z",
        "updatedAt" : "2021-03-18T04:14:30Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "04ca039bdf74c3b71be5fe53574906f426f25256",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +267,271 @@   *  - (Shuffle + Session Window Assignment, see `SessionWindowExec`)\n   *  - Partial Aggregation (now there is at most 1 tuple per group)\n   *  - SessionStateStoreRestore (now there is 1 tuple from this batch + optionally one from\n   *    the previous)\n   *  - SessionWindowMergeExec (merge session window by change window's starttime && endtime)"
  }
]