[
  {
    "id" : "7573f1a7-3293-4dfe-83c2-e7aaddea992c",
    "prId" : 28863,
    "prUrl" : "https://github.com/apache/spark/pull/28863#pullrequestreview-433415583",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "19d219c7-1ff5-48ad-8b57-c76da0cef954",
        "parentId" : null,
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "The implementation is based on [this](https://docs.oracle.com/en/database/oracle/oracle-database/19/jjdbc/client-side-security.html#GUID-97E88D18-B590-4313-87B8-EE422DA644B3).",
        "createdAt" : "2020-06-18T15:48:39Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "461eed070d86a7d9d5f8ba536a69d59621faa907",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +26,30 @@import org.apache.spark.sql.execution.datasources.jdbc.JDBCOptions\n\nprivate[sql] class OracleConnectionProvider(driver: Driver, options: JDBCOptions)\n  extends SecureConnectionProvider(driver, options) {\n  override val appEntry: String = \"kprb5module\""
  },
  {
    "id" : "84f5b0b3-da3a-431a-9ec4-25401d017db1",
    "prId" : 28863,
    "prUrl" : "https://github.com/apache/spark/pull/28863#pullrequestreview-433415583",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "32fa23ac-f7db-4c06-baf6-ed87ee8e5f54",
        "parentId" : null,
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "Here synchronization is important to avoid race just like in other providers.",
        "createdAt" : "2020-06-18T15:50:37Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "461eed070d86a7d9d5f8ba536a69d59621faa907",
    "line" : 52,
    "diffHunk" : "@@ -1,1 +50,54 @@  }\n\n  override def setAuthenticationConfigIfNeeded(): Unit = SecurityConfigurationLock.synchronized {\n    val (parent, configEntry) = getConfigWithAppEntry()\n    if (configEntry == null || configEntry.isEmpty) {"
  },
  {
    "id" : "0417fa52-3c78-48da-af30-3b24737859a7",
    "prId" : 28863,
    "prUrl" : "https://github.com/apache/spark/pull/28863#pullrequestreview-435708690",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "470d862e-5331-491c-8bec-54aae36b18d3",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "Just a question; where does this value come? From the Oracle JDBC impl?",
        "createdAt" : "2020-06-20T07:28:58Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "87729e42-f9be-4d73-8efe-12fd668b9f33",
        "parentId" : "470d862e-5331-491c-8bec-54aae36b18d3",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "Yeah, I've used JD-GUI to take a look at the details.",
        "createdAt" : "2020-06-23T11:58:32Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "461eed070d86a7d9d5f8ba536a69d59621faa907",
    "line" : 30,
    "diffHunk" : "@@ -1,1 +28,32 @@private[sql] class OracleConnectionProvider(driver: Driver, options: JDBCOptions)\n  extends SecureConnectionProvider(driver, options) {\n  override val appEntry: String = \"kprb5module\"\n\n  override def getConnection(): Connection = {"
  },
  {
    "id" : "11cc0408-f1bf-4f3a-8d4b-47bf1c644975",
    "prId" : 28863,
    "prUrl" : "https://github.com/apache/spark/pull/28863#pullrequestreview-435719637",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "69cb5ff6-2b11-4ddf-b5e5-cf2b7f47a188",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "How about adding a link here to this configuration?\r\nhttps://docs.oracle.com/en/database/oracle/oracle-database/20/jajdb/oracle/jdbc/OracleConnection.html#CONNECTION_PROPERTY_THIN_NET_AUTHENTICATION_SERVICES",
        "createdAt" : "2020-06-20T07:41:35Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "8a0267ba-0667-4ac6-8bab-da92cbdacc6e",
        "parentId" : "69cb5ff6-2b11-4ddf-b5e5-cf2b7f47a188",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "Good idea, added.",
        "createdAt" : "2020-06-23T12:00:37Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "37ee2746-2c94-4c3c-a1f6-c083c31227c6",
        "parentId" : "69cb5ff6-2b11-4ddf-b5e5-cf2b7f47a188",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "I've changed the version to 19c in order to be consistent w/ the driver version in the pom.",
        "createdAt" : "2020-06-23T12:14:20Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "461eed070d86a7d9d5f8ba536a69d59621faa907",
    "line" : 48,
    "diffHunk" : "@@ -1,1 +46,50 @@    // The possible values can be found in AnoServices public interface\n    // The value is coming from AUTHENTICATION_KERBEROS5 final String in driver version 19.6.0.0\n    result.put(\"oracle.net.authentication_services\", \"(KERBEROS5)\");\n    result\n  }"
  },
  {
    "id" : "1eeb3da8-35df-4a68-925f-59259c995126",
    "prId" : 28863,
    "prUrl" : "https://github.com/apache/spark/pull/28863#pullrequestreview-438965425",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Just a question. Why do we use `(KERBEROS5)` instead of `(KERBEROS)` in the given link? The new value looks correct to me, but it's weird to give a link with a different content. It would be great if we can give a more accurate link about `(KERBEROS5)` (if possible).",
        "createdAt" : "2020-06-25T23:02:37Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "a251ba79-257c-4c26-bf84-263b1319663f",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "At the first glance that smells like a major issue. What I can think of is that somehow the value and the define (`AnoServices.AUTHENTICATION_KERBEROS5`) mixed up. I'll double check in the driver implementation w/ JD-GUI + re-testing it on cluster to avoid questions. It will take a while so asking some patience.\r\n\r\nWhen I've designed this I've had the feeling these configs must be overridable for flexibility. Now it's clear how it could pay off.",
        "createdAt" : "2020-06-26T09:37:35Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "517bd752-61b3-4592-a90f-b03f359cf713",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "Hmmm, during the investigation I've found the following code in the JDBC driver implementation w/ JD-GUI:\r\n```\r\npublic interface AnoServices {\r\n...\r\n  public static final String AUTHENTICATION_KERBEROS5 = \"KERBEROS5\";\r\n...\r\n```\r\nLet's see how the test behaves.\r\n",
        "createdAt" : "2020-06-26T14:34:40Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "76c4243e-a6b4-4f27-ac7b-af759c8954b2",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "Now I'm pretty sure this is a documentation issue because of the following:\r\n* The driver [documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/jjdbc/client-side-security.html#GUID-991705F7-C2C5-4BA9-85D1-32749AE2FF64) gives the following as an example:\r\n```\r\n...\r\n    Connection conn = \r\n      (Connection)Subject.doAs(specificSubject, new PrivilegedExceptionAction()\r\n        {\r\n          public Object run()\r\n          {\r\n            Connection con = null;\r\n            Properties prop = new Properties();\r\n            prop.setProperty(AnoServices.AUTHENTICATION_PROPERTY_SERVICES, \r\n                             \"(\" + AnoServices.AUTHENTICATION_KERBEROS5 + \")\");\r\n...\r\n```\r\nand that said I've found `AUTHENTICATION_KERBEROS5 = \"KERBEROS5\";` in `AnoServices`.\r\n* Cluster test has passed w/ `KERBEROS5` \r\n\r\nChecking the documentation whether it fits to this version...\r\n",
        "createdAt" : "2020-06-26T15:09:49Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "41850eb8-c27c-4826-86fc-618a2a1389d2",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "I've double checked and the version matches which makes the situation weird (there is an interface value in the JDBC driver impl which is not documented).\r\nI think what we can state here is that `AnoServices` constant works fine and that must be provided to make it work (that said such pre-configured configs can be overriden if changes).\r\nI would remove the link and add this information if you agree. WDYT @dongjoon-hyun @maropu ?\r\n",
        "createdAt" : "2020-06-26T15:31:24Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "a23b4595-4318-4868-ae1e-3baba844bed6",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "+1 for that. Thank you!",
        "createdAt" : "2020-06-26T17:34:29Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "1bc11eb3-a783-4bd0-b722-6498d011a84b",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "Thanks for the investigation! +1",
        "createdAt" : "2020-06-26T22:35:25Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "5ae40a1e-558c-43fc-82e9-4fbfbda8d81a",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "Thanks guys! Processing the remaining suggestions.",
        "createdAt" : "2020-06-29T07:44:31Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      },
      {
        "id" : "63f76b75-7076-4cea-adde-0f2fc085cc07",
        "parentId" : "a2834d20-7c40-4a16-8fa5-2f1ac968db4b",
        "authorId" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "body" : "Fixed the comment.",
        "createdAt" : "2020-06-29T07:54:36Z",
        "updatedAt" : "2020-06-29T07:56:41Z",
        "lastEditedBy" : "e6f86365-3ac2-48b4-94f9-21ce737cf1ac",
        "tags" : [
        ]
      }
    ],
    "commit" : "461eed070d86a7d9d5f8ba536a69d59621faa907",
    "line" : 48,
    "diffHunk" : "@@ -1,1 +46,50 @@    // The possible values can be found in AnoServices public interface\n    // The value is coming from AUTHENTICATION_KERBEROS5 final String in driver version 19.6.0.0\n    result.put(\"oracle.net.authentication_services\", \"(KERBEROS5)\");\n    result\n  }"
  }
]