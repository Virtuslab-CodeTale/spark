[
  {
    "id" : "91b95c0a-d667-46a5-8040-a98e29d2dc95",
    "prId" : 33204,
    "prUrl" : "https://github.com/apache/spark/pull/33204#pullrequestreview-699485202",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c9ca57c5-ec87-4c91-adc0-371004fe88c3",
        "parentId" : null,
        "authorId" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "body" : "there is a `verifyAutoGeneratedAliasesNotExists` in the latest master code. could you put them together?",
        "createdAt" : "2021-07-05T09:23:24Z",
        "updatedAt" : "2021-07-05T09:24:17Z",
        "lastEditedBy" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "tags" : [
        ]
      },
      {
        "id" : "938b23dd-f607-454a-804e-ddc696eadbf0",
        "parentId" : "c9ca57c5-ec87-4c91-adc0-371004fe88c3",
        "authorId" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "body" : "OK",
        "createdAt" : "2021-07-06T02:18:04Z",
        "updatedAt" : "2021-07-06T02:18:04Z",
        "lastEditedBy" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "tags" : [
        ]
      }
    ],
    "commit" : "ee5e76e04c393be21d6c3637b82887d283261f36",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +261,265 @@  override def run(session: SparkSession): Seq[Row] = {\n    val isTemporary = session.sessionState.catalog.isTempView(name)\n    verifyTemporaryObjectsNotExists(session.sessionState.catalog, isTemporary, name, query)\n    verifyAutoGeneratedAliasesNotExists(query, isTemporary, name)\n    if (isTemporary) {"
  },
  {
    "id" : "afbe1984-05e3-468c-a529-7b3ca5f77978",
    "prId" : 33204,
    "prUrl" : "https://github.com/apache/spark/pull/33204#pullrequestreview-699507220",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "48ba1f89-daaf-4c4a-88ae-d59102be2c28",
        "parentId" : null,
        "authorId" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "body" : "let's remove `verifyAutoGeneratedAliasesNotExists(analyzedPlan, isTemporary = false, name)` in `alterTemporaryView ` function",
        "createdAt" : "2021-07-06T03:13:32Z",
        "updatedAt" : "2021-07-06T03:13:32Z",
        "lastEditedBy" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "tags" : [
        ]
      },
      {
        "id" : "4bd1c5b4-9cf2-4e2e-a4c7-ac5427898dfa",
        "parentId" : "48ba1f89-daaf-4c4a-88ae-d59102be2c28",
        "authorId" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "body" : "OK",
        "createdAt" : "2021-07-06T03:27:30Z",
        "updatedAt" : "2021-07-06T03:27:30Z",
        "lastEditedBy" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "tags" : [
        ]
      }
    ],
    "commit" : "ee5e76e04c393be21d6c3637b82887d283261f36",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +261,265 @@  override def run(session: SparkSession): Seq[Row] = {\n    val isTemporary = session.sessionState.catalog.isTempView(name)\n    verifyTemporaryObjectsNotExists(session.sessionState.catalog, isTemporary, name, query)\n    verifyAutoGeneratedAliasesNotExists(query, isTemporary, name)\n    if (isTemporary) {"
  },
  {
    "id" : "6675e466-5f62-41e5-8603-7d5e10ce75ea",
    "prId" : 32032,
    "prUrl" : "https://github.com/apache/spark/pull/32032#pullrequestreview-633280235",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "081dd5a8-fcb6-4031-9b5f-ec5426819208",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "ditto",
        "createdAt" : "2021-04-12T08:41:45Z",
        "updatedAt" : "2021-04-14T03:19:24Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "111ef8be8bc03a62389aed4f0871b958714eb789",
    "line" : 45,
    "diffHunk" : "@@ -1,1 +75,79 @@      newChildren: IndexedSeq[LogicalPlan]): CreateViewCommand = {\n    assert(!isAnalyzed)\n    copy(plan = newChildren.head)\n  }\n"
  },
  {
    "id" : "a90183b9-f39a-4c9c-b6d4-48df00557b5e",
    "prId" : 32032,
    "prUrl" : "https://github.com/apache/spark/pull/32032#pullrequestreview-646126158",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "shall we only include it as inner children only when `isAnalyzed = true`? Maybe we can put it in the base class, as it's better to include the plan in inner children to show it in the UI.",
        "createdAt" : "2021-04-23T14:30:16Z",
        "updatedAt" : "2021-04-23T14:30:16Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "ca0e2ff5-545f-44d1-a8ee-d52be568498e",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "@cloud-fan which UI are you referring to? If you are referring to the Spark UI, I see the following and it shows the same even if I use `override def innerChildren: Seq[QueryPlan[_]] = if (isAnalyzed) Seq(plan) else Nil`:\r\n<img width=\"719\" alt=\"Screen Shot 2021-04-23 at 9 30 57 PM\" src=\"https://user-images.githubusercontent.com/12103644/115947249-42962180-a47b-11eb-90e6-874b592f97e1.png\">\r\n",
        "createdAt" : "2021-04-24T04:32:13Z",
        "updatedAt" : "2021-04-24T04:32:13Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "884d7cb3-88fd-4109-a003-a4e3506cc9e1",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "how about the \"optimized plan\" in the EXPLAIN result?",
        "createdAt" : "2021-04-25T09:55:07Z",
        "updatedAt" : "2021-04-25T09:55:08Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "ebd4d3fc-01a2-4c96-8cb0-8fe12a1e16e0",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "I see the following for the both cases. Were you expecting something different?\r\n\r\n```\r\n== Parsed Logical Plan ==\r\n'CreateViewStatement [test], SELECT 1, false, false, PersistedView\r\n+- 'Project [unresolvedalias(1, None)]\r\n   +- OneRowRelation\r\n\r\n== Analyzed Logical Plan ==\r\n\r\nCreateViewCommand `default`.`test`, SELECT 1, false, false, PersistedView, true\r\n   +- Project [1 AS 1#7]\r\n      +- OneRowRelation\r\n\r\n== Optimized Logical Plan ==\r\nCreateViewCommand `default`.`test`, SELECT 1, false, false, PersistedView, true\r\n   +- Project [1 AS 1#7]\r\n      +- OneRowRelation\r\n\r\n== Physical Plan ==\r\nExecute CreateViewCommand\r\n   +- CreateViewCommand `default`.`test`, SELECT 1, false, false, PersistedView, true\r\n         +- Project [1 AS 1#7]\r\n            +- OneRowRelation\r\n```",
        "createdAt" : "2021-04-26T02:32:14Z",
        "updatedAt" : "2021-04-26T02:32:14Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "19cbcfa4-03e3-472f-bc9c-9037b253d3f5",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "interesting. I thought there will be problems if a plan is in both `children` and `innerChildren`, but seems we are fine.",
        "createdAt" : "2021-04-26T05:07:18Z",
        "updatedAt" : "2021-04-26T05:07:19Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "77cb2c17-96a0-4472-bdc9-01d4bd6e587c",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "Ah, the reason is that when explain runs, `CreateViewCommand` already went thru the `Analyzer` and its children is removed (note the `true` above, which is `isAnalyzed`).",
        "createdAt" : "2021-04-26T19:19:07Z",
        "updatedAt" : "2021-04-26T19:19:07Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "350175e4-087d-4a29-8660-aefe5bdc509b",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "but the \"Parsed Logical Plan\" should be unresolved and the `plan` is in both `children` and `innerChildren`.",
        "createdAt" : "2021-04-27T03:08:56Z",
        "updatedAt" : "2021-04-27T03:08:57Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "517dcc65-dde1-4cea-b46c-0307a6ed0980",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "\"Parsed Logical Plan\" is `CreateViewStatement`, not `CreateViewCommand`.",
        "createdAt" : "2021-04-27T06:15:49Z",
        "updatedAt" : "2021-04-27T06:15:50Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "d5b6e0ff-ad73-41a9-a18f-7f166edf3eec",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "ah now I get it. If there is a place that creates `CreateViewCommand` directly, we get a problem.\r\n\r\nI think it's safer to avoid that to be future-proof. e.g.\r\n```\r\noverride def innerChildren: Seq[QueryPlan[_]] = if (analyzed) Seq(plan) else Nil\r\n```",
        "createdAt" : "2021-04-27T07:13:39Z",
        "updatedAt" : "2021-04-27T07:13:39Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "9285fec9-069a-42b2-94ba-25de52b65c8c",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "I agree. I will do a follow up PR.",
        "createdAt" : "2021-04-27T16:52:07Z",
        "updatedAt" : "2021-04-27T16:52:07Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "111ef8be8bc03a62389aed4f0871b958714eb789",
    "line" : 48,
    "diffHunk" : "@@ -1,1 +78,82 @@  }\n\n  override def innerChildren: Seq[QueryPlan[_]] = Seq(plan)\n\n  // `plan` needs to be analyzed, but shouldn't be optimized so that caching works correctly."
  },
  {
    "id" : "f1623cad-ec30-40be-bdb0-1bd74325d4d7",
    "prId" : 31933,
    "prUrl" : "https://github.com/apache/spark/pull/31933#pullrequestreview-618860834",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1b2a9a5a-bf5d-4915-a6c7-4fdc4aa2cfc8",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "how do we analyze it since it's not a child?",
        "createdAt" : "2021-03-23T04:53:24Z",
        "updatedAt" : "2021-03-25T03:52:40Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "7a725291-cc04-43dd-92e8-6d4ac0a55c05",
        "parentId" : "1b2a9a5a-bf5d-4915-a6c7-4fdc4aa2cfc8",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "The analyzed plan is passed here. I can keep the name `child` if that's clearer.",
        "createdAt" : "2021-03-23T17:12:30Z",
        "updatedAt" : "2021-03-25T03:52:40Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "507b00c34058cf52f430641078e44a0c1fc0be84",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +63,67 @@    properties: Map[String, String],\n    originalText: Option[String],\n    analyzedPlan: LogicalPlan,\n    allowExisting: Boolean,\n    replace: Boolean,"
  }
]