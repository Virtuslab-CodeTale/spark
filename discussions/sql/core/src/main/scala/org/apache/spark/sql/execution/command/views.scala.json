[
  {
    "id" : "91b95c0a-d667-46a5-8040-a98e29d2dc95",
    "prId" : 33204,
    "prUrl" : "https://github.com/apache/spark/pull/33204#pullrequestreview-699485202",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c9ca57c5-ec87-4c91-adc0-371004fe88c3",
        "parentId" : null,
        "authorId" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "body" : "there is a `verifyAutoGeneratedAliasesNotExists` in the latest master code. could you put them together?",
        "createdAt" : "2021-07-05T09:23:24Z",
        "updatedAt" : "2021-07-05T09:24:17Z",
        "lastEditedBy" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "tags" : [
        ]
      },
      {
        "id" : "938b23dd-f607-454a-804e-ddc696eadbf0",
        "parentId" : "c9ca57c5-ec87-4c91-adc0-371004fe88c3",
        "authorId" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "body" : "OK",
        "createdAt" : "2021-07-06T02:18:04Z",
        "updatedAt" : "2021-07-06T02:18:04Z",
        "lastEditedBy" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "tags" : [
        ]
      }
    ],
    "commit" : "ee5e76e04c393be21d6c3637b82887d283261f36",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +261,265 @@  override def run(session: SparkSession): Seq[Row] = {\n    val isTemporary = session.sessionState.catalog.isTempView(name)\n    verifyTemporaryObjectsNotExists(session.sessionState.catalog, isTemporary, name, query)\n    verifyAutoGeneratedAliasesNotExists(query, isTemporary, name)\n    if (isTemporary) {"
  },
  {
    "id" : "afbe1984-05e3-468c-a529-7b3ca5f77978",
    "prId" : 33204,
    "prUrl" : "https://github.com/apache/spark/pull/33204#pullrequestreview-699507220",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "48ba1f89-daaf-4c4a-88ae-d59102be2c28",
        "parentId" : null,
        "authorId" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "body" : "let's remove `verifyAutoGeneratedAliasesNotExists(analyzedPlan, isTemporary = false, name)` in `alterTemporaryView ` function",
        "createdAt" : "2021-07-06T03:13:32Z",
        "updatedAt" : "2021-07-06T03:13:32Z",
        "lastEditedBy" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "tags" : [
        ]
      },
      {
        "id" : "4bd1c5b4-9cf2-4e2e-a4c7-ac5427898dfa",
        "parentId" : "48ba1f89-daaf-4c4a-88ae-d59102be2c28",
        "authorId" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "body" : "OK",
        "createdAt" : "2021-07-06T03:27:30Z",
        "updatedAt" : "2021-07-06T03:27:30Z",
        "lastEditedBy" : "c5e50a39-baa7-4db5-8cdd-ad281bb7e7e5",
        "tags" : [
        ]
      }
    ],
    "commit" : "ee5e76e04c393be21d6c3637b82887d283261f36",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +261,265 @@  override def run(session: SparkSession): Seq[Row] = {\n    val isTemporary = session.sessionState.catalog.isTempView(name)\n    verifyTemporaryObjectsNotExists(session.sessionState.catalog, isTemporary, name, query)\n    verifyAutoGeneratedAliasesNotExists(query, isTemporary, name)\n    if (isTemporary) {"
  },
  {
    "id" : "6675e466-5f62-41e5-8603-7d5e10ce75ea",
    "prId" : 32032,
    "prUrl" : "https://github.com/apache/spark/pull/32032#pullrequestreview-633280235",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "081dd5a8-fcb6-4031-9b5f-ec5426819208",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "ditto",
        "createdAt" : "2021-04-12T08:41:45Z",
        "updatedAt" : "2021-04-14T03:19:24Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "111ef8be8bc03a62389aed4f0871b958714eb789",
    "line" : 45,
    "diffHunk" : "@@ -1,1 +75,79 @@      newChildren: IndexedSeq[LogicalPlan]): CreateViewCommand = {\n    assert(!isAnalyzed)\n    copy(plan = newChildren.head)\n  }\n"
  },
  {
    "id" : "a90183b9-f39a-4c9c-b6d4-48df00557b5e",
    "prId" : 32032,
    "prUrl" : "https://github.com/apache/spark/pull/32032#pullrequestreview-646126158",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "shall we only include it as inner children only when `isAnalyzed = true`? Maybe we can put it in the base class, as it's better to include the plan in inner children to show it in the UI.",
        "createdAt" : "2021-04-23T14:30:16Z",
        "updatedAt" : "2021-04-23T14:30:16Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "ca0e2ff5-545f-44d1-a8ee-d52be568498e",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "@cloud-fan which UI are you referring to? If you are referring to the Spark UI, I see the following and it shows the same even if I use `override def innerChildren: Seq[QueryPlan[_]] = if (isAnalyzed) Seq(plan) else Nil`:\r\n<img width=\"719\" alt=\"Screen Shot 2021-04-23 at 9 30 57 PM\" src=\"https://user-images.githubusercontent.com/12103644/115947249-42962180-a47b-11eb-90e6-874b592f97e1.png\">\r\n",
        "createdAt" : "2021-04-24T04:32:13Z",
        "updatedAt" : "2021-04-24T04:32:13Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "884d7cb3-88fd-4109-a003-a4e3506cc9e1",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "how about the \"optimized plan\" in the EXPLAIN result?",
        "createdAt" : "2021-04-25T09:55:07Z",
        "updatedAt" : "2021-04-25T09:55:08Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "ebd4d3fc-01a2-4c96-8cb0-8fe12a1e16e0",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "I see the following for the both cases. Were you expecting something different?\r\n\r\n```\r\n== Parsed Logical Plan ==\r\n'CreateViewStatement [test], SELECT 1, false, false, PersistedView\r\n+- 'Project [unresolvedalias(1, None)]\r\n   +- OneRowRelation\r\n\r\n== Analyzed Logical Plan ==\r\n\r\nCreateViewCommand `default`.`test`, SELECT 1, false, false, PersistedView, true\r\n   +- Project [1 AS 1#7]\r\n      +- OneRowRelation\r\n\r\n== Optimized Logical Plan ==\r\nCreateViewCommand `default`.`test`, SELECT 1, false, false, PersistedView, true\r\n   +- Project [1 AS 1#7]\r\n      +- OneRowRelation\r\n\r\n== Physical Plan ==\r\nExecute CreateViewCommand\r\n   +- CreateViewCommand `default`.`test`, SELECT 1, false, false, PersistedView, true\r\n         +- Project [1 AS 1#7]\r\n            +- OneRowRelation\r\n```",
        "createdAt" : "2021-04-26T02:32:14Z",
        "updatedAt" : "2021-04-26T02:32:14Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "19cbcfa4-03e3-472f-bc9c-9037b253d3f5",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "interesting. I thought there will be problems if a plan is in both `children` and `innerChildren`, but seems we are fine.",
        "createdAt" : "2021-04-26T05:07:18Z",
        "updatedAt" : "2021-04-26T05:07:19Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "77cb2c17-96a0-4472-bdc9-01d4bd6e587c",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "Ah, the reason is that when explain runs, `CreateViewCommand` already went thru the `Analyzer` and its children is removed (note the `true` above, which is `isAnalyzed`).",
        "createdAt" : "2021-04-26T19:19:07Z",
        "updatedAt" : "2021-04-26T19:19:07Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "350175e4-087d-4a29-8660-aefe5bdc509b",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "but the \"Parsed Logical Plan\" should be unresolved and the `plan` is in both `children` and `innerChildren`.",
        "createdAt" : "2021-04-27T03:08:56Z",
        "updatedAt" : "2021-04-27T03:08:57Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "517dcc65-dde1-4cea-b46c-0307a6ed0980",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "\"Parsed Logical Plan\" is `CreateViewStatement`, not `CreateViewCommand`.",
        "createdAt" : "2021-04-27T06:15:49Z",
        "updatedAt" : "2021-04-27T06:15:50Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "d5b6e0ff-ad73-41a9-a18f-7f166edf3eec",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "ah now I get it. If there is a place that creates `CreateViewCommand` directly, we get a problem.\r\n\r\nI think it's safer to avoid that to be future-proof. e.g.\r\n```\r\noverride def innerChildren: Seq[QueryPlan[_]] = if (analyzed) Seq(plan) else Nil\r\n```",
        "createdAt" : "2021-04-27T07:13:39Z",
        "updatedAt" : "2021-04-27T07:13:39Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "9285fec9-069a-42b2-94ba-25de52b65c8c",
        "parentId" : "b9da60c9-6c84-4de4-9b98-6b27288b063a",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "I agree. I will do a follow up PR.",
        "createdAt" : "2021-04-27T16:52:07Z",
        "updatedAt" : "2021-04-27T16:52:07Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "111ef8be8bc03a62389aed4f0871b958714eb789",
    "line" : 48,
    "diffHunk" : "@@ -1,1 +78,82 @@  }\n\n  override def innerChildren: Seq[QueryPlan[_]] = Seq(plan)\n\n  // `plan` needs to be analyzed, but shouldn't be optimized so that caching works correctly."
  },
  {
    "id" : "f1623cad-ec30-40be-bdb0-1bd74325d4d7",
    "prId" : 31933,
    "prUrl" : "https://github.com/apache/spark/pull/31933#pullrequestreview-618860834",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1b2a9a5a-bf5d-4915-a6c7-4fdc4aa2cfc8",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "how do we analyze it since it's not a child?",
        "createdAt" : "2021-03-23T04:53:24Z",
        "updatedAt" : "2021-03-25T03:52:40Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "7a725291-cc04-43dd-92e8-6d4ac0a55c05",
        "parentId" : "1b2a9a5a-bf5d-4915-a6c7-4fdc4aa2cfc8",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "The analyzed plan is passed here. I can keep the name `child` if that's clearer.",
        "createdAt" : "2021-03-23T17:12:30Z",
        "updatedAt" : "2021-03-25T03:52:40Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "507b00c34058cf52f430641078e44a0c1fc0be84",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +63,67 @@    properties: Map[String, String],\n    originalText: Option[String],\n    analyzedPlan: LogicalPlan,\n    allowExisting: Boolean,\n    replace: Boolean,"
  },
  {
    "id" : "a4c3d143-0906-4ad1-b1af-9fe6ca117f0f",
    "prId" : 31732,
    "prUrl" : "https://github.com/apache/spark/pull/31732#pullrequestreview-603922514",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d1566e87-7c06-4bf7-b476-056195a4d948",
        "parentId" : null,
        "authorId" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "body" : "could you leave a comment to make the filtering rule clear? i.e. allowList has higher priority than denyList.",
        "createdAt" : "2021-03-04T08:48:21Z",
        "updatedAt" : "2021-03-04T23:09:20Z",
        "lastEditedBy" : "29c89154-22f7-40ee-b295-115a55734d6c",
        "tags" : [
        ]
      },
      {
        "id" : "66f3a0b5-48e8-4f1f-bdab-bf12d02a887e",
        "parentId" : "d1566e87-7c06-4bf7-b476-056195a4d948",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "Added the comment.",
        "createdAt" : "2021-03-04T10:08:13Z",
        "updatedAt" : "2021-03-04T23:09:20Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      }
    ],
    "commit" : "7d12709b9e0fa00b5c09fc02ba25d6989c5d64aa",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +369,373 @@   * 2. do not exists in denyList\n   */\n  private def shouldCaptureConfig(key: String): Boolean = {\n    configAllowList.exists(prefix => key.equals(prefix)) ||\n      !configPrefixDenyList.exists(prefix => key.startsWith(prefix))"
  },
  {
    "id" : "988121e4-e8af-4dc9-9efb-4a3857fc9c4d",
    "prId" : 31652,
    "prUrl" : "https://github.com/apache/spark/pull/31652#pullrequestreview-608325212",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9c7ce171-2c34-4c5d-992f-37e3062d20f2",
        "parentId" : null,
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "This is unnecessary because `case p => !p.sameResult(aliasedPlan)` should cover, but I added this case explicitly to make the intention clear.",
        "createdAt" : "2021-03-10T04:41:32Z",
        "updatedAt" : "2021-03-10T20:37:43Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "7e4815a03d0d423ac377b6c3f7ce05f102ab0087",
    "line" : 218,
    "diffHunk" : "@@ -1,1 +622,626 @@      aliasedPlan: LogicalPlan): Boolean = rawTempView match {\n    // If TemporaryViewRelation doesn't store the analyzed view, always uncache.\n    case TemporaryViewRelation(_, None) => true\n    // Do not need to uncache if the to-be-replaced temp view plan and the new plan are the\n    // same-result plans."
  },
  {
    "id" : "8a2fc2a9-7001-4d05-8371-440c2cb292b1",
    "prId" : 31652,
    "prUrl" : "https://github.com/apache/spark/pull/31652#pullrequestreview-609076888",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "96414cbf-9ade-4144-95ae-8b6b03a3a2c2",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "Do we still need it? `rawTempView` should always be `TemporaryViewRelation` right?",
        "createdAt" : "2021-03-10T05:47:58Z",
        "updatedAt" : "2021-03-10T20:37:43Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "400bc622-81bf-4a05-bc9e-aca80402dce1",
        "parentId" : "96414cbf-9ade-4144-95ae-8b6b03a3a2c2",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "We need to first update `CREATE TEMP VIEW USING`:\r\nhttps://github.com/apache/spark/blob/3a299aa6480ac22501512cd0310d31a441d7dfdc/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/ddl.scala#L93-L100\r\n, which I will get to right after this PR.\r\n\r\nOnce the PR is done, we can update `createTempView` to take in `TemporaryViewRelation` (https://github.com/apache/spark/pull/31273/files#r580757641), then I can safely remove this line.\r\n\r\nLet me actually create a JIRA to capture these as subtasks.",
        "createdAt" : "2021-03-10T17:44:02Z",
        "updatedAt" : "2021-03-10T20:37:43Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "37057a40-c594-4350-9d33-ac3dfaf44e96",
        "parentId" : "96414cbf-9ade-4144-95ae-8b6b03a3a2c2",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "I created https://issues.apache.org/jira/browse/SPARK-34698 to track these.",
        "createdAt" : "2021-03-10T19:15:56Z",
        "updatedAt" : "2021-03-10T20:37:43Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "7e4815a03d0d423ac377b6c3f7ce05f102ab0087",
    "line" : 222,
    "diffHunk" : "@@ -1,1 +626,630 @@    // same-result plans.\n    case TemporaryViewRelation(_, Some(p)) => !p.sameResult(aliasedPlan)\n    case p => !p.sameResult(aliasedPlan)\n  }\n"
  }
]