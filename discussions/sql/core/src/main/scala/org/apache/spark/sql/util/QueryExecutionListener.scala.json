[
  {
    "id" : "f275828c-f449-414e-8dc9-371dbedfd1a0",
    "prId" : 31881,
    "prUrl" : "https://github.com/apache/spark/pull/31881#pullrequestreview-616048202",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8b088be2-ac46-4e98-9fd2-15ab28deaa44",
        "parentId" : null,
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "Manage this within `ExecutionListenerBus` instead of pulling it out ?\r\nMake `sessionUUID` an instance variable - and use `session` only in constructor (so it is not a field in the class)",
        "createdAt" : "2021-03-19T02:43:35Z",
        "updatedAt" : "2021-03-19T02:47:38Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      },
      {
        "id" : "3c5ea4f9-fae8-4514-a27b-ddedb2cf0bbf",
        "parentId" : "8b088be2-ac46-4e98-9fd2-15ab28deaa44",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Oh, this is a backporting PR. @Ngone51 can we address the comment in a separate PR so that followup can also be ported back?",
        "createdAt" : "2021-03-19T02:58:52Z",
        "updatedAt" : "2021-03-19T02:58:52Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "cc3f8e3a-7e51-4289-b8e5-a638f44bdd5b",
        "parentId" : "8b088be2-ac46-4e98-9fd2-15ab28deaa44",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Sure, I'll do a follow-up. Thanks @mridulm ",
        "createdAt" : "2021-03-19T03:09:38Z",
        "updatedAt" : "2021-03-19T03:09:38Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "3fee011a-5869-4990-be9d-fd6e1fd7695a",
        "parentId" : "8b088be2-ac46-4e98-9fd2-15ab28deaa44",
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "Sorry, missed the original PR !",
        "createdAt" : "2021-03-19T04:11:13Z",
        "updatedAt" : "2021-03-19T04:11:13Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      }
    ],
    "commit" : "0d364cc5f6ca8b966b9b16e6aa8308cae66250c5",
    "line" : 9,
    "diffHunk" : "@@ -1,1 +81,85 @@  session.sparkContext.cleaner.foreach { cleaner =>\n    cleaner.registerSparkListenerForCleanup(this, listenerBus)\n  }\n\n  if (loadExtensions) {"
  },
  {
    "id" : "b375dea3-495e-48f2-9d06-12417e553869",
    "prId" : 31839,
    "prUrl" : "https://github.com/apache/spark/pull/31839#pullrequestreview-613935754",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "54e91d41-a50a-45f4-86f1-7bc71c31a61a",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "So, this fix is designed to be disabled when `spark.cleaner.referenceTracking=false`?",
        "createdAt" : "2021-03-15T17:56:47Z",
        "updatedAt" : "2021-03-17T14:31:40Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "8d835d64-473c-4773-98e9-2d77f3c01abf",
        "parentId" : "54e91d41-a50a-45f4-86f1-7bc71c31a61a",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "To be honest, no. It fixes the memory leak so we generally always want it takes effect. And the `ContextCleaner` is an experienced framework that we can leverage to fix this issue elegantly without aggressive changes.\r\n\r\nThe config is introduced since Spark 1.0.0 and enabled by default. So I personally think it's acceptable to assume users run applications with cleaner enabled in most cases.",
        "createdAt" : "2021-03-16T03:38:58Z",
        "updatedAt" : "2021-03-17T14:31:40Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "2a9d20c2-594c-4f55-a368-c59d6b67839b",
        "parentId" : "54e91d41-a50a-45f4-86f1-7bc71c31a61a",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "I'm not against having that assumption. But, this doesn't fix memory leaks at all if `spark.cleaner.referenceTracking=false` technically, does it? We should be clear about the limitation of the PR.",
        "createdAt" : "2021-03-16T18:23:11Z",
        "updatedAt" : "2021-03-17T14:31:40Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "3ddda0bb-d3d4-4e28-8f54-4135164eaa07",
        "parentId" : "54e91d41-a50a-45f4-86f1-7bc71c31a61a",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "> But, this doesn't fix memory leaks at all if spark.cleaner.referenceTracking=false technically, does it? \r\n\r\nYes, it doesn't.",
        "createdAt" : "2021-03-17T01:47:35Z",
        "updatedAt" : "2021-03-17T14:31:40Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "a59f49a2-b047-408a-9390-c1a4d1e254c9",
        "parentId" : "54e91d41-a50a-45f4-86f1-7bc71c31a61a",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "Let's mention it in the PR description to be clear.",
        "createdAt" : "2021-03-17T03:10:16Z",
        "updatedAt" : "2021-03-17T14:31:40Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "85943503-b139-4a28-a8ff-6c5fc40c5055",
        "parentId" : "54e91d41-a50a-45f4-86f1-7bc71c31a61a",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Updated.",
        "createdAt" : "2021-03-17T05:38:29Z",
        "updatedAt" : "2021-03-17T14:31:40Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "9e81427eb7ac351d7511c0abec6d189eb7b9fbff",
    "line" : 7,
    "diffHunk" : "@@ -1,1 +79,83 @@  private val listenerBus = new ExecutionListenerBus(session.sessionUUID)\n  session.sparkContext.listenerBus.addToSharedQueue(listenerBus)\n  session.sparkContext.cleaner.foreach { cleaner =>\n    cleaner.registerSparkListenerForCleanup(this, listenerBus)\n  }"
  },
  {
    "id" : "8c166f7b-3e25-4e3d-bae4-97e6283b5c70",
    "prId" : 31231,
    "prUrl" : "https://github.com/apache/spark/pull/31231#pullrequestreview-571198802",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2e058ef3-1163-4ce1-a123-4a7e5c91cbf0",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "The problem here is that it removes all the listeners even added from another session.",
        "createdAt" : "2021-01-18T12:20:38Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "b59b6bcc-cad3-4fc0-ba2b-8e31e51df333",
        "parentId" : "2e058ef3-1163-4ce1-a123-4a7e5c91cbf0",
        "authorId" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "body" : "+1",
        "createdAt" : "2021-01-18T13:08:47Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "tags" : [
        ]
      },
      {
        "id" : "5346548a-e9e8-4abb-b32b-1c748135a9ab",
        "parentId" : "2e058ef3-1163-4ce1-a123-4a7e5c91cbf0",
        "authorId" : "c12eb4aa-c39d-4fa9-8470-ed071c0be24a",
        "body" : "It only removes the session belongs `QueryExecutionListener`, not the others. I can't imagine how it can remove listener create by other sessions, can you give me an example?",
        "createdAt" : "2021-01-19T03:07:11Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "c12eb4aa-c39d-4fa9-8470-ed071c0be24a",
        "tags" : [
        ]
      },
      {
        "id" : "f40671c2-28f1-4ca3-97f8-5854cf107616",
        "parentId" : "2e058ef3-1163-4ce1-a123-4a7e5c91cbf0",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "You're removing all listeners from Spark Context which other Spark sessions share. ",
        "createdAt" : "2021-01-19T03:48:30Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "5b2a09a8-0e7c-40d1-bf4b-c594df7eec63",
        "parentId" : "2e058ef3-1163-4ce1-a123-4a7e5c91cbf0",
        "authorId" : "c12eb4aa-c39d-4fa9-8470-ed071c0be24a",
        "body" : "Add a new test and explain how we don't remove the Spark Context shared listener.",
        "createdAt" : "2021-01-19T12:21:36Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "c12eb4aa-c39d-4fa9-8470-ed071c0be24a",
        "tags" : [
        ]
      },
      {
        "id" : "e081fb5d-3e8f-46c8-a14b-559df64574d1",
        "parentId" : "2e058ef3-1163-4ce1-a123-4a7e5c91cbf0",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Oh, okay. I misread.",
        "createdAt" : "2021-01-19T12:33:16Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "2b2a10d317be6247e38ceca01eccf4df372d8459",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +130,134 @@  @DeveloperApi\n  def clearListenerBus(): Unit = {\n    session.sparkContext.removeSparkListener(listenerBus)\n  }\n"
  },
  {
    "id" : "f8adf7a5-3ee6-47a6-b8e4-0c987f2fe0f6",
    "prId" : 31231,
    "prUrl" : "https://github.com/apache/spark/pull/31231#pullrequestreview-570892332",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5fb60018-fc89-4c80-8eb1-f170197ecfda",
        "parentId" : null,
        "authorId" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "body" : "Just a question, does the user need to manually clear these listener event?",
        "createdAt" : "2021-01-18T13:08:16Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "tags" : [
        ]
      },
      {
        "id" : "ae14ebfa-b7bf-4a67-bc9a-976db44d5709",
        "parentId" : "5fb60018-fc89-4c80-8eb1-f170197ecfda",
        "authorId" : "c12eb4aa-c39d-4fa9-8470-ed071c0be24a",
        "body" : "I think it is a good idea to remove the listeners automatically. If I understand correctly, Spark now has no method to destroy a SparkSession, user manager session lifecycle by themself, so we can't remove the listener automatically. Maybe we can put clear listener behavior in `SparkSession.clearActiveSession()`, but i think it's not a good idea.\r\n",
        "createdAt" : "2021-01-19T04:07:10Z",
        "updatedAt" : "2021-01-21T06:20:07Z",
        "lastEditedBy" : "c12eb4aa-c39d-4fa9-8470-ed071c0be24a",
        "tags" : [
        ]
      }
    ],
    "commit" : "2b2a10d317be6247e38ceca01eccf4df372d8459",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +129,133 @@   */\n  @DeveloperApi\n  def clearListenerBus(): Unit = {\n    session.sparkContext.removeSparkListener(listenerBus)\n  }"
  },
  {
    "id" : "fb027005-854c-4bda-ab2c-178494cc1db7",
    "prId" : 25292,
    "prUrl" : "https://github.com/apache/spark/pull/25292#pullrequestreview-373214095",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "91dd8634-bfff-4f8f-82cb-51413dce19c4",
        "parentId" : null,
        "authorId" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "body" : "This will need a release note.",
        "createdAt" : "2019-07-29T20:35:18Z",
        "updatedAt" : "2019-07-29T21:23:16Z",
        "lastEditedBy" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "tags" : [
        ]
      },
      {
        "id" : "34b5b5a2-b407-4652-8dc4-0e9ef74b6ca5",
        "parentId" : "91dd8634-bfff-4f8f-82cb-51413dce19c4",
        "authorId" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "body" : "There is another issue in this API: It passes a private class `QueryExecution` to the user in a public API. Didn't fix it as it will require a re-design of this API.",
        "createdAt" : "2019-07-29T20:36:53Z",
        "updatedAt" : "2019-07-29T21:23:16Z",
        "lastEditedBy" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "tags" : [
        ]
      },
      {
        "id" : "2d8b7b27-f9f3-4225-a729-6219f53f1e45",
        "parentId" : "91dd8634-bfff-4f8f-82cb-51413dce19c4",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Yea, we should sort those problems out. There's another occurrence at Dataset.queryExecution as an API. ",
        "createdAt" : "2019-07-30T01:36:50Z",
        "updatedAt" : "2019-07-30T01:36:50Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "773273c3-6674-479f-b242-bd3bf2c42054",
        "parentId" : "91dd8634-bfff-4f8f-82cb-51413dce19c4",
        "authorId" : "1d40bb30-68bd-4124-82bc-33d93ee4bc65",
        "body" : "I'm a bit concerned about this change. This broke one of my project that uses this API. Instead of changing the signature here, did we consider just wrapping the exception?",
        "createdAt" : "2020-03-11T23:51:48Z",
        "updatedAt" : "2020-03-11T23:51:48Z",
        "lastEditedBy" : "1d40bb30-68bd-4124-82bc-33d93ee4bc65",
        "tags" : [
        ]
      },
      {
        "id" : "37702eaf-6d63-4a7c-bb89-9bf45d88ee3d",
        "parentId" : "91dd8634-bfff-4f8f-82cb-51413dce19c4",
        "authorId" : "1d40bb30-68bd-4124-82bc-33d93ee4bc65",
        "body" : "RE: `QueryExecution` I think that has become a developer API at this point.  I think a lot of developers use it to debug things.",
        "createdAt" : "2020-03-11T23:53:06Z",
        "updatedAt" : "2020-03-11T23:53:06Z",
        "lastEditedBy" : "1d40bb30-68bd-4124-82bc-33d93ee4bc65",
        "tags" : [
        ]
      },
      {
        "id" : "cf0fba0f-be28-4c42-914c-0dfabca434be",
        "parentId" : "91dd8634-bfff-4f8f-82cb-51413dce19c4",
        "authorId" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "body" : "> wrapping the exception?\r\n\r\nThis is a good suggestion. This can avoid api changes, and we can also fix this bug that errors are not sent to the listener in 2.4.",
        "createdAt" : "2020-03-12T00:40:42Z",
        "updatedAt" : "2020-03-12T00:55:21Z",
        "lastEditedBy" : "2d6b46ba-4100-4c4d-9341-fff5e39647ec",
        "tags" : [
        ]
      }
    ],
    "commit" : "bdc2c26a04155074f9a3dcf64afa7e15872f0223",
    "line" : 11,
    "diffHunk" : "@@ -1,1 +64,68 @@   */\n  @DeveloperApi\n  def onFailure(funcName: String, qe: QueryExecution, error: Throwable): Unit\n}\n"
  }
]