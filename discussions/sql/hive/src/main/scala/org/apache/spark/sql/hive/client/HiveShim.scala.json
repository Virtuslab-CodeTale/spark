[
  {
    "id" : "a6db54d2-24b3-4611-8dba-6fda82d55db5",
    "prId" : 33382,
    "prUrl" : "https://github.com/apache/spark/pull/33382#pullrequestreview-718364227",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "239b7855-b58b-462d-9a64-e297b8bd5818",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "This fallback can lead to a huge performance slowdown, or even hang the application (e.g. listing millions of partitions)\r\n\r\nI think we should be very conservative about fallback. Maybe a config to control this is better, instead of looking at the `directSQL` flag.",
        "createdAt" : "2021-07-26T10:39:25Z",
        "updatedAt" : "2021-07-26T10:39:25Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "67654481-014a-4ed9-b3f1-c98a0366a615",
        "parentId" : "239b7855-b58b-462d-9a64-e297b8bd5818",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "@cloud-fan thanks for your input. What do you think of the proposal [here](https://github.com/apache/spark/pull/33382#issuecomment-883134666)? We can introduce a flag `SQLConf.get.metastorePartitionPruningFallbackOnException` which default to false. As result, the code will no longer depend on the directSQL flag (currently when the flag is turned off on the remote HMS, Spark will always fallback to list all partitions).",
        "createdAt" : "2021-07-26T17:14:55Z",
        "updatedAt" : "2021-07-26T17:14:55Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      },
      {
        "id" : "a53d8b63-00b5-45eb-8c2a-6a16c470b96f",
        "parentId" : "239b7855-b58b-462d-9a64-e297b8bd5818",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "SGTM",
        "createdAt" : "2021-07-27T11:04:04Z",
        "updatedAt" : "2021-07-27T11:04:04Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "394263b5-284d-48dc-95de-aa4ae1374f90",
        "parentId" : "239b7855-b58b-462d-9a64-e297b8bd5818",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "@cloud-fan updated the PR with this approach. Let me know what you think.",
        "createdAt" : "2021-07-29T17:36:50Z",
        "updatedAt" : "2021-07-29T17:36:50Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      }
    ],
    "commit" : "32fc0054a6f71565f9e44d3a542310392ab3bd77",
    "line" : 28,
    "diffHunk" : "@@ -1,1 +894,898 @@              shouldFallback =>\n            logWarning(\"Caught Hive MetaException attempting to get partition metadata by \" +\n              \"filter from Hive. Falling back to fetching all partition metadata, which will \" +\n              \"degrade performance. Modifying your Hive metastore configuration to set \" +\n              s\"${tryDirectSqlConfVar.varname} to true (if it is not true already) may resolve \" +"
  }
]