[
  {
    "id" : "4ace1b81-f4b7-4940-8b87-77476a05ccee",
    "prId" : 32446,
    "prUrl" : "https://github.com/apache/spark/pull/32446#pullrequestreview-654087281",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "802f825b-74cd-406b-8ae5-57e9d6418ff6",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Here, line 303 claims that we need `the side-effect of Hive.get(conf)`.\r\nCould you confirm that `shim.getHive(conf)` doesn't break the side-effect assumption?",
        "createdAt" : "2021-05-07T05:14:03Z",
        "updatedAt" : "2021-05-07T05:14:03Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "83f1ef44-b4c8-4187-bd1c-33dd93652c59",
        "parentId" : "802f825b-74cd-406b-8ae5-57e9d6418ff6",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "yeah it shouldn't - both function are doing the same in this case by updating the `Hive` object's config with provided `conf`.",
        "createdAt" : "2021-05-07T05:16:22Z",
        "updatedAt" : "2021-05-07T05:16:23Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      }
    ],
    "commit" : "88697a43ba63963a1951f8d99a697fab4ca5692f",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +304,308 @@    // See discussion in https://github.com/apache/spark/pull/16826/files#r104606859\n    // for more details.\n    shim.getHive(conf)\n    // setCurrentSessionState will use the classLoader associated\n    // with the HiveConf in `state` to override the context class loader of the current"
  },
  {
    "id" : "23d4bb52-1a1b-475a-89d3-162a7145e886",
    "prId" : 32410,
    "prUrl" : "https://github.com/apache/spark/pull/32410#pullrequestreview-679603176",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0c147e18-0a17-4b84-9ed9-b276612db912",
        "parentId" : null,
        "authorId" : "813f0961-9a16-4e42-a167-961d914c472c",
        "body" : "@HyukjinKwon @sunchao I changed it to `shim.setCurrentSessionState(state)` to make it simpler.",
        "createdAt" : "2021-05-14T06:05:24Z",
        "updatedAt" : "2021-05-14T06:05:24Z",
        "lastEditedBy" : "813f0961-9a16-4e42-a167-961d914c472c",
        "tags" : [
        ]
      },
      {
        "id" : "39068d0f-fa49-4f5b-b965-6fb1eb586a21",
        "parentId" : "0c147e18-0a17-4b84-9ed9-b276612db912",
        "authorId" : "2821208d-43c5-4475-94ad-36cbf84c14d8",
        "body" : "@wangyum I wonder if this is a safe change. And why do you think this is making it simpler? ",
        "createdAt" : "2021-06-07T19:58:50Z",
        "updatedAt" : "2021-06-07T19:58:51Z",
        "lastEditedBy" : "2821208d-43c5-4475-94ad-36cbf84c14d8",
        "tags" : [
        ]
      },
      {
        "id" : "ab32acde-9137-41ed-8227-bb7a892ec651",
        "parentId" : "0c147e18-0a17-4b84-9ed9-b276612db912",
        "authorId" : "813f0961-9a16-4e42-a167-961d914c472c",
        "body" : "Sorry for late replay. It is two questions.\r\n\r\n> if this is a safe change\r\n\r\nYes. The difference is `sessionState.start` creating too many directories and Spark SQL do not need it.\r\n\r\n> why do you think this is making it simpler?\r\n\r\n`shim.setCurrentSessionState(state)` is simpler than `if (version != hive.v12) SessionState.setCurrentSessionState(state) else   SessionState.start(state) `.",
        "createdAt" : "2021-06-09T12:45:42Z",
        "updatedAt" : "2021-06-09T12:45:42Z",
        "lastEditedBy" : "813f0961-9a16-4e42-a167-961d914c472c",
        "tags" : [
        ]
      }
    ],
    "commit" : "4bca8ecaec066ef19d04a12e134ba830320a2e0f",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +191,195 @@    // got changed. We reset it to clientLoader.ClassLoader here.\n    state.getConf.setClassLoader(clientLoader.classLoader)\n    shim.setCurrentSessionState(state)\n    state.out = new PrintStream(outputBuffer, true, UTF_8.name())\n    state.err = new PrintStream(outputBuffer, true, UTF_8.name())"
  },
  {
    "id" : "74bb2218-3400-4d14-b8fe-a369175442bc",
    "prId" : 32410,
    "prUrl" : "https://github.com/apache/spark/pull/32410#pullrequestreview-682750212",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "4c0257a7-d08d-48d5-8a5d-251174890531",
        "parentId" : null,
        "authorId" : "2821208d-43c5-4475-94ad-36cbf84c14d8",
        "body" : "@HyukjinKwon @wangyum should this also be replaced with `shim.setCurrentSessionState(state)`?",
        "createdAt" : "2021-06-14T09:22:38Z",
        "updatedAt" : "2021-06-14T09:22:38Z",
        "lastEditedBy" : "2821208d-43c5-4475-94ad-36cbf84c14d8",
        "tags" : [
        ]
      },
      {
        "id" : "996662bd-ed01-4b44-a731-04df2158eb27",
        "parentId" : "4c0257a7-d08d-48d5-8a5d-251174890531",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I think it's because it executes some Hive queries e.g.) `sparkSession.metadataHive.runSqlHive(\"SELECT * FROM t\")` at `sql/hive/src/test/scala/org/apache/spark/sql/hive/HiveMetastoreCatalogSuite.scala`",
        "createdAt" : "2021-06-14T09:37:20Z",
        "updatedAt" : "2021-06-14T09:37:20Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "f754a457-6405-4327-8df7-ed47d1b62765",
        "parentId" : "4c0257a7-d08d-48d5-8a5d-251174890531",
        "authorId" : "813f0961-9a16-4e42-a167-961d914c472c",
        "body" : "Yes. Hive query needs to start `SessionState`.",
        "createdAt" : "2021-06-14T10:26:12Z",
        "updatedAt" : "2021-06-14T10:26:12Z",
        "lastEditedBy" : "813f0961-9a16-4e42-a167-961d914c472c",
        "tags" : [
        ]
      }
    ],
    "commit" : "4bca8ecaec066ef19d04a12e134ba830320a2e0f",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +830,834 @@\n    // Hive query needs to start SessionState.\n    SessionState.start(state)\n    logDebug(s\"Running hiveql '$cmd'\")\n    if (cmd.toLowerCase(Locale.ROOT).startsWith(\"set\")) { logDebug(s\"Changing config: $cmd\") }"
  }
]