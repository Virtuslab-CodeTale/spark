[
  {
    "id" : "639f3891-bd54-4360-b0b5-5102e321597e",
    "prId" : 30665,
    "prUrl" : "https://github.com/apache/spark/pull/30665#pullrequestreview-548185551",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a9ac16f1-bbbf-4cd1-ac92-b01e7466f84f",
        "parentId" : null,
        "authorId" : "813f0961-9a16-4e42-a167-961d914c472c",
        "body" : "`deprecated: Boolean = true` -> `isDeprecatedConstructor: Boolean`?",
        "createdAt" : "2020-12-09T13:33:59Z",
        "updatedAt" : "2020-12-09T13:33:59Z",
        "lastEditedBy" : "813f0961-9a16-4e42-a167-961d914c472c",
        "tags" : [
        ]
      }
    ],
    "commit" : "0e3dca1ea3228747a43d573075bc6162cc76d475",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +200,204 @@    funcWrapper: HiveFunctionWrapper,\n    children: Seq[Expression],\n    deprecated: Boolean = true)\n  extends Generator with HiveInspectors with CodegenFallback with UserDefinedExpression {\n"
  },
  {
    "id" : "34e885c7-d358-4c84-a15e-4819ea39d571",
    "prId" : 30665,
    "prUrl" : "https://github.com/apache/spark/pull/30665#pullrequestreview-548186264",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5e0907b2-37e3-497f-b6f4-b0422aeae8b2",
        "parentId" : null,
        "authorId" : "813f0961-9a16-4e42-a167-961d914c472c",
        "body" : "How about?\r\n```scala\r\nprotected lazy val outputInspector = {\r\n  if (isDeprecatedConstructor) {\r\n    function.initialize(inputInspectors.toArray)\r\n  } else {\r\n    val rowOI = ObjectInspectorFactory.getStandardStructObjectInspector(\r\n      children.zipWithIndex.map(e => s\"_col${e._2}\").asJava, inputInspectors.asJava)\r\n    function.initialize(rowOI)\r\n  }\r\n}\r\n```",
        "createdAt" : "2020-12-09T13:34:48Z",
        "updatedAt" : "2020-12-09T13:34:48Z",
        "lastEditedBy" : "813f0961-9a16-4e42-a167-961d914c472c",
        "tags" : [
        ]
      }
    ],
    "commit" : "0e3dca1ea3228747a43d573075bc6162cc76d475",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +226,230 @@    } else {\n      function.initialize(rowOI)\n    }\n\n  @transient"
  },
  {
    "id" : "9d74dc78-fa44-4023-b13d-31e1d51f5782",
    "prId" : 29749,
    "prUrl" : "https://github.com/apache/spark/pull/29749#pullrequestreview-490447836",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a9b47658-a11f-4249-8739-c5b1ca1dbf2b",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "`ScalaUDF` doesn't extend `ImplicitCastInputTypes` either. Does it have the same problem?",
        "createdAt" : "2020-09-17T06:26:13Z",
        "updatedAt" : "2020-09-18T14:36:08Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "83e61b66-213e-4eab-83c5-45c2d658f0ea",
        "parentId" : "a9b47658-a11f-4249-8739-c5b1ca1dbf2b",
        "authorId" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "body" : "No, `ImplicitTypeCasts` has checked `ScalaUDF ` as `case udf: ScalaUDF if udf.inputTypes.nonEmpty =>`",
        "createdAt" : "2020-09-17T10:17:23Z",
        "updatedAt" : "2020-09-18T14:36:08Z",
        "lastEditedBy" : "baca2fab-b749-483f-8c77-c4db14eca9d9",
        "tags" : [
        ]
      }
    ],
    "commit" : "e13f2b94ff0c2897663dd81e596c775b728db862",
    "line" : 6,
    "diffHunk" : "@@ -1,1 +49,53 @@  with Logging\n  with UserDefinedExpression\n  with ImplicitCastInputTypes {\n\n  override lazy val deterministic: Boolean = isUDFDeterministic && children.forall(_.deterministic)"
  },
  {
    "id" : "fd8eb5c8-0079-4900-897b-14342d343728",
    "prId" : 24459,
    "prUrl" : "https://github.com/apache/spark/pull/24459#pullrequestreview-231849043",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "71f317c1-e53c-4413-916c-7fd88df137b7",
        "parentId" : null,
        "authorId" : "3effe229-2580-4532-83c5-e3fff5ca47ac",
        "body" : "Once the value of canDoMerge is always set false after deserialization, in the merge() function, the aggregationBuffer will be always re-created even the passed buffer parameter is actually a Partial2 or Final state. This, correct me if I am wrong, is a flaw causing performance downgrade.\r\nMay need to do none-trivial work in serialize() to include the state.",
        "createdAt" : "2019-04-25T22:43:54Z",
        "updatedAt" : "2019-04-25T22:44:20Z",
        "lastEditedBy" : "3effe229-2580-4532-83c5-e3fff5ca47ac",
        "tags" : [
        ]
      },
      {
        "id" : "42b82d35-cb1a-4265-9e2e-94597fe7522e",
        "parentId" : "71f317c1-e53c-4413-916c-7fd88df137b7",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "the deserialized buffer can only appear as the second parameter in `merge`, so `canDoMerge` doesn't matter here.",
        "createdAt" : "2019-04-26T06:39:08Z",
        "updatedAt" : "2019-04-26T06:39:08Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "6addba5a-08e1-4db8-9b90-7ce1509fc448",
        "parentId" : "71f317c1-e53c-4413-916c-7fd88df137b7",
        "authorId" : "3effe229-2580-4532-83c5-e3fff5ca47ac",
        "body" : "I see, except for the case of falling back from hash agg, and that's what you want to address here, and this is not impacting spark udaf. The logic looks clear and good to me, thanks!",
        "createdAt" : "2019-04-26T19:20:11Z",
        "updatedAt" : "2019-04-26T19:20:11Z",
        "lastEditedBy" : "3effe229-2580-4532-83c5-e3fff5ca47ac",
        "tags" : [
        ]
      },
      {
        "id" : "cde6a9b4-d91d-4f93-9334-f255d05c784d",
        "parentId" : "71f317c1-e53c-4413-916c-7fd88df137b7",
        "authorId" : "896060dc-3c09-4c4c-9e91-0bc5e3187d3a",
        "body" : "LGTM",
        "createdAt" : "2019-04-29T19:06:17Z",
        "updatedAt" : "2019-04-29T19:06:17Z",
        "lastEditedBy" : "896060dc-3c09-4c4c-9e91-0bc5e3187d3a",
        "tags" : [
        ]
      }
    ],
    "commit" : "3d523b6996157026d61edc705054437dee362f6d",
    "line" : 104,
    "diffHunk" : "@@ -1,1 +481,485 @@    // Deserializes an `AggregationBuffer` from the shuffled partial aggregation phase to prepare\n    // for global aggregation by merging multiple partial aggregation results within a single group.\n    HiveUDAFBuffer(aggBufferSerDe.deserialize(bytes), false)\n  }\n"
  }
]