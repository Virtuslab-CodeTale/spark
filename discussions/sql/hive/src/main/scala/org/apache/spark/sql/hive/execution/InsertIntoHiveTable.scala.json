[
  {
    "id" : "02de50ca-755c-451b-bfd3-c7acb77f228f",
    "prId" : 30538,
    "prUrl" : "https://github.com/apache/spark/pull/30538#pullrequestreview-563761100",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6136bf14-8a77-4d44-8ebb-72c33b4a8248",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "how about empty string?",
        "createdAt" : "2021-01-07T08:32:48Z",
        "updatedAt" : "2021-01-08T08:03:31Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "ba6a5984-ab78-4445-90f9-b07b5e55a35e",
        "parentId" : "6136bf14-8a77-4d44-8ebb-72c33b4a8248",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "The test:\r\n```scala\r\n  test(\"SPARK-33591: '' as a partition value\") {\r\n    val t = \"part_table\"\r\n    withTable(t) {\r\n      sql(s\"CREATE TABLE $t (col1 INT, p1 STRING) $defaultUsing PARTITIONED BY (p1)\")\r\n      sql(s\"INSERT INTO TABLE $t PARTITION (p1 = '') SELECT 0\")\r\n    }\r\n  }\r\n```\r\nfails with:\r\n```\r\nPartition spec is invalid. The spec ([p1=Some()]) contains an empty partition column value\r\norg.apache.spark.sql.AnalysisException: Partition spec is invalid. The spec ([p1=Some()]) contains an empty partition column value\r\n\tat org.apache.spark.sql.execution.datasources.PreprocessTableInsertion$.org$apache$spark$sql$execution$datasources$PreprocessTableInsertion$$preprocess(rules.scala:412)\r\n```\r\nat https://github.com/apache/spark/blob/d730b6bdaa92f2ca19cc8852ac58035e28d47a4f/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/rules.scala#L408-L409",
        "createdAt" : "2021-01-07T19:23:38Z",
        "updatedAt" : "2021-01-08T08:03:31Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "89c15724d5af9b423a14f512c8764bd26eee6c9f",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +134,138 @@    val numStaticPartitions = partition.values.count(_.nonEmpty)\n    val partitionSpec = partition.map {\n      case (key, Some(null)) => key -> ExternalCatalogUtils.DEFAULT_PARTITION_NAME\n      case (key, Some(value)) => key -> value\n      case (key, None) => key -> \"\""
  }
]