[
  {
    "id" : "02de50ca-755c-451b-bfd3-c7acb77f228f",
    "prId" : 30538,
    "prUrl" : "https://github.com/apache/spark/pull/30538#pullrequestreview-563761100",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6136bf14-8a77-4d44-8ebb-72c33b4a8248",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "how about empty string?",
        "createdAt" : "2021-01-07T08:32:48Z",
        "updatedAt" : "2021-01-08T08:03:31Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "ba6a5984-ab78-4445-90f9-b07b5e55a35e",
        "parentId" : "6136bf14-8a77-4d44-8ebb-72c33b4a8248",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "The test:\r\n```scala\r\n  test(\"SPARK-33591: '' as a partition value\") {\r\n    val t = \"part_table\"\r\n    withTable(t) {\r\n      sql(s\"CREATE TABLE $t (col1 INT, p1 STRING) $defaultUsing PARTITIONED BY (p1)\")\r\n      sql(s\"INSERT INTO TABLE $t PARTITION (p1 = '') SELECT 0\")\r\n    }\r\n  }\r\n```\r\nfails with:\r\n```\r\nPartition spec is invalid. The spec ([p1=Some()]) contains an empty partition column value\r\norg.apache.spark.sql.AnalysisException: Partition spec is invalid. The spec ([p1=Some()]) contains an empty partition column value\r\n\tat org.apache.spark.sql.execution.datasources.PreprocessTableInsertion$.org$apache$spark$sql$execution$datasources$PreprocessTableInsertion$$preprocess(rules.scala:412)\r\n```\r\nat https://github.com/apache/spark/blob/d730b6bdaa92f2ca19cc8852ac58035e28d47a4f/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/rules.scala#L408-L409",
        "createdAt" : "2021-01-07T19:23:38Z",
        "updatedAt" : "2021-01-08T08:03:31Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "89c15724d5af9b423a14f512c8764bd26eee6c9f",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +134,138 @@    val numStaticPartitions = partition.values.count(_.nonEmpty)\n    val partitionSpec = partition.map {\n      case (key, Some(null)) => key -> ExternalCatalogUtils.DEFAULT_PARTITION_NAME\n      case (key, Some(value)) => key -> value\n      case (key, None) => key -> \"\""
  },
  {
    "id" : "4f72ec7c-d076-48f0-9ad3-165453fba1b6",
    "prId" : 29319,
    "prUrl" : "https://github.com/apache/spark/pull/29319#pullrequestreview-481606233",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1c4d4c65-3354-4cf4-a92e-b474a2618a30",
        "parentId" : null,
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "There are too many case \r\n\r\n1. Hive version > 2.0 & Hive version < 2.9\r\n2. insert overwrite table\r\n3. dynamic partition insert",
        "createdAt" : "2020-09-03T08:20:55Z",
        "updatedAt" : "2020-09-03T08:21:12Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      }
    ],
    "commit" : "6be846b8e6ec61c0b496d688de18db4a2a787f9a",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +326,330 @@                        s\"Cannot remove partition directory '$path'\")\n                    }\n                  }\n                }\n                // Don't let Hive do overwrite operation since it is slower."
  },
  {
    "id" : "f6864aba-0d16-4250-b6a8-19c801f9f2ac",
    "prId" : 28649,
    "prUrl" : "https://github.com/apache/spark/pull/28649#pullrequestreview-454651179",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "767995ec-d595-4e93-b05f-57fab56c61b3",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "`numDynamicPartitions == 0 && numStaticPartitions > 0`?",
        "createdAt" : "2020-07-24T06:03:05Z",
        "updatedAt" : "2020-07-29T23:32:37Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "43ad6ed4-1ded-4422-9a2d-6e87213dc052",
        "parentId" : "767995ec-d595-4e93-b05f-57fab56c61b3",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "or just make it a lazy val, so that we only compute it when needed.",
        "createdAt" : "2020-07-24T06:06:18Z",
        "updatedAt" : "2020-07-29T23:32:37Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "4d6471754366a5e990c67527a53ab0935340db44",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +150,154 @@    }\n\n    val oldPart = if ( numDynamicPartitions == 0) {\n      externalCatalog.getPartitionOption(\n        table.database,"
  },
  {
    "id" : "e77ae8e4-b824-43e7-b694-788c8e2a9b2c",
    "prId" : 28649,
    "prUrl" : "https://github.com/apache/spark/pull/28649#pullrequestreview-457216106",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "be5fea06-92ae-49f6-ad9e-24c9e17c7871",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "do we have this warning message before?",
        "createdAt" : "2020-07-24T06:06:35Z",
        "updatedAt" : "2020-07-29T23:32:37Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "9adb18af-bf22-4b58-b9d2-7c9aea77b39b",
        "parentId" : "be5fea06-92ae-49f6-ad9e-24c9e17c7871",
        "authorId" : "b8f11172-21bd-42d9-8d93-465aaee9f95d",
        "body" : "No, we didn't have this warning before. But, it's good to see this explicitly in the log to understand why no job was run.",
        "createdAt" : "2020-07-28T16:32:44Z",
        "updatedAt" : "2020-07-29T23:32:37Z",
        "lastEditedBy" : "b8f11172-21bd-42d9-8d93-465aaee9f95d",
        "tags" : [
        ]
      },
      {
        "id" : "ef032203-2e81-4e37-ba33-dd81914635a4",
        "parentId" : "be5fea06-92ae-49f6-ad9e-24c9e17c7871",
        "authorId" : "8df147d9-bc9d-4fd9-bb98-5dcf9619220b",
        "body" : "+1 for adding a warning message here, I feel previous behavior with silently exiting query might be quite confusing for users and developers.\r\n\r\nnit: as we could have multiple `INSERT OVERWRITE` in one query, do we also want to include table name (`table.identifier.table`) in warning message?",
        "createdAt" : "2020-07-29T06:00:51Z",
        "updatedAt" : "2020-07-29T23:32:37Z",
        "lastEditedBy" : "8df147d9-bc9d-4fd9-bb98-5dcf9619220b",
        "tags" : [
        ]
      }
    ],
    "commit" : "4d6471754366a5e990c67527a53ab0935340db44",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +184,188 @@      if (!oldPart.isEmpty && ifPartitionNotExists) {\n        val partitionStr = partitionSpec.map(_.productIterator.mkString(\"=\")).mkString(\"/\")\n        logWarning(s\"Partition '$partitionStr' already exist, skip running job to overwrite \" +\n          s\"since 'IF NOT EXISTS' is set.\")\n        return"
  },
  {
    "id" : "0adeb96e-871a-41cf-a69c-d3ac6d9eff66",
    "prId" : 28649,
    "prUrl" : "https://github.com/apache/spark/pull/28649#pullrequestreview-457216106",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "fb6f9ff7-3336-4b6f-b910-ddcd1bc15357",
        "parentId" : null,
        "authorId" : "8df147d9-bc9d-4fd9-bb98-5dcf9619220b",
        "body" : "nit: `if (oldPart.isDefined && ifPartitionNotExists)`",
        "createdAt" : "2020-07-29T06:02:18Z",
        "updatedAt" : "2020-07-29T23:32:37Z",
        "lastEditedBy" : "8df147d9-bc9d-4fd9-bb98-5dcf9619220b",
        "tags" : [
        ]
      }
    ],
    "commit" : "4d6471754366a5e990c67527a53ab0935340db44",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +182,186 @@      // https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML#LanguageManualDML-InsertingdataintoHiveTablesfromqueries\n      // scalastyle:on\n      if (!oldPart.isEmpty && ifPartitionNotExists) {\n        val partitionStr = partitionSpec.map(_.productIterator.mkString(\"=\")).mkString(\"/\")\n        logWarning(s\"Partition '$partitionStr' already exist, skip running job to overwrite \" +"
  },
  {
    "id" : "18200593-e400-4373-878b-774dafd37cb4",
    "prId" : 28511,
    "prUrl" : "https://github.com/apache/spark/pull/28511#pullrequestreview-413585691",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "91f511bf-ab5d-49e4-82c4-0964d321f8e2",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "This should be put after `SPARK-18107:`, as the context relies on SPARK-18107",
        "createdAt" : "2020-05-18T13:19:40Z",
        "updatedAt" : "2020-05-19T05:57:51Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "78e097284096b27839928668a3deaf6a49cab336",
    "line" : 26,
    "diffHunk" : "@@ -1,1 +292,296 @@            .client\n            .version\n          // SPARK-31684:\n          // For Hive 2.0.0 and onwards, as https://issues.apache.org/jira/browse/HIVE-11940\n          // has been fixed, and there is no performance issue anymore. We should leave the"
  },
  {
    "id" : "1bed56b0-1ee8-491a-9fe6-d1f27d99d5a1",
    "prId" : 27887,
    "prUrl" : "https://github.com/apache/spark/pull/27887#pullrequestreview-373350627",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "2e4f09f4-32d5-4a29-a097-37d3be09933e",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "indentation?",
        "createdAt" : "2020-03-12T08:19:55Z",
        "updatedAt" : "2020-03-12T08:19:55Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "bbf41e2db8b48757c702617a27d10a12aa5a9f04",
    "line" : 71,
    "diffHunk" : "@@ -1,1 +266,270 @@          // data. We construct partition path. If the path exists, we delete it manually.\n          val partitionPath = if (oldPart.isEmpty && overwrite\n            && table.tableType == CatalogTableType.EXTERNAL) {\n            val partitionColumnNames = table.partitionColumnNames\n            val tablePath = new Path(table.location)"
  }
]