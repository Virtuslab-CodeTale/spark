[
  {
    "id" : "840afbc2-ea7c-4533-a3b3-a7437fdb82b8",
    "prId" : 28016,
    "prUrl" : "https://github.com/apache/spark/pull/28016#pullrequestreview-381730131",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "21f66777-76f0-47d3-aa47-2336d1d314c0",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "unnecessary change",
        "createdAt" : "2020-03-26T05:44:12Z",
        "updatedAt" : "2020-03-26T10:05:26Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "025d5745-30c3-4129-b8c5-1674491544e6",
        "parentId" : "21f66777-76f0-47d3-aa47-2336d1d314c0",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "If I remove it, the build fails with:\r\n```\r\nError:(1012, 44) not found: type DaysWritable\r\n  private def getDateWritable(value: Any): DaysWritable =\r\n```\r\nI moved `DaysWritable` from `sql/hive` to `sql/core` to reuse it in ORC.",
        "createdAt" : "2020-03-26T06:29:31Z",
        "updatedAt" : "2020-03-26T10:05:26Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "c8a897abd4a0fae72d42335951ff77b1f054c655",
    "line" : 4,
    "diffHunk" : "@@ -1,1 +33,37 @@import org.apache.spark.sql.catalyst.expressions._\nimport org.apache.spark.sql.catalyst.util._\nimport org.apache.spark.sql.execution.datasources.DaysWritable\nimport org.apache.spark.sql.types\nimport org.apache.spark.sql.types._"
  },
  {
    "id" : "2e61b510-82ef-4e8a-8cf9-c6f5234608d8",
    "prId" : 27807,
    "prUrl" : "https://github.com/apache/spark/pull/27807#pullrequestreview-370737154",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b7ac57e7-6fa3-49cd-b8fc-68d0d65732c9",
        "parentId" : null,
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "The bug fix should be made independently from the PR, I think.",
        "createdAt" : "2020-03-07T10:41:23Z",
        "updatedAt" : "2020-03-11T06:21:33Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "407cc1fd8584f2a045b8db74cfe50023f13b7919",
    "line" : 49,
    "diffHunk" : "@@ -1,1 +495,499 @@      case poi: WritableConstantTimestampObjectInspector =>\n        val t = poi.getWritableConstantValue\n        val constant = DateTimeUtils.fromJavaTimestamp(t.getTimestamp)\n        _ => constant\n      case poi: WritableConstantIntObjectInspector =>"
  },
  {
    "id" : "41e7cd77-1e92-4093-9bca-9787e5757e99",
    "prId" : 27807,
    "prUrl" : "https://github.com/apache/spark/pull/27807#pullrequestreview-371872517",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "562bface-0425-42de-a78d-ed5ddfbded15",
        "parentId" : null,
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Gregorian year is shorter than Julian year: 365.2425 days vs 365.25 days, so the same local date in Gregorian calendar requires less days in Julian calendar.",
        "createdAt" : "2020-03-10T11:30:52Z",
        "updatedAt" : "2020-03-11T06:21:33Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      }
    ],
    "commit" : "407cc1fd8584f2a045b8db74cfe50023f13b7919",
    "line" : 96,
    "diffHunk" : "@@ -1,1 +1059,1063 @@      // Proleptic Gregorian calendar: 1582-01-01 -> -141714\n      // Julian calendar: 1582-01-01 -> -141704\n      // The code below converts -141714 to -141704.\n      val daysSinceEpoch = value.asInstanceOf[Int]\n      val rebasedDays = if (daysSinceEpoch < DateTimeUtils.GREGORIAN_CUTOVER_DAY) {"
  },
  {
    "id" : "7edb4831-f5bb-4ab0-a8f1-a5ae4b1c2045",
    "prId" : 24846,
    "prUrl" : "https://github.com/apache/spark/pull/24846#pullrequestreview-250224933",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5b32e616-e758-4a03-af45-bafde4d2b9a7",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Can we have a test case for this, @cxzl25 ? Otherwise, we cannot protect your PR from the future regression.",
        "createdAt" : "2019-06-16T04:03:31Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "bc5647f2-d9f4-4886-b7f2-818959e29ce7",
        "parentId" : "5b32e616-e758-4a03-af45-bafde4d2b9a7",
        "authorId" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "body" : "ok, add a new test, please help review again, thank you",
        "createdAt" : "2019-06-16T10:13:23Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "tags" : [
        ]
      }
    ],
    "commit" : "52edc0fec4e2636f1187bb9b8ca6d25697b275ac",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +849,853 @@      }\n    case Literal(_, dt: StructType) =>\n      toInspector(dt)\n    // We will enumerate all of the possible constant expressions, throw exception if we missed\n    case Literal(_, dt) => sys.error(s\"Hive doesn't support the constant type [$dt].\")"
  },
  {
    "id" : "dc17861a-0b79-40be-aef7-62eb2ac64da2",
    "prId" : 24846,
    "prUrl" : "https://github.com/apache/spark/pull/24846#pullrequestreview-250483794",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "fbdbadc8-c98b-40ed-bf30-394c6dfcf93e",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "@cxzl25, the error messages say the literal of struct type is not supported. Can you show and double check if that's supported in Hive as well?",
        "createdAt" : "2019-06-17T02:29:09Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "a570b2bb-c754-4400-8770-2aa34a288e4a",
        "parentId" : "fbdbadc8-c98b-40ed-bf30-394c6dfcf93e",
        "authorId" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "body" : "I use hive to run the test case sql is ok\r\n\r\n![image](https://user-images.githubusercontent.com/3898450/59575129-9cde3280-90ec-11e9-8fcc-8229b6512e97.png)\r\n\r\n```sql\r\nCREATE TEMPORARY FUNCTION testLiteralStructType AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFArray';\r\nSELECT testLiteralStructType(named_struct('name', 'xx', 'value', 1))[0].value;\r\n```\r\nhttps://github.com/apache/spark/blob/5ae1a6bf0dea9e74ced85686ef33a87cfa3e90c2/sql/hive/src/main/scala/org/apache/spark/sql/hive/HiveInspectors.scala#L851\r\n\r\n\r\n\r\n",
        "createdAt" : "2019-06-17T02:45:18Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "tags" : [
        ]
      },
      {
        "id" : "1f08ef53-0844-434d-8c8f-56a42c68ed61",
        "parentId" : "fbdbadc8-c98b-40ed-bf30-394c6dfcf93e",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I think technically `named_struct` isn't a literal in this case. It's foldable expression in the example above. Can you fix the PR title and description accordingly to prevent confusion?",
        "createdAt" : "2019-06-17T03:10:58Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "65e2fe37-8d09-49c3-8266-fca3a5fbec34",
        "parentId" : "fbdbadc8-c98b-40ed-bf30-394c6dfcf93e",
        "authorId" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "body" : "Using ```named_struct``` just wants to construct a constant of type struct.\r\nIf use the following sql, there will be no problem mentioned in this pr.\r\nShould I change to such a title?  Hive UDF supports foldable expression\r\nAny suggestions?\r\n\r\n```sql\r\nCREATE TABLE test_struct_tbl AS \r\nSELECT named_struct('name', 'xx', 'value', 1) as c1;\r\nCREATE TEMPORARY FUNCTION testLiteralStructType AS 'org.apache.hadoop.hive.ql.udf.generic.GenericUDFArray';\r\nSELECT testLiteralStructType(c1)[0].value\r\nFROM test_struct_tbl;\r\n```\r\n![image](https://user-images.githubusercontent.com/3898450/59599460-2adc0c80-9131-11e9-86ee-29d07a4c43c8.png)\r\n\r\n![image](https://user-images.githubusercontent.com/3898450/59599235-a093a880-9130-11e9-8dc8-9d96f1eb1120.png)\r\n",
        "createdAt" : "2019-06-17T10:56:03Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "tags" : [
        ]
      },
      {
        "id" : "d69e1c08-a354-4680-b9f4-84b7528403db",
        "parentId" : "fbdbadc8-c98b-40ed-bf30-394c6dfcf93e",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "I think you can just replace \"literal struct type\" to \"struct type foldable expression\"",
        "createdAt" : "2019-06-17T13:10:05Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "52edc0fec4e2636f1187bb9b8ca6d25697b275ac",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +849,853 @@      }\n    case Literal(_, dt: StructType) =>\n      toInspector(dt)\n    // We will enumerate all of the possible constant expressions, throw exception if we missed\n    case Literal(_, dt) => sys.error(s\"Hive doesn't support the constant type [$dt].\")"
  },
  {
    "id" : "3ec97b62-09d8-44a8-b6fc-a0a182eab9e6",
    "prId" : 24846,
    "prUrl" : "https://github.com/apache/spark/pull/24846#pullrequestreview-250442893",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "042dfd1b-89fc-484d-b325-223ef9906f4b",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "The fix looks correct.\r\n\r\nHowever, to use `toInspector` here is to invoke `toInspector(dataType: DataType)` for nested fields. For the fields, not constant object inspector is used anymore.\r\n\r\nSince it is literal, can we follow array and map literals logics, to use constant object inspector for nested fields?\r\n\r\n ",
        "createdAt" : "2019-06-17T05:56:27Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "e7d4ce9c-e9c6-44cc-9ccc-b71bd96afc8d",
        "parentId" : "042dfd1b-89fc-484d-b325-223ef9906f4b",
        "authorId" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "body" : "Looking at the logics of array and map literals , there is no constant object inspector for nested fields.\r\n\r\nIt seems that hive udf only requires the object to be ```instanceof ConstantObjectInspector``` , no requirement for nested fields.\r\n\r\nHive implements ```ObjectInspectorFactory#getStandardConstantStructObjectInspector``` on [HIVE-11428](https://issues.apache.org/jira/browse/HIVE-11428), but there is no such method in hive-exec 1.2.1.spark2.\r\n\r\nhttps://github.com/apache/hive/blob/d72f70ad959c27a713f53d5e8b9172d662a29d51/serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/ObjectInspectorUtils.java#L1422-L1459",
        "createdAt" : "2019-06-17T10:22:34Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "8de20372-3c43-4f6b-838b-45ccb852019b",
        "tags" : [
        ]
      },
      {
        "id" : "4b50abfe-0743-453e-99f2-7dccbbc4b345",
        "parentId" : "042dfd1b-89fc-484d-b325-223ef9906f4b",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Hmm, I thought to fill constant object inspectors for struct fields into `ObjectInspectorFactory.getStandardStructObjectInspector`. But there is no `getStandardConstantStructObjectInspector` for null value case.\r\n\r\nOk. Then I think current fix is good. Thanks.",
        "createdAt" : "2019-06-17T11:39:51Z",
        "updatedAt" : "2019-06-17T13:30:27Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "52edc0fec4e2636f1187bb9b8ca6d25697b275ac",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +849,853 @@      }\n    case Literal(_, dt: StructType) =>\n      toInspector(dt)\n    // We will enumerate all of the possible constant expressions, throw exception if we missed\n    case Literal(_, dt) => sys.error(s\"Hive doesn't support the constant type [$dt].\")"
  }
]