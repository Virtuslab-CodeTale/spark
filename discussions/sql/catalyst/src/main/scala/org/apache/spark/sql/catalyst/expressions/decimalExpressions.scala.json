[
  {
    "id" : "408512b9-45fa-4df2-ab8e-9735a89e3ef7",
    "prId" : 33103,
    "prUrl" : "https://github.com/apache/spark/pull/33103#pullrequestreview-693368478",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d4623d48-aa6c-4f87-ae26-ebde9eccd992",
        "parentId" : null,
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "Looks like it's the root cause, should I close my PR?",
        "createdAt" : "2021-06-27T00:47:06Z",
        "updatedAt" : "2021-06-27T00:47:06Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "ddad4e53-240d-41b9-b8ca-67cb574526d7",
        "parentId" : "d4623d48-aa6c-4f87-ae26-ebde9eccd992",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Yea, thanks! I added you as co-author.",
        "createdAt" : "2021-06-27T00:48:55Z",
        "updatedAt" : "2021-06-27T00:48:55Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "9a082844a1bf9c3eac5f956fbfde1f36b7a65ed3",
    "line" : 17,
    "diffHunk" : "@@ -1,1 +112,116 @@  override def eval(input: InternalRow): Any = child.eval(input)\n  override protected def doGenCode(ctx: CodegenContext, ev: ExprCode): ExprCode =\n    child.genCode(ctx)\n  override def prettyName: String = \"promote_precision\"\n  override def sql: String = child.sql"
  },
  {
    "id" : "c2675360-ddde-4837-af46-90e9a7f8f7bc",
    "prId" : 27627,
    "prUrl" : "https://github.com/apache/spark/pull/27627#pullrequestreview-367634261",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9d2a09ee-5d5c-4a5f-ae70-2ab2fe870cd1",
        "parentId" : null,
        "authorId" : "99e31844-a5b3-48a2-af71-412edb607a13",
        "body" : "Can we override `nullable` with `false` as `doGenCode()` does?",
        "createdAt" : "2020-02-23T15:28:15Z",
        "updatedAt" : "2020-06-01T18:16:22Z",
        "lastEditedBy" : "99e31844-a5b3-48a2-af71-412edb607a13",
        "tags" : [
        ]
      },
      {
        "id" : "56a3d936-a97d-4f72-bb9d-cc39196d372d",
        "parentId" : "9d2a09ee-5d5c-4a5f-ae70-2ab2fe870cd1",
        "authorId" : "7907b27a-5a9f-4bce-8e6d-d4cd7c2bd693",
        "body" : "Since the child can be nullable, the input value can be null.   Making nullable to false in that case will not work, as it may result in npe.  We can change the doGenCode() here to make the check for null for that, but since  the nullSafeCodeGen in UnaryExpression already takes care of the if nullable checks,  it seems there is no need to add if null checks here. ",
        "createdAt" : "2020-03-03T00:49:44Z",
        "updatedAt" : "2020-06-01T18:16:22Z",
        "lastEditedBy" : "7907b27a-5a9f-4bce-8e6d-d4cd7c2bd693",
        "tags" : [
        ]
      }
    ],
    "commit" : "77958880245cca238bd976900e57715f6f96a3c4",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +153,157 @@    nullOnOverflow: Boolean) extends UnaryExpression {\n\n  override def nullable: Boolean = true\n\n  override def eval(input: InternalRow): Any = {"
  },
  {
    "id" : "36529c5e-b10e-4253-ba3a-208d3b56526a",
    "prId" : 25010,
    "prUrl" : "https://github.com/apache/spark/pull/25010#pullrequestreview-256044459",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "238e9482-d99e-484f-929b-9a4941196047",
        "parentId" : null,
        "authorId" : "a11722a8-ecfa-4827-88e3-4d708f023846",
        "body" : "Is it safe to skip the assignment to `${ev.isNull}` in the `nullable = false` branch? \r\n\r\nI'm concerned about what would happen when the underlying variable that the `${ev.isNull} = ` updates has already been initialized (possibly to a default value): I _guess_ that's okay because then then when `nullable == false` the `isNull` variable already has the correct value (`false`).\r\n\r\nI was just curious whether there's existing precedence for this in codegen.\r\n\r\nShould we limit scope and keep the `isNull` assignment as we had it before (deferring this additional optimization)? Or should we keep this additional optimization citing precedence? (I'm not a codegen expert; mostly asking for my own curiousity, plus general conservatism about reducing number of branches / cases to review).",
        "createdAt" : "2019-06-29T16:41:52Z",
        "updatedAt" : "2019-06-29T19:19:20Z",
        "lastEditedBy" : "a11722a8-ecfa-4827-88e3-4d708f023846",
        "tags" : [
        ]
      },
      {
        "id" : "8c9fb0e1-b9cc-467a-a8d6-869402a979f4",
        "parentId" : "238e9482-d99e-484f-929b-9a4941196047",
        "authorId" : "24e1dd39-ae3f-4bbb-a391-f60afb62d075",
        "body" : "Not only it is safe, but it doesn't even compile to make that assignment in the nullable case. If a variable is not nullable, its `isNull` variable is just the constant `false`: so no assignment has to be done (please see the code in `nullSafeCodeGen`).\r\n\r\n> I was just curious whether there's existing precedence for this in codegen.\r\n\r\nYou can find similar patterns in `collectionOperations.scala`\r\n",
        "createdAt" : "2019-06-29T17:05:43Z",
        "updatedAt" : "2019-06-29T19:19:20Z",
        "lastEditedBy" : "24e1dd39-ae3f-4bbb-a391-f60afb62d075",
        "tags" : [
        ]
      },
      {
        "id" : "85e2f957-9c29-4336-b4b4-f238cf0eb8f4",
        "parentId" : "238e9482-d99e-484f-929b-9a4941196047",
        "authorId" : "a11722a8-ecfa-4827-88e3-4d708f023846",
        "body" : "TIL! Thanks for clarifying.",
        "createdAt" : "2019-06-29T17:17:50Z",
        "updatedAt" : "2019-06-29T19:19:20Z",
        "lastEditedBy" : "a11722a8-ecfa-4827-88e3-4d708f023846",
        "tags" : [
        ]
      }
    ],
    "commit" : "4928330c928e988f71002a5f5f17ae9283232e2a",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +71,75 @@        \"set\"\n      }\n      val setNull = if (nullable) {\n        s\"${ev.isNull} = ${ev.value} == null;\"\n      } else {"
  }
]