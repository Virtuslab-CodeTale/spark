[
  {
    "id" : "537c594e-59d3-437c-bde0-2740d4cd449d",
    "prId" : 30970,
    "prUrl" : "https://github.com/apache/spark/pull/30970#pullrequestreview-559937224",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5bf1a492-b235-4e28-ba93-e3863e79ab15",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Maybe:\r\n```suggestion\r\n        if schema.length > 1 && j.options.isEmpty =>\r\n        // Options here should be empty because the optimization should not be enabled\r\n        // for some options. For example, when the parse mode is failfast it should not\r\n        // optimize, and should force to parse the whole input JSON with failing fast for\r\n        // an invalid input.\r\n        // To be more conservative, it does not optimize when any option is set for now.\r\n```",
        "createdAt" : "2020-12-30T07:14:53Z",
        "updatedAt" : "2020-12-30T07:32:51Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "a512b336-6353-42bd-8099-59e4b8135476",
        "parentId" : "5bf1a492-b235-4e28-ba93-e3863e79ab15",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "+1",
        "createdAt" : "2020-12-30T07:20:36Z",
        "updatedAt" : "2020-12-30T07:32:51Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "4a5dd45f-15a8-4ad9-95bc-bc22cc0f43fb",
        "parentId" : "5bf1a492-b235-4e28-ba93-e3863e79ab15",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Thanks!",
        "createdAt" : "2020-12-30T07:33:05Z",
        "updatedAt" : "2020-12-30T07:33:06Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "333fbcbfd72a40c751cdaaa940aba44c54c483a9",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +99,103 @@\n    case g @ GetStructField(j @ JsonToStructs(schema: StructType, _, _, _), ordinal, _)\n        if schema.length > 1 && j.options.isEmpty =>\n        // Options here should be empty because the optimization should not be enabled\n        // for some options. For example, when the parse mode is failfast it should not"
  },
  {
    "id" : "2cb5074b-9f69-4fed-9116-61edda24df0d",
    "prId" : 30912,
    "prUrl" : "https://github.com/apache/spark/pull/30912#pullrequestreview-558268865",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "31365b89-d417-4cef-b1b2-3ddfbb977692",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Thank you for generalizing this. This renaming looks fine to me.",
        "createdAt" : "2020-12-23T23:16:49Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "627ab485091eac1993796d5c23650c748ad9d1b3",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +36,40 @@ * 4. Prune unnecessary columns from GetStructField + CsvToStructs.\n */\nobject OptimizeCsvJsonExprs extends Rule[LogicalPlan] {\n  private def nameOfCorruptRecord = SQLConf.get.getConf(SQLConf.COLUMN_NAME_OF_CORRUPT_RECORD)\n"
  },
  {
    "id" : "ad26dd9a-2800-476e-b40e-b0aae98939bc",
    "prId" : 30912,
    "prUrl" : "https://github.com/apache/spark/pull/30912#pullrequestreview-558719720",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "49a39086-ae96-420e-b2e7-cd6c9d6ea7a4",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "What about:\r\n\r\n```scala\r\ncase p if SQLConf.get.jsonExpressionOptimization => p.transformExpressions(jsonOptimization)\r\ncase p if SQLConf.get.csvExpressionOptimization => p.transformExpressions(csvOptimization)\r\ncase p => p\r\n```\r\n? Or is the optimization dependent on each other?",
        "createdAt" : "2020-12-24T02:36:42Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "2301c330-f0da-4d18-a706-50c7689cd4c2",
        "parentId" : "49a39086-ae96-420e-b2e7-cd6c9d6ea7a4",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Not dependent, but if so `p` only goes to match first case when both are enabled.",
        "createdAt" : "2020-12-24T02:46:21Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "058f620a-060e-4041-80bd-d8eeb2ed0f9f",
        "parentId" : "49a39086-ae96-420e-b2e7-cd6c9d6ea7a4",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Ah I see. Since we generalized the rule, it might more make sense to have one configuration to enable and disable this ..",
        "createdAt" : "2020-12-24T02:59:25Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "b6dcf11c-afb2-4a4e-b290-4a1c6eb216cb",
        "parentId" : "49a39086-ae96-420e-b2e7-cd6c9d6ea7a4",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "To enable/disable entire rule, `spark.sql.optimizer.excludedRules` should be able to help. So the purpose here is to have individual configs for enabling csv/json.",
        "createdAt" : "2020-12-24T03:07:07Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "3eb22cac-c45b-44f2-82f5-c8306a3ce1e9",
        "parentId" : "49a39086-ae96-420e-b2e7-cd6c9d6ea7a4",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Hm .. okay. I still prefer to separate refactoring from this PR but it's fine if both you and @dongjoon-hyun prefer.",
        "createdAt" : "2020-12-24T03:36:37Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "7816d468-0b66-4564-8c40-3ddc69b0d329",
        "parentId" : "49a39086-ae96-420e-b2e7-cd6c9d6ea7a4",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Technically, I'm neutral in terms of separating.",
        "createdAt" : "2020-12-24T22:09:38Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "627ab485091eac1993796d5c23650c748ad9d1b3",
    "line" : 54,
    "diffHunk" : "@@ -1,1 +52,56 @@        optimized\n      }\n  }\n\n  private val jsonOptimization: PartialFunction[Expression, Expression] = {"
  },
  {
    "id" : "03e0bfb0-1515-416d-ad4f-5ed9931e6d58",
    "prId" : 30912,
    "prUrl" : "https://github.com/apache/spark/pull/30912#pullrequestreview-559513126",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bdc773b5-87a7-4852-8f25-01df8866ba25",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "```suggestion\r\n        if schema.length > 1 && c.options.isEmpty && schema(ordinal).name != nameOfCorruptRecord =>\r\n        // When the parse mode is permissive, and corrupt column is not selected, we can prune here\r\n        // from `GetStructField`. To be more conservative, it does not optimize when any option\r\n        // is set.\r\n```",
        "createdAt" : "2020-12-29T12:34:49Z",
        "updatedAt" : "2020-12-29T12:35:20Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "627ab485091eac1993796d5c23650c748ad9d1b3",
    "line" : 113,
    "diffHunk" : "@@ -1,1 +111,115 @@  private val csvOptimization: PartialFunction[Expression, Expression] = {\n    case g @ GetStructField(c @ CsvToStructs(schema: StructType, _, _, _, None), ordinal, _)\n        if schema.length > 1 && c.options.isEmpty && schema(ordinal).name != nameOfCorruptRecord =>\n        // When the parse mode is permissive, and corrupt column is not selected, we can prune here\n        // from `GetStructField`. To be more conservative, it does not optimize when any option"
  }
]