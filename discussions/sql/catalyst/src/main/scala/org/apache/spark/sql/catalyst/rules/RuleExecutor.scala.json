[
  {
    "id" : "ecc80f3c-e955-4984-8154-c5d4fdd0d645",
    "prId" : 27846,
    "prUrl" : "https://github.com/apache/spark/pull/27846#pullrequestreview-370943113",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0a03b567-2b62-4aba-977c-901dd81d09c3",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "unnecessary change?",
        "createdAt" : "2020-03-08T22:34:33Z",
        "updatedAt" : "2020-03-09T13:03:24Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "db179039-8f8b-44c7-bb33-55d398ec03c1",
        "parentId" : "0a03b567-2b62-4aba-977c-901dd81d09c3",
        "authorId" : "c48b13f0-9ce5-4910-a8eb-aee1ac73ffcb",
        "body" : "I thought the ident here was incorrect, so fixed it together.",
        "createdAt" : "2020-03-09T02:01:11Z",
        "updatedAt" : "2020-03-09T13:03:24Z",
        "lastEditedBy" : "c48b13f0-9ce5-4910-a8eb-aee1ac73ffcb",
        "tags" : [
        ]
      },
      {
        "id" : "e1f90407-df52-43fb-8cad-9371fb87a3b4",
        "parentId" : "0a03b567-2b62-4aba-977c-901dd81d09c3",
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "ok",
        "createdAt" : "2020-03-09T06:46:53Z",
        "updatedAt" : "2020-03-09T13:03:24Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      }
    ],
    "commit" : "36bf2e134436a9b5c7d96c839855dd69cef45538",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +239,243 @@               |=== Result of Batch ${batchName} ===\n               |${sideBySide(oldPlan.treeString, newPlan.treeString).mkString(\"\\n\")}\n            \"\"\".stripMargin\n          } else {\n            s\"Batch ${batchName} has no effect.\""
  },
  {
    "id" : "e00202c7-de13-4a13-9f95-a2bb8af3a922",
    "prId" : 26977,
    "prUrl" : "https://github.com/apache/spark/pull/26977#pullrequestreview-355536215",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b2454c2b-c2fa-432d-ba5c-70aa1490a2cd",
        "parentId" : null,
        "authorId" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "body" : "In the message, we need to explicitly tell users how to resolve this exception. Increasing the value of SQLConf.ANALYZER_MAX_ITERATIONS.key",
        "createdAt" : "2020-02-08T04:42:18Z",
        "updatedAt" : "2020-02-10T05:07:34Z",
        "lastEditedBy" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "tags" : [
        ]
      },
      {
        "id" : "9e441216-5fed-4f18-aa79-44bc836a4614",
        "parentId" : "b2454c2b-c2fa-432d-ba5c-70aa1490a2cd",
        "authorId" : "c48b13f0-9ce5-4910-a8eb-aee1ac73ffcb",
        "body" : "IMO, here is the common logic in `RuleExecutor` to handle `errorOnExceed` strategy, which should not include specific knowledge `ANALYZER_MAX_ITERATIONS` of inheritance class `analyzer`.  This will lead to potential bug when we introduce more MAX_ITERATION setting?\r\n\r\nMaybe we can use a common phrase here like 'increasing the value of corresponding SQLConf setting'. Or an alternative way of adding a string hint field in `Strategy`, and set it in `Analyzer` together with `errorOnExceed` flag?\r\n\r\nWhat do you think ? @gatorsmile  Thanks a lot!",
        "createdAt" : "2020-02-08T07:32:49Z",
        "updatedAt" : "2020-02-10T05:07:34Z",
        "lastEditedBy" : "c48b13f0-9ce5-4910-a8eb-aee1ac73ffcb",
        "tags" : [
        ]
      },
      {
        "id" : "8b5bc82d-7d25-4950-b3c4-810ae68a8cdc",
        "parentId" : "b2454c2b-c2fa-432d-ba5c-70aa1490a2cd",
        "authorId" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "body" : "We need a clear message for end users. Usability is more important. \r\n\r\nRegarding the implementation, I think we should avoid over-engineering. Just make it simple. Adding the message postfix in abstract class Strategy looks fine to me.",
        "createdAt" : "2020-02-08T07:46:59Z",
        "updatedAt" : "2020-02-10T05:07:34Z",
        "lastEditedBy" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "tags" : [
        ]
      },
      {
        "id" : "77c7f397-b69c-4989-a341-678a7232079b",
        "parentId" : "b2454c2b-c2fa-432d-ba5c-70aa1490a2cd",
        "authorId" : "c48b13f0-9ce5-4910-a8eb-aee1ac73ffcb",
        "body" : "I see, thanks for the clarification. :-)",
        "createdAt" : "2020-02-08T07:54:38Z",
        "updatedAt" : "2020-02-10T05:07:34Z",
        "lastEditedBy" : "c48b13f0-9ce5-4910-a8eb-aee1ac73ffcb",
        "tags" : [
        ]
      }
    ],
    "commit" : "bff75bc6e2e877c08113062dc471458caa5cb996",
    "line" : 45,
    "diffHunk" : "@@ -1,1 +177,181 @@              s\"$endingMsg\"\n            if (Utils.isTesting || batch.strategy.errorOnExceed) {\n              throw new TreeNodeException(curPlan, message, null)\n            } else {\n              logWarning(message)"
  },
  {
    "id" : "e1687e6b-9ff3-4c48-8e89-2772f71697ef",
    "prId" : 25039,
    "prUrl" : "https://github.com/apache/spark/pull/25039#pullrequestreview-257668169",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "now we have both `Once` and `Idempotent`, we should pick which one in which cases?",
        "createdAt" : "2019-07-03T06:51:32Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "9863f10d-1145-4f9c-9621-270811f92aaf",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "body" : "I would suggest to use `Once` in the test suites only. \r\n \r\nIn the unit tests of optimizer rules, we have many batches that are using `Once`. The expected result of the optimized plan is based on the Once policy. These batches are not expected to be idempotent. ",
        "createdAt" : "2019-07-03T07:05:54Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "d19fc546-1296-40ce-befb-9eca847aeceb",
        "tags" : [
        ]
      },
      {
        "id" : "4e6379f6-6c23-4fdd-83a5-d2e1298b9956",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "body" : "To be clear, `Once` means a batch should be run only once, but does not guarantee anything for multiple runs. On the other hand, `Idempotent` means that a batch should be run once, but multiple runs should yield the same result of a single run.",
        "createdAt" : "2019-07-03T07:10:03Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "tags" : [
        ]
      },
      {
        "id" : "672820ab-a506-43b8-8db9-c047b404c6b1",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "body" : "Basically if a batch is marked as `Idempotent`, the idempotence contract is enforced by running an additional checker.",
        "createdAt" : "2019-07-03T07:11:55Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "tags" : [
        ]
      },
      {
        "id" : "8303879d-36bb-4372-94ab-f7143f5a30cc",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "body" : "After we make sure all rules are idempotent, `Once` would be for test only and the names would all seem weird and confusing.\r\nOne way is to use `Once` for the semantics of idempotent, and add a test-only `OnceUnchecked` for all the catalyst rule tests (I don't suppose we should use this anywhere else).\r\nAnother option is to add another ENV variable, similar to `SPARK_TESTING` (sth. like `SPARK_RULE_TESTING`) for the `RuleExecutor` to skip the check.\r\n",
        "createdAt" : "2019-07-03T16:29:15Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "tags" : [
        ]
      },
      {
        "id" : "8d101ba7-2a9a-4f3f-bfb6-5eff96decf1e",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "body" : "See `RuleExecutorSuite`, `Once` *was* supposed to run only once (and does not necessarily have to  pass the sanity check).",
        "createdAt" : "2019-07-03T16:33:23Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "tags" : [
        ]
      },
      {
        "id" : "1fb14baa-889d-4611-b061-05024cb79e2d",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "body" : "I know what you are saying, @yeshengm. All I meant was all we need is `Idempotent` and `FixedPoint` except for the occasions that @gatorsmile worried about in our catalyst rule tests where really `FixedPoint` should be used but it was mistakenly put as `Once`.\r\n\r\nNow I remember last time I worked the experimental branch, there wasn't a whole lot of such places, so let's just change those false `Once` to `FixedPoint` in our tests, and we'll need `Once` only (which is checked under testing mode).",
        "createdAt" : "2019-07-03T16:48:02Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "tags" : [
        ]
      },
      {
        "id" : "a44f00cd-b986-4c6b-a0bb-11889d08be35",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "body" : "@maryannxue We can definitely change that. But that means we also have to change tests in `RuleExecutorSuite`. So you are suggesting that we only have `Once` with idempotence semantics & `FixedPoint` right?",
        "createdAt" : "2019-07-03T17:01:51Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "88f0c774-9c59-4485-885d-f6aee36efcea",
        "tags" : [
        ]
      },
      {
        "id" : "0007877a-b7d9-4c8e-a80d-79024bb24403",
        "parentId" : "9bbfa3d3-7be5-415e-a54f-a53cfc716e79",
        "authorId" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "body" : "Yep.",
        "createdAt" : "2019-07-03T18:31:47Z",
        "updatedAt" : "2019-07-15T19:48:15Z",
        "lastEditedBy" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "tags" : [
        ]
      }
    ],
    "commit" : "304b2c23d6edfea6860a091bd19391d27a8ccbf9",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +52,56 @@\n  /** A strategy that only runs once. */\n  case object Once extends Strategy { val maxIterations = 1 }\n\n  /** A strategy that runs until fix point or maxIterations times, whichever comes first. */"
  }
]