[
  {
    "id" : "e92c88d2-dca4-41b9-9fa2-812f78ee1256",
    "prId" : 31120,
    "prUrl" : "https://github.com/apache/spark/pull/31120#pullrequestreview-565107131",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "62846b5f-d6ab-4130-b218-669b47b0d6b9",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "The doc example of `CreateNamedStruct` is\r\n```\r\n> SELECT _FUNC_(\"a\", 1, \"b\", 2, \"c\", 3);\r\n       {\"a\":1,\"b\":2,\"c\":3}\r\n```\r\n\r\nI think it's a valid syntax for named rows.",
        "createdAt" : "2021-01-11T07:01:26Z",
        "updatedAt" : "2021-01-11T07:01:26Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "fb1727ea-e8e6-4bf6-88bd-71189d857daf",
        "parentId" : "62846b5f-d6ab-4130-b218-669b47b0d6b9",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> The doc example of `CreateNamedStruct` is\r\n> \r\n> ```\r\n> > SELECT _FUNC_(\"a\", 1, \"b\", 2, \"c\", 3);\r\n>        {\"a\":1,\"b\":2,\"c\":3}\r\n> ```\r\n> \r\n> I think it's a valid syntax for named rows.\r\n\r\nI got it, seems because I run this  SQL in normal UT, i just return struct data's value part. I was misled.",
        "createdAt" : "2021-01-11T07:19:41Z",
        "updatedAt" : "2021-01-11T07:19:41Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      }
    ],
    "commit" : "fffc4501d64d3678d53cd23c92e8bf229e6d5e98",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +510,514 @@    Examples:\n      > SELECT _FUNC_('{\"a\":1, \"b\":0.8}', 'a INT, b DOUBLE');\n       {1, 0.8}\n      > SELECT _FUNC_('{\"time\":\"26/08/2015\"}', 'time Timestamp', map('timestampFormat', 'dd/MM/yyyy'));\n       {2015-08-26 00:00:00}"
  },
  {
    "id" : "fb7692ca-cbb2-423d-b178-b0112a01d4bd",
    "prId" : 30172,
    "prUrl" : "https://github.com/apache/spark/pull/30172#pullrequestreview-519268851",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1552a69e-9ed3-4084-978f-992f03aa6f05",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Can we update migration guide?",
        "createdAt" : "2020-10-28T14:34:46Z",
        "updatedAt" : "2020-10-28T18:00:11Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "bd9919d5-69c5-45c1-8b47-282dfacaed49",
        "parentId" : "1552a69e-9ed3-4084-978f-992f03aa6f05",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "Will it break user queries?",
        "createdAt" : "2020-10-28T15:43:48Z",
        "updatedAt" : "2020-10-28T18:00:11Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "77174b4d-4484-419e-8542-7e2d91f9b322",
        "parentId" : "1552a69e-9ed3-4084-978f-992f03aa6f05",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Nope but the output from this function becomes different",
        "createdAt" : "2020-10-28T15:45:55Z",
        "updatedAt" : "2020-10-28T18:00:11Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "8133f80b-aba9-4d61-b311-2200a58df3d1",
        "parentId" : "1552a69e-9ed3-4084-978f-992f03aa6f05",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Should I add a SQL config, just in case? or this is overkill already ...",
        "createdAt" : "2020-10-28T15:53:39Z",
        "updatedAt" : "2020-10-28T18:00:11Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "f20c740c-608a-4670-a0f6-268f5bd0f032",
        "parentId" : "1552a69e-9ed3-4084-978f-992f03aa6f05",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Okay .. NVM ..",
        "createdAt" : "2020-10-29T01:28:32Z",
        "updatedAt" : "2020-10-29T01:28:33Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "349615db819b3257fd74a690ca38e8effe7a63f0",
    "line" : 17,
    "diffHunk" : "@@ -1,1 +802,806 @@    }\n\n    UTF8String.fromString(dt.sql)\n  }\n"
  },
  {
    "id" : "c96a13b5-9367-4686-a2c7-72f1bc73d2c8",
    "prId" : 28167,
    "prUrl" : "https://github.com/apache/spark/pull/28167#pullrequestreview-390937734",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0037b212-a7c6-4bd7-86d5-b9dfdd78870f",
        "parentId" : null,
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Do you check that only top level fields are valid?",
        "createdAt" : "2020-04-09T15:58:19Z",
        "updatedAt" : "2020-04-10T09:13:05Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "36f941c4-757f-4de7-95cb-1ab4ac89a746",
        "parentId" : "0037b212-a7c6-4bd7-86d5-b9dfdd78870f",
        "authorId" : "832e1988-205f-40f9-89d5-c37ea16224c9",
        "body" : "no, nested fields are checked by `JsonParser` as well.",
        "createdAt" : "2020-04-09T16:15:09Z",
        "updatedAt" : "2020-04-10T09:13:05Z",
        "lastEditedBy" : "832e1988-205f-40f9-89d5-c37ea16224c9",
        "tags" : [
        ]
      }
    ],
    "commit" : "c06abe06086a3a50a2c126cfe68ea94dd1647af2",
    "line" : 51,
    "diffHunk" : "@@ -1,1 +981,985 @@          // parse the JSON string\n          while (parser.nextToken() != null) {\n            parser.skipChildren()\n          }\n          return true"
  },
  {
    "id" : "91124c1e-6278-4e6a-be9d-31c2ea6dc427",
    "prId" : 28167,
    "prUrl" : "https://github.com/apache/spark/pull/28167#pullrequestreview-391324283",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3e3ec2e1-a974-41dc-a989-fc8509792cc2",
        "parentId" : null,
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "Could you add nested cases in the examples?",
        "createdAt" : "2020-04-10T08:04:06Z",
        "updatedAt" : "2020-04-10T09:13:05Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "65207f0c-c25b-42b7-99b3-2bfcf149c463",
        "parentId" : "3e3ec2e1-a974-41dc-a989-fc8509792cc2",
        "authorId" : "832e1988-205f-40f9-89d5-c37ea16224c9",
        "body" : "Yes. Sure.",
        "createdAt" : "2020-04-10T08:13:49Z",
        "updatedAt" : "2020-04-10T09:13:05Z",
        "lastEditedBy" : "832e1988-205f-40f9-89d5-c37ea16224c9",
        "tags" : [
        ]
      }
    ],
    "commit" : "c06abe06086a3a50a2c126cfe68ea94dd1647af2",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +949,953 @@      > Select _FUNC_('{\"key\" : \"valid JSON\"}');\n        true\n      > Select _FUNC_('{\"invalid JSON\"}');\n        false\n      > Select _FUNC_('{\"jobj\": {\"id\": 1}}');"
  },
  {
    "id" : "99b54fc5-7b16-408f-b9b9-638a282a7bf5",
    "prId" : 27854,
    "prUrl" : "https://github.com/apache/spark/pull/27854#pullrequestreview-371036658",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "485b1b22-519b-457c-bafb-20ad782e7dd0",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Here is about the actual fix.\r\n\r\nThe reason why there are differences compared to JSON datasource is:\r\n\r\n1. JSON datasource always expects `StructType`. Array of JSON objects is still inferred as `StructType`. Other types are disallowed as a root type.\r\n2. `schema_of_json` infers the type as is. Array of JSON objects is inferred as `ArrayType(StructType)`. Other types are allowed as a root type.",
        "createdAt" : "2020-03-09T10:00:42Z",
        "updatedAt" : "2020-03-09T14:59:59Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "4ca013b68dca9a97c24997752218736348458492",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +789,793 @@        case other: DataType =>\n          jsonInferSchema.canonicalizeType(other, jsonOptions).getOrElse(StringType)\n      }\n    }\n"
  },
  {
    "id" : "62e336f4-1357-4a16-b261-b6a8929dc377",
    "prId" : 27836,
    "prUrl" : "https://github.com/apache/spark/pull/27836#pullrequestreview-384397335",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "19f2bce6-24f3-4c65-a6dd-bb18efa76c9c",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Apparently, the current implementation seems to have the same limitations: `NullPointerException` and `ClassCastException`. Please add more unit test cases with `null` and `Integer` input.",
        "createdAt" : "2020-03-31T04:29:50Z",
        "updatedAt" : "2020-04-08T08:37:05Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "ec2fb881-e46e-4d8a-aa64-b26f3c967683",
        "parentId" : "19f2bce6-24f3-4c65-a6dd-bb18efa76c9c",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "I checked.\r\n```\r\nscala> sql(\"select json_object_keys(null)\").show\r\njava.lang.NullPointerException\r\n\r\nscala> sql(\"select json_object_keys(1)\").show\r\njava.lang.ClassCastException: class java.lang.Integer cannot be cast to class org.apache.spark.unsafe.types.UTF8String (java.lang.Integer is in module java.base of loader 'bootstrap'; org.apache.spark.unsafe.types.UTF8String is in unnamed module of loader 'app')\r\n```",
        "createdAt" : "2020-03-31T04:39:18Z",
        "updatedAt" : "2020-04-08T08:37:05Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "faa35719770475e35b5970dc4bd703d3e6cea9d4",
    "line" : 63,
    "diffHunk" : "@@ -1,1 +917,921 @@    } catch {\n      case _: JsonProcessingException | _: IOException => null\n    }\n  }\n"
  },
  {
    "id" : "c6403fb9-45dd-4aaa-905f-9c7e1c0d8b05",
    "prId" : 27836,
    "prUrl" : "https://github.com/apache/spark/pull/27836#pullrequestreview-387729925",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "56980c35-fd40-4e9d-9330-51a37afffe65",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "If you don't mind, please add a comment before this line.",
        "createdAt" : "2020-04-04T19:56:10Z",
        "updatedAt" : "2020-04-08T08:37:06Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "faa35719770475e35b5970dc4bd703d3e6cea9d4",
    "line" : 46,
    "diffHunk" : "@@ -1,1 +900,904 @@    val json = child.eval(input).asInstanceOf[UTF8String]\n    // return null for `NULL` input\n    if(json == null) {\n      return null\n    }"
  }
]