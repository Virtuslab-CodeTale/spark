[
  {
    "id" : "ce225d08-247d-48af-ba01-723a4d22af2a",
    "prId" : 33676,
    "prUrl" : "https://github.com/apache/spark/pull/33676#pullrequestreview-724865922",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ace229d2-9e80-44f7-b3da-5b991e8cfef6",
        "parentId" : null,
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "capturing resolver directly from `alter` variable to simplify.",
        "createdAt" : "2021-08-08T05:55:21Z",
        "updatedAt" : "2021-08-08T05:56:11Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "0b94f7684c7bbf148e0d4686970a468188d35c3c",
    "line" : 9,
    "diffHunk" : "@@ -1,1 +943,947 @@    def checkColumnNotExists(op: String, fieldNames: Seq[String], struct: StructType): Unit = {\n      if (struct.findNestedField(\n          fieldNames, includeCollections = true, alter.conf.resolver).isDefined) {\n        alter.failAnalysis(s\"Cannot $op column, because ${fieldNames.quoted} \" +\n          s\"already exists in ${struct.treeString}\")"
  },
  {
    "id" : "80ea87a1-db8b-4ce0-9108-8c88e404808a",
    "prId" : 33600,
    "prUrl" : "https://github.com/apache/spark/pull/33600#pullrequestreview-720162467",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "b61580c2-37db-42df-8344-25c394f625b5",
        "parentId" : null,
        "authorId" : "957f9c71-6f42-4d35-9de9-a731f295e818",
        "body" : "nitï¼šbefore check exists",
        "createdAt" : "2021-08-02T08:43:35Z",
        "updatedAt" : "2021-08-02T08:43:35Z",
        "lastEditedBy" : "957f9c71-6f42-4d35-9de9-a731f295e818",
        "tags" : [
        ]
      },
      {
        "id" : "0dda820d-234c-48ad-b35a-16c890581867",
        "parentId" : "b61580c2-37db-42df-8344-25c394f625b5",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "does the order matter here?",
        "createdAt" : "2021-08-02T09:51:18Z",
        "updatedAt" : "2021-08-02T09:51:19Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "b7f734b4-86b5-47a7-8bb5-cae3fab6f5c5",
        "parentId" : "b61580c2-37db-42df-8344-25c394f625b5",
        "authorId" : "957f9c71-6f42-4d35-9de9-a731f295e818",
        "body" : "Maybe quick fail ?",
        "createdAt" : "2021-08-02T12:47:25Z",
        "updatedAt" : "2021-08-02T12:47:25Z",
        "lastEditedBy" : "957f9c71-6f42-4d35-9de9-a731f295e818",
        "tags" : [
        ]
      }
    ],
    "commit" : "38c093570dd762fee74611596a8f0eb2761e9214",
    "line" : 12,
    "diffHunk" : "@@ -1,1 +953,957 @@          checkColumnNotExists(\"add\", colToAdd.name, table.schema)\n        }\n        SchemaUtils.checkColumnNameDuplication(\n          colsToAdd.map(_.name.quoted),\n          \"in the user specified columns\","
  },
  {
    "id" : "dbe4492c-5b89-4b07-9d45-704ce4cd47ea",
    "prId" : 33200,
    "prUrl" : "https://github.com/apache/spark/pull/33200#pullrequestreview-710854247",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cbc20d99-1e66-400c-bc12-9a83324947d8",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "What if the to-be-added columns have duplicated names? e.g. `ADD COLUMNS a ..., a ...`",
        "createdAt" : "2021-07-20T06:07:09Z",
        "updatedAt" : "2021-07-20T06:07:09Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "46acbf71-5e69-44e0-ac9f-c0f62f2f505a",
        "parentId" : "cbc20d99-1e66-400c-bc12-9a83324947d8",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "For v1 command, this is checked in [AlterTableAddColumnsCommand](https://github.com/apache/spark/blob/c0d84e6cf1046b7944796038414ef21fe9c7e3b5/sql/core/src/main/scala/org/apache/spark/sql/execution/command/tables.scala#L235), but for v2, this is not checked and it's up to the catalog implementation to handle it. Is this a bug? If so, I can fix this as a separate PR.",
        "createdAt" : "2021-07-20T16:42:05Z",
        "updatedAt" : "2021-07-20T16:42:05Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "a4e0415f-b8e6-4c3a-81d4-94a1efe0ccfb",
        "parentId" : "cbc20d99-1e66-400c-bc12-9a83324947d8",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "Also, if this is a bug, will the fix be ported to 3.2?\r\n\r\nI am not sure whether this PR will be ported to 3.2, so I need to know whether the fix should come before or after this PR.",
        "createdAt" : "2021-07-20T16:45:35Z",
        "updatedAt" : "2021-07-20T16:45:35Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      },
      {
        "id" : "4902ef4b-46d9-4820-959f-0d7223a40f53",
        "parentId" : "cbc20d99-1e66-400c-bc12-9a83324947d8",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "Yea I think it's a bug. We can probably fix it after this PR, as this PR refactors the related code.",
        "createdAt" : "2021-07-20T16:46:03Z",
        "updatedAt" : "2021-07-20T16:46:04Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "c84baf19-85b7-478e-b477-a01f3063e5dc",
        "parentId" : "cbc20d99-1e66-400c-bc12-9a83324947d8",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "I'd like to merge this PR to 3.2, as this is the last PR to complete the ALTER TABLE command migration.",
        "createdAt" : "2021-07-20T16:48:35Z",
        "updatedAt" : "2021-07-20T16:48:35Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "d3a82233-2112-4dd0-8157-25b1a03d26f2",
        "parentId" : "cbc20d99-1e66-400c-bc12-9a83324947d8",
        "authorId" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "body" : "Got it thanks!",
        "createdAt" : "2021-07-20T16:50:32Z",
        "updatedAt" : "2021-07-20T16:50:33Z",
        "lastEditedBy" : "b14448be-63dd-4b59-ab38-deeb2a38de86",
        "tags" : [
        ]
      }
    ],
    "commit" : "d2e691086b80fb7f64d1bce144bd1bdd03428b8d",
    "line" : 130,
    "diffHunk" : "@@ -1,1 +950,954 @@      case AlterTableAddColumns(table: ResolvedTable, colsToAdd) =>\n        colsToAdd.foreach { colToAdd =>\n          checkColumnNotExists(\"add\", colToAdd.name, table.schema)\n        }\n"
  }
]