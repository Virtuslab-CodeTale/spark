[
  {
    "id" : "fbcd173e-8158-407f-8bb3-d0daff1c779e",
    "prId" : 32082,
    "prUrl" : "https://github.com/apache/spark/pull/32082#pullrequestreview-638046510",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8e27bcb0-928d-46b5-a4e9-1106e5fbd73a",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "ditto",
        "createdAt" : "2021-04-15T13:44:10Z",
        "updatedAt" : "2021-04-27T19:27:48Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "64431dce-0462-499a-bd64-856dd67b0b82",
        "parentId" : "8e27bcb0-928d-46b5-a4e9-1106e5fbd73a",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "I don't think we need to do anything here? the input is a `BUF`.",
        "createdAt" : "2021-04-16T20:00:57Z",
        "updatedAt" : "2021-04-27T19:27:48Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      }
    ],
    "commit" : "c18715fcc304f4a805d420e193d4a3884b3f7e4f",
    "line" : 42,
    "diffHunk" : "@@ -1,1 +40,44 @@  }\n\n  override def merge(buffer: BUF, input: BUF): BUF = aggrFunc.merge(buffer, input)\n\n  override def eval(buffer: BUF): Any = {"
  },
  {
    "id" : "944b7621-80d4-4fb8-91ad-47033106028b",
    "prId" : 32082,
    "prUrl" : "https://github.com/apache/spark/pull/32082#pullrequestreview-641628685",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0a6f2618-dc77-4c78-bdea-2be56b7e62a1",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "For `TypedImperativeAggregate`, the entire `update` function is a black box to Catalyst. The magic method can't help here as codegen doesn't apply here.\r\n\r\nWe need to have deeper codegen integration in  `TypedImperativeAggregate`, which we may not able to complete before 3.2. I think it's OK, and we can always add magic method later as it won't break backward compatibility.\r\n\r\n@sunchao can you revisit the doc of v2 `AggregateFunction` and remove descriptions of the magic method?",
        "createdAt" : "2021-04-21T09:59:39Z",
        "updatedAt" : "2021-04-27T19:27:48Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "d988b133-b0ec-41a3-8a95-862a7fe0d526",
        "parentId" : "0a6f2618-dc77-4c78-bdea-2be56b7e62a1",
        "authorId" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "body" : "Yes I think it may require some work to fully support codegen and magic method in aggregate function. How about we change the `AggregateFunction#update` to non-default method so users have to implement it? We can switch to default and throw exception when we have the magic method support in future and it should be backward compatible. cc @rdblue ",
        "createdAt" : "2021-04-21T23:10:29Z",
        "updatedAt" : "2021-04-27T19:27:48Z",
        "lastEditedBy" : "9ae00886-75a7-4f39-aed7-d47b26b67afb",
        "tags" : [
        ]
      }
    ],
    "commit" : "c18715fcc304f4a805d420e193d4a3884b3f7e4f",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +36,40 @@  override def createAggregationBuffer(): BUF = aggrFunc.newAggregationState()\n\n  override def update(buffer: BUF, input: InternalRow): BUF = {\n    aggrFunc.update(buffer, inputProjection(input))\n  }"
  }
]