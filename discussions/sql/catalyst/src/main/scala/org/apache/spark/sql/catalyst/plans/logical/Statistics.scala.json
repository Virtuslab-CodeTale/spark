[
  {
    "id" : "7223173e-eb59-4534-93d7-9f1aa5550dda",
    "prId" : 33286,
    "prUrl" : "https://github.com/apache/spark/pull/33286#pullrequestreview-708007297",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5c7cc123-0759-4502-a56f-88e97fa13818",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "this parameter looks a bit weird, I'd expect the caller side to do\r\n`updatedMap.get(attr.exprId).map(_._2).getOrElse(oriColStat).updateStates(oldNumRows, newNumRows)`",
        "createdAt" : "2021-07-16T04:45:58Z",
        "updatedAt" : "2021-07-16T04:45:59Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "dd6f2185-c517-4144-872e-483fb7346326",
        "parentId" : "5c7cc123-0759-4502-a56f-88e97fa13818",
        "authorId" : "ada71464-b8c9-4d7b-9020-d49c27251fdb",
        "body" : "I thought that would work too, but turns out that we actually need `oriColStat` to avoid updating the \"updated\" statistic.",
        "createdAt" : "2021-07-16T04:55:55Z",
        "updatedAt" : "2021-07-16T04:55:55Z",
        "lastEditedBy" : "ada71464-b8c9-4d7b-9020-d49c27251fdb",
        "tags" : [
        ]
      },
      {
        "id" : "800e8f4a-5e51-4af9-8723-98d9fdbd209a",
        "parentId" : "5c7cc123-0759-4502-a56f-88e97fa13818",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "Ah I see the related code\r\n```\r\n      else if (colStat.distinctCount.get > 1) {\r\n        // Update ndv based on the overall filter selectivity: scale down ndv if the number of rows\r\n        // decreases; otherwise keep it unchanged.\r\n        Some(EstimationUtils.updateNdv(oldNumRows = rowsBeforeFilter,\r\n          newNumRows = rowsAfterFilter, oldNdv = oriColStat.distinctCount.get))\r\n```",
        "createdAt" : "2021-07-16T04:58:33Z",
        "updatedAt" : "2021-07-16T04:58:34Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "40ba767126a0275d7d50f55afe8f9dba88901818",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +125,129 @@      oldNumRows: BigInt,\n      newNumRows: BigInt,\n      updatedColumnStatOpt: Option[ColumnStat] = None): ColumnStat = {\n    val updatedColumnStat = updatedColumnStatOpt.getOrElse(this)\n    val newDistinctCount = EstimationUtils.updateStat(oldNumRows, newNumRows,"
  }
]