[
  {
    "id" : "721522b7-f692-40b1-9202-e731f81852c9",
    "prId" : 33082,
    "prUrl" : "https://github.com/apache/spark/pull/33082#pullrequestreview-693355074",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "3d4fa73f-a4cc-4b81-bbcc-4e29ecda093b",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Oh, some `SubExprEliminationState` contains not `VariableValue` but still some statements that includes other expressions?",
        "createdAt" : "2021-06-26T15:58:06Z",
        "updatedAt" : "2021-06-26T15:58:06Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "fefae5b8-ef5d-457e-86f4-19e6a8c5b875",
        "parentId" : "3d4fa73f-a4cc-4b81-bbcc-4e29ecda093b",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> Oh, some `SubExprEliminationState` contains not `VariableValue` but still some statements that includes other expressions?\r\n\r\nYes, the expression contains input var  may match `SubExprEliminationState` and just skiped.",
        "createdAt" : "2021-06-26T16:22:45Z",
        "updatedAt" : "2021-06-26T16:22:45Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "cf3acf02-42d3-4d4c-ba3f-06d928eef6fe",
        "parentId" : "3d4fa73f-a4cc-4b81-bbcc-4e29ecda093b",
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Hmm, after second look, it looks not root cause. A subexpr should be evaluated before using it. \r\n\r\nSo technically all its children expressions are not needed.\r\n\r\nI found the root cause. `PromotePrecision` overwrites `Expression.genCode` where is subexpression replace happens. So `PromotePrecision` skips subexpression elimination. I will submit another PR and include your test as co-author there. Thanks.",
        "createdAt" : "2021-06-26T20:39:08Z",
        "updatedAt" : "2021-06-26T20:39:55Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "1a90927831a07b6d77c118d4575d1f2c96bd6089",
    "line" : 22,
    "diffHunk" : "@@ -1,1 +1780,1784 @@          val SubExprEliminationState(isNull, value) = subExprs(e)\n          collectLocalVariable(value, e)\n          collectLocalVariable(isNull, e)\n\n        case ref: BoundReference if ctx.currentVars != null &&"
  }
]