[
  {
    "id" : "e55de902-33e8-4929-9a29-226acdb66ce6",
    "prId" : 33671,
    "prUrl" : "https://github.com/apache/spark/pull/33671#pullrequestreview-727820043",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "8975d863-c153-4932-b9d0-e41994631f6c",
        "parentId" : null,
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "If the main query has more than one subqueries, when resolving the second subquery, the `cteDefMap` will contain CTE defs from the first subquery. I think we should clone the map here?",
        "createdAt" : "2021-08-11T17:08:17Z",
        "updatedAt" : "2021-08-11T17:08:18Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      },
      {
        "id" : "18bb5002-359f-4900-839f-0cfd506e8f7d",
        "parentId" : "8975d863-c153-4932-b9d0-e41994631f6c",
        "authorId" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "body" : "It's not necessary, right? The real resolving has happened in CTESubstitution earlier. Now there's a strict 1 to 1 ID mapping, so the map can only contain some unrelated CTE defs at its worst.",
        "createdAt" : "2021-08-11T18:38:17Z",
        "updatedAt" : "2021-08-11T18:38:17Z",
        "lastEditedBy" : "4916859c-0e27-4e9d-ac39-ad95bc1382d3",
        "tags" : [
        ]
      },
      {
        "id" : "92b2d135-dd74-42a9-91a6-42542d04f0d8",
        "parentId" : "8975d863-c153-4932-b9d0-e41994631f6c",
        "authorId" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "body" : "oh I see, makes sense",
        "createdAt" : "2021-08-11T18:40:28Z",
        "updatedAt" : "2021-08-11T18:40:28Z",
        "lastEditedBy" : "b1f2cebb-db23-4759-b446-886279d07e99",
        "tags" : [
        ]
      }
    ],
    "commit" : "4cc52f74ab8a12599b74ae163e8f4065a99e359d",
    "line" : 61,
    "diffHunk" : "@@ -1,1 +59,63 @@      case other =>\n        other.transformExpressionsWithPruning(_.containsAllPatterns(PLAN_EXPRESSION, CTE)) {\n          case e: SubqueryExpression => e.withNewPlan(resolveWithCTE(e.plan, cteDefMap))\n        }\n    }"
  }
]