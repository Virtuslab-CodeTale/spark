[
  {
    "id" : "c2f916f1-f1a7-49a5-a44d-5ffacdf88ed1",
    "prId" : 31648,
    "prUrl" : "https://github.com/apache/spark/pull/31648#pullrequestreview-599148212",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "11d8780e-cc6c-4929-8f76-fc7568b80b98",
        "parentId" : null,
        "authorId" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "body" : "For reviewer : clean up unused code for code simplifications.\r\nMethod signature for checkEvaluation as follow:\r\ncheckEvaluation(expression: => Expression, expected: Any, inputRow: InternalRow = EmptyRow)",
        "createdAt" : "2021-02-25T14:08:52Z",
        "updatedAt" : "2021-02-25T14:09:29Z",
        "lastEditedBy" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "tags" : [
        ]
      },
      {
        "id" : "af0bbb5e-aaa2-4ed7-9237-e40ee52b5f4b",
        "parentId" : "11d8780e-cc6c-4929-8f76-fc7568b80b98",
        "authorId" : "9953a478-bdd8-4f15-be59-f6f654ff85ae",
        "body" : "Is this test change related to the code change? ",
        "createdAt" : "2021-02-26T00:03:30Z",
        "updatedAt" : "2021-02-26T00:05:58Z",
        "lastEditedBy" : "9953a478-bdd8-4f15-be59-f6f654ff85ae",
        "tags" : [
        ]
      }
    ],
    "commit" : "1c6ada69378bffbda397e44ac6795032ef0d6ec7",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +29,33 @@    def testConcat(inputs: String*): Unit = {\n      val expected = if (inputs.contains(null)) null else inputs.mkString\n      checkEvaluation(Concat(inputs.map(Literal.create(_, StringType))), expected)\n    }\n"
  },
  {
    "id" : "b76c9afc-3ede-4840-ab30-508621275b5c",
    "prId" : 31510,
    "prUrl" : "https://github.com/apache/spark/pull/31510#pullrequestreview-585013139",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c0a8b4b0-5341-4fec-b5aa-9fa229deeb21",
        "parentId" : null,
        "authorId" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "body" : "For reviewer, Method signature for `checkEvaluation` as follow:\r\n\r\n`checkEvaluation(expression: => Expression, expected: Any, inputRow: InternalRow = EmptyRow)`",
        "createdAt" : "2021-02-07T13:09:07Z",
        "updatedAt" : "2021-02-07T13:12:06Z",
        "lastEditedBy" : "6a8d0007-eb0f-4236-a65a-2174a14ac689",
        "tags" : [
        ]
      }
    ],
    "commit" : "bff7afde412ea15378a5c32d878b6c24a810d24e",
    "line" : 5,
    "diffHunk" : "@@ -1,1 +29,33 @@    def testConcat(inputs: String*): Unit = {\n      val expected = if (inputs.contains(null)) null else inputs.mkString\n      checkEvaluation(Concat(inputs.map(Literal.create(_, StringType))), expected)\n    }\n"
  },
  {
    "id" : "5a062d0f-40e8-4871-892c-827af633e6ce",
    "prId" : 25963,
    "prUrl" : "https://github.com/apache/spark/pull/25963#pullrequestreview-300585925",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "40a5243d-e194-4da7-b200-b3243f0fb1c8",
        "parentId" : null,
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "The `usage` part of the expressions says that some part of patterns can use locale:\r\n```\r\n'S': sign anchored to number (uses locale)\r\n      'L': currency symbol (uses locale)\r\n      'D': decimal point (uses locale)\r\n      'G': group separator (uses locale)\r\n```\r\nCould you test a few locales.",
        "createdAt" : "2019-10-09T14:11:31Z",
        "updatedAt" : "2019-10-21T03:16:03Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "f068d4f2-173d-4a59-accf-4175c56c4eff",
        "parentId" : "40a5243d-e194-4da7-b200-b3243f0fb1c8",
        "authorId" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "body" : "@MaxGekk Thanks for this review. I test the locale on `Postgresql` but 'L' seems not works.\r\n```\r\nselect to_number('USD34234.4350', 'L99999.0000');  // 34234.435\r\nselect to_number('EUR34234.4350', 'L99999.0000');  // 34234.435\r\nselect to_number('RY34234.4350', 'L99999.0000');  // 34234.435\r\n```\r\nAlthough 'RY ' is not a valid locale , the result is the same as the others .",
        "createdAt" : "2019-10-11T09:58:17Z",
        "updatedAt" : "2019-10-21T03:16:03Z",
        "lastEditedBy" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "tags" : [
        ]
      },
      {
        "id" : "7d4f9d66-b800-4d10-8393-f28af89375b7",
        "parentId" : "40a5243d-e194-4da7-b200-b3243f0fb1c8",
        "authorId" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "body" : "I think the description of locales is not consistent with the behavior in fact. Maybe I should remove the comment for locale as it was a bug of `Postgresql`.",
        "createdAt" : "2019-10-11T10:00:53Z",
        "updatedAt" : "2019-10-21T03:16:03Z",
        "lastEditedBy" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "tags" : [
        ]
      }
    ],
    "commit" : "afa19a89d786e4fa4158487ab1748ba11a5c69dc",
    "line" : 12,
    "diffHunk" : "@@ -1,1 +842,846 @@  }\n\n  test(\"ToNumber\") {\n    // Test '0' and '9'\n    checkEvaluation(ToNumber(Literal(\"454\"), Literal(\"\")), \"\")"
  },
  {
    "id" : "64c4176b-b4f8-4c07-997b-d3d24e1f80a4",
    "prId" : 25963,
    "prUrl" : "https://github.com/apache/spark/pull/25963#pullrequestreview-300621613",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0cb91c83-c568-4764-9668-a48593ab1c64",
        "parentId" : null,
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "Here you check only one negative tests. Could you add a little bit more negative tests.",
        "createdAt" : "2019-10-09T14:33:52Z",
        "updatedAt" : "2019-10-21T03:16:03Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "715afc73-5062-4c00-b80c-5c13574661aa",
        "parentId" : "0cb91c83-c568-4764-9668-a48593ab1c64",
        "authorId" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "body" : "For example here is a test coverage report:\r\n<img width=\"532\" alt=\"Screen Shot 2019-10-09 at 17 41 31\" src=\"https://user-images.githubusercontent.com/1580697/66491818-134bd980-eabc-11e9-9e09-2f7265df6f0a.png\">\r\n",
        "createdAt" : "2019-10-09T14:42:07Z",
        "updatedAt" : "2019-10-21T03:16:03Z",
        "lastEditedBy" : "5c8bf89e-8bb3-4151-8b92-286da26c827e",
        "tags" : [
        ]
      },
      {
        "id" : "928230f6-2b89-428d-84a8-199256d23794",
        "parentId" : "0cb91c83-c568-4764-9668-a48593ab1c64",
        "authorId" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "body" : "> Here you check only one negative tests. Could you add a little bit more negative tests.\r\n\r\nOK. I will add more.",
        "createdAt" : "2019-10-11T11:22:44Z",
        "updatedAt" : "2019-10-21T03:16:03Z",
        "lastEditedBy" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "tags" : [
        ]
      }
    ],
    "commit" : "afa19a89d786e4fa4158487ab1748ba11a5c69dc",
    "line" : 89,
    "diffHunk" : "@@ -1,1 +919,923 @@    checkEvaluation(ToNumber(Literal(\"42nd\"), Literal(\"99th\")), \"42\")\n\n    ToNumber(Literal(\"454.3.2\"), Literal(\"999D9D9\")).checkInputDataTypes() match {\n      case TypeCheckResult.TypeCheckFailure(msg) =>\n        assert(msg.contains(\"Multiple decimal points in\"))"
  },
  {
    "id" : "f0e01485-913b-4b3b-a871-d82995385e33",
    "prId" : 25172,
    "prUrl" : "https://github.com/apache/spark/pull/25172#pullrequestreview-268759724",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dc6cc60c-a784-468c-bac4-9c921cf64499",
        "parentId" : null,
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "Nit: Also test corner case, e.g. position is negative, or position is larger than 9",
        "createdAt" : "2019-07-22T15:33:25Z",
        "updatedAt" : "2019-09-09T11:18:09Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      },
      {
        "id" : "3ba84e43-d110-4440-99b2-487c74e690c9",
        "parentId" : "dc6cc60c-a784-468c-bac4-9c921cf64499",
        "authorId" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "body" : "Thanks for your reminder. but the negative is illegal in `Postgresql`.\r\n```\r\norg.postgresql.util.PSQLException: ERROR: negative substring length not allowed\r\n  在位置：SQL function \"overlay\" statement 1\r\n```\r\nOracle's description:\r\n`If pos is specified, it must be greater than or equal to 1.`\r\nDB2's description:\r\n`If you specify n, it must be a positive whole number.`\r\nVertical's description:\r\n`(INTEGER) is the character or octet position (counting from one) at which to begin the overlay`\r\nI will check position is larger than 9.\r\nPostgresql's behavior is:\r\n`select OVERLAY('abcdef' PLACING '45' FROM 7);      // abcdef45`\r\nOracle and DB2 expanded the Overlay function, but not follow ANSI standard.",
        "createdAt" : "2019-07-23T07:07:13Z",
        "updatedAt" : "2019-09-09T11:18:09Z",
        "lastEditedBy" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "tags" : [
        ]
      },
      {
        "id" : "4498ea12-fcdd-4267-ab75-cbc431057c7b",
        "parentId" : "dc6cc60c-a784-468c-bac4-9c921cf64499",
        "authorId" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "body" : "I will add tests about your suggestion in `StringExpressionsSuite`.",
        "createdAt" : "2019-07-23T08:04:08Z",
        "updatedAt" : "2019-09-09T11:18:09Z",
        "lastEditedBy" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "tags" : [
        ]
      },
      {
        "id" : "2f2e7efe-3c7a-4349-9955-d28cd4274585",
        "parentId" : "dc6cc60c-a784-468c-bac4-9c921cf64499",
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "I think Spark basically avoids runtime exceptions. Could you follow the behaivour for string cases?\r\n```\r\nscala> sql(\"\"\"select overlay(\"aaaaaa\", \"bb\", 0)\"\"\").show\r\n+--------------------------+                                                    \r\n|overlay(aaaaaa, bb, 0, -1)|\r\n+--------------------------+\r\n|                   bbaaaaa|\r\n+--------------------------+\r\n\r\n\r\nscala> sql(\"\"\"select overlay(\"aaaaaa\", \"bb\", -10)\"\"\").show\r\n+----------------------------+\r\n|overlay(aaaaaa, bb, -10, -1)|\r\n+----------------------------+\r\n|                    bbaaaaaa|\r\n+----------------------------+\r\n```",
        "createdAt" : "2019-07-24T01:57:58Z",
        "updatedAt" : "2019-09-09T11:18:09Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "1001b95f-a82b-46d0-b285-f90adccec040",
        "parentId" : "dc6cc60c-a784-468c-bac4-9c921cf64499",
        "authorId" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "body" : "I have added tests for negative and zero. I think this behavior is very different from ANSI SQL and other databases.",
        "createdAt" : "2019-07-24T04:18:11Z",
        "updatedAt" : "2019-09-09T11:18:09Z",
        "lastEditedBy" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "tags" : [
        ]
      },
      {
        "id" : "30b9d8b1-3b17-4b14-9c86-40e9e89f3535",
        "parentId" : "dc6cc60c-a784-468c-bac4-9c921cf64499",
        "authorId" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "body" : "In this pr, plz follow the current behaivour of overlay(string, string). If you wanna to change this behaivour, you can make an another pr for that.",
        "createdAt" : "2019-07-30T05:21:02Z",
        "updatedAt" : "2019-09-09T11:18:09Z",
        "lastEditedBy" : "044062b3-9d96-4ec3-a1e2-3a2f595bbc02",
        "tags" : [
        ]
      },
      {
        "id" : "4657e0ca-8388-44fd-8096-461c577e1a9e",
        "parentId" : "dc6cc60c-a784-468c-bac4-9c921cf64499",
        "authorId" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "body" : "@maropu OK. I will follow the current behaivour of overlay(string, string).",
        "createdAt" : "2019-07-31T02:40:35Z",
        "updatedAt" : "2019-09-09T11:18:09Z",
        "lastEditedBy" : "f26e51a2-ed90-47c7-9856-a6cc134b7f39",
        "tags" : [
        ]
      }
    ],
    "commit" : "6201a3725036ee860f0d5c6d8b3053b79dbb1a62",
    "line" : 41,
    "diffHunk" : "@@ -1,1 +472,476 @@    val input = Literal(Array[Byte](1, 2, 3, 4, 5, 6, 7, 8, 9))\n    checkEvaluation(new Overlay(input, Literal(Array[Byte](-1)),\n      Literal.create(6, IntegerType)), Array[Byte](1, 2, 3, 4, 5, -1, 7, 8, 9))\n    checkEvaluation(new Overlay(input, Literal(Array[Byte](-1, -1, -1, -1)),\n      Literal.create(7, IntegerType)), Array[Byte](1, 2, 3, 4, 5, 6, -1, -1, -1, -1))"
  }
]