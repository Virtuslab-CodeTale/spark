[
  {
    "id" : "59a707a4-c7fe-41fe-8503-fd8ed9857de1",
    "prId" : 26934,
    "prUrl" : "https://github.com/apache/spark/pull/26934#pullrequestreview-333884357",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d26ea988-d393-4338-87c3-fb2090fa0b4d",
        "parentId" : null,
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "Just like this may be ok .  @juliuszsompolski \r\nIf removed we don't need to do anything",
        "createdAt" : "2019-12-18T10:14:14Z",
        "updatedAt" : "2019-12-18T10:14:24Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "5c74a9cc-274b-4752-9bee-7e82250085b4",
        "parentId" : "d26ea988-d393-4338-87c3-fb2090fa0b4d",
        "authorId" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "body" : "but I think this\r\n```\r\n    val view = kvstore.view(classOf[ExecutionInfo]).index(\"finishTime\").first(0L)\r\n    val toDelete = KVUtils.viewToSeq(view, countToDelete.toInt) { j =>\r\n      j.finishTimestamp != 0\r\n    }\r\n```\r\ncan still delete executions that are FINISHED, but still fetching?",
        "createdAt" : "2019-12-18T10:18:31Z",
        "updatedAt" : "2019-12-18T10:18:31Z",
        "lastEditedBy" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "tags" : [
        ]
      },
      {
        "id" : "7a3a453e-3d77-4f11-b65a-c354290ce948",
        "parentId" : "d26ea988-d393-4338-87c3-fb2090fa0b4d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> can still delete executions that are FINISHED, but still fetching?\r\n\r\nhttps://github.com/apache/spark/blob/d38f8167483d4d79e8360f24a8c0bffd51460659/sql/hive-thriftserver/src/main/scala/org/apache/spark/sql/hive/thriftserver/ui/HiveThriftServer2AppStatusStore.scala#L113-L123\r\n\r\nHere will control this. Won't remove `FINISHED` execution.",
        "createdAt" : "2019-12-18T10:26:31Z",
        "updatedAt" : "2019-12-18T10:26:31Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "8dada442-533e-4566-b44c-505a72e2869d",
        "parentId" : "d26ea988-d393-4338-87c3-fb2090fa0b4d",
        "authorId" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "body" : ":+1: thanks",
        "createdAt" : "2019-12-18T10:51:10Z",
        "updatedAt" : "2019-12-18T10:51:10Z",
        "lastEditedBy" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "tags" : [
        ]
      }
    ],
    "commit" : "1297e80f9baa812e392bbf1910d688e89f753713",
    "line" : 13,
    "diffHunk" : "@@ -1,1 +186,190 @@      updateStoreWithTriggerEnabled(executionList.get(e.id))\n      executionList.remove(e.id)\n    }\n  }\n"
  },
  {
    "id" : "98ed0375-c592-4030-b85a-0e37312ff771",
    "prId" : 26934,
    "prUrl" : "https://github.com/apache/spark/pull/26934#pullrequestreview-333905198",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "parentId" : null,
        "authorId" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "body" : "I think we can add a comment here to explain? This issue can happen only on cancel operations right?",
        "createdAt" : "2019-12-18T10:35:43Z",
        "updatedAt" : "2019-12-18T10:40:14Z",
        "lastEditedBy" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "tags" : [
        ]
      },
      {
        "id" : "f1bc4c71-1249-4382-acfd-068f191de559",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> I think we can add a comment here to explain? This issue can happen only on cancel operations right?\r\n\r\nSome operation `FAILED|CANCELED` and remove statementId before call `closeOperation `\r\nin current master brach.",
        "createdAt" : "2019-12-18T10:45:42Z",
        "updatedAt" : "2019-12-18T10:45:42Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "d890ce9c-aaea-4179-a4cf-715f65a19a9a",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "body" : "Yeah, we could add comment like `Operations that were CANCELED or FAILED may have already been removed.`\r\n\r\nBut now it doesn't happen because we don't trim LiveExecutionData?",
        "createdAt" : "2019-12-18T10:52:09Z",
        "updatedAt" : "2019-12-18T10:52:09Z",
        "lastEditedBy" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "tags" : [
        ]
      },
      {
        "id" : "a81bbe14-49ed-47d3-b6b9-ee18d1d22c28",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "body" : "Yes, It seems this issue doesn't happen as we aren't removing `LiveExecutionData`.  @AngersZhuuuu Could you make `spark.sql.thriftserver.ui.retainedStatements=1` and try to reproduce the same?",
        "createdAt" : "2019-12-18T10:54:20Z",
        "updatedAt" : "2019-12-18T10:54:26Z",
        "lastEditedBy" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "tags" : [
        ]
      },
      {
        "id" : "6e35fa26-2a3b-49ff-8120-c4d335817f78",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> Yes, It seems this issue doesn't happen as we aren't removing `LiveExecutionData`. @AngersZhuuuu Could you make `spark.sql.thriftserver.ui.retainedStatements=1` and try to reproduce the same?\r\n\r\nSo complicated now... executionList won't remove, and then `updateStoreWithTriggerEnabled ` may cause some problem.  I will test it .",
        "createdAt" : "2019-12-18T11:16:19Z",
        "updatedAt" : "2019-12-18T11:16:20Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "fc8c98c3-534d-48ec-9648-a2a3ce569408",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "body" : "I don't think, `updateStoreWithTriggerEnabled` cause a problem, as it write a new entry to the kvstore, like in the historyserver case.",
        "createdAt" : "2019-12-18T11:20:49Z",
        "updatedAt" : "2019-12-18T11:23:49Z",
        "lastEditedBy" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "tags" : [
        ]
      },
      {
        "id" : "88a09217-3130-47dd-8199-4d3c8faeccbe",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> I don't think, `updateStoreWithTriggerEnabled` cause a problem, as it write a new entry to the kvstore, like in the historyserver case.\r\n\r\nseems we don't need to fix this now.",
        "createdAt" : "2019-12-18T11:24:45Z",
        "updatedAt" : "2019-12-18T11:24:45Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      },
      {
        "id" : "87d1ad25-2d5f-4187-bd0f-791a8d90a54c",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "body" : "> seems we don't need to fix this now.\r\n\r\nYes, Right. But still in branch-2.4 this issue can happen right?",
        "createdAt" : "2019-12-18T11:26:56Z",
        "updatedAt" : "2019-12-18T11:26:56Z",
        "lastEditedBy" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "tags" : [
        ]
      },
      {
        "id" : "a38348a5-d514-4c93-b423-d3b485c8d409",
        "parentId" : "c8ee069d-3f2e-4e76-9c90-9546f056d46d",
        "authorId" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "body" : "> > seems we don't need to fix this now.\r\n> \r\n> Yes, Right. But still in branch-2.4 this issue can happen right?\r\n\r\nDon't need, since i spark-2.4, didn't add `onStatementClosed & onStatementCanceled`",
        "createdAt" : "2019-12-18T11:29:23Z",
        "updatedAt" : "2019-12-18T11:29:23Z",
        "lastEditedBy" : "594db420-88ec-4875-8cd3-0d8b0bec131c",
        "tags" : [
        ]
      }
    ],
    "commit" : "1297e80f9baa812e392bbf1910d688e89f753713",
    "line" : 8,
    "diffHunk" : "@@ -1,1 +181,185 @@\n  private def onOperationClosed(e: SparkListenerThriftServerOperationClosed): Unit = {\n    if (executionList.contains(e.id)) {\n      executionList.get(e.id).closeTimestamp = e.closeTime\n      executionList.get(e.id).state = ExecutionState.CLOSED"
  },
  {
    "id" : "128bf5f1-b573-44a9-9bfc-a99ee67e6054",
    "prId" : 26821,
    "prUrl" : "https://github.com/apache/spark/pull/26821#pullrequestreview-331022756",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "bee8f786-a5a1-47da-be60-bf052541063a",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "place it before flush()",
        "createdAt" : "2019-12-12T09:13:29Z",
        "updatedAt" : "2019-12-12T09:22:06Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6b2c5a3cc46d25595bfa7e187846187dd5ac806",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +73,77 @@    if (!live) {\n      flush((entity: LiveEntity) => updateStoreWithTriggerEnabled(entity))\n      if (appId != null) {\n        kvstore.write(new HiveThriftserver2ListenerData(\n          appId, attemptId, sessionList, executionList))"
  },
  {
    "id" : "13e1bc77-3cc3-4b1f-8273-d91f22156c38",
    "prId" : 26821,
    "prUrl" : "https://github.com/apache/spark/pull/26821#pullrequestreview-331022756",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d6763c8d-a3fe-44bc-b2ec-90dfe3b12a64",
        "parentId" : null,
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "same here",
        "createdAt" : "2019-12-12T09:13:39Z",
        "updatedAt" : "2019-12-12T09:22:06Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "b6b2c5a3cc46d25595bfa7e187846187dd5ac806",
    "line" : 23,
    "diffHunk" : "@@ -1,1 +82,86 @@  def initialize(appId: String, attemptId: Option[String]): Unit = {\n    if (!live) {\n      this.appId = appId\n      this.attemptId = attemptId\n      try {"
  },
  {
    "id" : "9d8b62ef-8f3b-466f-84c0-df28f35ceb42",
    "prId" : 26378,
    "prUrl" : "https://github.com/apache/spark/pull/26378#pullrequestreview-322508559",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c054d588-3501-476a-8788-706914bdc51c",
        "parentId" : null,
        "authorId" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "body" : "it still deletes based on finishTimestamp. It should delete based on state being FAILED, CANCELED or CLOSED.",
        "createdAt" : "2019-11-25T16:14:10Z",
        "updatedAt" : "2019-11-28T10:24:30Z",
        "lastEditedBy" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "tags" : [
        ]
      },
      {
        "id" : "d753485c-11b1-4621-8ada-f7cd18de134b",
        "parentId" : "c054d588-3501-476a-8788-706914bdc51c",
        "authorId" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "body" : "Thanks for the clarification. Updated.",
        "createdAt" : "2019-11-25T19:02:31Z",
        "updatedAt" : "2019-11-28T10:24:30Z",
        "lastEditedBy" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "39ddc891582db48a7d5e2ece771aac064cd41f1f",
    "line" : 234,
    "diffHunk" : "@@ -1,1 +232,236 @@    val view = kvstore.view(classOf[ExecutionInfo]).index(\"finishTime\").first(0L)\n    val toDelete = KVUtils.viewToSeq(view, countToDelete.toInt) { j =>\n      j.finishTimestamp != 0\n    }\n    toDelete.foreach { j => kvstore.delete(j.getClass, j.execId) }"
  },
  {
    "id" : "0d8c327f-4dcc-4831-a8c7-d74dc2bb25c7",
    "prId" : 26378,
    "prUrl" : "https://github.com/apache/spark/pull/26378#pullrequestreview-323330501",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "5d52d46e-2aa3-49f5-9a96-b0f7828a2f81",
        "parentId" : null,
        "authorId" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "body" : "you're using this function only from `kvStore.onFlush`. Could inline it there?",
        "createdAt" : "2019-11-26T09:59:19Z",
        "updatedAt" : "2019-11-28T10:24:30Z",
        "lastEditedBy" : "e5beb795-ac0e-4bd6-ad66-708215b8ae58",
        "tags" : [
        ]
      },
      {
        "id" : "5c989f97-ce96-4ae9-945b-e2e64cbe574b",
        "parentId" : "5d52d46e-2aa3-49f5-9a96-b0f7828a2f81",
        "authorId" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "body" : "I have slightly refactored the store update logic.",
        "createdAt" : "2019-11-26T22:39:45Z",
        "updatedAt" : "2019-11-28T10:24:30Z",
        "lastEditedBy" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "39ddc891582db48a7d5e2ece771aac064cd41f1f",
    "line" : 202,
    "diffHunk" : "@@ -1,1 +200,204 @@      entity.write(kvstore, now, checkTriggers = trigger)\n    }\n  }\n\n  /** Go through all `LiveEntity`s and use `entityFlushFunc(entity)` to flush them. */"
  },
  {
    "id" : "ef5df012-697f-4f95-96e9-485696bbdf11",
    "prId" : 26378,
    "prUrl" : "https://github.com/apache/spark/pull/26378#pullrequestreview-323385876",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "625c2689-9b7d-4c2f-99a5-c105cc4bcb15",
        "parentId" : null,
        "authorId" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "body" : "Nit: remove empty line.",
        "createdAt" : "2019-11-27T01:19:11Z",
        "updatedAt" : "2019-11-28T10:24:30Z",
        "lastEditedBy" : "15acce7d-132b-48c9-894b-9bc3f4c2b09d",
        "tags" : [
        ]
      },
      {
        "id" : "f707caea-b23b-4c0a-82cc-edf4bbf57973",
        "parentId" : "625c2689-9b7d-4c2f-99a5-c105cc4bcb15",
        "authorId" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "body" : "Done",
        "createdAt" : "2019-11-27T01:42:19Z",
        "updatedAt" : "2019-11-28T10:24:30Z",
        "lastEditedBy" : "d0d56018-475d-4da3-93a6-5e843402b7f2",
        "tags" : [
        ]
      }
    ],
    "commit" : "39ddc891582db48a7d5e2ece771aac064cd41f1f",
    "line" : 296,
    "diffHunk" : "@@ -1,1 +294,298 @@  }\n}\n\nprivate[thriftserver] class LiveSessionData(\n    val sessionId: String,"
  }
]