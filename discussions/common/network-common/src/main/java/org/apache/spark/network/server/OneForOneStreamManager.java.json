[
  {
    "id" : "7b54619c-873a-4e76-a489-5bf1f5f63820",
    "prId" : 27831,
    "prUrl" : "https://github.com/apache/spark/pull/27831#pullrequestreview-374098354",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "6452e382-9ac8-4def-a80a-c0bb798998e6",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "It is possible to get rid of `state.chunksBeingTransferred` totally? ",
        "createdAt" : "2020-03-06T13:33:46Z",
        "updatedAt" : "2020-03-06T13:33:54Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "8e96a92e-9d6c-4248-8473-9ea0d8c0ff9a",
        "parentId" : "6452e382-9ac8-4def-a80a-c0bb798998e6",
        "authorId" : "63ff4260-20f2-455f-9711-d4ea25218ce1",
        "body" : "No we can't because without it, we do not know how many to remove from total when channel terminated.",
        "createdAt" : "2020-03-07T08:41:58Z",
        "updatedAt" : "2020-03-07T08:41:58Z",
        "lastEditedBy" : "63ff4260-20f2-455f-9711-d4ea25218ce1",
        "tags" : [
        ]
      },
      {
        "id" : "b62e5d01-84b4-46a0-b2fc-79c87ee6e7b9",
        "parentId" : "6452e382-9ac8-4def-a80a-c0bb798998e6",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Maybe we can track transferring chunks by channel, e.g. `Map[Channel, Count]`? The number of channels should be less than `streams`.\r\n\r\nAnd, if we can not get rid of `state.chunksBeingTransferred`, `connectionTerminated` could also be somewhat time consuming as it also traverse all `streams`.",
        "createdAt" : "2020-03-09T13:14:39Z",
        "updatedAt" : "2020-03-09T13:14:39Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "db822ca0-278b-4b47-af01-b32a339825ef",
        "parentId" : "6452e382-9ac8-4def-a80a-c0bb798998e6",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "> And, if we can not get rid of state.chunksBeingTransferred, connectionTerminated could also be somewhat time consuming as it also traverse all streams.\r\n\r\nIIUC, connectionTerminated won't be called frequently compared to chunksBeingTransferred which would less matter.",
        "createdAt" : "2020-03-13T04:29:26Z",
        "updatedAt" : "2020-03-13T04:29:34Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      },
      {
        "id" : "a997647f-29b3-4381-b892-62f6cf596e7d",
        "parentId" : "6452e382-9ac8-4def-a80a-c0bb798998e6",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "Oh, yeah. This a good point.",
        "createdAt" : "2020-03-13T07:42:11Z",
        "updatedAt" : "2020-03-13T07:42:11Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "d6af3f5754417f4ca2e20d9e169d187b7dc72ac1",
    "line" : 12,
    "diffHunk" : "@@ -1,1 +126,130 @@      if (state.associatedChannel == channel) {\n        streams.remove(entry.getKey());\n        totalChunksBeingTransferred.addAndGet((-state.chunksBeingTransferred.get()));\n\n        try {"
  },
  {
    "id" : "942841b9-166e-48d2-8c7a-084ffe0fb2e6",
    "prId" : 27064,
    "prUrl" : "https://github.com/apache/spark/pull/27064#pullrequestreview-342277477",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "de5ea541-2a4d-4b39-a00d-31089ce2d519",
        "parentId" : null,
        "authorId" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "body" : "Is this the only exception type we need to deal with here?",
        "createdAt" : "2020-01-14T00:50:06Z",
        "updatedAt" : "2020-01-14T21:17:40Z",
        "lastEditedBy" : "5e28de51-305c-4276-b3a0-78bcc74eb6f2",
        "tags" : [
        ]
      },
      {
        "id" : "8dde9230-041c-4f25-befb-430f0458a61e",
        "parentId" : "de5ea541-2a4d-4b39-a00d-31089ce2d519",
        "authorId" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "body" : "Other kind of exception would be Error which `TransportRequestHandler.channelInactive` is also not catching and let the process fail.",
        "createdAt" : "2020-01-14T03:45:29Z",
        "updatedAt" : "2020-01-14T21:17:40Z",
        "lastEditedBy" : "0c28e5da-df9b-4076-bb67-3b6878f1f4ce",
        "tags" : [
        ]
      }
    ],
    "commit" : "0fde4c94fd67f6be55ee6eff511e9d046fd3cd5c",
    "line" : 25,
    "diffHunk" : "@@ -1,1 +134,138 @@            }\n          }\n        } catch (RuntimeException e) {\n          if (failedToReleaseBufferException == null) {\n            failedToReleaseBufferException = e;"
  }
]