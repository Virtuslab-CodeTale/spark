[
  {
    "id" : "acfdfc59-c7ab-4034-a66e-32dcdce31ae4",
    "prId" : 33078,
    "prUrl" : "https://github.com/apache/spark/pull/33078#pullrequestreview-695645620",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "46947c57-04f2-492c-b3ac-1b1a37ad5868",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "`PushBlockStream` is a public class. I'm afraid this would have the compatibility issue. cc @mridulm ",
        "createdAt" : "2021-06-29T14:50:33Z",
        "updatedAt" : "2021-06-29T14:50:33Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "e2851650-bacd-4d72-852b-b0b28d152fd2",
        "parentId" : "46947c57-04f2-492c-b3ac-1b1a37ad5868",
        "authorId" : "9953a478-bdd8-4f15-be59-f6f654ff85ae",
        "body" : "PushBlockStream is introduced with push-based shuffle which is not complete yet. The users will not have been able to use it because a number of necessary pieces were not added.",
        "createdAt" : "2021-06-29T15:49:02Z",
        "updatedAt" : "2021-06-29T15:49:02Z",
        "lastEditedBy" : "9953a478-bdd8-4f15-be59-f6f654ff85ae",
        "tags" : [
        ]
      },
      {
        "id" : "cef8824a-6d42-47b1-8cb1-8e961b849ea6",
        "parentId" : "46947c57-04f2-492c-b3ac-1b1a37ad5868",
        "authorId" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "body" : "Technically, this is a breaking change, since it was introduced in 3.1\r\nBut given it cant be used until push based shuffle can be enabled, this should be fine.\r\nThoughts @Ngone51 ?",
        "createdAt" : "2021-06-30T01:15:14Z",
        "updatedAt" : "2021-06-30T01:15:14Z",
        "lastEditedBy" : "d35df420-57a9-43e8-b8d5-cad0f4002681",
        "tags" : [
        ]
      },
      {
        "id" : "35815f46-d14d-41e3-8788-f311a9039b67",
        "parentId" : "46947c57-04f2-492c-b3ac-1b1a37ad5868",
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "sgtm",
        "createdAt" : "2021-06-30T02:33:27Z",
        "updatedAt" : "2021-06-30T02:33:27Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      }
    ],
    "commit" : "53109918cbdbdba2fe79f38a991c171efec7e85f",
    "line" : 76,
    "diffHunk" : "@@ -1,1 +112,116 @@  public static PushBlockStream decode(ByteBuf buf) {\n    String appId = Encoders.Strings.decode(buf);\n    int attemptId = buf.readInt();\n    int shuffleId = buf.readInt();\n    int mapIdx = buf.readInt();"
  },
  {
    "id" : "a2634d0c-1d1f-4ef0-9010-8808890db09f",
    "prId" : 29855,
    "prUrl" : "https://github.com/apache/spark/pull/29855#pullrequestreview-495824081",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7e0df27d-3f2f-41a6-8948-98837d1f4b48",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "What does `index` mean here? Could you add some comments to explain?",
        "createdAt" : "2020-09-24T13:24:59Z",
        "updatedAt" : "2020-10-13T15:54:30Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "31636c5d-3af9-4539-8d09-ff456923054a",
        "parentId" : "7e0df27d-3f2f-41a6-8948-98837d1f4b48",
        "authorId" : "15ef9b5b-1583-47d9-b883-14ebfd23a00a",
        "body" : "Will add comments to clarify.\r\nThe block push API is pushing a batch of blocks in a single invocation, similar to block fetch.\r\n`index` is to identify the index in that batch for a given pushed block, so we can properly handle block push failures in a batch.\r\nThis is similar to the `chunkIndex` in `StreamChunkId` used by `ChunkFetchRequest`.",
        "createdAt" : "2020-09-24T18:06:23Z",
        "updatedAt" : "2020-10-13T15:54:30Z",
        "lastEditedBy" : "15ef9b5b-1583-47d9-b883-14ebfd23a00a",
        "tags" : [
        ]
      }
    ],
    "commit" : "2c95f18d2bdf9ac373b0d5319b686a1d66c1e72b",
    "line" : 38,
    "diffHunk" : "@@ -1,1 +36,40 @@  // Similar to the chunkIndex in StreamChunkId, indicating the index of a block in a batch of\n  // blocks to be pushed.\n  public final int index;\n\n  public PushBlockStream(String appId, String blockId, int index) {"
  },
  {
    "id" : "93e352f5-536e-4656-8ce8-2586ea6dcefa",
    "prId" : 29855,
    "prUrl" : "https://github.com/apache/spark/pull/29855#pullrequestreview-495814086",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d597bb5b-feb1-4cd8-a5ab-fd5417379258",
        "parentId" : null,
        "authorId" : "171fe41b-96df-4362-a600-2d1f030de577",
        "body" : "By looking at BlockPushCallback, seems like it's also possible that `PushBlockStream` sent from the remote shuffle service to the pusher? ",
        "createdAt" : "2020-09-24T13:32:43Z",
        "updatedAt" : "2020-10-13T15:54:30Z",
        "lastEditedBy" : "171fe41b-96df-4362-a600-2d1f030de577",
        "tags" : [
        ]
      },
      {
        "id" : "e6a2a5cb-728b-4ae9-94b6-395adf9c3db8",
        "parentId" : "d597bb5b-feb1-4cd8-a5ab-fd5417379258",
        "authorId" : "15ef9b5b-1583-47d9-b883-14ebfd23a00a",
        "body" : "That's right. PushBlockStream is the metadata header associated with a shuffle block being pushed. It's created on the pusher/client side, and the shuffle service/server side will also include the same metadata header when it's acknowledging the success or failure of a block push request. Will update this comment to reflect both scenarios.",
        "createdAt" : "2020-09-24T17:53:16Z",
        "updatedAt" : "2020-10-13T15:54:30Z",
        "lastEditedBy" : "15ef9b5b-1583-47d9-b883-14ebfd23a00a",
        "tags" : [
        ]
      }
    ],
    "commit" : "2c95f18d2bdf9ac373b0d5319b686a1d66c1e72b",
    "line" : 30,
    "diffHunk" : "@@ -1,1 +28,32 @@\n/**\n * Request to push a block to a remote shuffle service to be merged in push based shuffle.\n * The remote shuffle service will also include this message when responding the push requests.\n */"
  }
]