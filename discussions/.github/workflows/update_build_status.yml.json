[
  {
    "id" : "ec2d15c3-1612-4841-9c7d-b1d81747fae6",
    "prId" : 32235,
    "prUrl" : "https://github.com/apache/spark/pull/32235#pullrequestreview-638814435",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "27bf38dc-d54e-4f4b-b37d-721d64c31577",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "It links \"View more details on GitHub Actions\" to the workflow run in forked repository:\r\n![Screen Shot 2021-04-19 at 9 16 26 PM](https://user-images.githubusercontent.com/6477701/115237290-5da12280-a157-11eb-8d6b-91c90d0dace2.png)\r\n\r\nThis is an unrelated minor change.",
        "createdAt" : "2021-04-19T12:37:08Z",
        "updatedAt" : "2021-04-19T12:39:00Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "051d2927edcca603bdacd885df3bcf7919a0badb",
    "line" : 15,
    "diffHunk" : "@@ -1,1 +76,80 @@                          status: run.data.status,\n                          conclusion: run.data.conclusion,\n                          details_url: run.data.details_url\n                        })\n                      } else {"
  },
  {
    "id" : "b3b81771-82ec-44cf-b924-63d36ac76c57",
    "prId" : 32193,
    "prUrl" : "https://github.com/apache/spark/pull/32193#pullrequestreview-636907543",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "98e096ab-c4bb-4979-b1d1-43a5ec101dba",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Just a question. What happens when the fork disables this job?\r\nGitHub allows us to disable workflows. So, I usually disables the snapshot publishing jobs.",
        "createdAt" : "2021-04-15T16:37:09Z",
        "updatedAt" : "2021-04-16T10:40:31Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "b3c34f8b-b5c3-4020-92c8-83e2e9a1d529",
        "parentId" : "98e096ab-c4bb-4979-b1d1-43a5ec101dba",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Yeah, that's a problem. I will try to integrate with [\"action required\" status](https://docs.github.com/en/rest/guides/getting-started-with-the-checks-api#about-check-suites) of the checks in GitHub Actions (that allows us to link URLs with some guides) to guide users to explicitly enable workflows needed.\r\n\r\nThis workflow is okay because this one is supposed to run in the main repo but if users disable the main build job, it's a problem.\r\n\r\nFWIW, here is one example when a contributor did not enable the main build job: https://github.com/apache/spark/pull/32187",
        "createdAt" : "2021-04-15T16:40:54Z",
        "updatedAt" : "2021-04-16T10:40:31Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "480243cb6650e11d35fc3300e259144e476cb43a",
    "line" : 24,
    "diffHunk" : "@@ -1,1 +22,26 @@on:\n  schedule:\n  - cron: \"*/15 * * * *\"\n\njobs:"
  },
  {
    "id" : "43677465-ed3c-488f-a9a6-521aa6d42d47",
    "prId" : 32193,
    "prUrl" : "https://github.com/apache/spark/pull/32193#pullrequestreview-638131043",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "parentId" : null,
        "authorId" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "body" : "If I understand correct, the latest patch still not covers the case mentioned in https://github.com/HyukjinKwon/spark/pull/42#issuecomment-821023453 .\r\n\r\nWe need do a double check in here using [Get Pull Request](https://docs.github.com/en/rest/reference/pulls#get-a-pull-request), and check `current_pr.head.sha` == `pr.head.sha`, if not equal, we should use `current_pr.head.sha` as the `ref` input rather than `pr.head.sha` in current schedule job, or just skip current schedule status set job, let next scheduler refresh the status (also can avoid the status error on frequent commits case potentially).",
        "createdAt" : "2021-04-16T14:30:58Z",
        "updatedAt" : "2021-04-16T14:39:49Z",
        "lastEditedBy" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "tags" : [
        ]
      },
      {
        "id" : "312e7e6e-64fe-473e-b09b-1d5c644944ba",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "@Yikun, I think it does handle. The logic here only works if the specific sha has the status check. So as long as the status check has the matched link, it will work. If it doesn't, it will skip.",
        "createdAt" : "2021-04-16T15:01:11Z",
        "updatedAt" : "2021-04-16T15:01:12Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "3580bab0-4244-4e14-9070-1cfaf00dc7ed",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "body" : "> The logic here only works if the specific sha has the status check.\r\n\r\nemm, but old (not latest) commit (multi commits in one PR) still have valid check-runs, I just a little bit confusing how to ensure the commit is the latest?",
        "createdAt" : "2021-04-16T15:08:39Z",
        "updatedAt" : "2021-04-16T15:08:39Z",
        "lastEditedBy" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "tags" : [
        ]
      },
      {
        "id" : "b94e6874-4e1c-4a84-9c16-e89abe0ffb38",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "body" : "I mean the first commit triggers the first notify check, the second trigger the second notify check, there are two valid commits with check-runs. and then schedule job happened, the 3rd commit is coming between the schedule job.",
        "createdAt" : "2021-04-16T15:11:48Z",
        "updatedAt" : "2021-04-16T15:12:04Z",
        "lastEditedBy" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "tags" : [
        ]
      },
      {
        "id" : "97d7203a-8e20-4d43-9f43-8d00d43c68f4",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "If this specific pr.head.sha is not matched with the one from motify workflow, it will skip because the pr.head.sha wouldn't have a status check set from notify workflow.\r\n\r\nIf pr.head.sha has the status, the sha will always be matched (although it might not be the latest). The next run of the workflow in the main repo will handle the latest one.",
        "createdAt" : "2021-04-16T15:12:38Z",
        "updatedAt" : "2021-04-16T15:19:25Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "6cacea66-04d0-4b8a-b54f-49b7a118c195",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "So as long as a sha has the status check matched with the forked one (which is now guaranteed in the notify workflow),  it will keep matched.",
        "createdAt" : "2021-04-16T15:23:54Z",
        "updatedAt" : "2021-04-16T15:24:24Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "2bb62875-61be-42e6-b663-149631550c9c",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "In the seanrio you mentioned, the third commit will be skipped because it does not have a check run named \"Build and test\" set from notify workflow. If it has, the status will be updated coresspondingly.",
        "createdAt" : "2021-04-16T15:26:54Z",
        "updatedAt" : "2021-04-16T15:27:41Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "08f14999-c950-432f-9fc3-8120da31e9b6",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "body" : "OK, thanks for the detail explanatation, it make sense, and I also see the schedule job is less than 20s. If it still have the real problem, we will fix it when it happenes.",
        "createdAt" : "2021-04-16T15:28:40Z",
        "updatedAt" : "2021-04-16T15:28:40Z",
        "lastEditedBy" : "c13f1277-0254-494b-8e7a-bd7c261b2e9f",
        "tags" : [
        ]
      },
      {
        "id" : "8f930cf3-8bec-443f-864d-b9dec40b3cee",
        "parentId" : "64a794a2-a3a7-4138-8b50-48da931daf60",
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Thank you Yikun for very detailed review:)",
        "createdAt" : "2021-04-16T23:04:25Z",
        "updatedAt" : "2021-04-16T23:04:25Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "480243cb6650e11d35fc3300e259144e476cb43a",
    "line" : 56,
    "diffHunk" : "@@ -1,1 +54,58 @@                    owner: context.repo.owner,\n                    repo: context.repo.repo,\n                    ref: pr.head.sha\n                  })\n"
  },
  {
    "id" : "22807ae2-42c8-4f2b-97f4-8b89d810a485",
    "prId" : 32193,
    "prUrl" : "https://github.com/apache/spark/pull/32193#pullrequestreview-637798710",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ef450490-0dac-44ed-8cea-3a11b5987693",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "Note that here it gets the status of the workflow from the forked repository that is stored in the status check of the PR open in the main repo.",
        "createdAt" : "2021-04-16T15:06:11Z",
        "updatedAt" : "2021-04-16T15:06:11Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "480243cb6650e11d35fc3300e259144e476cb43a",
    "line" : 63,
    "diffHunk" : "@@ -1,1 +61,65 @@                    if (cr.name == 'Build and test') {\n                      // text contains parameters to make request in JSON.\n                      const params = JSON.parse(cr.output.text)\n\n                      // Get the workflow run in the forked repository"
  }
]