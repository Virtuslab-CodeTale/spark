[
  {
    "id" : "3fa1423f-2181-4f3c-b8cd-a4961e15b9d8",
    "prId" : 31071,
    "prUrl" : "https://github.com/apache/spark/pull/31071#pullrequestreview-563216063",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "f2dcc21b-a264-4941-819a-4f4a810ac5c3",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "If we have three case statements before this line, `t is null` and `t is not null and exit code is non-zero` and `t is not null and exist code is `zero` is covered. When we fall into here?",
        "createdAt" : "2021-01-06T21:13:36Z",
        "updatedAt" : "2021-01-07T22:03:43Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "5a66b84e-6c56-4edb-80f7-773521cd1963",
        "parentId" : "f2dcc21b-a264-4941-819a-4f4a810ac5c3",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "We shouldn't but this is to prevent the spurious \"non-exhaustive match\" warning.",
        "createdAt" : "2021-01-07T05:16:18Z",
        "updatedAt" : "2021-01-07T22:03:43Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "3d75c8ab-bd99-4db9-87ad-93764724146a",
        "parentId" : "f2dcc21b-a264-4941-819a-4f4a810ac5c3",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Oh, got it.",
        "createdAt" : "2021-01-07T05:17:49Z",
        "updatedAt" : "2021-01-07T22:03:43Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "86b09a6d3c04384b7dd9a0070bed45f0932cc190",
    "line" : 32,
    "diffHunk" : "@@ -1,1 +91,95 @@                  case 0 =>\n                    PodSucceeded(pod)\n                  case _ =>\n                    PodFailed(pod)\n                }"
  },
  {
    "id" : "5ca2d364-9762-4ccd-b3f1-eae682de8eeb",
    "prId" : 31071,
    "prUrl" : "https://github.com/apache/spark/pull/31071#pullrequestreview-563707005",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "d27260ee-c632-46d9-83dc-5a953e14a781",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "What about the following?\r\n```scala\r\nsparkContainerStatus.getState.getTerminated match {\r\n  case t if t != null and t.getExitCode != 0 =>\r\n    PodFailed(pod)\r\n  case t if t != null and t.getExitCode == 0 =>\r\n    PodSucceeded(pod)\r\n  case _ =>\r\n    PodRunning(pod)\r\n}\r\n```",
        "createdAt" : "2021-01-06T21:16:12Z",
        "updatedAt" : "2021-01-07T22:03:43Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "3963fad3-9e57-4759-94d6-15f2ed4de47a",
        "parentId" : "d27260ee-c632-46d9-83dc-5a953e14a781",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "Sure that would work to. Do you prefer this one?",
        "createdAt" : "2021-01-07T05:16:55Z",
        "updatedAt" : "2021-01-07T22:03:43Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "f83cd274-2109-4efe-9fc6-60a4fa8baa77",
        "parentId" : "d27260ee-c632-46d9-83dc-5a953e14a781",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Yes, I do because it's shorter. :)",
        "createdAt" : "2021-01-07T05:19:09Z",
        "updatedAt" : "2021-01-07T22:03:43Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "0abc18da-cf40-4448-95c3-51192eff4f99",
        "parentId" : "d27260ee-c632-46d9-83dc-5a953e14a781",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "I refactored this into using flatMaps so we can just pattern match on the result, WDYT?",
        "createdAt" : "2021-01-07T18:05:01Z",
        "updatedAt" : "2021-01-07T22:03:43Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      }
    ],
    "commit" : "86b09a6d3c04384b7dd9a0070bed45f0932cc190",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +93,97 @@                  case _ =>\n                    PodFailed(pod)\n                }\n              // No exit code means we are running.\n              case _ =>"
  },
  {
    "id" : "0611d523-8b5d-4ae9-98c4-98e0c1533a9e",
    "prId" : 30892,
    "prUrl" : "https://github.com/apache/spark/pull/30892#pullrequestreview-562025507",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1ee2dc1c-c29d-49e8-9621-95da8db8f409",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Sorry, but this seems to fail like the following in some cases. Could you check this once more, @holdenk ?\r\n```\r\ncontainerStatuses=[\r\nContainerStatus(\r\n  containerID=docker://...,\r\n  image=...,\r\n  imageID=..., \r\n  lastState=ContainerState(running=null, terminated=null, waiting=null, additionalProperties={}),\r\n  name=pod,\r\n  ready=true,\r\n  restartCount=0,\r\n  started=true,\r\n  state=ContainerState(running=ContainerStateRunning(startedAt=2021-01-03T10:25:24Z, additionalProperties={}), terminated=null, waiting=null, additionalProperties={}),\r\n  additionalProperties={}\r\n)\r\n]\r\n```",
        "createdAt" : "2021-01-03T10:41:48Z",
        "updatedAt" : "2021-01-03T10:41:59Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "c4f43810-5df6-4c64-9a36-b9e2e882a8c3",
        "parentId" : "1ee2dc1c-c29d-49e8-9621-95da8db8f409",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "That makes sense, we'll sometimes not have any status entries for the Spark container. I'll take out the logWarning since this is a more expected state in a follow up.",
        "createdAt" : "2021-01-05T17:58:15Z",
        "updatedAt" : "2021-01-05T17:58:36Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "63d988b1-6e64-411c-b5e5-c3de2a2ce8ee",
        "parentId" : "1ee2dc1c-c29d-49e8-9621-95da8db8f409",
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Thank you, @holdenk .",
        "createdAt" : "2021-01-05T18:21:45Z",
        "updatedAt" : "2021-01-05T18:21:45Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "85550c371fd41c02282766ef7638e496e894e99c",
    "line" : 43,
    "diffHunk" : "@@ -1,1 +83,87 @@            // Otherwise look for the Spark container\n            val sparkContainerStatusOpt = pod.getStatus.getContainerStatuses.asScala\n              .find(_.getName() == sparkContainerName)\n            sparkContainerStatusOpt match {\n              case Some(sparkContainerStatus) =>"
  },
  {
    "id" : "8515587a-c2c0-4cee-9cc1-81d6237a7336",
    "prId" : 30675,
    "prUrl" : "https://github.com/apache/spark/pull/30675#pullrequestreview-564311649",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "82c331d2-a521-46c3-990e-75d47c892542",
        "parentId" : null,
        "authorId" : "8c82da5a-f351-4a37-a8a9-13809311b07b",
        "body" : "Ah, so there is a no-argument constructor already (!) ðŸ‘ ",
        "createdAt" : "2021-01-08T15:27:11Z",
        "updatedAt" : "2021-01-09T19:40:55Z",
        "lastEditedBy" : "8c82da5a-f351-4a37-a8a9-13809311b07b",
        "tags" : [
        ]
      }
    ],
    "commit" : "a98bf364b8ccdfdc5abef4b4355e61c74c9f3802",
    "line" : 29,
    "diffHunk" : "@@ -1,1 +50,54 @@  }\n\n  def apply(): ExecutorPodsSnapshot = ExecutorPodsSnapshot(Map.empty[Long, ExecutorPodState], 0)\n\n  def setShouldCheckAllContainers(watchAllContainers: Boolean): Unit = {"
  },
  {
    "id" : "9909da58-cbf5-439a-8b94-76103b06f1ec",
    "prId" : 29924,
    "prUrl" : "https://github.com/apache/spark/pull/29924#pullrequestreview-507711705",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "7bbd4f8b-036d-49c8-8e7c-3a94a61afe2c",
        "parentId" : null,
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "Good addition :+1: ",
        "createdAt" : "2020-10-13T18:17:30Z",
        "updatedAt" : "2020-10-13T19:18:45Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      }
    ],
    "commit" : "a4958b9b99066e2c23c8cb5ba54b2cb5a9ae9a4d",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +67,71 @@        case \"running\" =>\n          if (shouldCheckAllContainers &&\n            \"Never\" == pod.getSpec.getRestartPolicy &&\n            pod.getStatus.getContainerStatuses.stream\n              .map[ContainerStateTerminated](cs => cs.getState.getTerminated)"
  },
  {
    "id" : "06f2086a-8712-43fa-acf1-8029a6d74981",
    "prId" : 25614,
    "prUrl" : "https://github.com/apache/spark/pull/25614#pullrequestreview-288974776",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "87c46ab3-880b-4154-a6e9-b79e129b9b75",
        "parentId" : null,
        "authorId" : "69f86a76-43b6-41a1-a955-7e68c926958c",
        "body" : "Can we add a test for this?",
        "createdAt" : "2019-08-30T05:09:45Z",
        "updatedAt" : "2019-09-09T17:02:57Z",
        "lastEditedBy" : "69f86a76-43b6-41a1-a955-7e68c926958c",
        "tags" : [
        ]
      },
      {
        "id" : "0c850b13-415d-4ba0-89b1-b0709e85c72b",
        "parentId" : "87c46ab3-880b-4154-a6e9-b79e129b9b75",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "Is the failedExecutorWithRuningSidecar bellow now what you're looking for?",
        "createdAt" : "2019-09-17T01:11:30Z",
        "updatedAt" : "2019-09-17T01:11:31Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      }
    ],
    "commit" : "b69ba8af1d5107806844510e1878b3813f1007aa",
    "line" : 18,
    "diffHunk" : "@@ -1,1 +64,68 @@          // TODO(SPARK-29023): Kubernenetes 1.17 sidecar container feature will\n          // make this code redundant https://github.com/kubernetes/enhancements/issues/753\n          // Checking executor container status is not terminated\n          // Pod status can still be running if sidecar container status is running\n          val executorContainerStatusCode = pod.getStatus.getContainerStatuses.asScala."
  },
  {
    "id" : "5bd054ba-4705-4c19-8b30-1aac95555fcf",
    "prId" : 25614,
    "prUrl" : "https://github.com/apache/spark/pull/25614#pullrequestreview-291274080",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "c50d5fec-7b1f-43c9-be20-14f15eb0010a",
        "parentId" : null,
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "Same comment as above. If the container name is generally enforced elsehwere that's ok but if we're depending on Spark being the only one to launch we should see if there is another filter we could do (maybe a tag)?",
        "createdAt" : "2019-09-09T15:43:45Z",
        "updatedAt" : "2019-09-09T17:02:57Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "d33b06d4-6373-4b38-b99f-0a4fbc0a6f11",
        "parentId" : "c50d5fec-7b1f-43c9-be20-14f15eb0010a",
        "authorId" : "74a83bdf-538c-45d9-952a-f97f442b197f",
        "body" : "I think you made a really good point, but as far as I know, there is no identifier of container expect the container name. maybe we have to force people use this default name.   ",
        "createdAt" : "2019-09-09T16:51:17Z",
        "updatedAt" : "2019-09-09T17:02:57Z",
        "lastEditedBy" : "74a83bdf-538c-45d9-952a-f97f442b197f",
        "tags" : [
        ]
      },
      {
        "id" : "a056ee2d-15ef-4b42-9406-9e9ab9330948",
        "parentId" : "c50d5fec-7b1f-43c9-be20-14f15eb0010a",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "Ok, this is probably a rare case but (for example) the Google K8s Spark folks launch their own containers I believe, so let's try and make not of this in the migration guide.",
        "createdAt" : "2019-09-17T01:05:13Z",
        "updatedAt" : "2019-09-17T01:05:13Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "bdc3ed55-825c-478d-aac9-b51deb8f9c5f",
        "parentId" : "c50d5fec-7b1f-43c9-be20-14f15eb0010a",
        "authorId" : "63281e91-e961-4e6e-b0bb-6855587910d1",
        "body" : "@holdenk @jinxingwang one idea is to introduce a conf option for the executor container name so it can be tracked in cluster mode in case it is modified by the pod template feature.",
        "createdAt" : "2019-09-19T10:43:31Z",
        "updatedAt" : "2019-09-19T10:44:09Z",
        "lastEditedBy" : "63281e91-e961-4e6e-b0bb-6855587910d1",
        "tags" : [
        ]
      },
      {
        "id" : "529e83e6-c4e6-4918-a387-7e096ec2db27",
        "parentId" : "c50d5fec-7b1f-43c9-be20-14f15eb0010a",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "That would be a cool, I think we can probably just mention it in the migration guide if we don't, but if we add setting for configuring the container name I'm good with that too.",
        "createdAt" : "2019-09-20T16:37:49Z",
        "updatedAt" : "2019-09-20T16:37:49Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      }
    ],
    "commit" : "b69ba8af1d5107806844510e1878b3813f1007aa",
    "line" : 21,
    "diffHunk" : "@@ -1,1 +67,71 @@          // Pod status can still be running if sidecar container status is running\n          val executorContainerStatusCode = pod.getStatus.getContainerStatuses.asScala.\n            filter(_.getName == DEFAULT_EXECUTOR_CONTAINER_NAME).\n            flatMap(c => Option(c.getState.getTerminated)).\n            map(_.getExitCode)."
  },
  {
    "id" : "fb67b677-6034-433b-85d1-af71ace7f02c",
    "prId" : 25614,
    "prUrl" : "https://github.com/apache/spark/pull/25614#pullrequestreview-291285692",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1ac391d8-d874-4742-96bb-315cab57e3f0",
        "parentId" : null,
        "authorId" : "63281e91-e961-4e6e-b0bb-6855587910d1",
        "body" : "What if the side car thing provides a service that we need eg. kerberos renewal, shouldnt we remove the executor pod asap and not wait for the Spark container error to happen? I think we should emit a log msg at least eg. \"Spark executor is running but pod is not healthy\". Or we could have a configurable property to allow removal if any container is failing. In addition, Pod restartPolicy is set to `Never` and the will be no recovery for the side car. I think we could provide a few more managements capabilities. Thoughts?",
        "createdAt" : "2019-09-19T10:56:12Z",
        "updatedAt" : "2019-09-19T10:57:49Z",
        "lastEditedBy" : "63281e91-e961-4e6e-b0bb-6855587910d1",
        "tags" : [
        ]
      },
      {
        "id" : "5180ee8f-e1ed-4c58-ada9-eb473b9bde3a",
        "parentId" : "1ac391d8-d874-4742-96bb-315cab57e3f0",
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "That's a good point. I don't know how often the sidecar is \"critical\" to keep running along side Spark so I'll defer to other's judgement here.",
        "createdAt" : "2019-09-20T16:40:00Z",
        "updatedAt" : "2019-09-20T16:40:01Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "6c38ac66-34a7-48fb-bf0e-1c99b766411d",
        "parentId" : "1ac391d8-d874-4742-96bb-315cab57e3f0",
        "authorId" : "74a83bdf-538c-45d9-952a-f97f442b197f",
        "body" : "The current state is if any container is running, the pod will keep running, so there is no case \"Spark executor is running but pod is not healthy\" but will happen \"pod is healthy but Spark executor container(or any sidecar container) is not running \"\r\nMy change made \"main(executor)\" container reflect on the pod status.\r\nYour point is very good, that other sidecar also should be healthy when they should be. My thoughts on it are, sidecars are not as critical as \"main\" container in some case, and should not necessary cause pod to restart all the time. so I will like it to happen is to let \"main(executor)\" container determine if a pod should be restarted. which should be main container error out when any of its sidecar container is not healthy. \r\nLet me know what you guys think. thanks.",
        "createdAt" : "2019-09-20T17:01:49Z",
        "updatedAt" : "2019-09-20T17:01:49Z",
        "lastEditedBy" : "74a83bdf-538c-45d9-952a-f97f442b197f",
        "tags" : [
        ]
      }
    ],
    "commit" : "b69ba8af1d5107806844510e1878b3813f1007aa",
    "line" : 19,
    "diffHunk" : "@@ -1,1 +65,69 @@          // make this code redundant https://github.com/kubernetes/enhancements/issues/753\n          // Checking executor container status is not terminated\n          // Pod status can still be running if sidecar container status is running\n          val executorContainerStatusCode = pod.getStatus.getContainerStatuses.asScala.\n            filter(_.getName == DEFAULT_EXECUTOR_CONTAINER_NAME)."
  }
]