[
  {
    "id" : "05dde993-79af-4032-b349-3aa51248fe74",
    "prId" : 30283,
    "prUrl" : "https://github.com/apache/spark/pull/30283#pullrequestreview-526804936",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "0d4fe6ad-4361-4054-be11-81a09932eaba",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "ditto. If possible, shall we follow the order and spacing in `master branch`.\r\n- https://github.com/apache/spark/blob/master/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/submit/LoggingPodStatusWatcher.scala#L45-L48",
        "createdAt" : "2020-11-09T23:51:25Z",
        "updatedAt" : "2020-11-20T01:49:22Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "fc930043-1e17-4624-b2c5-7cc6de21c150",
        "parentId" : "0d4fe6ad-4361-4054-be11-81a09932eaba",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "Done.",
        "createdAt" : "2020-11-10T02:26:11Z",
        "updatedAt" : "2020-11-20T01:49:22Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      }
    ],
    "commit" : "1c64c6cbdfd392be490f031c4599d786d831b9c2",
    "line" : 27,
    "diffHunk" : "@@ -1,1 +49,53 @@  extends LoggingPodStatusWatcher with Logging {\n\n  private var podCompleted = false\n\n  private var resourceTooOldReceived: Boolean = false"
  },
  {
    "id" : "c3ae6fda-5750-4b47-a68b-c2367f199bfc",
    "prId" : 30283,
    "prUrl" : "https://github.com/apache/spark/pull/30283#pullrequestreview-534999389",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "1cc66ac5-9b86-4cd0-a6af-59d144a0335c",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Instead of `${appId}`, the other branches seem to use `${conf.appName}`, don't they?",
        "createdAt" : "2020-11-15T04:13:51Z",
        "updatedAt" : "2020-11-20T01:49:22Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "2c24c190-c957-4ffe-aa34-4e7551ec3dbf",
        "parentId" : "1cc66ac5-9b86-4cd0-a6af-59d144a0335c",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "Reverted to appId per below.",
        "createdAt" : "2020-11-20T01:01:57Z",
        "updatedAt" : "2020-11-20T01:49:22Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      }
    ],
    "commit" : "1c64c6cbdfd392be490f031c4599d786d831b9c2",
    "line" : 111,
    "diffHunk" : "@@ -1,1 +210,214 @@    podCompleted\n  } else {\n    logInfo(s\"Deployed Spark application ${appId} with submission ID $sId into Kubernetes\")\n    // Always act like the application has completed since we don't want to wait for app completion\n    true"
  },
  {
    "id" : "625bc4f3-932e-447e-97a9-977668846a5c",
    "prId" : 30283,
    "prUrl" : "https://github.com/apache/spark/pull/30283#pullrequestreview-537785737",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "23aec484-c657-4abb-8e95-3ea12e5176fe",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "~Please revert this change. This is inconsistent with Apache Spark 3.1 and 3.0.~",
        "createdAt" : "2020-11-24T18:17:02Z",
        "updatedAt" : "2020-11-24T18:20:00Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "1c64c6cbdfd392be490f031c4599d786d831b9c2",
    "line" : 24,
    "diffHunk" : "@@ -1,1 +46,50 @@    appId: String,\n    maybeLoggingInterval: Option[Long],\n    waitForCompletion: Boolean)\n  extends LoggingPodStatusWatcher with Logging {\n"
  },
  {
    "id" : "90f2ac37-2832-4892-8088-b006a5de0046",
    "prId" : 29496,
    "prUrl" : "https://github.com/apache/spark/pull/29496#pullrequestreview-522596813",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "parentId" : null,
        "authorId" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "body" : "@jkleckner \r\n\r\nThis line is different in the `master` branch. It checks whether the client was set to wait for the completion of the driver, not simply checking `hasCompleted()`, which should normally return false - causing `spark-submit` to terminate immediately. \r\n\r\nFor `2.4.7` port you may want to add additional parameter to the `LoggingPodStatusWatcherImpl`, specifically `waitForCompletion: Boolean`, that can be checked in this if statement. In current master they are using `KubernetesDriverConf` instead of passing parameters separately: https://github.com/apache/spark/blob/5e6173ebefcbf3d85ba10234b35fe043f8497d32/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/submit/LoggingPodStatusWatcher.scala#L40. \r\n\r\nHowever in `2.4.6`, `KubernetesDriverConf` is not yet introduced, and instead the `appId` and `maybeLoggingInterval` are passed individually. Simple solution is to add `waitForCompletion` as a parameter, and use it in the above if statement. \r\n\r\nThis has worked well for me. ",
        "createdAt" : "2020-09-02T16:27:55Z",
        "updatedAt" : "2020-09-02T16:29:05Z",
        "lastEditedBy" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "tags" : [
        ]
      },
      {
        "id" : "a49cdba8-7645-49c9-b5f0-7204822a76e3",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "@shockdm  Yes, you are right.  And it is great that you have it working!\r\nWe're happy to make the change but would you mind sharing the code so as to be consistent with what you already have?",
        "createdAt" : "2020-09-03T02:28:14Z",
        "updatedAt" : "2020-09-03T02:28:14Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      },
      {
        "id" : "8e847cb1-dd71-4593-9438-e1948c0588af",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "@shockdm ping",
        "createdAt" : "2020-09-11T16:07:35Z",
        "updatedAt" : "2020-09-11T16:07:36Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      },
      {
        "id" : "17cdf391-8957-4b03-b06f-7fd60c0aaddf",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "body" : "@jkleckner sorry, spent some time doing test runs to make sure it fixed our use case. I'll share the final code shortly.",
        "createdAt" : "2020-09-12T03:22:58Z",
        "updatedAt" : "2020-09-12T03:22:58Z",
        "lastEditedBy" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "tags" : [
        ]
      },
      {
        "id" : "d2e3bef2-f5ae-4f89-9078-87f1a3c80660",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "@shockdm ping",
        "createdAt" : "2020-09-25T17:34:40Z",
        "updatedAt" : "2020-09-25T17:34:40Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      },
      {
        "id" : "228d4afc-4ca0-44f8-96bc-767d11679e4e",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "body" : "@jkleckner Thank you for the reminder, and sorry for the delay! Check out https://github.com/shockdm/spark/pull/1",
        "createdAt" : "2020-09-25T19:56:37Z",
        "updatedAt" : "2020-09-25T19:56:37Z",
        "lastEditedBy" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "tags" : [
        ]
      },
      {
        "id" : "946a746a-6635-4de1-8891-988096b30c93",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "Your patches look like an improvement, thank you @shockdm.\r\nThere are enough differences that perhaps you might be willing to submit them?",
        "createdAt" : "2020-09-26T01:01:38Z",
        "updatedAt" : "2020-09-26T01:01:39Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      },
      {
        "id" : "75a7f636-b449-49b0-bd18-6f57fbb2d27e",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "body" : "With the original comment by @dongjoon-hyun:\r\n\r\n> Thank you for making a backporting PR, @jkleckner .\r\nCould you make a backporting PR to branch-3.0 first?\r\nTo prevent any regression from 2.4 to 3.0, we have a policy for backporting sequence. We cannot backport this to branch-2.4 directly.\r\n\r\nWhat would be the correct approach to submit this backport atm?",
        "createdAt" : "2020-09-28T12:22:00Z",
        "updatedAt" : "2020-09-28T12:22:00Z",
        "lastEditedBy" : "bc0a2820-3d2d-48c4-a6f7-5a1c89666577",
        "tags" : [
        ]
      },
      {
        "id" : "cf9cebc9-ad5c-4f27-a7a6-68d6bb89ecc4",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "@dongjoon-hyun Is the merging or the submitting of a PR to branch-3.0 a pre-requisite to submitting this PR or an improved PR?\r\n\r\nNote that the implementations inherently diverge due to the divergence of the base branches.",
        "createdAt" : "2020-09-28T16:52:22Z",
        "updatedAt" : "2020-09-28T16:52:22Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      },
      {
        "id" : "94c69e97-f062-4ad1-af09-acea05e035f9",
        "parentId" : "35f3234b-620b-41fa-8435-7fb5c42e316b",
        "authorId" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "body" : "@shockdm The 3.0 patch #29533 has now been merged.  Even though we never got an answer whether that was a prerequisite, that blockage is now gone.\r\n\r\nWould you be willing to rebase and clean up your patch for submission?",
        "createdAt" : "2020-11-03T15:13:59Z",
        "updatedAt" : "2020-11-03T15:13:59Z",
        "lastEditedBy" : "616a44bb-2bcb-45fb-8f40-13f498f69117",
        "tags" : [
        ]
      }
    ],
    "commit" : "601c820066b90df9308aefcbce012e3757c634a7",
    "line" : 55,
    "diffHunk" : "@@ -1,1 +190,194 @@  }\n\n  override def watchOrStop(sId: String): Boolean = if (hasCompleted()) {\n    logInfo(s\"Waiting for application ${appId} with submission ID $sId to finish...\")\n    val interval = maybeLoggingInterval"
  }
]