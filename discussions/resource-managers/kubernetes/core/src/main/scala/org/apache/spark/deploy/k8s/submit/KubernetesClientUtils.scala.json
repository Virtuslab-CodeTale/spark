[
  {
    "id" : "41911a66-db74-41e1-81c1-f8e63343d81b",
    "prId" : 30472,
    "prUrl" : "https://github.com/apache/spark/pull/30472#pullrequestreview-560271417",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "ed0e8e05-a448-4520-ba62-87a65c44155a",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "This seems to introduce a bug because we will consider file name later by `truncatedMapSize = truncatedMapSize + (fileName.length + fileContent.length)`. Please see [this comment](https://github.com/apache/spark/pull/30472#discussion_r550364758).\r\n```scala\r\nscala> Seq(\"b\" -> 1, \"abcdef\" -> 1).sortBy(f => f._1).sortBy(f => f._2)\r\nres14: Seq[(String, Int)] = List((abcdef,1), (b,1))\r\n\r\nscala> Seq(\"b\" -> 1, \"abcdef\" -> 1).sortBy(f => f._1).sortBy(f => f._2).map(f => f._1.length + f._2)\r\nres15: Seq[Int] = List(7, 2)\r\n```",
        "createdAt" : "2020-12-31T00:32:27Z",
        "updatedAt" : "2021-01-06T05:10:00Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "e36d0840-a9ac-484f-a9a3-fc2c1807df0c",
        "parentId" : "ed0e8e05-a448-4520-ba62-87a65c44155a",
        "authorId" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "body" : "Values are actually sum total of the size of filename and it's content. Two items with same size (i.e. `\"b\" ->10 and \"abcdef\" ->10` ) would mean, that if first one did not fit, next one won't fit either. Anyway, I have addressed it, by -- update the `truncateMapSize` iff `truncateMap` is updated.",
        "createdAt" : "2020-12-31T06:17:38Z",
        "updatedAt" : "2021-01-06T05:10:00Z",
        "lastEditedBy" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "tags" : [
        ]
      }
    ],
    "commit" : "a42f82d40337a3b171196e6a97b9f76c8977a08b",
    "line" : 40,
    "diffHunk" : "@@ -1,1 +98,102 @@    val fileToFileSizePairs = confFiles.map(f => (f, f.getName.length + f.length()))\n    // sort first by name and then by length, so that during tests we have consistent results.\n    fileToFileSizePairs.sortBy(f => f._1).sortBy(f => f._2).map(_._1)\n  }\n"
  },
  {
    "id" : "7a265e43-9238-4da6-b368-8f61fe69c81d",
    "prId" : 30472,
    "prUrl" : "https://github.com/apache/spark/pull/30472#pullrequestreview-560273426",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "57aaa63e-1a0e-48d6-aedf-f65ccdac6ae0",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "In `else`, we should reduce `truncatedMapSize` back because the next file can have a shorter name.\r\n\r\nIn case of `MalformedInputException`, we already has the same logic.",
        "createdAt" : "2020-12-31T00:33:04Z",
        "updatedAt" : "2021-01-06T05:10:00Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "5acf73b2-1b41-41fa-81df-b9d630db2cd3",
        "parentId" : "57aaa63e-1a0e-48d6-aedf-f65ccdac6ae0",
        "authorId" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "body" : "Now, we increment the size, only when the map is updated.",
        "createdAt" : "2020-12-31T06:32:56Z",
        "updatedAt" : "2021-01-06T05:10:00Z",
        "lastEditedBy" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "tags" : [
        ]
      }
    ],
    "commit" : "a42f82d40337a3b171196e6a97b9f76c8977a08b",
    "line" : 70,
    "diffHunk" : "@@ -1,1 +120,124 @@            truncatedMap.put(fileName, fileContent)\n            truncatedMapSize = truncatedMapSize + (fileName.length + fileContent.length)\n          } else {\n            skippedFiles.add(fileName)\n          }"
  },
  {
    "id" : "491a8bcb-5ee5-4ddc-83de-da4337009c42",
    "prId" : 30472,
    "prUrl" : "https://github.com/apache/spark/pull/30472#pullrequestreview-560237273",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dabc857e-ad92-4530-8d5d-701817f0ae7e",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "`testIfTooLargeOrBinary` looks misleading because it doesn't include `f.getName.matches(\".*\\\\.template\") || f.getName.matches(\"spark.*(conf|properties)\")`.",
        "createdAt" : "2020-12-31T00:37:26Z",
        "updatedAt" : "2021-01-06T05:10:00Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      }
    ],
    "commit" : "a42f82d40337a3b171196e6a97b9f76c8977a08b",
    "line" : 103,
    "diffHunk" : "@@ -1,1 +150,154 @@    // and configMaps do not allow for size greater than 1.5 MiB(configurable).\n    // https://etcd.io/docs/v3.4.0/dev-guide/limit/\n    def testIfTooLargeOrBinary(f: File): Boolean = (f.length() + f.getName.length > maxSize) ||\n      f.getName.matches(\".*\\\\.(gz|zip|jar|tar)\")\n"
  },
  {
    "id" : "59c40f57-999d-48ca-b9a7-e13e51586fa7",
    "prId" : 27735,
    "prUrl" : "https://github.com/apache/spark/pull/27735#pullrequestreview-518396840",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "507bcd6d-2bf6-4b15-9d77-2e9234a77621",
        "parentId" : null,
        "authorId" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "body" : "Why is this seperate from KubernetesUtils?",
        "createdAt" : "2020-10-24T17:18:17Z",
        "updatedAt" : "2020-11-16T06:49:36Z",
        "lastEditedBy" : "ae55b635-dd0e-41aa-9272-372de9a35f38",
        "tags" : [
        ]
      },
      {
        "id" : "369ecb7d-2614-488f-a7cb-89e9f8912bfb",
        "parentId" : "507bcd6d-2bf6-4b15-9d77-2e9234a77621",
        "authorId" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "body" : "Hi @holdenk , thank you for taking a look. \r\nI can go ahead and merge this with `KubernetesUtils`, I have kept it separate as `KubernetesUtils` has already grown up a bit and the helper functions here are mostly the one used by `KubernetesClientApplication` or the `submit` package. I do not have a strong opinion, that this should stay separate and it should be named `KubernetesClientUtils`. \r\nWhat do you think? Shall I just go ahead and merge this, with KubernetesUtils ? any other suggestion?",
        "createdAt" : "2020-10-28T07:53:10Z",
        "updatedAt" : "2020-11-16T06:49:36Z",
        "lastEditedBy" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "tags" : [
        ]
      },
      {
        "id" : "d7575d0b-a1dd-41d7-8912-c1ad05eb7b64",
        "parentId" : "507bcd6d-2bf6-4b15-9d77-2e9234a77621",
        "authorId" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "body" : "Some of the functions are also used by `MountConfDirExecutorFeatureStep` .",
        "createdAt" : "2020-10-28T07:54:55Z",
        "updatedAt" : "2020-11-16T06:49:36Z",
        "lastEditedBy" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "tags" : [
        ]
      }
    ],
    "commit" : "ba93111b8ccfc7958e4facf57280a7c980beed84",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +31,35 @@import org.apache.spark.internal.Logging\n\nprivate[spark] object KubernetesClientUtils extends Logging {\n\n  // Config map name can be 63 chars at max."
  },
  {
    "id" : "affb1a97-4342-4ad1-b0eb-95e0575610fa",
    "prId" : 27735,
    "prUrl" : "https://github.com/apache/spark/pull/27735#pullrequestreview-524929908",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "265149c3-c842-4af3-b2eb-afa13a318a59",
        "parentId" : null,
        "authorId" : "7694af3d-5af2-4788-8413-c0558915c452",
        "body" : "Then, why don't we use `54` instead of `50`? `54` will reduce the chance of name conflict than `50`.\r\n```\r\nscala> 63 - \"-conf-map\".length\r\nres2: Int = 54\r\n```",
        "createdAt" : "2020-11-05T21:28:23Z",
        "updatedAt" : "2020-11-16T06:49:36Z",
        "lastEditedBy" : "7694af3d-5af2-4788-8413-c0558915c452",
        "tags" : [
        ]
      },
      {
        "id" : "580729a1-6016-431c-ba9f-43ce41b289f0",
        "parentId" : "265149c3-c842-4af3-b2eb-afa13a318a59",
        "authorId" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "body" : "Yeah, good point. ",
        "createdAt" : "2020-11-06T08:07:46Z",
        "updatedAt" : "2020-11-16T06:49:36Z",
        "lastEditedBy" : "79d368bd-8aec-43ce-bcd3-764c21bb93d5",
        "tags" : [
        ]
      }
    ],
    "commit" : "ba93111b8ccfc7958e4facf57280a7c980beed84",
    "line" : 35,
    "diffHunk" : "@@ -1,1 +33,37 @@private[spark] object KubernetesClientUtils extends Logging {\n\n  // Config map name can be 63 chars at max.\n  def configMapName(prefix: String): String = s\"${prefix.take(54)}-conf-map\"\n"
  }
]