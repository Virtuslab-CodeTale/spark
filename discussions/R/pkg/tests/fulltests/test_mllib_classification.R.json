[
  {
    "id" : "3e7c701e-e236-40b0-9f67-aea2d34d5b72",
    "prId" : 28907,
    "prUrl" : "https://github.com/apache/spark/pull/28907#pullrequestreview-435699455",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "79df1132-bf91-4763-8c79-b7b6d5c2f8b6",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "It suppresses:\r\n\r\n```\r\ntest_mllib_classification.R:258: error: spark.logit\r\n(converted from warning) the condition has length > 1 and only the first element will be used\r\nBacktrace:\r\n 1. SparkR::spark.logit(...) tests/fulltests/test_mllib_classification.R:258:2\r\n 2. SparkR::spark.logit(...)\r\n```",
        "createdAt" : "2020-06-23T11:44:34Z",
        "updatedAt" : "2020-06-24T01:19:20Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      }
    ],
    "commit" : "14886cb5f1f5ecffd8b865d99ebdc76301bf8713",
    "line" : 47,
    "diffHunk" : "@@ -1,1 +269,273 @@  # and lowerBoundsOnIntercepts\n  l <- matrix(c(0.0, -1.0, 0.0, -1.0, 0.0, -1.0, 0.0, -1.0), nrow = 2, ncol = 4)\n  model <- suppressWarnings(spark.logit(training, Species ~ ., family = \"multinomial\",\n                                        lowerBoundsOnCoefficients = l,\n                                        lowerBoundsOnIntercepts = as.array(c(0.0, 0.0))))"
  },
  {
    "id" : "b94adfde-8fe1-4849-b306-278577e0adcc",
    "prId" : 28907,
    "prUrl" : "https://github.com/apache/spark/pull/28907#pullrequestreview-435862170",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "475799fd-beab-47de-988b-5e2c174792ad",
        "parentId" : null,
        "authorId" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "body" : "> matrix objects now also inherit from class \"array\", so e.g., class(diag(1)) is c(\"matrix\", \"array\"). This invalidates code incorrectly assuming that class(matrix_obj)) has length one.\r\n\r\nhttps://cran.r-project.org/doc/manuals/r-devel/NEWS.html",
        "createdAt" : "2020-06-23T11:45:08Z",
        "updatedAt" : "2020-06-24T01:19:20Z",
        "lastEditedBy" : "5e07d5ab-b4b3-41e4-beca-fefd635980c6",
        "tags" : [
        ]
      },
      {
        "id" : "c1664d28-16fa-4c1e-bb21-9467ee9d3ab4",
        "parentId" : "475799fd-beab-47de-988b-5e2c174792ad",
        "authorId" : "f4bc734b-cbc3-43df-b666-2332624deed4",
        "body" : "Thanks! This also reminds me that it'll be great to test on r-devel (which I guess is 4.0.3 right now)",
        "createdAt" : "2020-06-23T14:51:10Z",
        "updatedAt" : "2020-06-24T01:19:21Z",
        "lastEditedBy" : "f4bc734b-cbc3-43df-b666-2332624deed4",
        "tags" : [
        ]
      }
    ],
    "commit" : "14886cb5f1f5ecffd8b865d99ebdc76301bf8713",
    "line" : 14,
    "diffHunk" : "@@ -1,1 +131,135 @@\n  # test summary coefficients return matrix type\n  expect_true(any(class(summary$coefficients) == \"matrix\"))\n  expect_true(class(summary$coefficients[, 1]) == \"numeric\")\n"
  },
  {
    "id" : "65b171bc-68db-41f6-8cd7-0f2bc35a37f5",
    "prId" : 27570,
    "prUrl" : "https://github.com/apache/spark/pull/27570#pullrequestreview-360018467",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "e8f0e605-0769-4e25-b1cb-5b464ec62367",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : " Can we also check the predict result here?",
        "createdAt" : "2020-02-16T07:12:25Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      },
      {
        "id" : "95fbbee2-1bd0-4452-bcd0-7b7ff370ba73",
        "parentId" : "e8f0e605-0769-4e25-b1cb-5b464ec62367",
        "authorId" : "981b170c-729a-429c-b115-0350ea50b32b",
        "body" : "I am not sure if such check are really useful here. In practice fitting is not unlikely failure point and most likely problems are related to parameter passing.",
        "createdAt" : "2020-02-16T10:58:29Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "981b170c-729a-429c-b115-0350ea50b32b",
        "tags" : [
        ]
      },
      {
        "id" : "693a7f96-b153-467b-992a-dcfb8565833f",
        "parentId" : "e8f0e605-0769-4e25-b1cb-5b464ec62367",
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "I looked other classification tests. It seems other tests checked the ```typeof``` and result of the prediction.  I guess it might be better to be consistent with other tests?",
        "createdAt" : "2020-02-17T23:43:42Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      },
      {
        "id" : "774fcd60-0f73-44c2-8c1c-de22d9b5512a",
        "parentId" : "e8f0e605-0769-4e25-b1cb-5b464ec62367",
        "authorId" : "981b170c-729a-429c-b115-0350ea50b32b",
        "body" : "`typeof` is not applicable here.  `typeof` is S compatibility thingy, and can be used only to distinguish between core types (here it could only determine if value is S4 type). ",
        "createdAt" : "2020-02-18T00:55:02Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "981b170c-729a-429c-b115-0350ea50b32b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7126bbffd87295dd3011616aa5e363cdcb02198f",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +501,505 @@\n  prediction1 <- predict(model1, df)\n  expect_is(prediction1, \"SparkDataFrame\")\n  expect_equal(summary(model1)$factorSize, 3)\n"
  },
  {
    "id" : "56e35db6-170f-40b2-bc11-9cef3dd6c601",
    "prId" : 27570,
    "prUrl" : "https://github.com/apache/spark/pull/27570#pullrequestreview-362128689",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "cb37269b-b994-47f5-b96f-ac01977bf8ac",
        "parentId" : null,
        "authorId" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "body" : "Out of curiosity, why this check? ",
        "createdAt" : "2020-02-20T14:35:38Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "707cf6e1-750c-4aea-8774-f79c13fb7add",
        "tags" : [
        ]
      },
      {
        "id" : "4de0ac42-b451-4d70-bebe-1903e0c1b3c0",
        "parentId" : "cb37269b-b994-47f5-b96f-ac01977bf8ac",
        "authorId" : "981b170c-729a-429c-b115-0350ea50b32b",
        "body" : "This is used to avoid failures in case of missing `winutils`. If i recall correctly the primary target was CRAN tests (and these shouldn't run here anyway), but I think it still applicable to AppVeyor.",
        "createdAt" : "2020-02-20T18:22:03Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "981b170c-729a-429c-b115-0350ea50b32b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7126bbffd87295dd3011616aa5e363cdcb02198f",
    "line" : 20,
    "diffHunk" : "@@ -1,1 +505,509 @@\n  # Test model save/load\n  if (windows_with_hadoop()) {\n    modelPath <- tempfile(pattern = \"spark-fmclassifier\", fileext = \".tmp\")\n    write.ml(model1, modelPath)"
  },
  {
    "id" : "f9235fb9-d6d6-4ef1-b14c-bcf4715813f6",
    "prId" : 27570,
    "prUrl" : "https://github.com/apache/spark/pull/27570#pullrequestreview-387781057",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "a2046b2f-0e5a-43ac-a593-364b413aa93f",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "Seems to me that all the other ML R tests check the prediction result. For example, in LinearSVM, \r\n```\r\n  # Test prediction with string label\r\n  prediction <- predict(model, training)\r\n  expect_equal(typeof(take(select(prediction, \"prediction\"), 1)$prediction), \"character\")\r\n  expected <- c(\"versicolor\", \"versicolor\", \"versicolor\", \"virginica\",  \"virginica\",\r\n                \"virginica\",  \"virginica\",  \"virginica\",  \"virginica\",  \"virginica\")\r\n  expect_equal(sort(as.list(take(select(prediction, \"prediction\"), 10))[[1]]), expected)\r\n```\r\nIs it OK if we do something similar here? \r\n\r\n",
        "createdAt" : "2020-03-02T16:41:13Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      },
      {
        "id" : "968889c4-6e4f-43c6-aa11-bd4d8932417a",
        "parentId" : "a2046b2f-0e5a-43ac-a593-364b413aa93f",
        "authorId" : "981b170c-729a-429c-b115-0350ea50b32b",
        "body" : "Sure we can. The question is what we are really trying to test in such cases? What types of implementation mistakes can we detect here, that are not already covered by JVM tests and / or SparkR data frames tests?\r\n\r\nThese checks involve additional jobs and many tests are already rejected to keep things manageable, so unless these serve specific purpose, I'd prefer to keep things lean here.\r\n\r\nIn contrast there are many SparkR ML failure modes that are real, and could be tested, but are crippled by lack of required API. But that's way beyond the scope of this PR.",
        "createdAt" : "2020-03-03T15:30:14Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "981b170c-729a-429c-b115-0350ea50b32b",
        "tags" : [
        ]
      },
      {
        "id" : "0654166c-571d-4c72-ac7f-90f607515271",
        "parentId" : "a2046b2f-0e5a-43ac-a593-364b413aa93f",
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "I am OK with this. ",
        "createdAt" : "2020-04-05T04:48:03Z",
        "updatedAt" : "2020-04-05T04:48:03Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7126bbffd87295dd3011616aa5e363cdcb02198f",
    "line" : 16,
    "diffHunk" : "@@ -1,1 +501,505 @@\n  prediction1 <- predict(model1, df)\n  expect_is(prediction1, \"SparkDataFrame\")\n  expect_equal(summary(model1)$factorSize, 3)\n"
  },
  {
    "id" : "b3738e73-f69d-4998-81c5-4079db163635",
    "prId" : 27570,
    "prUrl" : "https://github.com/apache/spark/pull/27570#pullrequestreview-387768096",
    "prSource" : "GitHub",
    "comments" : [
      {
        "id" : "dac6d1ae-c04d-4236-b74c-695f2bdec72d",
        "parentId" : null,
        "authorId" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "body" : "add ```unlink(modelPath)``` to delete the dir \r\n\r\nAlso, I prefer to follow what the other tests do for testing model save and load: checking if the loaded model has the same fields as the saved model. In scala test, we do this for ```FMClassifier```:\r\n```\r\n      assert(model.intercept === model2.intercept)\r\n      assert(model.linear.toArray === model2.linear.toArray)\r\n      assert(model.factors.toArray === model2.factors.toArray)\r\n      assert(model.numFeatures === model2.numFeatures)\r\n```\r\nIn LinearSVM R test, it does this:\r\n```\r\n    coefs <- summary(model)$coefficients\r\n    coefs2 <- summary(model2)$coefficients\r\n    expect_equal(coefs, coefs2)\r\n```\r\nIs it OK we do something similar?\r\n",
        "createdAt" : "2020-03-02T16:53:14Z",
        "updatedAt" : "2020-04-04T23:34:49Z",
        "lastEditedBy" : "99765afe-8dbe-4d5f-9ad3-d5bc40f0462b",
        "tags" : [
        ]
      },
      {
        "id" : "0b2ed7bb-497d-4f59-8708-f5a50d66d5b0",
        "parentId" : "dac6d1ae-c04d-4236-b74c-695f2bdec72d",
        "authorId" : "981b170c-729a-429c-b115-0350ea50b32b",
        "body" : "> Also, I prefer to follow what the other tests do for testing model save and load: checking if the loaded model has the same fields as the saved model. \r\n\r\nW test if summaries are equal\r\n\r\n```\r\n    expect_equal(summary(model1), summary(model2))\r\n```\r\n\r\nso that should cover things.",
        "createdAt" : "2020-04-04T23:51:03Z",
        "updatedAt" : "2020-04-04T23:51:04Z",
        "lastEditedBy" : "981b170c-729a-429c-b115-0350ea50b32b",
        "tags" : [
        ]
      }
    ],
    "commit" : "7126bbffd87295dd3011616aa5e363cdcb02198f",
    "line" : 33,
    "diffHunk" : "@@ -1,1 +518,522 @@      collect(drop(prediction1, c(\"rawPrediction\", \"probability\"))),\n      collect(drop(prediction2, c(\"rawPrediction\", \"probability\")))\n    )\n    unlink(modelPath)\n  }"
  }
]